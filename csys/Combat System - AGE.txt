th u(NEWCOBJ,Adaptive Game Engine Combat System <AGE>,age,,,,WIZARD SAFE !NO_COMMAND,INHERIT SIDEFX SAFE)
th u(NEWCOBJ,Adaptive Game Engine Database <AGEDB>,agedb,,age,1,WIZARD SAFE !NO_COMMAND,INHERIT SIDEFX SAFE)

&ISADMIN [u(cobj,age)]=cor(u(parent(%!)/isadmin,%0),u(tester,%0))

&SYSTEM`SWITCHES [u(cobj,age)]=setunion(u(%q<sysname>`%q<command>`PLAYER),if(cor(u(isadmin,%#),u(tester,%#)),u(%q<sysname>`%q<command>`ADMIN)),|,|)
&SYSTEM`NAME [u(cobj,age)]=u(strfirstof,%q<sysname>,COMBAT)
&SYSTEM`COLORS [u(cobj,age)]=COMBAT
&SYSTEM`OPTIONS [u(cobj,age)]=COMBAT

&FUN`VERSION [u(cobj,age)]=default(%#/D`CSYS`VERSION,1)

@lock/use [u(cobj,age)]=FUN`VERSION/1

&INC`EANNOUNCE [u(cobj,age)]=@attach %!/INC`MSG`ROOM=[ansi(90,COMBAT:)]%B[ansi(117,%0:)]%B%1,,,,,1
&INC`ANNOUNCE [u(Cobj,age)]=@attach %!/INC`MSG`ROOM=[ansi(90,COMBAT:)]%B%0,,,,,1
&INC`EPRIVATE [u(cobj,age)]=@attach %!/INC`MSG=[ansi(90,COMBAT:)]%B[ansi(117,%0:)]%B%1,%2,,,1
&INC`PRIVATE [u(cobj,age)]=@attach %!/INC`MSG=[ansi(90,COMBAT:)]%B%0,%1,,,1
&INC`DEBUG [u(cobj,age)]=@select/inline words(u(setr,testlist,u(filter,TESTER,lplayers(%l))))=>0,{@attach %!/INC`MSG`ROOM=[ansi(90,DEBUG:)][ansi(117,%0:)]%B%1,%q<testlist>,,,,1};


@@ -- Section for AGE Config.

&INC`VALID`ADJECTIVE [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Adjective entered!;@select/inline isint(%0)=1,{@attach %!/INC`VALID`INT},0,{@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/ADJECTIVES),|,value};th u(setq,valueformat,%q<value>);

&CMD`AGE [u(cobj,age)]=$^(?s)\+(ageconfig)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:@check cor(hasflag(%#,WIZARD),cor(u(isadmin,%#),u(tester,%#)))=@attach %!/INC`MSG=ERROR: Permission denied.;th u(setq,command,%1);th u(setq,sysname,AGE);@attach %!/INC`GETSWITCH=%2;@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`%q<sysname>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4,%5
@set [u(cobj,age)]/CMD`AGE=regexp

&AGE`AGECONFIG`PLAYER [u(cobj,age)]=
&AGE`AGECONFIG`ADMIN [u(cobj,age)]=ADJECTIVE|DRIVE|WEIGHT|STAT|ATTACK|ARCHETYPE

&INC`AGE`MAIN [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`MAIN`DISPLAY},{@attach %!/INC`AGE`MAIN`SET}

&INC`AGE`MAIN`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Core Values);@dolist/inline/delimit | [get(u(cobj,agedb)/CORES)]={@pemit %#=%i0: [default(u(cobj,agedb)/CORE`%i0`CUSTOM,u(cobj,agedb)/CORE`%i0,??)]};@pemit %#=u(footer)

&INC`AGE`MAIN`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/CORES),|,Core;@attach %!/INC`VALID`NUMBER=%2;&CORE`%q<CORE>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set AGE %q<core> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set AGE Core '%q<core>' To: %q<value>

&CORES [u(cobj,agedb)]=BALANCE|NORMALIZE|BASEDAMAGE|FUDGESCATTER|SCATTER

&CORE`BALANCE [u(cobj,agedb)]=2
&CORE`NORMALIZE [u(cobj,agedb)]=1.3
&CORE`BASEDAMAGE [u(cobj,agedb)]=120
&CORE`FUDGESCATTER [u(cobj,agedb)]=5
&CORE`SCATTER [u(cobj,agedb)]=10

&INC`AGE`ADJECTIVE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ADJECTIVE`DISPLAY},{@attach %!/INC`AGE`ADJECTIVE`SET}

&INC`AGE`ADJECTIVE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Adjectives);@dolist/inline/delimit | [get(u(cobj,agedb)/ADJECTIVES)]={@pemit %#=%i0: [default(u(cobj,agedb)/ADJECTIVES`%i0`CUSTOM,u(cobj,agedb)/ADJECTIVES`%i0,??)]};@pemit %#=u(footer)

&INC`AGE`ADJECTIVE`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/ADJECTIVES),|,Adjective;@attach %!/INC`VALID`INT=%2;&ADJECTIVES`%q<adjective>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set %q<adjective> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Adjective '%q<adjective>' To: %q<value>

&ADJECTIVES [u(cobj,agedb)]=Minor|Moderate|Solid|Significant|Major|Superior|Massive|Extreme

&ADJECTIVES`MINOR [u(cobj,agedb)]=3
&ADJECTIVES`MODERATE [u(cobj,agedb)]=6
&ADJECTIVES`SOLID [u(cobj,agedb)]=9
&ADJECTIVES`SIGNIFICANT [u(cobj,agedb)]=12
&ADJECTIVES`MAJOR [u(cobj,agedb)]=15
&ADJECTIVES`SUPERIOR [u(cobj,agedb)]=20
&ADJECTIVES`MASSIVE [u(cobj,agedb)]=25
&ADJECTIVES`EXTREME [u(cobj,agedb)]=30

&ADJ [u(cobj,age)]=if(isnum(%0),%0,get(u(cobj,agedb)/ADJECTIVES`%0))

&ADJINC [u(cobj,age)]=localize([u(setq,total,add(%1,match(u(setr,adj,get(u(cobj,agedb)/ADJECTIVES)),%0,|)))][switch(%q<total>,<1,0,>8,Extreme,elements(%q<adj>,%q<total>,|))])

&CUST [u(cobj,age)]=u(strfirstof,get(u(cobj,agedb)/%0`%1`CUSTOM),get(u(cobj,agedb)/%0`%1))

&PERCENTAGES`TINY [u(cobj,agedb)]=1
&PERCENTAGES`SMALL [u(cobj,agedb)]=2
&PERCENTAGES`STANDARD [u(cobj,agedb)]=3
&PERCENTAGES`CONSIDERABLE [u(cobj,agedb)]=4
&PERCENTAGES`SUBSTANTIAL [u(cobj,agedb)]=5
&PERCENTAGES`OVERWHELMING [u(cobj,agedb)]=6


@@ - Drive Config

&INC`AGE`DRIVE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`DRIVE`DISPLAY},{@attach %!/INC`AGE`DRIVE`SET}

&INC`AGE`DRIVE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - DRIVE Config);@pemit %#=ansi(u(color,%#,SYSTEm,COLUMN_NAMES),align(12 12 8 8 8,Name,MinDrive,Bonus,Penalty,Damage\%));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/DRIVES)]={@pemit %#=align(12 12 8 8 8,%i0,u(cust,DRIVES,%i0),u(cust,DRIVES,%i0`BONUS),u(cust,DRIVES,%i0`PENALTY),u(cust,DRIVES,%i0`DAMAGE))};@pemit %#=u(footer)

&INC`AGE`DRIVE`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/DRIVES),|,DRIVE;@select/inline strlen(%1)=>1,{@attach %!/INC`PARTIAL=%1,BONUS|PENALTY|DAMAGE,|,Option;@attach %!/INC`AGE`DRIVE`SET`%q<option>},{@attach %!/INC`AGE`DRIVE`SET`MINDRIVE}

&INC`AGE`DRIVE`SET`MINDRIVE [u(cobj,age)]=@attach %!/INC`VALID`POSINT=%2;&DRIVES`%q<DRIVE>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE Tier %q<DRIVE> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE Tier '%q<DRIVE>' To: %q<value>

&INC`AGE`DRIVE`SET`BONUS [u(cobj,age)]=@attach %!/INC`VALID`ADJECTIVE=%2;&DRIVES`%q<DRIVE>`BONUS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Bonus to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Bonus To: %q<value>
&INC`AGE`DRIVE`SET`PENALTY [u(cobj,age)]=@attach %!/INC`VALID`ADJECTIVE=%2;&DRIVES`%q<DRIVE>`PENALTY`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Penalty to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Penalty To: %q<value>
&INC`AGE`DRIVE`SET`DAMAGE [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&DRIVES`%q<DRIVE>`DAMAGE`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Damage to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Damage To: %q<value>

&DRIVES [u(cobj,agedb)]=Primed|Ready|Lagging|Overextended|Wavering|Spent

&DRIVES`PRIMED [u(cobj,agedb)]=81
&DRIVES`PRIMED`DEFENSE`BONUS`STAT`1 [u(cobj,agedb)]=Moderate
&DRIVES`PRIMED`DEFENSE`BONUS`STAT`3 [u(cobj,agedb)]=Moderate

&DRIVES`READY [u(cobj,agedb)]=56

&DRIVES`LAGGING [u(cobj,agedb)]=21
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Minor

&DRIVES`OVEREXTENDED [u(cobj,agedb)]=0
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid

&DRIVES`WAVERING [u(cobj,agedb)]=-24
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DAMAGE [u(cobj,agedb)]=0.2

&DRIVES`SPENT [u(cobj,agedb)]=-1000
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DAMAGE [u(cobj,agedb)]=1000

&DRIVESTATUS [u(cobj,age)]=first(squish(iter(get(u(cobj,agedb)/DRIVES),if(gte(get(%0/D`COMBAT`DRIVE),u(cust,DRIVES,%i0)),%i0[ibreak()]),|,|),|),|)

@@ Damage Age Config --

&DAMAGES [u(cobj,agedb)]=Perfect|Excellent|Good|Damaged|Critical|Disabled|Scrap

&DAMAGES`PERFECT [u(cobj,agedb)]=1
&DAMAGES`EXCELLENT [u(cobj,agedb)]=0.76
&DAMAGES`GOOD [u(cobj,agedb)]=0.501
&DAMAGES`DAMAGED [u(cobj,agedb)]=0.251
&DAMAGES`CRITICAL [u(cobj,agedb)]=0.01
&DAMAGES`DISABLED [u(cobj,agedb)]=-0.249
&DAMAGES`SCRAP [u(cobj,agedb)]=-99999

&PERCENT [u(cobj,age)]=fdiv(sub(get(%0/D`COMBAT`HEALTH),get(%0/D`COMBAT`DAMAGE)),get(%0/D`COMBAT`HEALTH))

&DSTAGE [u(cobj,age)]=localize([u(setq,perc,u(percent,%0))][first(iter(get(u(cobj,agedb)/DAMAGES),if(gte(u(cust,DAMAGES,%i0),%q<perc>),%i0[ibreak()]),|,%b))])

&DSTAGENUM [u(cobj,age)]=match(get(u(cobj,agedb)/DAMAGES),u(dstage,%0),|)

@@ Weight Age Config--

&INC`AGE`WEIGHT [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`WEIGHT`DISPLAY},{@attach %!/INC`AGE`WEIGHT`SET}

&INC`AGE`WEIGHT`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Weight Config);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(12 12 8 8 8,Name,Threshold,Bonus,Penalty,Tunings));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/WEIGHTS)]={@pemit %#=align(12 12 8 8 8,%i0,u(cust,WEIGHTS,%i0),u(cust,WEIGHTS,%i0`BONUS),u(cust,WEIGHTS,%i0`PENALTY),u(cust,WEIGHTS,%i0`TUNINGS))};@pemit %#=u(footer,Global: [u(cust,WEIGHTS,GLOBAL)])

&INC`AGE`WEIGHT`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,[get(u(cobj,agedb)/WEIGHTS)],|,Weight;@attach %!/INC`PARTIAL=%1,BONUS,|,Option;@attach %!/INC`AGE`WEIGHT`SET`%q<option>

&INC`AGE`WEIGHT`SET`THRESHOLD [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&WEIGHTS`%q<Tech>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Tech %q<Tech> Threshold to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Tech '%q<Tech>' Threshold To: %q<value>
&INC`AGE`WEIGHT`SET`BONUS [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&WEIGHTS`%q<weight>`BONUS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Weight %q<weight> Bonus to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Weight '%q<weight>' Bonus To: %q<value>

&WEIGHTS [u(cobj,agedb)]=LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS

&WEIGHTS`LIGHT [u(cobj,agedb)]=Light
&WEIGHTS`LIGHT`BONUS [u(cobj,agedb)]=0

&WEIGHTS`MEDIUM [u(cobj,agedb)]=Medium
&WEIGHTS`MEDIUM`BONUS [u(cobj,agedb)]=6

&WEIGHTS`HEAVY [u(cobj,agedb)]=Heavy
&WEIGHTS`HEAVY`BONUS [u(cobj,agedb)]=12

&WEIGHTS`SUPERHEAVY [u(cobj,agedb)]=Superheavy
&WEIGHTS`SUPERHEAVY`BONUS [u(cobj,agedb)]=24

&WEIGHTS`BOSS [u(cobj,agedb)]=Boss
&WEIGHTS`BOSS`BONUS [u(cobj,agedb)]=30

&WEIGHT [u(cobj,age)]=localize([u(setq,glob,u(cust,TECHS,GLOBAL))][switch(%0,-1,X,first(squish(iter(get(u(cobj,agedb)/TECHS),if(gte(sub(%0,%q<glob>),u(cust,TECHS,%i0)),%i0[ibreak()]),|,%b))))])

&WEIGHT`UPGRADE [u(cobj,age)]=switch(%0,LIGHT,MEDIUM,MEDIUM,HEAVY,HEAVY,SUPERHEAVY,SUPERHEAVY,SUPERHEAVY,BOSS,BOSS)
&WEIGHT`DOWNGRADE [u(cobj,age)]=switch(%0,LIGHT,LIGHT,MEDIUM,LIGHT,HEAVY,MEDIUM,SUPERHEAVY,SUPERHEAVY,BOSS,BOSS)

@@ Stats ------

&ENTITY`0 [u(cobj,agedb)]=Mode

&ENTITY`0`STAT`0 [u(cobj,agedb)]=Power
&ENTITY`0`STAT`0`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`0`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`0`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`0`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`0`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`0`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`0`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`0`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`0`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`0`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`1 [u(cobj,agedb)]=Endurance
&ENTITY`0`STAT`1`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`1`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`1`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`1`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`1`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`1`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`1`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`1`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`1`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`1`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`2 [u(cobj,agedb)]=Precision
&ENTITY`0`STAT`2`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`2`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`2`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`2`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`2`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`2`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`2`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`2`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`2`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`2`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`3 [u(cobj,agedb)]=Mitigation
&ENTITY`0`STAT`3`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`3`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`3`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`3`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`3`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`3`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`3`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`3`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`3`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`3`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`4 [u(cobj,agedb)]=Weight
&ENTITY`0`STAT`4`MINIMUM [u(cobj,agedb)]=0
&ENTITY`0`STAT`4`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`4`DEFAULT [u(cobj,agedb)]=2

&STATS [u(cobj,age)]=iter(u(sortattr,lattr(u(cobj,agedb)/ENTITY`%0`STAT`*)),get(u(cobj,agedb)/%i0),%b,|)

&CUSTSTAT [u(cobj,age)]=u(strfirstof,get(u(cobj,agedb)/ENTITY`%0`STAT`%1`CUSTOM),get(u(cobj,agedb)/ENTITY`%0`STAT`%1))

&INC`AGE`STAT [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`STAT`DISPLAY},{@attach %!/INC`AGE`STAT`SET}

&INC`AGE`STAT`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - STAT Config);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(12 8 8 8 8 8 8,Name,Minimum,Maximum,Default,Dial,AccWorth,Mapping));@pemit %#=u(separator);@dolist/inline 0 1 2 3={@pemit %#=align(12 8 8 8 8 8 8,get(u(cobj,agedb)/ENTITY`0`STAT`%i0),u(custstat,0,%i0`MINIMUM),u(custstat,0,%i0`MAXIMUM),u(custstat,0,%i0`DEFAULT),u(custstat,0,%i0`DIAL),u(custstat,0,%i0`ACCWORTH),iter(u(sortattr,u(lattr,u(cobj,agedb)/ENTITY`0`STAT`%i0`MAPPING`*)),last(%i0,`): [get(u(cobj,agedb)/%i0)],%b,%R))};@pemit %#=u(footer)

&INC`AGE`STAT`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,u(u(cobj,age)/STATS),|,STAT;th u(setq,statnum,sub(match(u(u(cobj,age)/STATS),%q<stat>,|),1));@check strlen(%1)=@attach %!/INC`MSG=ERROR: Must enter an option!;@attach %!/INC`PARTIAL=before(%1,/),MINIMUM|MAXIMUM|DEFAULT|MAPPING|ACCWORTH,|,Option;@attach %!/INC`AGE`STAT`SET`%q<option>

&INC`AGE`STAT`SET`MINIMUM [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MINIMUM`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Minimum to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Minimum To: %q<value>
&INC`AGE`STAT`SET`MAXIMUM [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MAXIMUM`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Maximum to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Maximum To: %q<value>
&INC`AGE`STAT`SET`DEFAULT [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`DEFAULT`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Default to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Default To: %q<value>

&INC`AGE`STAT`SET`MAPPING [u(cobj,age)]=@check strlen(after(%1,/))=@attach %!/INC`MSG=ERROR: Must enter a Mapping #! 1-5!;@attach %!?INC`PARTIAL=after(%1,/),1|2|3|4|5,|,map;@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MAPPING`%q<map>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Mapping %q<map> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Mapping %q<map> To: %q<value>


@@ Attacks Config
&INC`AGE`ATTACK [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ATTACK`DISPLAY},{@attach %!/INC`AGE`ATTACK`SET}

&INC`AGE`ATTACK`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - ATTACK Config);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(12 12 12 8,Name,Multiplier,Percentage,Cost));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/ATTACKS)]={@pemit %#=align(12 12 12 8,%i0,u(cust,ATTACKS,%i0),u(cust,ATTACKS,%i0`PERCENTAGE),u(cust,ATTACKS,%i0`COST))};@pemit %#=u(footer)

&INC`AGE`ATTACK`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,[get(u(cobj,agedb)/ATTACKS)],|,ATTACK;@check strlen;@attach %!/INC`PARTIAL=%1,COST|MULTIPLIER|PERCENTAGE,|,Option;@attach %!/INC`AGE`ATTACK`SET`%q<option>

&INC`AGE`ATTACK`SET`COST [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ATTACKS`%q<attack>`COST`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Cost to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' cost To: %q<value>
&INC`AGE`ATTACK`SET`MULTIPLIER [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&ATTACKS`%q<attack>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Multiplier to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' Multiplier To: %q<value>
&INC`AGE`ATTACK`SET`PERCENTAGE [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&ATTACKS`%q<attack>`PERCENTAGE`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Percentage to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' Percentage To: %q<value>

&ATTACKS [u(cobj,agedb)]=1|2|3|4|5

&ATTACKS`1 [u(cobj,agedb)]=0.8
&ATTACKS`1`COST [u(cobj,agedb)]=-5
&ATTACKS`1`PERCENTAGE [u(cobj,agedb)]=0.065
&ATTACKS`1`DESCRIPTION [u(cobj,agedb)]=Light

&ATTACKS`2 [u(cobj,agedb)]=2.0
&ATTACKS`2`COST [u(cobj,agedb)]=10
&ATTACKS`2`PERCENTAGE [u(cobj,agedb)]=0.162
&ATTACKS`2`DESCRIPTION [u(cobj,agedb)]=Standard

&ATTACKS`3 [u(cobj,agedb)]=3.0
&ATTACKS`3`COST [u(cobj,agedb)]=30
&ATTACKS`3`PERCENTAGE [u(cobj,agedb)]=0.225
&ATTACKS`3`DESCRIPTION [u(cobj,agedb)]=Heavy

&ATTACKS`4 [u(cobj,agedb)]=4.0
&ATTACKS`4`COST [u(cobj,agedb)]=45
&ATTACKS`4`PERCENTAGE [u(cobj,agedb)]=0.294
&ATTACKS`4`DESCRIPTION [u(cobj,agedb)]=Massive

&ATTACKS`5 [u(cobj,agedb)]=5.0
&ATTACKS`5`COST [u(cobj,agedb)]=65
&ATTACKS`5`PERCENTAGE [u(cobj,agedb)]=0.355
&ATTACKS`5`DESCRIPTION [u(cobj,agedb)]=Finishing

@@ Offense and Defense
&OFF`1 [u(cobj,agedb)]=Consistent
&OFF`1`STATUS [u(Cobj,agedb)]=OFF_CONSISTENT
&OFF`1`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`1`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`1`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,precision strike,<=4,lethal strike,5,mortal strike)

&OFF`2 [u(cobj,agedb)]=Forceful
&OFF`2`STATUS [u(Cobj,agedb)]=OFF_FORCEFUL
&OFF`2`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`2`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`2`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,heavy blow,<=4,mighty blow,5,savage blow)

&OFF`3 [u(cobj,agedb)]=Efficient
&OFF`3`STATUS [u(Cobj,agedb)]=OFF_EFFICIENT
&OFF`3`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`3`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`3`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,effective attack,<=4,expert attack,5,perfect attack)

&OFF`4 [u(cobj,agedb)]=Dramatic
&OFF`4`STATUS [u(Cobj,agedb)]=OFF_DRAMATIC
&OFF`4`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`4`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`4`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,dynamic offensive,<=4,decisive offensive,5,absolute offensive)


&DEF`1 [u(cobj,agedb)]=Focus
&DEF`1`STATUS [u(Cobj,agedb)]=DEF_FOCUS
&DEF`1`ATTACK_TURNS [u(cobj,agedb)]=1
&DEF`1`DEFENSE_TURNS [u(Cobj,agedb)]=0
&DEF`1`ACTION [u(cobj,agedb)]=Focuses
&DEF`1`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 isn't even distracted by %2's %3!,<=4,%1 is able to ignore %2's %3!,5,%1 maintains laser focus in the face of %2's %3! It's the perfect opportunity!)
&DEF`1`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 takes %2's %3 in stride!,<=4,%1 stays ready through %2's %3!,5,%1 somehow keeps their position after %2's %3!)
&DEF`1`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 puts mind over matter when hit with %2's %3!,<=4,%1 hangs on to their preparation through %2's %3!,5,%1 struggles to stay focused at all after %2's %3!)
&DEF`1`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 suffers serious damage from %2's %3 for their effort!,<=4,%1 doesn't even try to stop %2's %3\, and pays for it!,5,%1 suffers the full fury of %2's %3! let's hope it was worth it!)

&DEF`2 [u(cobj,agedb)]=Bolster
&DEF`2`STATUS [u(Cobj,agedb)]=DEF_BOLSTER
&DEF`2`ATTACK_TURNS [u(cobj,agedb)]=1
&DEF`2`DEFENSE_TURNS [u(Cobj,agedb)]=0
&DEF`2`ACTION [u(cobj,agedb)]=Bolsters
&DEF`2`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 is untouched by %2's %3!,<=4,%1 is unscathed by %2's %3!,5,%1 has the perfect chance to one-up %2's %3! Let's see the damage!)
&DEF`2`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 wrestles with %2's %3!,<=4,%1 is able to wait out %2's %3!,5,%1 scrapes through %2's %3!)
&DEF`2`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 eats %2's %3 in the exchange!,<=4,%1 powers through %2's %3!,5,%1 takes a lot of damage trading with %2's %3!)
&DEF`2`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 receives %2's %3 badly!,<=4,%1 takes %2's %3 straight to the face!,5,%1 grossly underestimates %2's %3\, and suffers the consequences! That had to hurt!)

&DEF`3 [u(cobj,agedb)]=Guard
&DEF`3`STATUS [u(Cobj,agedb)]=DEF_GUARD
&DEF`3`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`3`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`3`ACTION [u(cobj,agedb)]=Guards
&DEF`3`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 stopped %2's %3 cold!,<=4,%1 completely blocked %2's %3!,5,%1 is somehow completely unphased by %2's %3! Impressive!)
&DEF`3`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 rolls with %2's %3!,<=4,%1 held back %2's %3!,5,%1 barely resisted %2's %3!)
&DEF`3`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 holds out against %2's %3!,<=4,%1 struggles against %2's %3!,5,%1 somehow endures %2's %3!)
&DEF`3`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1's guard is pierced by %2's %3!,<=4,%1 couldn't hold out against %2's %3!,5,%1 is completely overpowered by %2's %3! It's just too strong!)

&DEF`4 [u(cobj,agedb)]=Maneuver
&DEF`4`STATUS [u(Cobj,agedb)]=DEF_MANEUVER
&DEF`4`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`4`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`4`ACTION [u(cobj,agedb)]=Maneuvers
&DEF`4`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 easily avoids being struck by %2's %3!,<=4,%1 eludes %2's otherwise %3!,5,%1 negates %2's %3 completely! Good thinking!)
&DEF`4`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 avoids %2's %3 at the last minute!,<=4,%1 manages to fend off %2's %3!,5,%1 barely escapes destruction by %2's %3!)
&DEF`4`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 partly dulls %2's %3!,<=4,%1 only blunts %2's %3!,5,%1 can only do so much against %2's %3!)
&DEF`4`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 is caught flat-footed by %2's %3!,<=4,%1 takes the full brunt of %2's %3!,5,%1 is helpless before %2's %3! No escaping this one!)

&DEF`5 [u(cobj,agedb)]=Rally
&DEF`5`STATUS [u(Cobj,agedb)]=DEF_RALLY
&DEF`5`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`5`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`5`ACTION [u(cobj,agedb)]=Rallies
&DEF`5`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 is totally undaunted by %2's %3!,<=4,%1 isn't threatened by %2's %3!,5,%1 laughs in the face of death at %2's %3! Confidence surges!)
&DEF`5`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 shrugs off %2's %3!,<=4,%1 comes out on top from %2's %3!,5,%1 dramatically emerges from the aftermath of %2's %3!)
&DEF`5`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 determinedly pushes through %2's %3!,<=4,%1 suffers the brunt of %2's %3 to catch a breath!,5,%1 holds on and staggers through %2's %3!)
&DEF`5`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1's defiance only makes %2's %3 worse!,<=4,%1 pays dearly for standing in the way of %2's %3!,5,%1 is utterly crushed by %2's %3! It'll be hard to come back from that one!)

@@ Traits 

&TRAIT`0 [u(cobj,agedb)]=Stat
&TRAIT`0`PREFIX [u(cobj,agedb)]=STA
&TRAIT`1 [u(cobj,agedb)]=Archetype
&TRAIT`1`PREFIX [u(cobj,agedb)]=ARC
&TRAIT`2 [u(cobj,agedb)]=Quirk
&TRAIT`2`PREFIX [u(cobj,agedb)]=QRK
&TRAIT`3 [u(cobj,agedb)]=Accolade
&TRAIT`3`PREFIX [u(cobj,agedb)]=ACC

@@ Archetypes
&INC`AGE`ARCHETYPE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ARCHETYPE`DISPLAY},{@attach %!/INC`AGE`ARCHETYPE`SET}

&INC`AGE`ARCHETYPE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Archetype Config);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(4 40,ID,Name));@pemit %#=u(separator);@dolist/inline u(sortattr,u(lattr,u(cobj,agedb)/ARC`*))={@pemit %#=align(4 40,last(%i0,`),default(u(cobj,agedb)/%i0,<Unset>))};@pemit %#=u(footer)

&INC`AGE`ARCHETYPE`SET [u(cobj,age)]=@stop 1=@attach %!/INC`MSG=ERROR: SEt is not supported!;@attach %!/INC`PARTIAL=%0,u(u(cobj,age)/ARCHETYPES),|,ARCHETYPE;th u(setq,ARCHETYPEnum,sub(match(u(u(cobj,age)/ARCHETYPES),%q<ARCHETYPE>,|),1));


@@ Generalists
&ARC`0 [u(cobj,agedb)]=Unshaped

&ARC`1 [u(cobj,agedb)]=All-Star
&ARC`1`STATUS [u(cobj,agedb)]=ARC_ALLSTAR

&ARC`2 [u(cobj,agedb)]=Marksman
&ARC`2`STATUS [u(cobj,agedb)]=ARC_MARKSMAN

&ARC`3 [u(cobj,agedb)]=Bruiser
&ARC`3`STATUS [u(cobj,agedb)]=ARC_BRUISER

&ARC`4 [u(cobj,agedb)]=Tough Guy
&ARC`4`STATUS [u(cobj,agedb)]=ARC_TOUGHGUY

&ARC`5 [u(cobj,agedb)]=Vigilant
&ARC`5`STATUS [u(cobj,agedb)]=ARC_VIGILANT

&ARC`6 [u(cobj,agedb)]=Hero
&ARC`6`STATUS [u(cobj,agedb)]=ARC_HERO

&ARC`7 [u(cobj,agedb)]=Duelist
&ARC`7`STATUS [u(cobj,agedb)]=ARC_DUELIST

&ARC`8 [u(cobj,agedb)]=Slugger
&ARC`8`STATUS [u(cobj,agedb)]=ARC_SLUGGER

&ARC`9 [u(cobj,agedb)]=Striker
&ARC`9`STATUS [u(cobj,agedb)]=ARC_STRIKER

&ARC`10 [u(cobj,agedb)]=Defender
&ARC`10`STATUS [u(cobj,agedb)]=ARC_DEFENDER

&ARC`11 [u(cobj,agedb)]=Freestylist
&ARC`11`STATUS [u(cobj,agedb)]=ARC_FREESTYLIST

&ARC`12 [u(cobj,agedb)]=Challenger
&ARC`12`STATUS [u(cobj,agedb)]=ARC_CHALLENGER


@@ Specialists

&ARC`100 [u(cobj,agedb)]=Ace
&ARC`100`STATUS [u(cobj,agedb)]=ARC_ACE

&ARC`101 [u(cobj,agedb)]=Arsenal
&ARC`101`STATUS [u(Cobj,agedb)]=ARC_ARSENAL

&ARC`102 [u(cobj,agedb)]=Aspirant
&ARC`102`STATUS [u(cobj,agedb)]=ARC_ASPIRANT

&ARC`103 [u(cobj,agedb)]=Assassin
&ARC`103`STATUS [u(cobj,agedb)]=ARC_ASSASSIN

&ARC`104 [u(cobj,agedb)]=Berserker
&ARC`104`STATUS [u(Cobj,agedb)]=ARC_BERSERKER

&ARC`105 [u(cobj,agedb)]=Big Four
&ARC`105`STATUS [u(cobj,agedb)]=ARC_BIGFOUR

&ARC`106 [u(cobj,agedb)]=Blaster
&ARC`106`STATUS [u(Cobj,agedb)]=ARC_BLASTER

&ARC`107 [u(cobj,agedb)]=Demoralizer
&ARC`107`STATUS [u(Cobj,agedb)]=ARC_DEMORALIZER

&ARC`108 [u(cobj,agedb)]=Destroyer
&ARC`108`STATUS [u(Cobj,agedb)]=ARC_DESTROYER

&ARC`109 [u(cobj,agedb)]=Fencer
&ARC`109`STATUS [u(Cobj,agedb)]=ARC_FENCER

&ARC`110 [u(cobj,agedb)]=Fury
&ARC`110`STATUS [u(Cobj,agedb)]=ARC_FURY

&ARC`111 [u(cobj,agedb)]=Gambler
&ARC`111`STATUS [u(Cobj,agedb)]=ARC_GAMBLER

&ARC`112 [u(cobj,agedb)]=Grappler
&ARC`112`STATUS [u(Cobj,agedb)]=ARC_GRAPPLER

&ARC`113 [u(cobj,agedb)]=Ghost
&ARC`113`STATUS [u(Cobj,agedb)]=ARC_GHOST

&ARC`114 [u(cobj,agedb)]=Glass Cannon
&ARC`114`STATUS [u(Cobj,agedb)]=ARC_GLASSCANNON

&ARC`115 [u(cobj,agedb)]=Hot Blooded
&ARC`115`STATUS [u(Cobj,agedb)]=ARC_HOTBLOODED

&ARC`116 [u(cobj,agedb)]=Immortal
&ARC`116`STATUS [u(Cobj,agedb)]=ARC_IMMORTAL

&ARC`117 [u(cobj,agedb)]=Juggernaut
&ARC`117`STATUS [u(Cobj,agedb)]=ARC_JUGGERNAUT

&ARC`118 [u(cobj,agedb)]=Operator
&ARC`118`STATUS [u(Cobj,agedb)]=ARC_OPERATOR

&ARC`119 [u(cobj,agedb)]=Predator
&ARC`119`STATUS [u(Cobj,agedb)]=ARC_PREDATOR

&ARC`120 [u(cobj,agedb)]=Showoff
&ARC`120`STATUS [u(Cobj,agedb)]=ARC_SHOWOFF

&ARC`121 [u(cobj,agedb)]=Sniper
&ARC`121`STATUS [u(Cobj,agedb)]=ARC_SNIPER

&ARC`122 [u(cobj,agedb)]=Survivor
&ARC`122`STATUS [u(Cobj,agedb)]=ARC_SURVIVOR

&ARC`123 [u(cobj,agedb)]=Uncontrollable
&ARC`123`STATUS [u(Cobj,agedb)]=ARC_UNCONTROLLABLE

@@ Synergists

&ARC`200 [u(Cobj,agedb)]=Aegis
&ARC`200`STATUS [u(cobj,agedb)]=ARC_AEGIS

&ARC`201 [u(Cobj,agedb)]=Conspirator
&ARC`201`STATUS [u(cobj,agedb)]=ARC_CONSPIRATOR

&ARC`202 [u(Cobj,agedb)]=Engineer
&ARC`202`STATUS [u(cobj,agedb)]=ARC_ENGINEER

&ARC`203 [u(Cobj,agedb)]=Icon
&ARC`203`STATUS [u(cobj,agedb)]=ARC_ICON

&ARC`204 [u(Cobj,agedb)]=Martyr
&ARC`204`STATUS [u(cobj,agedb)]=ARC_MARTYR

&ARC`205 [u(Cobj,agedb)]=Mastermind
&ARC`205`STATUS [u(cobj,agedb)]=ARC_MASTERMIND

&ARC`206 [u(Cobj,agedb)]=Panacea
&ARC`206`STATUS [u(cobj,agedb)]=ARC_PANACEA

&ARC`207 [u(Cobj,agedb)]=Overlord
&ARC`207`STATUS [u(cobj,agedb)]=ARC_OVERLORD

&ARC`208 [u(Cobj,agedb)]=Royal
&ARC`208`STATUS [u(cobj,agedb)]=ARC_ROYAL

&ARC`209 [u(Cobj,agedb)]=Saint
&ARC`209`STATUS [u(cobj,agedb)]=ARC_SAINT

&ARC`210 [u(Cobj,agedb)]=Spotter
&ARC`210`STATUS [u(cobj,agedb)]=ARC_SPOTTER

&ARC`211 [u(Cobj,agedb)]=Tactician
&ARC`211`STATUS [u(cobj,agedb)]=ARC_TACTICIAN

&ARC`212 [u(Cobj,agedb)]=Witch
&ARC`212`STATUS [u(cobj,agedb)]=ARC_WITCH





@@ Quirks

&QRK`1 [u(cobj,agedb)]=Aim Assist
&QRK`1`STATUS [u(cobj,agedb)]=QRK_AIMASSIST

&QRK`2 [u(cobj,agedb)]=Calibrated Weaponry
&QRK`2`STATUS [u(cobj,agedb)]=QRK_CALIBRATEDWEAPONRY

&QRK`3 [u(cobj,agedb)]=Certain Kill
&QRK`3`STATUS [u(cobj,agedb)]=QRK_CERTAINKILL

&QRK`4 [u(cobj,agedb)]=Heavy Weaponry
&QRK`4`STATUS [u(Cobj,agedb)]=QRK_HEAVYWEAPONRY

&QRK`5 [u(cobj,agedb)]=Keen Eye
&QRK`5`STATUS [u(cobj,agedb)]=QRK_KEENEYE

&QRK`6 [u(Cobj,agedb)]=Killer Instinct
&QRK`6`STATUS [u(Cobj,agedb)]=QRK_KILLERINSTINCT

&QRK`7 [u(cobj,agedb)]=Last Word
&QRK`7`STATUS [u(cobj,agedb)]=QRK_LASTWORD

&QRK`8 [u(cobj,agedb)]=Mighty
&QRK`8`STATUS [u(Cobj,agedb)]=QRK_MIGHTY

&QRK`9 [u(cobj,agedb)]=Experimental Weaponry
&QRK`9`STATUS [u(cobj,agedb)]=QRK_EXPERIMENTALWEAPONRY

&QRK`10 [u(cobj,agedb)]=Elegant Stance
&QRK`10`STATUS [u(Cobj,agedb)]=QRK_ELEGANTSTANCE

&QRK`11 [u(cobj,agedb)]=Hyper Mode
&QRK`11`STATUS [u(Cobj,agedb)]=QRK_HYPERMODE

&QRK`12 [u(cobj,agedb)]=Momentum
&QRK`12`STATUS [u(Cobj,agedb)]=QRK_MOMENTUM

&QRK`13 [u(cobj,agedb)]=Riposte
&QRK`13`STATUS [u(Cobj,agedb)]=QRK_RIPOSTE

&QRK`14 [u(cobj,agedb)]=Stimulants
&QRK`14`STATUS [u(Cobj,agedb)]=QRK_STIMULANTS

&QRK`15 [u(cobj,agedb)]=Unwieldy Strength
&QRK`15`STATUS [u(Cobj,agedb)]=QRK_UNWIELDYSTRENGTH

&QRK`16 [u(cobj,agedb)]=Versatile Attacks
&QRK`16`STATUS [u(Cobj,agedb)]=QRK_VERSATILEATTACKS

&QRK`17 [u(cobj,agedb)]=Predictive Targeting
&QRK`17`STATUS [u(cobj,agedb)]=QRK_PREDICTIVETARGETING

&QRK`18 [u(cobj,agedb)]=Exsanguination
&QRK`18`STATUS [u(cobj,agedb)]=QRK_EXSANGUINATION

&QRK`19 [u(cobj,agedb)]=Toxicity
&QRK`19`STATUS [u(cobj,agedb)]=QRK_TOXICITY

&QRK`20 [u(cobj,agedb)]=Withering
&QRK`20`STATUS [u(cobj,agedb)]=QRK_WITHERING



@@ Defense Quirks
&QRK`100 [u(cobj,agedb)]=Cloaking
&QRK`100`STATUS [u(cobj,agedb)]=QRK_CLOAKING

&QRK`101 [u(cobj,agedb)]=Fortified Defenses
&QRK`101`STATUS [u(cobj,agedb)]=QRK_FORTIFIEDDEFENSES

&QRK`102 [u(cobj,agedb)]=Heavy Armor
&QRK`102`STATUS [u(cobj,agedb)]=QRK_HEAVYARMOR

&QRK`103 [u(cobj,agedb)]=Quick Reflexes
&QRK`103`STATUS [u(cobj,agedb)]=QRK_QUICKREFLEXES

&QRK`104 [u(cobj,agedb)]=Resilience
&QRK`104`STATUS [u(cobj,agedb)]=QRK_RESILIENCE

&QRK`105 [u(cobj,agedb)]=Staying Power
&QRK`105`STATUS [u(cobj,agedb)]=QRK_STAYINGPOWER

&QRK`106 [u(cobj,agedb)]=Tenacity
&QRK`106`STATUS [u(cobj,agedb)]=QRK_TENACITY

&QRK`107 [u(Cobj,agedb)]=Ablative Barrier
&QRK`107`STATUS [u(Cobj,agedb)]=QRK_ABLATIVEBARRIER

&QRK`108 [u(cobj,agedb)]=Anticipation
&QRK`108`STATUS [u(cobj,agedb)]=QRK_ANTICIPATION

&QRK`109 [u(cobj,agedb)]=Convenient Keepsake
&QRK`109`STATUS [u(Cobj,agedb)]=QRK_CONVENIENTKEEPSAKE

&QRK`110 [u(cobj,agedb)]=Hit and Run
&QRK`110`STATUS [u(Cobj,agedb)]=QRK_HITANDRUN

&QRK`111 [u(cobj,agedb)]=Immunized
&QRK`111`STATUS [u(cobj,agedb)]=QRK_IMMUNIZED

&QRK`112 [u(cobj,agedb)]=Last Chance
&QRK`112`STATUS [u(Cobj,agedb)]=QRK_LASTCHANCE

&QRK`113 [u(cobj,agedb)]=Point Defense
&QRK`113`STATUS [u(Cobj,agedb)]=QRK_POINTDEFENSE

&QRK`114 [u(cobj,agedb)]=Regeneration
&QRK`114`STATUS [u(cobj,agedb)]=QRK_REGENERATION

&QRK`115 [u(cobj,agedb)]=Siege Mode
&QRK`115`STATUS [u(cobj,agedb)]=QRK_SIEGEMODE

&QRK`116 [u(cobj,agedb)]=Stand and Deliver
&QRK`116`STATUS [u(cobj,agedb)]=QRK_STANDANDDELIVER

&QRK`117 [u(cobj,agedb)]=Stripped Down
&QRK`117`STATUS [u(cobj,agedb)]=QRK_STRIPPEDDOWN

&QRK`118 [u(cobj,agedb)]=Survival Instinct
&QRK`118`STATUS [u(cobj,agedb)]=QRK_SURVIVALINSTINCT

&QRK`119 [u(cobj,agedb)]=Vanish
&QRK`119`STATUS [u(cobj,agedb)]=QRK_VANISH

&QRK`120 [u(cobj,agedb)]=Shield User
&QRK`120`STATUS [u(cobj,agedb)]=QRK_SHIELDUSER

@@ Balanced Quirks
&QRK`200 [u(cobj,agedb)]=Bloodthirsty
&QRK`200`STATUS [u(cobj,agedb)]=QRK_BLOODTHIRSTY

&QRK`201 [u(cobj,agedb)]=Extra Effort
&QRK`201`STATUS [u(cobj,agedb)]=QRK_EXTRAEFFORT

&QRK`202 [u(cobj,agedb)]=Finesse
&QRK`202`STATUS [u(cobj,agedb)]=QRK_FINESSE

&QRK`203 [u(cobj,agedb)]=Genius
&QRK`203`STATUS [u(Cobj,agedb)]=QRK_GENIUS

&QRK`204 [u(cobj,agedb)]=Revenge
&QRK`204`STATUS [u(cobj,agedb)]=QRK_REVENGE

&QRK`205 [u(cobj,agedb)]=Solidity
&QRK`205`STATUS [u(cobj,agedb)]=QRK_SOLIDITY

&QRK`206 [u(cobj,agedb)]=Adrenaline
&QRK`206`STATUS [u(Cobj,agedb)]=QRK_ADRENALINE

&QRK`207 [u(cobj,agedb)]=Bag of Tricks
&QRK`207`STATUS [u(Cobj,agedb)]=QRK_BAGOFTRICKS

&QRK`208 [u(cobj,agedb)]=Destiny
&QRK`208`STATUS [u(cobj,agedb)]=QRK_DESTINY

&QRK`209 [u(cobj,agedb)]=Fighting Spirit
&QRK`209`STATUS [u(Cobj,agedb)]=QRK_FIGHTINGSPIRIT

&QRK`210 [u(cobj,agedb)]=Honor Bound
&QRK`210`STATUS [u(cobj,agedb)]=QRK_HONORBOUND

&QRK`211 [u(cobj,agedb)]=Improvisation
&QRK`211`STATUS [u(cobj,agedb)]=QRK_IMPROVISATION

&QRK`212 [u(cobj,agedb)]=Inspiration
&QRk`212`STATUS [u(Cobj,agedb)]=QRK_INSPIRATION

&QRK`213 [u(cobj,agedb)]=Last Stand
&QRK`213`STATUS [u(cobj,agedb)]=QRK_LASTSTAND

&QRK`214 [u(cobj,agedb)]=Overcharged
&QRK`214`STATUS [u(cobj,agedb)]=QRK_OVERCHARGED

&QRK`215 [u(Cobj,agedb)]=Prep Time
&QRK`215`STATUS [u(Cobj,agedb)]=QRK_PREPTIME

&QRK`216 [u(cobj,agedb)]=Repertoire
&QRK`216`STATUS [u(cobj,agedb)]=QRK_REPERTOIRE

&QRK`217 [u(cobj,agedb)]=Unbreakable
&QRK`217`STATUS [u(cobj,agedb)]=QRK_UNBREAKABLE

&QRK`218 [u(cobj,agedb)]=Selfless
&QRK`218`STATUS [u(cobj,agedb)]=QRK_SELFLESS

&QRK`219 [u(cobj,agedb)]=Team Support
&QRK`219`STATUS [u(cobj,agedb)]=QRK_TEAMSUPPORT

@@ ------------

&CMD`CHARGEN [u(cobj,age)]=$^(?s)\+(select|add|remove|set|create|delete|clear|list|search|mode|view|submit|matrix|rollforce|hypeforce|driveforce|switch|damageforce|healforce|csetup)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:th u(setq,command,%1);th u(setq,sysname,CHARGEN);@check cor(u(isadmin,%#),get(%#/D`TESTER))=@attach %!/INC`MSG=ERROR: Permission denied.;@attach %!/INC`GETSWITCH=%2;@attach %!/INC`%q<sysname>`%q<command>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4,%5
@set [u(cobj,age)]/CMD`CHARGEN=regexp

&CHARGEN`SELECT`PLAYER [u(cobj,age)]=
&CHARGEN`SELECT`ADMIN [u(cobj,age)]=
&CHARGEN`ADD`PLAYER [u(cobj,age)]=
&CHARGEN`ADD`ADMIN [u(cobj,age)]=
&CHARGEN`REMOVE`PLAYER [u(cobj,age)]=
&CHARGEN`REMOVE`ADMIN [u(cobj,age)]=
&CHARGEN`SET`PLAYER [u(cobj,age)]=
&CHARGEN`SET`ADMIN [u(cobj,age)]=
&CHARGEN`CREATE`PLAYER [u(cobj,age)]=
&CHARGEN`CREATE`ADMIN [u(cobj,age)]=
&CHARGEN`DELETE`PLAYER [u(cobj,age)]=
&CHARGEN`DELETE`ADMIN [u(cobj,age)]=
&CHARGEN`SEARCH`PLAYER [u(cobj,age)]=
&CHARGEN`SEARCH`ADMIN [u(cobj,age)]=
&CHARGEN`MODE`PLAYER [u(cobj,age)]=
&CHARGEN`MODE`ADMIN [u(cobj,age)]=
&CHARGEN`VIEW`PLAYER [u(cobj,age)]=
&CHARGEN`VIEW`ADMIN [u(cobj,age)]=
&CHARGEN`mantle`PLAYER [u(cobj,age)]=CLAIM|RELEASE|REVOKE|GRANT
&CHARGEN`mantle`ADMIN [u(cobj,age)]=ADD|REMOVE|LOCK|RAWLOCK|UNLOCK

@@ ---- Section for version Switch....

@@ &INC`CHARGEN`SWITCH`MAIN [u(cobj,age)]=@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will switch your Combat System version to [if(default(%#/D`CSYS`VERSION,1),Version 2.x,Version 1.x)]. Your current status and settings will be cleared.,COMBAT SWITCH;@attach %!/INC`MSG=You have switched combat system versions.;@attach %!/INC`MSG`ROOM=Switched to Combat system: [if(default(%#/D`CSYS`VERSION,1),Version 2.x,Version 1.x)];&D`CSYS`VERSION %#=switch(default(%#/D`CSYS`verSION,1),1,2,2,1)

&VERSION [u(cobj,age)]=default(%0/D`CSYS`VERSION,1)

@@ ---- VIEWS
@SQL CREATE OR REPLACE VIEW volv_mantle_stats AS SELECT centity_id AS mantle_id,GROUP_CONCAT(trait_value ORDER BY trait_id SEPARATOR ' ') AS mantle_stats,GROUP_CONCAT(trait_flags_1 ORDER BY trait_id SEPARATOR ' ') AS mantle_accolades FROM vol_ctrait WHERE trait_type=0 GROUP BY centity_id

@SQl CREATE OR REPLACE VIEW volv_mantle AS SELECT c.centity_id AS mantle_id,e.entity_name AS mantle_name,c.centity_date_created AS mantle_date_created,UNIX_TIMESTAMP(c.centity_date_created) AS mantle_date_created_secs,c.centity_version AS mantle_version,s.mantle_stats,s.mantle_accolades,ct.trait_value AS mantle_archetype,l.lock_definition AS mantle_global_lock FROM vol_centity AS c LEFT JOIN vol_entity AS e ON c.centity_id=e.entity_id LEFT JOIN volv_mantle_stats AS s ON s.mantle_id=c.centity_id LEFT JOIN vol_ctrait AS ct ON ct.centity_id=c.centity_id AND trait_type=1 AND trait_id=0 LEFT JOIN volv_lock as l ON l.entity_id=c.centity_id AND l.lock_name='LOAN' WHERE c.centity_type=0

@SQL CREATE OR REPLACE VIEW volv_mantle_link AS SELECT cl.clink_id AS mantle_link_id,cl.clink_display_num AS mantle_link_display_num,cl.character_id,cl.clink_approved AS mantle_link_approved,cl.clink_parent AS mantle_link_parent_id,cl.clink_loan_lock as mantle_link_loan_lock,cl.clink_type as mantle_link_type,cl.clink_locked AS mantle_link_locked,m.* FROM vol_clink AS cl LEFT JOIn volv_mantle AS m ON cl.centity_id=m.mantle_id ORDER BY cl.clink_display_num

@@ ----------- SECTION FOR +SELECT

&INC`CHARGEN`SELECT`MAIN [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=What will you select?;@attach %!/INC`PARTIAL=%0,PLAYER|MANTLE,|,type;@attach %!/INC`CHARGEN`SELECT`%q<type>

&INC`CHARGEN`SELECT`PLAYER [u(cobj,age)]=@select/inline cor(u(isadmin,%#),get(%#/D`TESTER))=1,{@attach %!/INC`CHECKPC=%2,1},{@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`MSG=You can only select yourself.};@select/inline words(u(setr,mantle_id,first(u(mysql,GET`MANTLE,%q<t1id>,u(VERSION,%#)))))=0,{@attach %!/INC`CHARGEN`CREATE`MANTLE`DO=%q<t1name>,%q<t1id>};&D`SELECT`MODE %#=MANTLE;&D`SELECT`PLAYER %#=%q<t1objid>;&D`SELECT`MANTLE %#=%q<mantle_id>;@attach %!/INC`SHOWSELECT

&Q`GET`MANTLE [u(cobj,age)]=SELECT mantle_id FROM volv_mantle_link WHERE character_id=? AND mantle_version=?

&INC`CHARGEN`SELECT`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@attach %!/INC`FINDMANTLELINK=%q<t1id>,%2;&D`SELECT`MANTLE %#=%q<mantle_id>;&D`SELECT`MODE %#=MANTLE;@attach %!/INC`SHOWSELECT

&INC`FINDMANTLELINK [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: No mantle selected!;@select/inline isint(%1)=1,{@check u(setr,mantle_id,first(u(setr,res,u(mysql,SELECT`MANTLE_LINK_ID`EXACT,%0,%1))))=@attach %!/INC`MSG=ERROR: Mantle '%1' not found.},0,{@check cor(u(setr,mantle_id,first(u(setr,res,u(mysql,SELECT`MANTLE_LINK_NAME`EXACT,%0,%1)))),u(setr,mantle_id,first(u(setr,res,u(mysql,SELECT`MANTLE_LINK_NAME`WILD,%0,%1)))))=@attach %!/INC`MSG=ERROR: Mantle '%1' not found!};th u(setq,link_id,elements(%q<res>,2));th u(setq,link_locked,elements(%q<res>,3));th u(setq,archetype_id,elements(%q<res>,4))

&INC`CHARGEN`VIEW`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@attach %!/INC`SELECT`MANTLE;@attach %!/INC`SHOWSELECT

&Q`SELECT`MANTLE_LINK_ID`EXACT [u(cobj,age)]=SELECT mantle_id,mantle_link_id,mantle_link_locked,mantle_archetype FROM volv_mantle_link WHERE character_id=? AND mantle_link_display_num=? LIMIT 1

&Q`SELECT`MANTLE_LINK_NAME`EXACT [u(cobj,age)]=SELECT mantle_id,mantle_link_id,mantle_link_locked,mantle_archetype FROM volv_mantle_link WHERE character_id=? AND mantle_name=? LIMIT 1

&Q`SELECT`MANTLE_LINK_NAME`WILD [u(cobj,age)]=SELECT mantle_id,mantle_link_id,mantle_link_locked,mantle_archetype FROM volv_mantle_link WHERE character_id=? AND mantle_name LIKE '!%%'

&INC`SHOWSELECT [u(cobj,age)]=@pemit %#=u(header,Character Editor: %q<t1name>);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(2 19 6 6 6 6 12 16,ID,Name,Pow,End,Pre,Mit,Weight,Archetype));@dolist/inline/delimit [chr(176)] [u(mysql3,VIEW`MANTLE_LINKS,%q<t1id>)]={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,accs,elements(%q<row>,6,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(2 19 6 6 6 6 12 16,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),elements(%q<stats>,1)[u(FUN`ACC,elements(%q<accs>,1))],elements(%q<stats>,2)[u(FUN`ACC,elements(%q<accs>,2))],elements(%q<stats>,3)[u(FUN`ACC,elements(%q<accs>,3))],elements(%q<stats>,4)[u(FUN`ACC,elements(%q<accs>,4))],u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unshaped),ansi(hx,N/A)))};@pemit %#=u(footer)

&VIEW`WEIGHT [u(cobj,age)]=switch(%0,1,Light,2,Medium,3,Heavy,4,Superheavy,5,Boss,<Unset>)

&FUN`ACC [u(Cobj,age)]=if(gte(%0,3),*%0,repeat(*,%0))

&Q`VIEW`MANTLE_LINKS [u(cobj,age)]=SELECT mantle_link_display_num,mantle_name,mantle_stats,mantle_archetype,mantle_link_approved,mantle_accolades FROM volv_mantle_link WHERE character_id=? AND mantle_link_parent_id IS NULL

&INC`SELECT`PLAYER [u(cobj,age)]=@check isobjid(get(%#/D`SELECT`PLAYER))=@attach %!/INC`MSG=ERROR: No player selected.;@attach %!/INC`CHECKPC=get(%#/D`SELECT`PLAYER),1

&INC`SELECT`MANTLE [u(cobj,age)]=@attach %!/INC`LOAD`MANTLE=get(%#/D`SELECT`MANTLE),%0

&INC`LOAD`MANTLE [u(cobj,age)]=th u(setq,m%1id,%0);th u(setq,mdat,u(mysql3,LOAD`MANTLE_LINK,r(m%1id),%q<t1id>));th iter(linkid displaynum owner approved parent id name creation version stats archetype type lock,u(setq,m%1%i0,elements(%q<mdat>,inum(0),chr(177))));

&Q`LOAD`MANTLE_LINK [u(cobj,age)]=SELECT mantle_link_id,mantle_link_display_num,character_id,mantle_link_approved,mantle_link_parent_id,mantle_id,mantle_name,mantle_date_created_secs,mantle_version,mantle_stats,mantle_archetype FROM volv_mantle_link WHERE mantle_id=? AND character_id=?

@@ --------- SECTION FOR +CREATE

&INC`CHARGEN`CREATE`MAIN [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=What will you create?;@attach %!/INC`PARTIAL=%0,MANTLE,|,type;@attach %!/INC`CHARGEN`CREATE`%q<type>

&INC`CHARGEN`CREATE`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@check strlen(%2)=@attach %!/INC`MSG=ERROR: Pilots require names.;@stop u(mysql,EXIST`MANTLE,%q<t1id>,%2)=@attach %!/INC`MSG=ERROR: Mantle of that name already exists.;@attach %!/INC`CHARGEN`CREATE`MANTLE`DO=%2,%q<t1id>;&D`SELECT`MANTLE %#=%q<mantle_id>;@attach %!/INC`MSG=Mantle created.;&D`SELECT`MODE %#=MANTLE;@attach %!/INC`SHOWSELECT

&Q`EXIST`MANTLE [u(cobj,age)]=SELECT mantle_id FROM volv_mantle_link WHERE character_id=? AND mantle_name=?

&INC`CHARGEN`CREATE`MANTLE`DO [u(cobj,age)]=@attach %!/INC`DOSQL=NEW`MANTLE/mantle_id,%0;@attach %!/INC`DOSQL=NEW`MANTLE2,%q<mantle_id>,u(VERSION,%#);@dolist/inline u(lattr,u(cobj,agedb)/ENTITY`0`STAT`*)={@attach %!/INC`DOSQL=NEW`MANTLE_TRAIT,%q<mantle_id>,last(%i0,`),0,get(u(cobj,agedb)/%i0`DEFAULT)};@attach %!/INC`DOSQL=NEW`MANTLE_LINK,%1,%q<mantle_id>,u(mysql,COUNT`MANTLE_LINKS,%1),0;

&Q`COUNT`MANTLE_LINKS [u(cobj,age)]=SELECT MAX(mantle_link_display_num)+1 FROM volv_mantle_link WHERE character_id=?

&Q`NEW`MANTLE [u(cobj,age)]=INSERT INTo vol_entity (entity_name,entity_type) VALUES (?,9)

&Q`NEW`MANTLE2 [u(cobj,age)]=INSERT INTO vol_centity (centity_id,centity_version,centity_date_created) VALUES (?,?,UTC_TIMESTAMP())

&Q`NEW`MANTLE_TRAIT [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,?,?)

&Q`NEW`MANTLE_LINK [u(cobj,age)]=INSERT INTO vol_clink (character_id,centity_id,clink_display_num,clink_type) VALUES (?,?,?,?)

@@ ------ +DELETE SECTION
&INC`CHARGEN`DELETE`MAIN [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=What will you delete?;@attach %!/INC`PARTIAL=%0,MANTLE,|,type;@attach %!/INC`CHARGEN`DELETE`%q<type>

&INC`CHARGEN`DELETE`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@check strlen(%2)=@attach %!/INC`MSG=ERROR: Pilots require names.;@check u(setr,pilot_id,u(mysql,FIND`PILOT,%q<player_id>,%2,%2))=@attach %!/INC`MSG=ERROR: Pilot '%2' not found.;@check cor(u(isadmin,%#),nor(u(setr,appsta,u(mysql,DELETE`PILOT`APPROVED,%q<player_id>,%q<pilot_id>)),u(setr,gensta,u(mysql,DELETE`PILOT`GENERIC,%q<player_id>,%q<pilot_id>))))=@attach %!/INC`MSG=ERROR: Permission denied. [if(%q<appsta>,switch(%q<appsta>,2,Item is approved.,1,Item is pending review.),Item is a generic.)];@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] The pilot will be deleted. This cannot be undone! Enter the same command again in ten seconds to verify.,DELETE PILOT %q<pilot_id>;@attach %!/INC`DOSQL=DELETE`PILOT,%q<pilot_id>;@attach %!/INC`MSG=Deleted Pilot '%2'!

&Q`DELETE`PILOT [u(cobj,age)]=DELETE FROM csys_pilots where id=?
&Q`DELETE`PILOT`APPROVED [u(cobj,age)]=SELECT approved FROM csys_player_pilots WHERE player_id=? AND pilot_id=?
&Q`DELETE`PILOT`GENERIC [u(cobj,age)]=SELECT gen.id FROM csys_player_pilots as link LEFT JOIN csys_generic_pilot as gen ON gen.id=link.pilot_id WHERE link.player_id=? AND link.pilot_id=?

&Q`GET`PILOT`APPROVED [u(cobj,age)]=SELECT approved FROM csys_player_pilots WHERE player_id=? AND pilot_id=? limit 1


@@ ------ +CLEAR Section
&INC`CHARGEN`CLEAR`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;th u(setq,mode,default(%#/D`SELECT`MODE,None));@check words(u(setr,typchoices,switch(%q<mode>,PILOT,ABILITIES|BOOSTS,MECHA,ABILITIES|BOOSTS|ATTACKS)),|)=@attach %!/INC`MSG=Mode '%q<mode>' cannot clear anything.;@check strlen(%0)=@attach %!/INC`MSG=What will you clear?;@attach %!/INC`PARTIAL=%0,%q<typchoices>,|,type;@attach %!/INC`CHARGEN`CLEAR`READY`%q<mode>;@attach %!/INC`CHARGEN`CLEAR`%q<mode>`%q<type>

&INC`CHARGEN`CLEAR`READY`PILOT [u(cobj,age)]=@attach %!/INC`SELECT`PILOT;@check cor(u(isadmin,%#),not(u(setr,appsta,u(mysql,GET`PILOT`APPROVED,%q<pilot_id>))))=@attach %!/INC`MSG=ERROR: Permission denied. [switch(%q<appsta>,1,This item is pending review.,2,This is approved.)];
&INC`CHARGEN`CLEAR`READY`MECHA [u(cobj,age)]=@attach %!/INC`SELECT`PILOT;@attach %!/INC`SELECT`MECHA;@check cor(u(isadmin,%#),not(u(setr,appsta,u(mysql,GET`MECHA`APPROVED,%q<player_id>,%q<mech_id>))))=@attach %!/INC`MSG=ERROR: Permission denied. [switch(%q<appsta>,1,This item is pending review.,2,This is approved.)];

&INC`CHARGEN`CLEAR`PILOT`ABILITIES [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`PILOT`ABILITIES,%q<pilot_id>;@attach %!/INC`MSG=Pilot Abilities cleared!

&Q`CLEAR`PILOT`ABILITIES [u(cobj,age)]=DELETE FROM csys_pilot_traits WHERE pilot_id=? and mode_id=0

&INC`CHARGEN`CLEAR`MECHA`ABILITIES [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`MECHA`ABILITIES,%q<mech_id>;@attach %!/INC`MSG=Mecha Abilities cleared!

&Q`CLEAR`MECHA`ABILITIES [u(cobj,age)]=DELETE FROM csys_mech_traits WHERE mech_id=? and mode_id=0

&INC`CHARGEN`CLEAR`PILOT`BOOSTS [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`PILOT`BOOSTS,%q<pilot_id>;@attach %!/INC`MSG=Pilot Boosts cleared!

&Q`CLEAR`PILOT`BOOSTS [u(cobj,age)]=DELETE FROM csys_pilot_traits WHERE pilot_id=? and mode_id=1

&INC`CHARGEN`CLEAR`MECHA`BOOSTS [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`MECHA`BOOSTS,%q<mech_id>;@attach %!/INC`MSG=Mecha Boosts cleared!
&Q`CLEAR`MECHA`BOOSTS [u(cobj,age)]=DELETE FROM csys_mech_traits WHERE mech_id=? and mode_id=1

&INC`CHARGEN`CLEAR`MECHA`ATTACKS [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`MECHA`ATTACKS,%q<mech_id>;@attach %!/INC`MSG=Mecha Attacks cleared!
&Q`CLEAR`MECHA`ATTACKS [u(cobj,age)]=DELETE FROM csys_attacks WHERE mech_id=?

@@ ------ +SET Section

&INC`CHARGEN`SET`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@attach %!/INC`CHARGEN`SET`[default(%#/D`SELECT`MODE,MANTLE)]

&INC`CHARGEN`SET`NONE [u(cobj,age)]=@attach %!/INC`MSG=ERROR: No Mode selected!

&INC`CHARGEN`SET`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`MANTLE=1;@check cor(u(isadmin,%#),not(u(setr,appsta,u(mysql,GET`MANTLE`APPROVED,%q<t1id>,%q<m1id>))))=@attach %!/INC`MSG=ERROR: Permission denied. [switch(%q<appsta>,1,This item is pending review.,2,This is approved.)];@check strlen(%0)=@attach %!/INC`MSG=ERROR: Must choose a parameter to set!;@attach %!/INC`PARTIAL=%0,NAME|POWER|ENDURANCE|PRECISION|MITIGATION|STATS|WEIGHT|ARCHETYPE[if(u(tester,%#),|APPROVED|POWBON|ENDBON|PREBON|MITBON)],|,choice;@attach %!/INC`CHARGEN`SET`MANTLE`%q<choice>;@attach %!/INC`SHOWSELECT

&Q`GET`MANTLE`APPROVED [u(cobj,age)]=SELECT mantle_link_approved FROM volv_mantle_link WHERE character_id=? AND m1id=?

&INC`CHARGEN`SET`MANTLE`NAME [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: Nothing entered to Name to!;@stop isint(%2)=@attach %!/INC`MSG=ERROR: None of that tomfoolery please.;@check if(u(setr,exist,u(mysql,EXIST`MANTLE,%q<t1id>,%2)),eq(%q<exist>,%q<t1id>),1)=@attach %!/INC`MSG=ERROR: Mantle names must be unique per player.;@attach %!/INC`DOSQL=SET`MANTLE`NAME,%2,%q<m1id>

&INC`CHARGEN`SET`MANTLE`POWER [u(cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`STAT=%0,%1,%2,0
&INC`CHARGEN`SET`MANTLE`ENDURANCE [u(cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`STAT=%0,%1,%2,1
&INC`CHARGEN`SET`MANTLE`PRECISION [u(cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`STAT=%0,%1,%2,2
&INC`CHARGEN`SET`MANTLE`MITIGATION [u(cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`STAT=%0,%1,%2,3

&INC`CHARGEN`SET`MANTLE`POWBON [u(Cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`ACCOLADE=%0,%1,%2,0
&INC`CHARGEN`SET`MANTLE`ENDBON [u(Cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`ACCOLADE=%0,%1,%2,1
&INC`CHARGEN`SET`MANTLE`PREBON [u(Cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`ACCOLADE=%0,%1,%2,2
&INC`CHARGEN`SET`MANTLE`MITBON [u(Cobj,age)]=@attach %!/INC`CHARGEN`SET`MANTLE`ACCOLADE=%0,%1,%2,3


&INC`CHARGEN`SET`MANTLE`WEIGHT [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@attach %!/INC`PARTIAL=%2,LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS,|,weight;@attach %!/INC`CHARGEN`SET`MANTLE`STAT=%0,%1,match(LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS,%q<weight>,|),4

&INC`CHARGEN`SET`MANTLE`STAT [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@check cand(isint(%2),gte(%2,get(u(cobj,agedb)/ENTITY`0`STAT`%3`MINIMUM)),lte(%2,get(u(cobj,agedb)/ENTITY`0`STAT`%3`MAXIMUM)))=@attach %!/INC`MSG=ERROR: %q<choice> must be a whole number between [get(u(cobj,agedb)/ENTITY`0`STAT`%3`MINIMUM)]-[get(u(cobj,agedb)/ENTITY`0`STAT`%3`MAXIMUM)].;@attach %!/INC`DOSQL=SET`MANTLE`STAT,%2,%q<m1id>,%3;

&Q`SET`MANTLE`NAME [u(cobj,age)]=UPDATE vol_entity SET entity_name=? WHERE entity_id=?
&Q`SET`MANTLE`STAT [u(cobj,age)]=UPDATE vol_ctrait SET trait_value=? WHERE centity_id=? AND trait_id=? AND trait_type=0
&Q`SET`MANTLE`ACCOLADE [u(cobj,age)]=UPDATE vol_ctrait SET trait_flags_1=? WHERE centity_id=? AND trait_id=? AND trait_type=0

&INC`CHARGEN`SET`MANTLE`ACCOLADE [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@check cand(isint(%2),gte(%2,0))=@attach %!/INC`MSG=ERROR: %q<choice> must be a whole number.;@attach %!/INC`DOSQL=SET`MANTLE`ACCOLADE,%2,%q<m1id>,%3;

&Q`SET`MANTLE`APPROVED [u(cobj,age)]=UPDATE vol_clink SET clink_approved=? WHERE character_id=? AND centity_id=?

&INC`CHARGEN`SET`MANTLE`APPROVED [u(cobj,age)]=@check match(0 1,%2)=@attach %!/INC`MSG=ERROR: Approved must be 0 (false) or 1 (true).;@attach %!/INC`DOSQL=SET`MANTLE`APPROVED,if(%2,2,0),%q<t1id>,%q<m1id>;

&INC`CHARGEN`SET`MANTLE`ARCHETYPE [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: Archetype field empty!;@check isint(u(setr,archetype_id,u(FIND_TRAIT,ARC,%2)))=@attach %!/INC`MSG=ERROR: Could not find archetype!;@attach %!/INC`DOSQL=SET`MANTLE`ARCHETYPE,%q<m1id>,0,1,%q<archetype_id>

&Q`SET`MANTLE`ARCHETYPE [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,?,?) ON DUPLICATE KEY UPDATE trait_value=VALUES(trait_value)

&FIND_TRAIT [u(cobj,age)]=localize(if(strlen(u(setr,found,u(filter,EXACT_TRAIT,u(setr,all,u(lattr,u(cobj,agedb)/%0`*)),%b,%b,%1))),last(%q<found>,`),last(first(u(filter,WILD_TRAIT,%q<all>,%b,%b,%1)),`)))

&FIND_MULTI [u(cobj,age)]=localize(if(strlen(u(setr,found,u(filter,EXACT_TRAIT,u(setr,all,u(lattr,u(cobj,agedb)/%0`*)),%b,%b,%1))),last(%q<found>,`),sortkey(#lambda/strlen(get(u(cobj,agedb)/%0`\%0)),iter(u(filter,WILD_TRAIT,%q<all>,%b,%b,%1),last(%i0,`)))))

&FIL`EXACT_TRAIT [u(cobj,age)]=strmatch(%1,get(u(cobj,agedb)/%0))
&FIL`WILD_TRAIT [u(cobj,age)]=strmatch(get(u(cobj,agedb)/%0),%1*)

@@ ---- +ADD SECTION
&INC`CHARGEN`ADD`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@attach %!/INC`CHARGEN`ADD`[default(%#/D`SELECT`MODE,None)]

&INC`CHARGEN`ADD`NONE [u(cobj,age)]=@attach %!/INC`MSG=ERROR: No mode selected!

@@ Mantle
&INC`CHARGEN`ADD`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`MANTLE=1;@check cor(u(isadmin,%#),not(u(setr,appsta,u(mysql,GET`MANTLE`APPROVED,%q<m1id>))))=@attach %!/INC`MSG=ERROR: Permission denied. [switch(%q<appsta>,1,This item is pending review.,2,This is approved.)];@attach %!/INC`PARTIAL=%0,QUIRK,|,choice;@attach %!/INC`CHARGEN`ADD`MANTLE`%q<choice>;@attach %!/INC`SHOWSELECT

&INC`CHARGEN`ADD`MANTLE`QUIRK [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: No Quirk entered to add.;@check u(setr,quirk_id,u(FIND_TRAIT,QRK,%2))=@attach %!/INC`MSG=ERROR: Could not find Quirk named '%2'.;@stop u(mysql,EXIST`MANTLE`QUIRK,%q<m1id>,%q<quirk_id>)=@attach %!/INC`MSG=ERROR: Mantle already has that Quirk.;@attach %!/INC`DOSQL=ADD`MANTLE`QUIRK,%q<m1id>,%q<quirk_id>

&Q`EXIST`MANTLE`QUIRK [u(cobj,age)]=SELECT trait_value FROM vol_ctrait where trait_type=2 AND centity_id=? AND trait_id=?
&Q`ADD`MANTLE`QUIRK [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,2,1)


@@ ---- +REMOVE SECTION
&INC`CHARGEN`REMOVE`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@attach %!/INC`CHARGEN`REMOVE`[default(%#/D`SELECT`MODE,None)]

&INC`CHARGEN`REMOVE`NONE [u(cobj,age)]=@attach %!/INC`MSG=ERROR: No mode selected!

@@ Mantle
&INC`CHARGEN`REMOVE`MANTLE [u(cobj,age)]=@attach %!/INC`SELECT`MANTLE=1;@check cor(u(isadmin,%#),not(u(mysql,GET`MANTLE`APPROVED,%q<m1id>)))=@attach %!/INC`MSG=ERROR: Permission denied.;@attach %!/INC`PARTIAL=%0,QUIRK,|,choice;@attach %!/INC`CHARGEN`REMOVE`MANTLE`%q<choice>;@attach %!/INC`SHOWSELECT

&INC`CHARGEN`REMOVE`MANTLE`QUIRK [u(cobj,age)]=@check strlen(%2)=@attach %!/INC`MSG=ERROR: No Quirk entered to remove.;@check u(setr,quirk_id,u(FIND_TRAIT,QRK,%2))=@attach %!/INC`MSG=ERROR: Could not find Quirk named '%2'.;@check u(setr,exist,u(mysql,EXIST`MANTLE`QUIRK,%q<m1id>,%q<quirk_id>))=@attach %!/INC`MSG=ERROR: Mantle lacks that Quirk.;@attach %!/INC`DOSQL=REMOVE`MANTLE`QUIRK,%q<m1id>,%q<quirk_id>

&Q`REMOVE`MANTLE`QUIRK [u(cobj,age)]=DELETE FROM vol_ctrait where centity_id=? AND trait_type=2 AND trait_id=?



@@ MP/GENERIC SECTION

&INC`STARTMP [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: You must choose between PILOT and MECHA.;@attach %!/INC`PARTIAL=%0,PILOT|MECHA,|,type;@check strlen(%2)=@attach %!/INC`MSG=ERROR: What %q<type> will you look for? Enter its name or ID!;@check u(setr,id,u(mysql,if(%3,EXIST`GENERIC`,FIND2`)%q<type>,%2,%2))=@attach %!/INC`MSG=ERROR: Nothing matched '%2'.;@stop gt(words(%q<id>),1)=@attach %!/INC`MSG=ERROR: '%2' matched %q<type> IDs [itemize(%q<id>,%b,and,\,)]. Please be more specific.;

&INC`CHARGEN`MP`ADD [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,%2;@attach %!/INC`DOSQL=CREATE`GENERIC`%q<type>,%q<id>;@attach %!/INC`MSG=Listed!

&INC`CHARGEN`MP`REMOVE [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,%2,1;@attach %!/INC`DOSQL=REMOVE`GENERIC`%q<type>,%q<id>;@attach %!/INC`MSG=De-listed!

&Q`FIND2`PILOT [u(cobj,age)]=SELECT id from csys_pilots where id=? or name=?
&Q`FIND2`MECHA [u(cobj,age)]=SELECT id from csys_mechas where id=? or name=?

&Q`EXIST`GENERIC`PILOT [u(cobj,age)]=SELECT pilot.id from csys_pilots as pilot LEFT JOIN csys_generic_pilot as gen ON pilot.id=gen.id WHERE pilot.id=? or pilot.name=? and gen.id IS NOT NULL

&Q`EXIST`GENERIC`MECHA [u(cobj,age)]=SELECT mech.id from csys_mechas as mech LEFT JOIN csys_mp_mecha as gen ON mech.id=gen.id WHERE mech.id=? or mech.name=? AND gen.id IS NOT NULL

&Q`CREATE`GENERIC`PILOT [u(cobj,age)]=INSERT INTO csys_generic_pilot (id) VALUES (?)
&Q`CREATE`GENERIC`MECHA [u(cobj,age)]=INSERT INTO csys_mp_mecha (id) VALUES (?)

&Q`REMOVE`GENERIC`PILOT [u(cobj,age)]=DELETE FROM csys_generic_pilot where id=?
&Q`REMOVE`GENERIC`MECHA [u(cobj,age)]=DELETE FROM csys_mp_mecha where id=?

&Q`LINK`PILOT`GENERIC [u(cobj,age)]=INSERT INTO csys_player_pilots (player_id, pilot_id, approved) VALUES (?,?,2) ON DUPLICATE KEY UPDATE pilot_id=pilot_id
&Q`LINK`MECHA`GENERIC [u(cobj,age)]=INSERT INTO csys_player_mechas (player_id, mech_id, approved) VALUES (?,?,2) ON DUPLICATE KEY UPDATE mech_id=mech_id

&Q`GENERIC`RELEASE`PILOT [u(cobj,age)]=DELETE FROM csys_player_pilots WHERE player_id=? and pilot_id=?
&Q`GENERIC`RELEASE`MECHA [u(cobj,age)]=DELETE FROM csys_player_mechas WHERE player_id=? and mech_id=?

&INC`CHARGEN`MP`FACTION [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,before(%2,/),1;@check isobjid(u(setr,fac,objid(u(u(cobj,gms)/FUN`FINDGROUP,after(%2,/)))))=@attach %!/INC`MSG=ERROR: Group not found.;@attach %!/INC`DOSQL=FACTION`GENERIC`%q<type>,%q<fac>,%q<id>;@attach %!/INC`MSG=Faction set to [u(moniker,%q<fac>)]!

&Q`FACTION`GENERIC`MECHA [u(cobj,age)]=UPDATE csys_mp_mecha SET lock_obj=? WHERE id=?
&Q`FACTION`GENERIC`PILOT [u(cobj,age)]=UPDATE csys_generic_pilot SET lock_obj=? WHERE id=?

&INC`CHARGEN`MP`UNFACTION [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,before(%2,/),1;@attach %!/INC`DOSQL=UNFACTION`GENERIC`%q<type>,%q<id>;@attach %!/INC`MSG=Faction unset!

&Q`UNFACTION`GENERIC`MECHA [u(cobj,age)]=UPDATE csys_mp_mecha SET lock_obj=NULL WHERE id=?
&Q`UNFACTION`GENERIC`PILOT [u(cobj,age)]=UPDATE csys_generic_pilot SET lock_obj=NULL WHERE id=?

&INC`CHARGEN`MP`CLAIM [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,%2,1;@attach %!/INC`DOSQL=LINK`%q<type>`GENERIC,%q<pid1>,%q<id>;@attach %!/INC`MSG=Claimed generic %q<type>!

&INC`CHARGEN`MP`RELEASE [u(cobj,age)]=@attach %!/INC`STARTMP=%0,%1,%2,1;@attach %!/INC`DOSQL=GENERIC`RELEASE`%q<type>,%q<pid1>,%q<id>;@attach %!/INC`MSG=Released generic %q<type>!

&INC`CHARGEN`MP`MAIN [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: You must choose between PILOT and MECHA.;@attach %!/INC`PARTIAL=%0,PILOT|MECHA,|,type;@attach %!/INC`CHARGEN`MP`LIST`%q<type>

&INC`CHARGEN`MP`LIST`PILOT [u(cobj,age)]=@pemit %#=u(header,Generic Pilots);@pemit %#=ansi(u(color,%#,COLOR,COLUMN_NAMES),align(3 3 3 3 3 3 3 3 3 15 15,MEL,RNG,SKL,AIM,AGI,MOB,DEF,ARM,CST,Abilities,Boosts));@pemit %#=u(separator);@dolist/inline/delimit [chr(176)] [u(mysql3,LIST`GENERIC`PILOTS)]={@pemit %#=u(separator,elements(%i0,1,chr(177)): [elements(%i0,2,chr(177))][if(isobjid(u(setr,fac,elements(%i0,11,chr(177)))),%b\([u(getproperty`groupname,%q<fac>)]\))]);@pemit %#=align(3 3 3 3 3 3 3 3 3 15 15,elements(%i0,3,chr(177)),elements(%i0,4,chr(177)),elements(%i0,5,chr(177)),elements(%i0,6,chr(177)),elements(%i0,7,chr(177)),elements(%i0,8,chr(177)),elements(%i0,9,chr(177)),elements(%i0,10,chr(177)),lmath(add,elements(%i0,lnum(3,10),chr(177),%b)),u(FUN`LIST`PILOT`ABILITIES,elements(%i0,1,chr(177)),1),u(FUN`LIST`PILOT`BOOSTS,elements(%i0,1,chr(177)),1))};@pemit %#=u(footer)

&Q`LIST`GENERIC`PILOTS [u(cobj,age)]=SELECT orig.id,orig.name,orig.mel,orig.rng,orig.skl,orig.aim,orig.agi,orig.mob,orig.def,orig.arm,gen.lock_obj FROM csys_generic_pilot as gen LEFT JOIN csys_pilots as orig ON orig.id=gen.id WHERE gen.id IS NOT NULL ORDER BY orig.name

&Q`LIST`GENERIC`MECHA [u(cobj,age)]=SELECT orig.id,orig.name,orig.mel,orig.rng,orig.skl,orig.aim,orig.agi,orig.mob,orig.def,orig.arm,orig.tech,orig.tech_x,gen.lock_obj FROM csys_mp_mecha as gen LEFT JOIN csys_mechas as orig ON orig.id=gen.id WHERE gen.id IS NOT NULL ORDER BY orig.name

&INC`CHARGEN`MP`LIST`MECHA [u(cobj,age)]=th u(setq,tech,u(game_config,COMBAT,TECH_LEVEL));@pemit %#=u(header,Generic Mechs);@pemit %#=ansi(u(color,%#,COLOR,COLUMN_NAMES),align(3 3 3 3 3 3 3 3 3 15 15 4,MEL,RNG,SKL,AIM,AGI,MOB,DEF,ARM,CST,Abilities,Boosts,Tech));@pemit %#=u(separator);@dolist/inline/delimit [chr(176)] [u(mysql3,LIST`GENERIC`MECHA)]={@pemit %#=u(separator,elements(%i0,1,chr(177)): [elements(%i0,2,chr(177))][if(isobjid(u(setr,fac,elements(%i0,13,chr(177)))),%b\([u(getproperty`groupname,%q<fac>)]\))]);@pemit %#=align(3 3 3 3 3 3 3 3 3 15 15 4,elements(%i0,3,chr(177)),elements(%i0,4,chr(177)),elements(%i0,5,chr(177)),elements(%i0,6,chr(177)),elements(%i0,7,chr(177)),elements(%i0,8,chr(177)),elements(%i0,9,chr(177)),elements(%i0,10,chr(177)),lmath(add,elements(%i0,lnum(3,10),chr(177),%b)),u(FUN`LIST`MECHA`ABILITIES,elements(%i0,1,chr(177)),1),u(FUN`LIST`MECHA`BOOSTS,elements(%i0,1,chr(177)),1),if(elements(%i0,12,chr(177)),EX,switch(sub(elements(%i0,11,chr(177)),%q<tech>),>=300,S,>=200,A,>=100,B,<=-300,F,<=-200,E,<=-100,D,C)))};@pemit %#=u(footer)

@@ +submit section
&INC`CHARGEN`SUBMIT`MAIN [u(cobj,age)]=@attach %!/INC`SELECT`PLAYER;@check eq(%q<pid1>,%q<player_id>)=@attach %!/INC`MSG=ERROR: Cannot +submit on another's behalf.;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Nothing selected to submit!;@attach %!/INC`PARTIAL=%0,PILOT|MECHA,|,choice;@attach %!/INC`CHARGEN`SUBMIT`[if(%q<choice>,%q<choice>,NONE)]

&INC`CHARGEN`SUBMIT`NONE [u(cobj,age)]=@attach %!/INC`MSG=ERROR: No Mode selected!

&Q`GET`MECHA`NAME [u(cobj,age)]=SELECT name FROM csys_mechas where id=? LIMIT 1
&Q`GET`PILOT`NAME [u(cobj,age)]=SELECT name from csys_pilots where id=? LIMIT 1
&Q`GET`PILOT`CST [u(cobj,age)]=SELECT mel+rng+skl+aim+agi+mob+def+arm FROM csys_pilots where id=? LIMIT 1
&Q`GET`MECHA`CST [u(cobj,age)]=SELECT mel+rng+skl+aim+agi+mob+def+arm FROM csys_mechas where id=? LIMIT 1

&INC`CHARGEN`SUBMIT`PILOT [u(cobj,age)]=@attach %!/INC`SELECT`PILOT;@stop u(setr,appsta,u(mysql,GET`PILOT`APPROVED,%q<player_id>,%q<pilot_id>))=@attach %!/INC`MSG=ERROR: [switch(%q<appsta>,1,Item is pending review.,2,Item is already approved.)];@attach %!/INC`VERIFY=WARNING: This will submit Pilot %q<pilot_id>: '[u(mysql,GET`PILOT`NAME,%q<pilot_id>)]' for approval. Are you sure? Enter the same command again within 10s to continue.,Pilot SUBMIT %q<pilot_id>;th u(setq,name,u(mysql,GET`PILOT`NAME,%q<pilot_id>));th u(setq,cst,u(mysql,GET`PILOT`CST,%q<pilot_id>));@attach %!/INC`DOSQL=SET`PILOT`APPROVED,1,%q<player_id>,%q<pilot_id>;@trigger/spoof u(cobj,jms)/CMD`+REQUEST`MAIN=,u(game_Config,COMBAT,JOB_CAT),PILOT APP: %q<name> (%q<cst>),Pilot %q<pilot_id>: '%q<name>' is awaiting admin approval. CST: %q<cst>

&INC`CHARGEN`SUBMIT`MECHA [u(cobj,age)]=@attach %!/INC`SELECT`PILOT;@attach %!/INC`SELECT`MECHA;@stop u(setr,appsta,u(mysql,GET`MECHA`APPROVED,%q<player_id>,%q<mech_id>))=@attach %!/INC`MSG=ERROR: [switch(%q<appsta>,1,Item is pending review.,2,Item is already approved.)];@attach %!/INC`VERIFY=WARNING: This will submit Mech %q<mech_id>: '[u(mysql,GET`MECHA`NAME,%q<mech_id>)]' for approval. Are you sure? Enter the same command again within 10s to continue.,MECH SUBMIT %q<mech_id>;@attach %!/INC`DOSQL=SET`MECHA`APPROVED,1,%q<player_id>,%q<mech_id>;th u(setq,name,u(mysql,GET`MECHA`NAME,%q<mech_id>));th u(setq,cst,u(mysql,GET`MECHA`CST,%q<mech_id>));@trigger/spoof u(cobj,jms)/CMD`+REQUEST`MAIN=,u(game_Config,COMBAT,JOB_CAT),MECHA APP: %q<name> (%q<cst>),Mecha %q<mech_id>: '%q<name>' is awaiting admin approval.

@@ +matrix section
&INC`CHARGEN`MATRIX`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;&D`MATRIX %#=not(get(%#/D`MATRIX));@attach %!/INc`MSG=You [if(get(%#/D`MATRIX),will now,will no longer)] see the Matrix.

&INC`CHARGEN`ROLLFORCE`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;@attach %!/INC`VALID`INT=%0;&D`ROLLFORCE %#=%q<value>;@attach %!/INC`MSG=Okay! Your next defense roll will be: %q<value>

&INC`CHARGEN`HYPEFORCE`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not battle-ready!;@attach %!/INC`VALID`INT=%2;&D`COMBAT`HYPE %q<t1>=%q<value>;@attach %!/INC`MSG=Okay! %q<t1name>'s current Hype is %q<value>. Are you hype about that?

&INC`CHARGEN`DAMAGEFORCE`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not battle-ready!;@attach %!/INC`VALID`INT=%2;@attach %!/INC`DAMAGE=%q<t1>,%q<value>,Damage Force

&INC`CHARGEN`HEALFORCE`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not battle-ready!;@attach %!/INC`VALID`INT=%2;@attach %!/INC`HEAL=%q<t1>,%q<value>,Heal Force

&INC`CHARGEN`DRIVEFORCE`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Try as you might\, you cannot see the Matrix.;@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not battle-ready!;@attach %!/INC`VALID`INT=%2;&D`COMBAT`DRIVE %q<t1>=%q<value>;@attach %!/INC`MSG=Okay! %q<t1name>'s current Drive is %q<value>. Shift into turbo!;th u(attrib_set,%q<t1>,D`COMBAT`DRIVE`STATUS,u(drivestatus,%q<t1>))

@@ PUSHES
&INC`SETSTATUS [u(cobj,age)]=@dolist/inline get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`PRE_SET_STATUS=%0,%1,%2,get(u(cobj,age)/STATUS`%2`TAGS),%4,%5};@select/inline strlen(%q<blockstatus>)=0,{th u(attrib_set,%0,D`COMBAT`STATUS,u(setr,next,add(1,get(%0/D`COMBAT`STATUS))));@cpattr [u(cobj,age)]/STATUS`%2=%0/D`COMBAT`STATUS`[u(setr,statid,%2$%q<next>)];th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`%2,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`%2),%q<statid>));th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`SOURCE,%#);@select/inline match(get(u(cobj,age)/STATUS`%2`ATTACK_TURNS) %4 %q<statusatkturns>,X)=>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS,X)},0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS,add(get(u(cobj,age)/STATUS`%2`ATTACK_TURNS),%4,%q<statusatkturns>))};@select/inline t(get(%0/D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS))=1,{th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%q<statid>))};@select/inline match(get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS) %5 %q<statusdefturns>,X)=>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS,X)},0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS,add(get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS),%5,%q<statusdefturns>))};@select/inline t(get(%0/D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS))=1,{th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%q<statid>))};@dolist/inline/nobreak/delimit | %3|%q<statargs>={@check strlen(%i0);th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`[before(%i0,=)],after(%i0,=))};@dolist/inline get(u(cobj,age)/STATUS`%2`TAGS)={th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`TAGS`%i0,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`%i0),%q<statid>))};th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS,setunion(get(%0/D`COMBAT`ACTIVE`STATUS),%q<statid>));@attach %!/STATUS`%2`ON_ACTIVATE=%0,%q<statid>;th unsetq(status???turns);@dolist/inline get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_GAIN_STATUS=%0,%1,%q<statid>,%3,%4,%5};@dolist/inline get(%1/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_INFLICT_STATUS=%1,%0,%q<statid>}},{@@ Insert thing here if need a message about Inflict Blocking!}

@@ %0 - Target. %1 - Source. %2 - Status to inflict. %3 - Arguments. %4 - Attack Turn Bonus. %5 - Defense Turn Bonus. (Set to X for indefinite.)

&PUSH`1 [u(cobj,agedb)]=Attack
&PUSH`1`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`1`2 [u(cobj,agedb)]=The next attack deals a Standard degree of more damage.
&PUSH`1`4 [u(cobj,agedb)]=The next attack deals a Substantial degree of more damage.
&PUSH`1`6 [u(cobj,agedb)]=The next attack deals an Overwhelming degree of more damage.
&PUSH`1`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_ATTACK,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Standard,4,Substantial,6,Overwhelming)]

&PUSH`2 [u(cobj,agedb)]=Defense
&PUSH`2`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`2`2 [u(cobj,agedb)]=The next attack against you deals a Standard degree of less damage.
&PUSH`2`4 [u(cobj,agedb)]=The next attack against you deals a Substantial degree of less damage.
&PUSH`2`6 [u(cobj,agedb)]=The next attack against you deals an Overwhelming degree of less damage.
&PUSH`2`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_DEFENSE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Standard,4,Substantial,6,Overwhelming)],0,1

&PUSH`3 [u(cobj,agedb)]=Balance
&PUSH`3`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`3`2 [u(cobj,agedb)]=Your next attack deals a Small degree of more damage, and the next attack against you deals a Small degree of less damage.
&PUSH`3`4 [u(cobj,agedb)]=Your next attack deals a Standard degree of more damage, and the next attack against you deals a Standard degree of less damage.
&PUSH`3`6 [u(cobj,agedb)]=Your next attack deals a Considerable degree of more damage, and the next attack against you deals a Considerable degree of less damage.
&PUSH`3`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_BALANCE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Small,4,Standard,6,Considerable)],1,1

&PUSH`4 [u(cobj,agedb)]=Buff
&PUSH`4`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`4`1 [u(cobj,agedb)]=You gain a Buff that grants a Minor bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`3 [u(cobj,agedb)]=You gain a Buff that grants a Solid bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`5 [u(cobj,agedb)]=You gain a Buff that grants a Major bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`7 [u(cobj,agedb)]=You gain a Buff that grants a Superior bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`ACTIVATE [u(cobj,agedb)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: You must choose a stat! Syntax: +push Buff/#=<stat>;@attach %!/INC`PARTIAL=%1,POWER|PRECISION|ENDURANCE|MITIGATION,|,pushchoice;@attach %!/INC`SETSTATUS=%#,%#,PUSH_BUFF_%q<pushchoice>,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Minor,3,Solid,5,Major,7,Superior)]

&PUSH`5 [u(cobj,agedb)]=Debuff
&PUSH`5`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`5`1 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Minor penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`3 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Solid penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`5 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Major penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`7 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Superior penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`ACTIVATE [u(cobj,agedb)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: You must choose a stat! Syntax: +push Debuff/#=<stat>;@attach %!/INC`PARTIAL=%1,POWER|PRECISION|ENDURANCE|MITIGATION,|,pushchoice;@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_DEBUFF_%q<pushchoice>,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Minor,3,Solid,5,Major,7,Superior)],1,0

&PUSH`6 [u(cobj,agedb)]=Damage Over Time
&PUSH`6`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`6`1 [u(cobj,agedb)]=A Tiny amount of the total damage you deal on your next attack will be dealt to the target when they attack, for their next 2 turns.
&PUSH`6`3 [u(cobj,agedb)]=A Standard amount of the total damage you deal on your next attack will be dealt to the target when they attack, for their next 2 turns.
&PUSH`6`5 [u(cobj,agedb)]=A Considerable amount of the total damage you deal on your next attack will be dealt to the target when they attack, for their next 2 turns.
&PUSH`6`7 [u(cobj,agedb)]=A Substantial amount of the total damage you deal on your next attack will be dealt to the target when they attack, for their next 2 turns.
&PUSH`6`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_DOT,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Tiny,3,Standard,5,Considerable,7,Substantial)],1,0

&PUSH`7 [u(cobj,agedb)]=Cure
&PUSH`7`CHOICES [u(cobj,agedb)]=3|5|7
&PUSH`7`3 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Moderate/Small severity or lower.
&PUSH`7`5 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Significant/Standard severity or lower.
&PUSH`7`7 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Superior/Substantial severity or lower.
&PUSH`7`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_CURE,COST=%q<hypecost>,0,0

&PUSH`8 [u(cobj,agedb)]=Break
&PUSH`8`CHOICES [u(cobj,agedb)]=3|5|7
&PUSH`8`3 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Moderate bonus or lower if it deals damage.
&PUSH`8`5 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Significant bonus or lower if it deals damage.
&PUSH`8`7 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Superior bonus or lower if it deals damage.
&PUSH`8`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_BREAK,COST=%q<hypecost>,1,0

&PUSH`9 [u(cobj,agedb)]=Boost
&PUSH`9`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`9`2 [u(cobj,agedb)]=You immediately gain 4 Drive.
&PUSH`9`4 [u(cobj,agedb)]=You immediately gain 8 Drive.
&PUSH`9`6 [u(cobj,agedb)]=You immediately gain 12 Drive.
&PUSH`9`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_BOOST,COST=%q<hypecost>,0,0

&PUSH`10 [u(cobj,agedb)]=Coup de Grace
&PUSH`10`CHOICES [u(cobj,agedb)]=3|5
&PUSH`10`3 [u(cobj,agedb)]=Your next attack converts all Debuff and Damage Over Time effects of Solid/Standard severity or lower into immediate heavy damage.
&PUSH`10`5 [u(cobj,agedb)]=Your next attack converts all Debuff and Damage Over Time effects currently on the target into immediate heavy damage.
&PUSH`10`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_COUPDEGRACE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,3,Solid,5,All)],1,0

&PUSH`11 [u(cobj,agedb)]=Finishing Blow
&PUSH`11`CHOICES [u(cobj,agedb)]=10
&PUSH`11`10 [u(cobj,agedb)]=Your next attack, so long as it does not result in a Miss, automatically becomes a Critical Hit after its final result is decided.
&PUSH`11`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_FINISHINGBLOW,COST=%q<hypecost>,1,0

&PUSH`12 [u(cobj,agedb)]=Second Wind
&PUSH`12`CHOICES [u(cobj,agedb)]=9
&PUSH`12`9 [u(cobj,agedb)]=You immediately recover 15% of your Max HP and all Debuffs and Damage over Time effects applied to you are cured, but you receive a Significant penalty to Endurance and Mitigation for one round. This Push can only be used once.
&PUSH`12`ACTIVATE [u(cobj,agedb)]=@stop get(%#/D`COMBAT`HISTORY`SECONDWIND)=@attach %!/INC`MSG=ERROR: You have already used Second Wind this fight!;@attach %!/INC`SETSTATUS=%#,%#,PUSH_SECONDWIND,COST=%q<hypecost>,0,1

&PUSH`13 [u(cobj,agedb)]=Ultimate Attack
&PUSH`13`CHOICES [u(cobj,agedb)]=10
&PUSH`13`10 [u(cobj,agedb)]=Your next attack deals +50% its normal amount of damage, but is somewhat less accurate.
&PUSH`13`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_ULTIMATEATTACK,COST=%q<hypecost>,1,0

&PUSH`14 [u(Cobj,agedb)]=Exhaust
&PUSH`14`CHOICES [u(Cobj,agedb)]=2|4|6
&PUSH`14`2 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 4 if it deals damage.
&PUSH`14`4 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 8 if it deals damage.
&PUSH`14`6 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 12 if it deals damage.
&PUSH`14`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_EXHAUST,COST=%q<hypecost>|DISPLAY=%q<hypecost>,1,0

&PUSH`15 [u(cobj,agedb)]=Indomitability
&PUSH`15`CHOICES [u(cobj,agedb)]=10
&PUSH`15`10 [u(cobj,agedb)]=After your next attack, all incoming attack damage is reduced by 30%! Wears off when you attack again.
&PUSH`15`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INDOMITABILITY,COST=%q<hypecost>,X,X

@@ STATUS Section 
&GETSTATUS [u(cobj,age)]=add(if(isnum(u(setr,adjbon,u(STATUS`[before(%1,$)]`%2`%3,%0,%1))),%q<adjbon>,u(adj,u(adjinc,%q<adjbon>,u(ladd,iter(get(u(setr,src,get(%0/D`COMBAT`STATUS`%1`SOURCE))/D`COMBAT`ACTIVE`STATUS),get(u(cobj,age)/STATUS`[before(%i0,$)]`OPPONENT`STATUS`[before(%1,$)]`%2`%3`UPGRADE)))))),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(adj,u(STATUS`[before(%i0,$)]`STATUS`[before(%1,$)]`%2`%3,%0,%i0)))))
@@ Arguments. %0 - the character. %1 - the status name. %2 - Attack/Defense. %3 - The attribute to grab.


@@ STATUS - Offenses

&STATUS`OFF_CONSISTENT [u(cobj,age)]=Consistent
&STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`OFF_FORCEFUL [u(cobj,age)]=Forceful
&STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`OFF_EFFICIENT [u(cobj,age)]=Consistent
&STATUS`OFF_EFFICIENT`ATTACK`DRIVE_COST [u(cobj,age)]=mul(get(%0/D`COMBAT`STATUS`%1`LEVEL),-1)

&STATUS`OFF_DRAMATIC [u(cobj,age)]=Dramatic
&STATUS`OFF_DRAMATIC`ATTACK_END_TURN [u(cobj,age)]=@select/inline t(u(setr,gainhype,switch(%q<atklevel>,1,switch(die(1,2),2,1,0),2,add(1,switch(die(1,5),1,1,0)),3,add(1,switch(die(1,5),1,0,1)),4,add(2,switch(die(1,5),1,0,1)),5,add(3,switch(die(1,2),1,1,0)))))=1,{@attach %!/INC`HYPE=%0,%q<gainhype>,Dramatic Attack}

@@ STATUS - Defenses
&STATUS`DEF_FOCUS [u(cobj,age)]=Focus
&STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`DEF_FOCUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`DEF_FOCUS`DESCRIPTION [u(Cobj,age)]=Moderate Bonus to Precision

&STATUS`DEF_BOLSTER [u(cobj,age)]=Bolster
&STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`DEF_BOLSTER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`DEF_BOLSTER`DESCRIPTION [u(Cobj,age)]=Moderate Bonus to Power

&STATUS`DEF_GUARD [u(cobj,age)]=Guard
&STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`DEF_MANEUVER [u(Cobj,age)]=Maneuver
&STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

&STATUS`DEF_RALLY [u(cobj,age)]=Rally
&STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=5
&STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`DEF_RALLY`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`DRIVE=%0,u(getstatus,%0,%1,DEFENSE,BONUS`DRIVE_GAIN),Rally

@@ STATUS - Archetypes - Generalists

&STATUS`ARC_ALLSTAR [u(cobj,age)]=All-Star
&STATUS`ARC_ALLSTAR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`STATIC`MAXIMUM`HP [u(cobj,age)]=15
&STATUS`ARC_ALLSTAR`STATIC`GAIN`DRIVE [u(cobj,age)]=5

&STATUS`ARC_MARKSMAN [u(cobj,age)]=Marksman
&STATUS`ARC_MARKSMAN`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_MARKSMAN`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_MARKSMAN`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_MARKSMAN`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Moderate
&STATUS`ARC_MARKSMAN`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor

&STATUS`ARC_BRUISER [u(cobj,age)]=Bruiser
&STATUS`ARC_BRUISER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_BRUISER`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_BRUISER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_BRUISER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_BRUISER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`ARC_TOUGHGUY [u(cobj,age)]=Tough Guy
&STATUS`ARC_TOUGHGUY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_TOUGHGUY`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_TOUGHGUY`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_TOUGHGUY`STATIC`MAXIMUM`HP [u(cobj,age)]=30

&STATUS`ARC_VIGILANT [u(cobj,age)]=Vigilant
&STATUS`ARC_VIGILANT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_VIGILANT`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_VIGILANT`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_VIGILANT`STATIC`GAIN`DRIVE [u(cobj,age)]=1

&STATUS`ARC_HERO [u(cobj,age)]=Hero
&STATUS`ARC_HERO`STATIC`GAIN`DRIVE [u(Cobj,age)]=5
&STATUS`ARC_HERO`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=3
&STATUS`ARC_HERO`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_HERO`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_HERO`STATIC`MAXIMUM`HP [u(cobj,age)]=75

&STATUS`ARC_DUELIST [u(cobj,age)]=Duelist
&STATUS`ARC_DUELIST`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate


&STATUS`ARC_SLUGGER [u(Cobj,age)]=Slugger
&STATUS`ARC_SLUGGER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_STRIKER [u(cobj,age)]=Striker
&STATUS`ARC_STRIKER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_STRIKER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_STRIKER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_DEFENDER [u(Cobj,age)]=Defender
&STATUS`ARC_DEFENDER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_DEFENDER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_DEFENDER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_DEFENDER`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_DEFENDER`STATIC`MAXIMUM`HP [u(cobj,age)]=15

&STATUS`ARC_FREESTYLIST [u(cobj,age)]=Freestylist
&STATUS`ARC_FREESTYLIST`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=2

&STATUS`ARC_CHALLENGER [u(Cobj,age)]=Challenger
&STATUS`ARC_CHALLENGER`STATIC`MAXIMUM`HP [u(cobj,age)]=120
&STATUS`ARC_CHALLENGER`STATIC`MAXIMUM`DRIVE [u(cobj,age)]=20
&STATUS`ARC_CHALLENGER`STATIC`START`DRIVE [u(cobj,age)]=20
&STATUS`ARC_CHALLENGER`STATIC`START`HYPE [u(cobj,age)]=2

@@ STATUS - ARchetypes - Specialists

&STATUS`ARC_ACE [u(cobj,age)]=Ace
&STATUS`ARC_ACE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Moderate,Ready,Minor)
&STATUS`ARC_ACE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Minor,Ready,Minor)
&STATUS`ARC_ACE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Moderate,Ready,Minor)
&STATUS`ARC_ACE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Minor,Ready,Minor)
&STATUS`ARC_ACE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid)
&STATUS`ARC_ACE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid)
&STATUS`ARC_ACE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid)
&STATUS`ARC_ACE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid)
&STATUS`ARC_ACE`ATTACK`DRIVE_COST [u(cobj,age)]=-5
&STATUS`ARC_ACE`DRIVE`EXHAUSTION_MULTIPLIER [u(Cobj,age)]=1
&STATUS`ARC_ACE`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ACE`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor

&STATUS`ARC_ARSENAL [u(cobj,age)]=Arsenal
&STATUS`ARC_ARSENAL`STATIC`GAIN`HYPE [u(cobj,age)]=2
&STATUS`ARC_ARSENAL`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`ARC_ARSENAL`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)

&STATUS`ARC_ARSENAL`STATUS`DEF_BOLSTER`DEFENSE`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)


&STATUS`ARC_ASPIRANT [u(cobj,age)]=Aspirant
&STATUS`ARC_ASPIRANT`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_PRECISION,,2,0;
&STATUS`ARC_ASPIRANT`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_POWER,,2,0;
&STATUS`ARC_ASPIRANT`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_ENDURANCE,,0,2;
&STATUS`ARC_ASPIRANT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_MITIGATION,,0,2;
&STATUS`ARC_ASPIRANT`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_DRIVE,,0,2;
&STATUS`ARC_ASPIRANT`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_POWER,,2,0;
&STATUS`ARC_ASPIRANT`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_POWER,,2,0;
&STATUS`ARC_ASPIRANT`OFF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_DRIVE,,0,2;
&STATUS`ARC_ASPIRANT`OFF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_HYPE,,0,2;
&STATUS`ARC_ASPIRANT`STATIC`START`HYPE [u(cobj,age)]=2
&STATUS`ARC_ASPIRANT`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_FIRST,,1,1;

&STATUS`ARC_ASPIRANT_FIRST [u(Cobj,age)]=Aspirant-FirstTurn
&STATUS`ARC_ASPIRANT_FIRST`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ASPIRANT_PRECISION [u(cobj,age)]=Aspirant-Precision
&STATUS`ARC_ASPIRANT_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_ASPIRANT_POWER [u(cobj,age)]=Aspirant-Power
&STATUS`ARC_ASPIRANT_POWER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_ASPIRANT_ENDURANCE [u(cobj,age)]=Aspirant-Endurance
&STATUS`ARC_ASPIRANT_PRECISION`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`ARC_ASPIRANT_MITIGATION [u(cobj,age)]=Aspirant-Mitigation
&STATUS`ARC_ASPIRANT_MITIGATION`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

&STATUS`ARC_ASPIRANT_HYPE [u(Cobj,age)]=Aspirant-Hype
&STATUS`ARC_ASPIRANT_DRIVE`GAIN`HYPE [u(cobj,age)]=1

&STATUS`ARC_ASPIRANT_DRIVE [u(cobj,age)]=Aspirant-Drive
&STATUS`ARC_ASPIRANT_DRIVE`GAIN`DRIVE [u(cobj,age)]=3

&STATUS`ARC_ASSASSIN [u(Cobj,age)]=Assassin
&STATUS`ARC_ASSASSIN`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%#,ARC_ASSASSIN_FOCUS,,1,0;
&STATUS`ARC_ASSASSIN`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%#,%#,ARC_ASSASSIN_MANEUVER,,0,1;
&STATUS`ARC_ASSASSIN`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Moderate

&STATUS`ARC_ASSASSIN_FOCUS [u(cobj,age)]=Assassin-Focus

&STATUS`ARC_ASSASSIN_FOCUS`ATTACK_MODIFY_HITMUL [u(Cobj,age)]=@select/inline and(Eq(%q<hitmul>,0.7),lte(u(setr,assrand,rand(0,100)),35))=1,{th u(setq,assmod,1);@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] deftly hits where it hurts! Critical Hit!;th u(setq,hitmul,1.0)};@attach %!/INC`DEBUG=ASSASSIN-FOCUS,Solid>Crit Upgrade Random: %q<assrand>/35;th unsetq(assrand)
&STATUS`ARC_ASSASSIN_FOCUS`ATTACK_INCREASE_DAMAGE [u(Cobj,age)]=@select/inline and(not(%q<assmod>),gte(%q<hitmul>,1.0),lte(u(setr,assrand,rand(0,100)),35))=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] blitzes through [ansi(hw,%n)]'s Defenses!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,35)))};@attach %!/INC`DEBUG=ASSASSIN-FOCUS,Natural Critical Bonus Random: %q<assrand>/35;th unsetq(assrand)

&STATUS`ARC_ASSASSIN_MANEUVER [u(cobj,age)]=Assassin-Maneuver
&STATUS`ARC_ASSASSIN_MANEUVER`DEFENSE_INCREASE_DAMAGE [u(cobj,age)]=@select/inline gte(%q<hitmul>,1)=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,%n)] is too lightly armored!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,20)))}
&STATUS`ARC_ASSASSIN_MANEUVER`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline eq(0.4,%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] barely touches [ansi(hw,%n)] at all!;th u(setq,damage,round(mul(%q<damage>,sub(1.0,u(scatter,35))),0))}

&STATUS`ARC_BERSERKER [u(cobj,age)]=Berserker
&STATUS`ARC_BERSERKER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(lte(u(setr,berper,u(percent,%0)),0.25),Extreme,if(lte(%q<berper>,0.5),Superior,if(lte(%q<berper>,0.75),Significant,Solid)))
&STATUS`ARC_BERSERKER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=if(lte(u(setr,berper,u(percent,%0)),0.25),Solid,if(lte(%q<berper>,0.5),Moderate,if(lte(%q<berper>,0.75),Minor,0)))
&STATUS`ARC_BERSERKER`STATIC`MAXIMUM`HP [u(Cobj,age)]=120
@@ &STATUS`ARC_BERSERKER`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
@@ &STATUS`ARC_BERSERKER`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_BERSERKER`BELOW_75_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is starting to get angry!
&STATUS`ARC_BERSERKER`BELOW_50_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is getting mighty pissed!
&STATUS`ARC_BERSERKER`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is totally hulked out with rage!

&STATUS`ARC_BIGFOUR [u(cobj,age)]=Big Four
&STATUS`ARC_BIGFOUR`STATIC`MAXIMUM`QUIRKS [u(cobj,age)]=2
&STATUS`ARC_BIGFOUR`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=Minor

&STATUS`ARC_BLASTER [u(Cobj,age)]=Blaster
&STATUS`ARC_BLASTER`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Major
&STATUS`ARC_BLASTER`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_BLASTER`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Minor
&STATUS`ARC_BLASTER`OFF`3`ACTIVATE [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`ARC_BLASTER_EFFICIENT))=0,{@attach %!/INC`SETSTATUS=%0,%0,ARC_BLASTER_EFFICIENT,CHARGED=0,X,0}
&STATUS`ARC_BLASTER`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,switch(%q<atklevel>,1,6,2,12,3,18,4,25,5,35))))

&STATUS`ARC_BLASTER_EFFICIENT [u(cobj,age)]=Blaster-Efficient
&STATUS`ARC_BLASTER_EFFICIENT`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=@select/inline get(%0/%q<atk>`STATUS`%1`CHARGED)=0,{th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,switch(%q<atklevel>,1,3,2,5,3,7,4,10,5,12))))};@select/inline cand(eq(1,get(%0/%q<atk>`STATUS`%1`CHARGED)),eq(3,%q<off>))=1,{@select/inline gte(%q<hitmul>,0)=1,{th u(setq,damage,add(%q<damage>,get(%0/%q<atk>`STATUS`%1`CHARGE)))};@attach %!/INC`EANNOUNCE=BLASTER,[ansi(hw,name(%q<atker>))] is firing [poss(%q<atker>)] lazer!;th u(attrib_set,%q<atker>,D`COMBAT`STATUS`%1`CHARGED,2)}
&STATUS`ARC_BLASTER_EFFICIENT`ATTACK_ON_MISS [u(cobj,age)]=@select/inline get(%0/%q<atk>`STATUS`%1`CHARGED)=0,{@attach %!/KILLSTATUS=%q<atker>,%1}
&STATUS`ARC_BLASTER_EFFICIENT`ATTACK_NEGATE_DAMAGE [u(cobj,age)]=@select/inline get(%0/%q<atk>`STATUS`%1`CHARGED)=0,{th u(attrib_set,%q<atker>,D`COMBAT`STATUS`%1`CHARGE,%q<damage>);th u(setq,damage,0);th u(attrib_set,%q<atker>,D`COMBAT`STATUS`%1`CHARGED,1);@attach %!/INC`EANNOUNCE=BLASTER,[ansi(hw,name(%q<atker>))] readies a Charged Attack!}
&STATUS`ARC_BLASTER_EFFICIENT`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline get(%q<atker>/D`COMBAT`STATUS`%1`CHARGED)=2,{@attach %!/KILLSTATUS=%q<atker>,%1}




&STATUS`ARC_DEMORALIZER [u(cobj,age)]=Demoralizer
&STATUS`ARC_DEMORALIZER`STATIC`GAIN`DRIVE [u(Cobj,age)]=1
&STATUS`ARC_DEMORALIZER`STATIC`MAXIMUM`HP [u(cobj,age)]=50
&STATUS`ARC_DEMORALIZER`ATTACK_POST_DAMAGE [u(cobj,age)]=@select/inline %q<off>=3,{th u(setq,olddrive,get(%0/D`COMBAT`DRIVE));@attach %!/INC`DRIVE=%0,-[mul(2,%q<atklevel>)],Demoralizer;@select/inline lt(get(%0/D`COMBAT`DRIVE),%q<olddrive>)=1,{@attach %!/INC`DRIVE=%q<atker>,1,Demoralizer}},5,{@attach %!/INC`SETSTATUS=%q<atker>,%q<atker>,ARC_DEMORALIZER_POWER,,1,0;@attach %!/INC`HYPE=%#,-%q<atklevel>,Demoralizer}
&STATUS`ARC_DEMORALIZER`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=add(u(adj,get(u(cobj,agedb)/DRIVES`[get(%#/%q<atk>`DRIVESTATUS)]`DEFENSE`PENALTY`STAT`0)),u(adj,if(words(get(%#/%q<atk>`ACTIVE`STATUS`PUSH)),Minor,0)))
&STATUS`ARC_DEMORALIZER`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=get(u(cobj,agedb)/DRIVES`[get(%#/%q<atk>`DRIVESTATUS)]`DEFENSE`PENALTY`STAT`1)
&STATUS`ARC_DEMORALIZER`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=add(u(adj,get(u(cobj,agedb)/DRIVES`[get(%#/%q<atk>`DRIVESTATUS)]`DEFENSE`PENALTY`STAT`2)),u(adj,if(words(get(%#/%q<atk>`ACTIVE`STATUS`PUSH)),Minor,0)))
&STATUS`ARC_DEMORALIZER`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=get(u(cobj,agedb)/DRIVES`[get(%#/%q<atk>`DRIVESTATUS)]`DEFENSE`PENALTY`STAT`3)

&STATUS`ARC_DEMORALIZER_POWER [u(cobj,age)]=Demoralizer-Power
&STATUS`ARC_DEMORALIZER_POWER`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Moderate

&STATUS`ARC_DESTROYER [u(cobj,age)]=Destroyer
&STATUS`ARC_DESTROYER`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline %q<off>=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_DESTROYER_DOT,DAMAGE=%q<damage>|INCREMENT=0,0,4},2,{@attach %!/INC`SETSTATUS=%0,%0,ARC_DESTROYER_FORCEFUL,,0,2;@attach %!/INC`EANNOUNCE=DESTROYER,[ansi(h,%n)] now suffers from a Moderate Penalty to Endurance and Mitigation!},3,{@attach %!/INC`DRIVE=%0,mul(%q<atklevel>,-2),Destroyer},4,{@attach %!/INC`HEAL=%q<atker>,round(mul(%q<damage>,u(scatter,12)),0),Destroyer}
&STATUS`ARC_DESTROYER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`ARC_DESTROYER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`ARC_DESTROYER`STATIC`MAXIMUM`HP [u(Cobj,age)]=-50

&STATUS`ARC_DESTROYER_FORCEFUL [u(cobj,age)]=Destroyer-Forceful
&STATUS`ARC_DESTROYER_FORCEFUL`TAGS [u(cobj,age)]=DISPLAY DEBUFF
&STATUS`ARC_DESTROYER_FORCEFUL`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Endurance and Mitigation
&STATUS`ARC_DESTROYER_FORCEFUL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_DESTROYER_FORCEFUL`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_DESTROYER_FORCEFUL`CURE`ADJECTIVE [u(cobj,age)]=Moderate

&STATUS`ARC_DESTROYER_DOT [u(Cobj,age)]=Destroyer-DOT
&STATUS`ARC_DESTROYER_DOT`DESCRIPTION [u(cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_DESTROYER_DOT`TAGS [u(cobj,age)]=DOT DISPLAY
&STATUS`ARC_DESTROYER_DOT`DEFENSE`DOT [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,9.5,4.5)))),0)
&STATUS`ARC_DESTROYER_DOT`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=DESTROYER,[ansi(h,%n)] suffers a grievous wound! Cure it quickly or suffer Damage over Time!
&STATUS`ARC_DESTROYER_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Small,1,Small,Tiny)

&STATUS`ARC_FENCER [u(cobj,age)]=Fencer
&STATUS`ARC_FENCER`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_GUARD,,0,1
&STATUS`ARC_FENCER`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_MANEUVER,,1,0
&STATUS`ARC_FENCER`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_FOCUS,,1,0

&STATUS`ARC_FENCER`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Minor
&STATUS`ARC_FENCER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FENCER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Minor
&STATUS`ARC_FENCER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Minor),2)

&STATUS`ARC_FENCER_FOCUS [u(Cobj,age)]=Fencer-Focus
&STATUS`ARC_FENCER_FOCUS`ATTACK_ON_STRIKE [u(Cobj,age)]=@select/inline gte(%q<hitmul>,0.7)=1,{@attach %!/INC`DRIVE=%q<atker>,5,Fencer Drive Bonus}

&STATUS`ARC_FENCER_GUARD [u(cobj,age)]=Fencer-Guard
&STATUS`ARC_FENCER_GUARD`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=@select/inline and(eq(%q<hitmul>,0.4),lte(u(setr,frand,rand(0,100)),30))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=FENCER,[ansi(hw,%n)] deftly parries the blow!};@attach %!/INC`DEBUG=FENCER-GUARD,Close>Miss Downgrade Rand: %q<frand>;th unsetq(frand)

&STATUS`ARC_FENCER_MANEUVER [u(cobj,age)]=Fencer-Maneuver
&STATUS`ARC_FENCER_MANEUVER`ATTACK_INCREASE_DAMAGE [u(Cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,switch(%q<hitmul>,0.7,20,1.0,10,0))))

&STATUS`ARC_FURY [u(cobj,age)]=Fury
&STATUS`ARC_FURY`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,30)))
&STATUS`ARC_FURY`ATTACK_POST_DAMAGE [u(Cobj,age)]=@attach %!/INC`DAMAGE=%q<atker>,round(mul(%q<startdamage>,u(scatter,5)),0),Fury Backlash;@attach %!/INC`DRIVE=%q<atker>,5,Fury Drive Bonus
&STATUS`ARC_FURY`ATTACK_ON_CRITICAL [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,5,Fury Critical Drive Bonus
&STATUS`ARC_FURY`ATTACK_ON_MISS [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,-5,Fury
&STATUS`ARC_FURY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`BANNED`OFF [u(Cobj,age)]=3
&STATUS`ARC_FURY`STATIC`GAIN`DRIVE [u(Cobj,age)]=-5

&STATUS`ARC_GAMBLER [u(cobj,age)]=Gambler
&STATUS`ARC_GAMBLER`STATIC`MAXIMUM`HP [u(cobj,age)]=45
&STATUS`ARC_GAMBLER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=GAMBLER,[ansi(hw,%n)] spins the slots! [switch(%q<gamble2>,>75,Minor Penalty,Solid Bonus)] to Endurance and Mitigation!;@attach %!/INC`DEBUG=GAMBLER,Defense Stat Bonus Rand: %q<gamble2>/75;@attach %!/INC`[u(setr,gam3,randword(HYPE DRIVE))]=%0,switch(%q<gam3>,DRIVE,5,HYPE,1),Gambler;
&STATUS`ARC_GAMBLER`ATTACK_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=GAMBLER,[ansi(hw,%n)] spins the slots! [switch(%q<gamble1>,>75,Minor Penalty,Solid Bonus)] to Precision and Power!;@attach %!/INC`DEBUG=GAMBLER,Attack Bonus Rand: %q<gamble1>/75

&STATUS`ARC_GRAPPLER [u(Cobj,age)]=Grappler
&STATUS`ARC_GRAPPLER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GRAPPLER_READY,STAT=[u(setr,grapstat,switch(%q<def>,1,PRECISION,2,POWER,3,ENDURANCE,4,MITIGATION))]|A_TURNS=[switch(%q<def>,1,1,2,1,3,0,4,0)]|D_TURNS=[switch(%q<def>,1,0,2,0,3,1,4,1)],1,0;@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(hw,%n)] readies a Significant %q<grapstat> Penalizing attack!

&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3`UPGRADE [u(cobj,age)]=1

&STATUS`ARC_GRAPPLER`PUSH_ON_ACTIVATE [u(Cobj,age)]=@select/inline cand(not(match(get(u(cobj,age)/STATUS`%2`TAGS),DEBUFF)),not(words(get(%0/D`COMBAT`ACTIVE`STATUS`ARC_GRAPPLER_PUSH))))=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GRAPPLER_PUSH,,1,0}
&STATUS`ARC_GRAPPLER`ON_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline t(match(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DEBUFF,|))=1,{@attach %!/INC`HYPE=%0,Grappler Bonus}

&STATUS`ARC_GRAPPLER_PUSH [u(Cobj,age)]=Grappler-Push
&STATUS`ARC_GRAPPLER_PUSH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GRAPPLER_PUSH`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GRAPPLER_PUSH`DESCRIPTION [u(cobj,age)]=Minor Buff to Precision
&STATUS`ARC_GRAPPLER_PUSH`BREAK`ADJECTIVE [u(cobj,age)]=Minor

&STATUS`ARC_GRAPPLER_READY [u(cobj,age)]=Grappler-Ready
&STATUS`ARC_GRAPPLER_READY`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_GRAPPLER_[get(%0/%q<atk>`STATUS`%1`STAT)],,get(%0/%q<atk>`STATUS`%1`A_TURNS),get(%0/%q<atk>`STATUS`%1`D_TURNS);@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(hw,%n)] suffers a [capstr(get(%0/%q<atk>`STATUS`%1`STAT))] debuff!

&STATUS`ARC_GRAPPLER_PRECISION [u(Cobj,age)]=Grappler-PrecisionDebuff
&STATUS`ARC_GRAPPLER_PRECISION`TAGS [u(cobj,age)]=DEBUFF
&STATUS`ARC_GRAPPLER_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_PRECISION`DESCRIPTION [u(cobj,age)]=Significant Penalty to Precision

&STATUS`ARC_GRAPPLER_POWER [u(cobj,age)]=Grappler-PowerDebuff
&STATUS`ARC_GRAPPLER_POWER`TAGS [u(cobj,age)]=DEBUFF
&STATUS`ARC_GRAPPLER_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_POWER`DESCRIPTION [u(cobj,age)]=Significant Penalty to Power

&STATUS`ARC_GRAPPLER_ENDURANCE [u(cobj,age)]=Grappler-EnduranceDebuff
&STATUS`ARC_GRAPPLER_ENDURANCE`TAGS [u(cobj,age)]=DEBUFF
&STATUS`ARC_GRAPPLER_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_ENDURANCE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Endurance

&STATUS`ARC_GRAPPLER_MITIGATION [u(cobj,age)]=Grappler-MitigationDebuff
&STATUS`ARC_GRAPPLER_MITIGATION`TAGS [u(cobj,age)]=DEBUFF
&STATUS`ARC_GRAPPLER_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_MITIGATION`DESCRIPTION [u(cobj,age)]=Significant Penalty to Mitigation


&STATUS`ARC_GHOST [u(cobj,age)]=Ghost
&STATUS`ARC_GHOST`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=th u(setq,ghost_downgrade,lte(u(setr,ghostrand,rand(0,100)),u(setr,ghostcheck,switch(%q<def>,1,20,2,20,3,25,4,25,5,30))));@select/inline cand(%q<hitmul>,%q<ghost_downgrade>)=1,{th u(setq,hitmul,switch(%q<hitmul>,0.0,0.0,0.4,0,0.7,0.4,1.0,0.7));@attach %!/INC`EANNOUNCE=GHOST,[ansi(hw,%n)] somehow eludes the brunt of the attack! Severity downgraded!};@attach %!/INC`DEBUG=GHOST,Hit Downgrade Rand: %q<ghostrand>/%q<ghostcheck>;th unsetq(ghostrand ghostcheck)
&STATUS`ARC_GHOST`DEFENSE_PRE_REROLL [u(cobj,age)]=@select/inline cand(not(%q<hitmul>),match(3 4,%q<def>))=1,{th u(setq,disablereroll,1)}
&STATUS`ARC_GHOST`DEFENSE_ON_MISS [u(cobj,age)]=@select/inline %q<def>=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GHOST_BUFF,,1,0;@attach %!/INC`EANNOUNCE=GHOST,[ansi(h,%n)] phases to a better vantage for attack. Major bonus to Power!},2,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GHOST_BUFF,,1,0;@attach %!/INC`EANNOUNCE=GHOST,[ansi(h,%n)] phases to a better vantage for attack. Major bonus to Power!},5,{@attach %!/INC`HYPE=%0,1,Ghost Bonus}
&STATUS`ARC_GHOST`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_GHOST`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(%q<def>,5,Significant,0)
&STATUS`ARC_GHOST`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`ARC_GHOST_BUFF [u(Cobj,age)]=Ghost-PowerBuff
&STATUS`ARC_GHOST_BUFF`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Major
&STATUS`ARC_GHOST_BUFF`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_GHOST_BUFF`DESCRIPTION [u(cobj,age)]=Major Bonus to Power
&STATUS`ARC_GHOST_BUFF`BREAK`ADJECTIVE [u(Cobj,age)]=Major

&STATUS`ARC_GLASSCANNON [u(cobj,age)]=Glass Cannon
&STATUS`ARC_GLASSCANNON`STATIC`MAXIMUM`HP [u(cobj,age)]=-100
&STATUS`ARC_GLASSCANNON`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Major
&STATUS`ARC_GLASSCANNON`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Major
&STATUS`ARC_GLASSCANNON`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GLASSCANNON_FOCUS,,1,1
&STATUS`ARC_GLASSCANNON`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GLASSCANNON_BOLSTER,,1,1

&STATUS`ARC_GLASSCANNON_FOCUS [u(Cobj,age)]=Glass Cannon-Focus
&STATUS`ARC_GLASSCANNON_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GLASSCANNON_FOCUS`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision, Minor Penalty to Endurance
&STATUS`ARC_GLASSCANNON_FOCUS`BREAK`ADJECTIVE [u(Cobj,age)]=Minor

&STATUS`ARC_GLASSCANNON_BOLSTER [u(Cobj,age)]=Glass Cannon-Bolster
&STATUS`ARC_GLASSCANNON_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GLASSCANNON_BOLSTER`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision, Minor Penalty to Mitigation
&STATUS`ARC_GLASSCANNON_BOLSTER`BREAK`ADJECTIVE [u(Cobj,age)]=Minor

&STATUS`ARC_HOTBLOODED [u(Cobj,age)]=Hot Blooded
&STATUS`ARC_HOTBLOODED`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`DRIVE),0),switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Moderate,READY,Significant,LAGGING,Major,OVEREXTENDED,Superior,0),0)
&STATUS`ARC_HOTBLOODED`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_HOTBLOODED_CONSISTENT,,1,0
&STATUS`ARC_HOTBLOODED`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_HOTBLOODED_FORCEFUL,,1,0

&STATUS`ARC_HOTBLOODED_CONSISTENT [u(Cobj,age)]=Hot Blooded-Consistent
&STATUS`ARC_HOTBLOODED_CONSISTENT`ATTACK`DRIVE_COST [u(cobj,age)]=-5

&STATUS`ARC_HOTBLOODED_FORCEFUL [u(Cobj,age)]=Hot Blooded-Forceful
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`DRIVE_COST [u(cobj,age)]=5
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant


&STATUS`ARC_IMMORTAL [u(Cobj,age)]=Immortal
&STATUS`ARC_IMMORTAL`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_IMMORTAL`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_IMMORTAL`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_IMMORTAL`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,11)),0),Immortal Regeneration}


&STATUS`ARC_JUGGERNAUT [u(cobj,age)]=Juggernaut
&STATUS`ARC_JUGGERNAUT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_JUGGERNAUT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_JUGGERNAUT`STATIC`MAXIMUM`HP [u(cobj,age)]=120
&STATUS`ARC_JUGGERNAUT`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_GUARD,,0,1
&STATUS`ARC_JUGGERNAUT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_MANEUVER,,0,1
&STATUS`ARC_JUGGERNAUT`DEF`5`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_RALLY,,0,1;

&STATUS`ARC_JUGGERNAUT_GUARD [u(cobj,age)]=Juggernaut-Guard
&STATUS`ARC_JUGGERNAUT_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_JUGGERNAUT_GUARD`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=@select/inline and(gte(%q<hitmul>,1.0),lte(u(setr,jugrand,rand(1,100)),75))=1,{th u(setq,hitmul,0.7);@attach %!/INC`EANNOUNCE=JUGGERNAUT,[ansi(hw,%n)] plows through the attack without exposing weakness! Critical Hit downgraded.};@attach %!/INC`DEBUG=JUGGERNAUT,Critical Hit Downgrade Rand: %q<jugrand>;th unsetq(jugrand)

&STATUS`ARC_JUGGERNAUT_MANEUVER [u(cobj,age)]=Juggernaut-Maneuver
&STATUS`ARC_JUGGERNAUT_MANEUVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_JUGGERNAUT_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_JUGGERNAUT_RALLY [u(cobj,age)]=Juggernaut-Rally
&STATUS`ARC_JUGGERNAUT_RALLY`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_JUGGERNAUT_RALLY`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`HEAL=%0,u(setr,jugheal,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,9)),0)),Juggernaut Regeneration,1;@attach %!/INC`EANNOUNCE=JUGGERNAUT,[ansi(hw,name(%0))] readies for more action... and regenerates [ansi(h,%q<jugheal> HP)]!



&STATUS`ARC_OPERATOR [u(cobj,age)]=Operator
&STATUS`ARC_OPERATOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_FOCUSBOLSTER,,1,0
&STATUS`ARC_OPERATOR`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_FOCUSBOLSTER,,1,0
&STATUS`ARC_OPERATOR`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_GUARDMANEUVER,,0,1
&STATUS`ARC_OPERATOR`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_GUARDMANEUVER,,0,1
&STATUS`ARC_OPERATOR`ATTACK`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_OPERATOR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_OPERATOR_FOCUSBOLSTER [u(cobj,age)]=Operator-FocusBolster
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`ATTACK_ON_MISS [u(cobj,age)]=@dolist/inline get(%#/%q<atk>`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_INFLICT_STATUS=%#,%i0};@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,name(%q<atker>))]'s tactics will not be shut down that easily!
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select gte(fdiv(%q<damage>,get(%0/D`COMBAT`HEALTH`ORIGINAL)),0.2)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_DEBUFF_OFFENSE,,1,0;@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,%n)] now suffers a Significant penalty to Offense!}

&STATUS`ARC_OPERATOR_GUARDMANEUVER [u(Cobj,age)]=Operator-GuardManeuver
&STATUS`ARC_OPERATOR_GUARDMANEUVER`DEFENSE_ON_MISS [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,-5,Operator Penalty
&STATUS`ARC_OPERATOR_GUARDMANEUVER`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select lt(fdiv(%q<damage>,get(%0/D`COMBAT`HEALTH`ORIGINAL)),0.2)=1,{@attach %!/INC`SETSTATUS=%q<atker>,%q<atker>,ARC_OPERATOR_DEBUFF_DEFENSE,,0,1;@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,%n)] now suffers a Significant penalty to Defense!}

&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE [u(cobj,age)]=Operator-DebuffOffense
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Power and Precision
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`CURE`ADJECTIVE [u(cobj,age)]=Significant

&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE [u(cobj,age)]=Operator-DebuffDefense
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Endurance and Mitigation
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`TAGS [u(cobj,age)]=DISPLAY DEBUFF
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`CURE`ADJECTIVE [u(cobj,age)]=Significant

&STATUS`ARC_PREDATOR [u(cobj,age)]=Predator
&STATUS`ARC_PREDATOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_INFLICT,,1,0
&STATUS`ARC_PREDATOR`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,Predator Maneuvering;@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_MANEUVER,,1,1
&STATUS`ARC_PREDATOR`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_RALLY,,0,1
&STATUS`ARC_PREDATOR`STATIC`MAXIMUM`HP [u(cobj,age)]=-50
&STATUS`ARC_PREDATOR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_PREDATOR_INFLICT [u(cobj,age)]=Predator-Inflict
&STATUS`ARC_PREDATOR_INFLICT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline t(%q<damage>)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_DOT,DAMAGE=%q<damage>|INCREMENT=0,0,2;@attach %!/INC`EANNOUNCE=PREDATOR,[ansi(hw,%n)] now sports an aggravated\, bloody wound!}

&STATUS`ARC_PREDATOR_DOT [u(cobj,age)]=Predator-DoT
&STATUS`ARC_PREDATOR_DOT`TAGS [u(cobj,age)]=DOT
&STATUS`ARC_PREDATOR_DOT`DEFENSE`DOT [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,24,9)))),0)
&STATUS`ARC_PREDATOR_DOT`TAGS [u(Cobj,age)]=DOT DISPLAY
&STATUS`ARC_PREDATOR_DOT`DESCRIPTION [u(Cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_PREDATOR_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Substantial,1,Substantial,Small)


&STATUS`ARC_PREDATOR_MANEUVER [u(Cobj,age)]=Predator-Maneuver
&STATUS`ARC_PREDATOR_MANEUVER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_PREDATOR_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_PREDATOR_MANEUVER`DESCRIPTION [u(cobj,age)]=Significant Bonus to Precision
&STATUS`ARC_PREDATOR_MANEUVER`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_PREDATOR_MANEUVER`BREAK`ADJECTIVE [u(cobj,age)]=Significant

&STATUS`ARC_PREDATOR_RALLY [u(cobj,age)]=Predator-Rally
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=5
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate


&STATUS`ARC_SHOWOFF [u(cobj,age)]=Showoff
&STATUS`ARC_SHOWOFF`STATIC`MAXIMUM`HYPE [u(cobj,age)]=15
&STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,OFF_DRAMATIC,,1,0;@dolist/inline setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1)={@attach %!/STATUS`[before(%i0,$)]`OFF`5`ACTIVATE=%0,%i0}
&STATUS`ARC_SHOWOFF`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline gt(u(setr,showdef,round(switch(get(%0/D`COMBAT`HYPE),>=20,80,>=15,85,>=10,90,>=5,95),0)),0)=1,{th u(setq,damage,mul(%q<damage>,u(scatter,%q<showdef>)))}
&STATUS`ARC_SHOWOFF`PUSH_ON_ACTIVATE [u(cobj,age)]=@select/inline %q<starthype>=>4,{th u(setq,showoffmul,0);@dolist/inline sort(squish(switchall(%q<starthype>,>=5,%B5%B,>=10,%B10%B,>=15,%B15%B)),-n)={@select/inline lt(%i0,%q<afterhype>)=1,{th u(setq,showoffmul,add(%q<showoffmul>,switch(%i0,5,18,10,14,15,10)))}};@select/inline gt(%q<showoffmul>,0)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_SHOWOFF_HYPEBOOST,MULTIPLIER=%q<showoffmul>,1,0;@attach %!/INC`EANNOUNCE=SHOWOFF,Oh yeah! [ansi(hw,%n)] is feeling it! Bonus to damage!}}

&STATUS`ARC_SHOWOFF_HYPEBOOST [u(cobj,age)]=Showoff-HypeBoost
&STATUS`ARC_SHOWOFF_HYPEBOOST`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,get(%0/%q<atk>`STATUS`%1`MULTIPLIER))))



&STATUS`ARC_SNIPER [u(cobj,age)]=Sniper
&STATUS`ARC_SNIPER`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_FOCUS,,1,0;
&STATUS`ARC_SNIPER`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_MANEUVER,,1,0;
&STATUS`ARC_SNIPER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SNIPER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`ARC_SNIPER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`ARC_SNIPER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)


&STATUS`ARC_SNIPER_FOCUS [u(cobj,age)]=Sniper-Focus
&STATUS`ARC_SNIPER_FOCUS`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline gte(%q<hitmul>,1)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_DEBUFF,,1,2;@attach %!/INC`EANNOUNCE=SNIPER,[ansi(h,%n)] was soundly disoriented by [ansi(hw,name(%q<atker>))]'s attack! Moderate Penalty to all Stats for 1 round!}
&STATUS`ARC_SNIPER_FOCUS`ATTACK_REROLL [u(cobj,age)]=@select/inline not(%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=SNIPER,[ansi(hw,[name(%q<atker>)])] has them in [poss(%q<atker>)] sights! Attack re-rolled!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>}

&STATUS`ARC_SNIPER_MANEUVER [u(cobj,age)]=Sniper-Maneuver
&STATUS`ARC_SNIPER_MANEUVER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`ARC_SNIPER_MANEUVER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_SNIPER_DEBUFF [u(cobj,age)]=Sniper-Debuff
&STATUS`ARC_SNIPER_DEBUFF`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`TAGS [u(Cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_SNIPER_DEBUFF`DESCRIPTION [u(cobj,age)]=Moderate Penalty to All
&STATUS`ARC_SNIPER_DEBUFF`CURE`ADJECTIVE [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR [u(cobj,age)]=Survivor
&STATUS`ARC_SURVIVOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_FOCUS,,0,1
&STATUS`ARC_SURVIVOR`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_BOLSTER,,1,1
&STATUS`ARC_SURVIVOR`DEF`3`ACTIVATE [u(cobj,age)]=@select/inline t(match(PRIMED READY LAGGING,get(%0/D`COMBAT`DRIVE`STATUS)))=1,{@attach %!/INC`DRIVE=%0,-5,Survivor Guard Penalty};@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_GUARD,,0,1
&STATUS`ARC_SURVIVOR`DEF`4`ACTIVATE [u(cobj,age)]=@select/inline t(match(PRIMED READY LAGGING,get(%0/D`COMBAT`DRIVE`STATUS)))=1,{@attach %!/INC`DRIVE=%0,-5,Survivor Maneuver Penalty};@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_MANEUVER,,0,1
&STATUS`ARC_SURVIVOR`BELOW_75_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] hardens [poss(%0)] defense!
&STATUS`ARC_SURVIVOR`BELOW_50_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] holds on even harder now! Defense up!
&STATUS`ARC_SURVIVOR`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] will not fall here! Defense skyrockets!

&STATUS`ARC_SURVIVOR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(lt(u(setr,perc,u(percent,%0)),0.25),Major,if(lt(%q<perc>,0.5),Significant,if(lt(%q<perc>,0.75),Solid,Moderate)))
&STATUS`ARC_SURVIVOR`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(lt(u(setr,perc,u(percent,%0)),0.25),Major,if(lt(%q<perc>,0.5),Significant,if(lt(%q<perc>,0.75),Solid,Moderate)))
&STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=add(u(adj,Minor),if(lte(%q<atklevel>,2),fdiv(u(adj,Moderate),2)))
&STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=add(u(adj,Minor),if(lte(%q<atklevel>,2),fdiv(u(adj,Moderate),2)))
&STATUS`ARC_SURVIVOR`STATIC`MAXIMUM`HP [u(cobj,age)]=100
&STATUS`ARC_SURVIVOR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(%q<atklevel>,3),fdiv(u(adj,Significant),2))
&STATUS`ARC_SURVIVOR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(%q<atklevel>,3),fdiv(u(adj,Significant),2))

&STATUS`ARC_SURVIVOR_FOCUS [u(cobj,age)]=Survivor-Focus
&STATUS`ARC_SURVIVOR_FOCUS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_FOCUS`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR_BOLSTER [u(cobj,age)]=Survivor-Bolster
&STATUS`ARC_SURVIVOR_BOLSTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_BOLSTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_BOLSTER`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR_GUARD [u(cobj,age)]=Survivor-Guard
&STATUS`ARC_SURVIVOR_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant

&STATUS`ARC_SURVIVOR_MANEUVER [u(cobj,age)]=Survivor-Maneuver
&STATUS`ARC_SURVIVOR_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant



&STATUS`ARC_UNCONTROLLABLE [u(cobj,age)]=Uncontrollable
&STATUS`ARC_UNCONTROLLABLE`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_FOCUS,,1,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_BOLSTER,,1,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_GUARD,,0,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_MANEUVER,,0,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_RALLY,,0,1;

&STATUS`ARC_UNCONTROLLABLE`STATIC`MAXIMUM`HP [u(cobj,age)]=500
&STATUS`ARC_UNCONTROLLABLE`STATIC`GAIN`DRIVE [u(cobj,age)]=10
&STATUS`ARC_UNCONTROLLABLE`STATIC`GAIN`HYPE [u(cobj,age)]=2
&STATUS`ARC_UNCONTROLLABLE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`ATTACK_END_TURN [u(cobj,age)]=@attach %!/INC`DAMAGE=%0,bound(round(mul(get(%0/D`COMBAT`HEALTH),0.1),0),0),Uncontrollable

&STATUS`ARC_UNCONTROLLABLE_BOLSTER [u(cobj,age)]=Uncontrollable-Bolster
&STATUS`ARC_UNCONTROLLABLE_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_FOCUS [u(cobj,age)]=Uncontrollable-Focus
&STATUS`ARC_UNCONTROLLABLE_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_GUARD [u(cobj,age)]=Uncontrollable-Guard
&STATUS`ARC_UNCONTROLLABLE_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_MANEUVER [u(cobj,age)]=Uncontrollable-Maneuver
&STATUS`ARC_UNCONTROLLABLE_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_RALLY [u(cobj,age)]=Uncontrollable-Rally
&STATUS`ARC_UNCONTROLLABLE_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=10


&STATUS`ARC_AEGIS [u(cobj,age)]=Aegis
&STATUS`ARC_AEGIS`SUPPORT [u(cobj,age)]=SUP_AEGIS
&STATUS`ARC_AEGIS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_AEGIS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_AEGIS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_AEGIS`STATIC`MAXIMUM`HP [u(cobj,age)]=75

&STATUS`SUP_AEGIS [u(cobj,age)]=Aegis-Support
&STATUS`SUP_AEGIS`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_AEGIS`DESCRIPTION [u(cobj,age)]=Standard Damage Reduction, 25% Chance to block Debuffs/DOTs.
&STATUS`SUP_AEGIS`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=th u(setq,damage,round(mul(%q<damage>,sub(1.0,u(scatter,10))),0))
&STATUS`SUP_AEGIS`ON_GAIN_STATUS [u(cobj,age)]=@select/inline and(words(setinter(DEBUFF DOT,get(u(cobj,age)/STATUS`[before(%2,$)]`TAGS))),lte(u(setr,aegisblock,rand(1,100)),25))=1,{@attach %!/KILLSTATUS=%0,%2,1;@attach %!/INC`EANNOUNCE=AEGIS-SUPPORT: [ansi(hw,name(%0))] is protected from evil magic!};@attach %!/INC`DEBUG=AEGIS-SUPPORT,Block DebuffDot 1d100 Roll: %q<aegisblock>/25 \(Responding to %2\);th unsetq(aegisblock)


&STATUS`ARC_CONSPIRATOR [u(cobj,age)]=Conspirator
&STATUS`ARC_CONSPIRATOR`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_CONSPIRATOR`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_CONSPIRATOR`SUPPORT [u(Cobj,age)]=SUP_CONSPIRATOR

&STATUS`SUP_CONSPIRATOR [u(cobj,age)]=Conspirator-Support
&STATUS`SUP_CONSPIRATOR`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_CONSPIRATOR`DESCRIPTION [u(Cobj,age)]=Attacks inflict 2*AtkLevel Drive Damage and small DoT
&STATUS`SUP_CONSPIRATOR`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,mul(-2,%q<atklevel>),Conspirator Penalty;@attach %!/INC`SETSTATUS=[get(%0/%q<atk>`STATUS`%1`SOURCE)],%0,ARC_CONSPIRATOR_INFLICT,,1,0
&STATUS`SUP_CONSPIRATOR`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline %q<damage>=>0,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_CONSPIRATOR_DOT,DAMAGE=%q<damage>,0,2;@attach %!/INC`EANNOUNCE=CONSPIRATOR,[ansi(hw,name(%q<atker>))] has landed a crippling blow! [ansi(hw,%n)] now suffers from Damage over Time!}

&STATUS`ARC_CONSPIRATOR_INFLICT [u(cobj,age)]=Conspirator-Inflict
&STATUS`ARC_CONSPIRATOR_INFLICT`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,mul(-2,%q<atklevel>),Conspirator Penalty;
&STATUS`ARC_CONSPIRATOR_INFLICT`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline %q<damage>=>0,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_CONSPIRATOR_DOT,DAMAGE=%q<damage>|INCREMENT=0,0,4;@attach %!/INC`EANNOUNCE=CONSPIRATOR,[ansi(hw,name(%q<atker>))] has landed a crippling blow! [ansi(hw,%n)] will suffer from Damage over Time if not quickly cured!}

&STATUS`ARC_CONSPIRATOR_DOT [u(cobj,age)]=Conspirator-DoT
&STATUS`ARC_CONSPIRATOR_DOT`DEFENSE`DOT [u(cobj,age)]=bound(round(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,9,4))),0),0)
&STATUS`ARC_CONSPIRATOR_DOT`TAGS [u(Cobj,age)]=DOT DISPLAY
&STATUS`ARC_CONSPIRATOR_DOT`DESCRIPTION [u(Cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_CONSPIRATOR_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Small,1,Small,Tiny)


&STATUS`ARC_ENGINEER [u(cobj,age)]=Engineer
&STATUS`ARC_ENGINEER`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=ENGINEER-SUPPORT,[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_FOCUS,,1,0;@attach %!/INC`EANNOUNCE=[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] may receive an attack severity upgrade!
&STATUS`ARC_ENGINEER`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_BOLSTER,,1,0;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] readies a flurry of extra attacks!
&STATUS`ARC_ENGINEER`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_GUARD,,0,1;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] is surrounded by a flickering\, unreliable barrier!
&STATUS`ARC_ENGINEER`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_MANEUVER,,0,1;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] may inflict backlash damage against level 3 attacks or lower. Watch out!
&STATUS`ARC_ENGINEER`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_RALLY,,1,0;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s will soars! Drive recovery bolstered.
&STATUS`ARC_ENGINEER`STATIC`GAIN`HYPE [u(cobj,age)]=1
&STATUS`ARC_ENGINEER`SUPPORT [u(Cobj,age)]=SUP_ENGINEER

&STATUS`SUP_ENGINEER [u(cobj,age)]=Engineer-Support
&STATUS`SUP_ENGINEER`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ENGINEER`DESCRIPTION [u(cobj,age)]=+1 Passive Hype Gain, benefits from Synergist Defense actions
&STATUS`SUP_ENGINEER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,Engineer Bonus

&STATUS`SUP_ENGINEER_FOCUS [u(cobj,age)]=Engineer-Support-Focus
&STATUS`SUP_ENGINEER_FOCUS`ATTACK_MODIFY_HITMUL [u(cobj,age)]=@select/inline eq(1,u(setr,enrand,rand(1,4)))=1,{th u(setq,hitmul,if(not(%q<hitmul>),0.4,switch(%q<hitmul>,0.4,0.7,0.7,1.0,1.0,1.0,1.0,%q<hitmul>)));@attach %!/INC`EANNOUNCE=ENGINEER-FOCUS,[ansi(hw,name(%q<atker>))] knows how to make 'em... and how to break 'em! Strike severity upgraded!};@attach %!/INC`DEBUG=ENGINEER-FOCUS,Strike Severity Upgrade Rand (1d4): %q<enrand>/1

&STATUS`SUP_ENGINEER_BOLSTER [u(cobj,age)]=Engineer-Support-Bolster
&STATUS`SUP_ENGINEER_BOLSTER`ATTACK_POST_DAMAGE [u(cobj,age)]=@select/inline %q<atklevel>=<5,{th u(setq,damage,round(mul(%q<damage>,1.[switch(u(setr,eatk,rand(1,3)),1,06,2,12,3,18,0)]),0));@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(%q<atker>))] flurries for %q<eatk> more strikes!}

&STATUS`SUP_ENGINEER_GUARD [u(cobj,age)]=Engineer-Support-Guard
&STATUS`SUP_ENGINEER_GUARD`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline u(setr,enmanrand,rand(0,1))=1,{th u(setq,damage,round(mul(%q<damage>,u(scatter,8)),0));@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,%n)] is girded within impregnable armor!};@attach %!/INC`DEBUG=ENGINEER-SUPPORT-GUARD,Damage Reduction Chance: %q<enmanrand>;th unsetq(enmanrand)

&STATUS`SUP_ENGINEER_MANEUVER [u(cobj,age)]=Engineer-Support-Maneuver
&STATUS`SUP_ENGINEER_MANEUVER`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select/inline cand(lte(%q<atklevel>,3),u(setr,enmanrand,rand(0,1)))=1,{@attach %!/INC`DAMAGE=%q<atker>,round(mul(%q<damage>,u(scatter,24)),0),Engineer Support Backlash};@attach %!/INC`DEBUG=ENGINEER-SUPPORT-MANEUVER,Backlash Damage Chance: %q<enmanrand>;th unsetq(enmanrand)

&STATUS`SUP_ENGINEER_RALLY [u(cobj,age)]=Engineer-Support-Rally
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_CLOSE [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,5,Engineer Rally Bonus
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_SOLID [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,10,Engineer Rally Bonus
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_CRITICAL [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,10,Engineer Rally Bonus



&STATUS`ARC_ICON [u(cobj,age)]=Icon
&STATUS`ARC_ICON`SUPPORT [u(cobj,age)]=SUP_ICON
&STATUS`ARC_ICON`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=[get(%#/D`COMBAT`SUPPORTING)],5,Icon Rally Bonus
&STATUS`ARC_ICON`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_FOCUSBOLSTER,,1,1
&STATUS`ARC_ICON`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_FOCUSBOLSTER,,1,1
&STATUS`ARC_ICON`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_GUARDMANEUVER,,1,1
&STATUS`ARC_ICON`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_GUARDMANEUVER,,1,1
&STATUS`ARC_ICON`STATIC`GAIN`DRIVE [u(cobj,age)]=2

&STATUS`SUP_ICON [u(cobj,age)]=Icon-Support
&STATUS`SUP_ICON`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ICON`DESCRIPTION [u(Cobj,age)]=Minor Bonus to All Stats
&STATUS`SUP_ICON`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ICON_FOCUSBOLSTER [u(cobj,age)]=Icon-FocusBolster
&STATUS`ARC_ICON_FOCUSBOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ICON_GUARDMANEUVER [u(cobj,age)]=Icon-GuardManeuver
&STATUS`ARC_ICON_GUARDMANEUVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_GUARDMANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor




&STATUS`ARC_MARTYR [u(Cobj,age)]=Martyr
&STATUS`ARC_MARTYR`SUPPORT [u(cobj,age)]=SUP_MARTYR
&STATUS`ARC_MARTYR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_MARTYR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_MARTYR`STATIC`GAIN`DRIVE [u(Cobj,age)]=5
&STATUS`ARC_MARTYR`STATIC`MAXIMUM`HP [u(Cobj,age)]=-75

&STATUS`SUP_MARTYR [u(Cobj,age)]=Martyr-Support
&STATUS`SUP_MARTYR`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select/inline cand(gte(%q<damage>,0),not(strmatch(get(%0/D`COMBAT`STATUS`%1`SOURCE),%0)),gte(u(percent,get(%0/D`COMBAT`STATUS`%1`SOURCE)),0))=0,{th u(setq,oridamage,%q<damage>);th u(setq,damage,round(mul(%q<oridamage>,sub(1.0,u(scatter,10)),0)));@attach %!/INC`DAMAGE=get(%0/D`COMBAT`STATUS`%1`SOURCE),sub(%q<oridamage>,%q<damage>),Take One For the Team};
&STATUS`SUP_MARTYR`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`DRIVE=%0,5,Martyr Support
&STATUS`SUP_MARTYR`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_MARTYR`DESCRIPTION [u(cobj,age)]=+5 Passive Drive gain, Synergist receives Standard portion of your injuries

&STATUS`ARC_MASTERMIND [u(cobj,age)]=Mastermind
&STATUS`ARC_MASTERMIND`SUPPORT [u(cobj,age)]=SUP_MASTERMIND
&STATUS`ARC_MASTERMIND`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`STATIC`GAIN`DRIVE [u(Cobj,age)]=-2
&STATUS`ARC_MASTERMIND`STATIC`GAIN`HYPE [u(Cobj,age)]=1

&STATUS`SUP_MASTERMIND [u(cobj,age)]=Mastermind-Support
&STATUS`SUP_MASTERMIND`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_MASTERMIND`DESCRIPTION [u(Cobj,age)]=Heal a Small amount of damage you inflict.
&STATUS`SUP_MASTERMIND`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`HEAL=%q<atker>,round(mul(add(%q<damage>,%q<dot>),u(scatter,6.5)),0),Mastermind Support Regen
&STATUS`SUP_MASTERMIND`DEFENSE_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`HEAL=[get(%0/%q<atk>`STATUS`%1`SOURCE)],round(mul(%q<damage>,u(scatter,5)),0),Mastermind Support Regen


&STATUS`ARC_PANACEA [u(cobj,age)]=Panacea
&STATUS`ARC_PANACEA`SUPPORT [u(cobj,age)]=SUP_PANACEA
&STATUS`ARC_PANACEA`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_CLEANSE,,0,1
&STATUS`ARC_PANACEA`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_CLEANSE,,0,1
&STATUS`ARC_PANACEA`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`DRIVE=%0,5,Panacea Guard Bonus
&STATUS`ARC_PANACEA`DEF`4`ACTIVATE [u(cobj,age)]=
&STATUS`ARC_PANACEA`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_RALLY,,0,1

&STATUS`ARC_PANACEA_RALLY [u(cobj,age)]=Panacea-Rally
&STATUS`ARC_PANACEA_RALLY`DEFENSE_END_TURN [u(cobj,age)]=@select/inline get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE)=>0,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,5)),0),Panacea Rally Regen}
&STATUS`ARC_PANACEA_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`ARC_PANACEA_CLEANSE [u(cobj,age)]=Panacea-Cleanse
&STATUS`ARC_PANACEA_CLEANSE`DEFENSE_END_TURN [u(cobj,age)]=@select/inline words(u(setr,panclear,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF))))=>0,{@dolist/inline %q<panclear>={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=PANACEA,[ansi(h,%n)] is cleansed of Negative Effects!}

&STATUS`SUP_PANACEA [u(cobj,age)]=Panacea-Support
&STATUS`SUP_PANACEA`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_PANACEA`DESCRIPTIOn [u(cobj,age)]=Regen a Small amount of suffered damage, Moderate Bonus to Endurance
&STATUS`SUP_PANACEA`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`SUP_PANACEA`ATTACK_END_TURN [u(cobj,age)]=@select/inline get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE)=>0,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),0.055),0),Panacea Support Regen}


&STATUS`ARC_OVERLORD [u(Cobj,age)]=Overlord
&STATUS`ARC_OVERLORD`SUPPORT [u(cobj,age)]=SUP_OVERLORD
&STATUS`ARC_OVERLORD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_OVERLORD`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_OVERLORD`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`SUP_OVERLORD [u(cobj,age)]=Overlord-Support
&STATUS`SUP_OVERLORD`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_OVERLORD`DESCRIPTION [u(cobj,age)]=For the Swarm! Your attacks empower your Synergist.
&STATUS`SUP_OVERLORD`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`SUP_OVERLORD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`SUP_OVERLORD`OFF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`DRIVE=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],5,Overlord Support Bonus
&STATUS`SUP_OVERLORD`OFF`2`ACTIVATE [u(Cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],2,Overlord Support Bonus
&STATUS`SUP_OVERLORD`OFF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],%0,SUP_OVERLORD_EFFICIENT,,2,0;@attach %!/INC`EANNOUNCE=OVERLORD-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`STATUS`%1`SOURCE)))]'s Precision is bolstered!
&STATUS`SUP_OVERLORD`OFF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],%0,SUP_OVERLORD_DRAMATIC,,2,0;@attach %!/INC`EANNOUNCE=OVERLORD-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`STATUS`%1`SOURCE)))]'s Power is bolstered!

&STATUS`SUP_OVERLORD_EFFICIENT [u(cobj,age)]=Overlord-Support-Efficient
&STATUS`SUP_OVERLORD_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_OVERLORD_DRAMATIC [u(cobj,age)]=Overlord-Support-Dramatic
&STATUS`SUP_OVERLORD_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate


&STATUS`ARC_ROYAL [u(Cobj,age)]=Royal
&STATUS`ARC_ROYAL`SUPPORT [u(cobj,age)]=SUP_ROYAL
&STATUS`ARC_ROYAL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_ROYAL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate

&STATUS`ARC_ROYAL`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ROYAL_PRECISION,,2,0;@attach %!/INC`EANNOUNCE=ROYAL,[ansi(hw,name(%0))] enjoys a Minor Precision Boost!
&STATUS`ARC_ROYAL`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ROYAL_PRECISION,,2,0;@attach %!/INC`EANNOUNCE=ROYAL,[ansi(hw,name(%0))] enjoys a Minor Precision Boost!
&STATUS`ARC_ROYAL`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,3,Royal Efficient Bonus
&STATUS`ARC_ROYAL`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,Royal Dramatic Bonus

&STATUS`ARC_ROYAL_PRECISION [u(cobj,age)]=Royal-Precision
&STATUS`ARC_ROYAL_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_ROYAL [u(cobj,age)]=Royal-Support
&STATUS`SUP_ROYAL`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ROYAL`DESCRIPTION [u(cobj,age)]=+1 Passive Hype, +5 Passive Drive
&STATUS`SUP_ROYAL`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`DRIVE=%0,5,Royal Support Bonus;@attach %!/INC`HYPE=%0,1,Royal Support Bonus


&STATUS`ARC_SAINT [u(Cobj,age)]=Saint
&STATUS`ARC_SAINT`SUPPORT [u(cobj,age)]=SUP_SAINT
&STATUS`ARC_SAINT`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SAINT_FOCUSBOLSTER,,1,0;
&STATUS`ARC_SAINT`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`1`ACTIVATE
&STATUS`ARC_SAINT`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SAINT_MANEUVERGUARDRALLY,,0,1;
&STATUS`ARC_SAINT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`3`ACTIVATE
&STATUS`ARC_SAINT`DEF`5`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`3`ACTIVATE
&STATUS`ARC_SAINT`ON_GAIN_STATUS [u(cobj,age)]=@select/inline cand(eq(1,u(setr,saintblock,randword(1 2))),words(setinter(get(u(cobj,age)/%1`TAGS),DOT DEBUFF)),not(strmatch(%1,%0)))=1,{@attach %!/INC`SETSTATUS=%1,%0,[before(%2,$)],%3,%4,%5;@attach %!/INC`EANNOUNCE=[ansi(h,name(%0))] declares a pox on the wicked! [ansi(hw,name(%1))] develops the same condition.};@attach %!/INC`DEBUG=SAINT,Status Block (1d2): %q<saintblock>/1

&STATUS`ARC_SAINT`PRE_SET_STATUS [u(cobj,age)]=@select/inline cand(words(setinter(%3,BUFF)),strmatch(%0,%1))=1,{@select/inline gt(add(%4,get(u(cobj,age)/STATUS`%2`ATTACK_TURNS)),0)=1,{th u(setq,statusatkturns,1)};@select/inline gt(add(%5,get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS)),0)=1,{th u(setq,statusdefturns,1)};@attach %!/INC`EANNOUNCE=SAINT,[ansi(h,%n)]'s mystical resolution further empowers Buffs to last one turn more.}

&STATUS`ARC_SAINT_FOCUSBOLSTER [u(cobj,age)]=Saint-FocusBolster
&STATUS`ARC_SAINT_FOCUSBOLSTER`ATTACK_NEGATE_DAMAGE [u(cobj,age)]=@select/inline gt(u(setr,ndrive,div(%q<damage>,15)),0)=1,{@attach %!/INC`DRIVE=%0,%q<ndrive>,Saint Drive Damage};th u(setq,damage,0)

&STATUS`ARC_SAINT_MANEUVERGUARDRALLY [u(cobj,age)]=Saint-ManeuverGuardRally
&STATUS`ARC_SAINT_MANEUVERGUARDRALLY`DEFENSE_NEGATE_DAMAGE [u(cobj,age)]=@select/inline u(setr,ndrive,div(u(setr,saintred,round(mul(%q<damage>,u(scatter,30)),0)),15))=>0,{@attach %!/INC`DRIVE=%0,mul(-1,%q<ndrive>),Saint Drive Defense};th u(setq,damage,sub(%q<damage>,%q<saintred>));@attach %!/INC`EANNOUNCE=SAINT,[ansi(h,%n)]'s faith keeps them strong! [ansi(h,%q<saintred>)] damage prevented!

&STATUS`SUP_SAINT [u(cobj,age)]=Saint-Support
&STATUS`SUP_SAINT`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_SAINT`DESCRIPTION [u(cobj,age)]=Regen a Standard amount of Damage you suffer.
&STATUS`SUP_SAINT`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(gt(u(percent,%0),0),get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE))=1,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,11)),0),Saint Support Regen}



&STATUS`ARC_SPOTTER [u(Cobj,age)]=Spotter
&STATUS`ARC_SPOTTER`SUPPORT [u(cobj,age)]=SUP_SPOTTER
&STATUS`ARC_SPOTTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SPOTTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SPOTTER`STATIC`MAXIMUM`HP [u(cobj,age)]=-50
&STATUS`ARC_SPOTTER`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_[u(setr,ranoff,randword(CONSISTENT FORCEFUL EFFICIENT DRAMATIC))],,1,0;@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_[u(setr,randef,randword(FOCUS BOLSTER GUARD FOCUS RALLY))],,0,1;@attach %!/INC`EPRIVATE=SPOTTER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] gains a Bonus to %q<ranoff> Attacks and %q<randef> Defenses.,%0 get(%0/D`COMBAT`SUPPORTING)
&STATUS`ARC_SPOTTER`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SPOTTER`DEF`1`ACTIVATE
&STATUS`ARC_SPOTTER`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`SUPPORTING)],2,Spotter Support Bonus
&STATUS`ARC_SPOTTER`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SPOTTER`DEF`3`ACTIVATE
&STATUS`ARC_SPOTTER`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_REROLL,,1,0;@attach %!/INC`EANNOUNCE=SPOTTER,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] is locked onto the foe with eagle eyes! Gains a chance to re-roll a miss.

&STATUS`SUP_SPOTTER_REROLL [u(cobj,age)]=Spotter-Support-Reroll
&STATUS`SUP_SPOTTER_REROLL`ATTACK_REROLL [u(cobj,age)]=@select/inline not(%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=SPOTTER-SUPPORT,[ansi(hw,[name(%q<atker>)])] stays on target!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>}

&STATUS`SUP_SPOTTER [u(cobj,age)]=Spotter-Support
&STATUS`SUP_SPOTTER`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_SPOTTER`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Precision
&STATUS`SUP_SPOTTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_SPOTTER_CONSISTENT [u(cobj,age)]=Spotter-Support-Consistent
&STATUS`SUP_SPOTTER_CONSISTENT`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_FORCEFUL [u(cobj,age)]=Spotter-Support-Forceful
&STATUS`SUP_SPOTTER_FORCEFUL`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_EFFICIENT [u(cobj,age)]=Spotter-Support-Efficient
&STATUS`SUP_SPOTTER_EFFICIENT`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_EFFICIENT`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,)]=fdiv(u(adj,Solid),2)

&STATUS`SUP_SPOTTER_DRAMATIC [u(cobj,age)]=Spotter-Support-Dramatic
&STATUS`SUP_SPOTTER_DRAMATIC`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_DRAMATIC`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,)]=fdiv(u(adj,Solid),2)

&STATUS`SUP_SPOTTER_FOCUS [u(cobj,age)]=Spotter-Support-Focus
&STATUS`SUP_SPOTTER_FOCUS`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_BOLSTER [u(cobj,age)]=Spotter-Support-Bolster
&STATUS`SUP_SPOTTER_BOLSTER`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_GUARD [u(cobj,age)]=Spotter-Support-Guard
&STATUS`SUP_SPOTTER_GUARD`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_MANEUVER [u(cobj,age)]=Spotter-Support-Maneuver
&STATUS`SUP_SPOTTER_MANEUVER`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_RALLY [u(cobj,age)]=Spotter-Support-Rally
&STATUS`SUP_SPOTTER_RALLY`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_RALLY`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)


&STATUS`ARC_TACTICIAN [u(Cobj,age)]=Tactician
&STATUS`ARC_TACTICIAN`SUPPORT [u(cobj,age)]=SUP_TACTICIAN
&STATUS`ARC_TACTICIAN`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_TACTICIAN_CONSISTENT,,0,1;@attach %!/INC`EANNOUNCE=TACTICIAN,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] receives a Solid boost to Endurance and Mitigation!
&STATUS`ARC_TACTICIAN`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_TACTICIAN_FORCEFUL,,1,0;@attach %!/INC`EANNOUNCE=TACTICIAN,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] receives a Moderate boost to Power and Precision!
&STATUS`ARC_TACTICIAN`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=[get(%0/D`COMBAT`SUPPORTING)],5,Tactician Support Bonus
&STATUS`ARC_TACTICIAN`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`SUPPORTING)],2,Tactician Support Bonus


&STATUS`SUP_TACTICIAN [u(cobj,age)]=Tactician-Support
&STATUS`SUP_TACTICIAN`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_TACTICIAN`DESCRIPTION [u(cobj,age)]=Minor Bonus to Precision
&STATUS`SUP_TACTICIAN`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_TACTICIAN_FORCEFUL [u(cobj,age)]=Tactician-Support-Forceful
&STATUS`SUP_TACTICIAN_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`SUP_TACTICIAN_FORCEFUL`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_TACTICIAN_CONSISTENT [u(cobj,age)]=Tactician-Support-Consistent
&STATUS`SUP_TACTICIAN_CONSISTENT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`SUP_TACTICIAN_CONSISTENT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid


&STATUS`ARC_WITCH [u(Cobj,age)]=Witch
&STATUS`ARC_WITCH`SUPPORT [u(cobj,age)]=SUP_WITCH
&STATUS`ARC_WITCH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_WITCH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_WITCH`BONUS`ATTACK`DRIVE_COST [u(cobj,age)]=-3
&STATUS`ARC_WITCH`STATIC`MAXIMUM`HP [u(Cobj,age)]=-25
&STATUS`ARC_WITCH`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_CONSISTENT,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall inflict a random Minor Debuff!
&STATUS`ARC_WITCH`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_FORCEFUL,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall heal [ansi(hw,%n)]!
&STATUS`ARC_WITCH`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_DRAMATIC,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall drain Hype on a Solid hit or better!
&STATUS`ARC_WITCH`ATTACK`DRIVE_COST [u(cobj,age)]=-3

&STATUS`SUP_WITCH [u(cobj,age)]=Witch-Support
&STATUS`SUP_WITCH`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_WITCH`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Precision and Power
&STATUS`SUP_WITCH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`SUP_WITCH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_WITCH_CONSISTENT [u(cobj,age)]=Witch-Support-Consistent
&STATUS`SUP_WITCH_CONSISTENT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,SUP_WITCH_DEBUFF_[u(setr,witchrand,randword(POWER ENDURANCE PRECISION MITIGATION))],,1,1;@attach %!/INC`EANNOUNCE=WITCH-SUPPORT,[ansi(hw,name(%0))] now suffers from a Minor [capstr(%q<witchrand>)] Debuff!

&STATUS`SUP_WITCH_DEBUFF_POWER [u(cobj,age)]=Witch-Support-Debuff-Power
&STATUS`SUP_WITCH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_ENDURANCE [u(cobj,age)]=Witch-Support-Debuff-Endurance
&STATUS`SUP_WITCH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_PRECISION [u(cobj,age)]=Witch-Support-Debuff-Precision
&STATUS`SUP_WITCH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_MITIGATION [u(cobj,age)]=Witch-Support-Debuff-Mitigation
&STATUS`SUP_WITCH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_FORCEFUL [u(cobj,age)]=Witch-Support-Forceful
&STATUS`SUP_WITCH_FORCEFUL`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`HEAL=%q<atker>,round(mul(%q<damage>,u(scatter,3)),0),Witch Support

&STATUS`SUP_WITCH_DRAMATIC [u(cobj,age)]=Witch-Support-Dramatic
&STATUS`SUP_WITCH_DRAMATIC`ATTACK_ON_CRITICAL [u(Cobj,age)]=@attach %!/INC`HYPE=%0,-1,Witch Support Dramatic Penalty
&STATUS`SUP_WITCH_DRAMATIC`ATTACK_ON_SOLID [u(Cobj,age)]=@attach %!/INC`HYPE=%0,-1,Witch Support Dramatic Penalty

@@ STATUS - Quirks - Offense

&STATUS`QRK_AIMASSIST [u(cobj,age)]=Aim Assist
&STATUS`QRK_AIMASSIST`ATTACK_REROLL [u(cobj,age)]=@select/inline and(not(%q<hitmul>),eq(1,u(setr,aimrand,rand(1,2))))=1,{@attach %!/INC`EANNOUNCE=AIM ASSIST,[ansi(hw,[name(%q<atker>)])] stays on target!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>};@attach %!/INC`DEBUG=AIM ASSIST,Aim Assist Rand 1d2: %q<aimrand>/1

&STATUS`QRK_CALIBRATEDWEAPONRY [u(cobj,age)]=Calibrated Weaponry
&STATUS`QRK_CALIBRATEDWEAPONRY`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`QRK_CALIBRATEDWEAPONRY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_CALIBRATEDWEAPONRY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_CERTAINKILL [u(cobj,age)]=Certain Kill
&STATUS`QRK_CERTAINKILL`ATTACK_ON_CRITICAL [u(cobj,age)]=@attach %!/INC`EANNOUNCE=CERTAIN KILL,[ansi(hw,name(%q<atker>))]'s blows strike with deadly precision! Critical Damage increased!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,25)))

&STATUS`QRK_ELEGANTSTANCE [u(cobj,age)]=Elegant Stance
&STATUS`QRK_ELEGANTSTANCE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_ELEGANTSTANCE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`QRK_ELEGANTSTANCE`BANNED`OFF [u(cobj,age)]=2

&STATUS`QRK_EXPERIMENTALWEAPONRY [u(cobj,age)]=Experimental Weaponry
&STATUS`QRK_EXPERIMENTALWEAPONRY`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_EXPERIMENTALWEAPONRY_CONSISTENT_[if(lte(u(setr,experrand,rand(1,100)),75),BONUS,PENALTY)],,1,0;@attach %!/INC`DEBUG=EXPERIMENTAL WEAPONRY,Consistent Bonus/Penalty Chance 1d100: %q<experrand>/75;th unsetq(experrand)
&STATUS`QRK_EXPERIMENTALWEAPONRY`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_EXPERIMENTALWEAPONRY_FORCEFUL_[if(lte(u(setr,experrand,rand(1,100)),75),BONUS,PENALTY)],,1,0;@attach %!/INC`DEBUG=EXPERIMENTAL WEAPONRY,Forceful Bonus/Penalty Chance 1d100: %q<experrand>/75;th unsetq(experrand)

&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS [u(cobj,age)]=Experimental Weaponry-Consistent-Bonus
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved beneficial! Solid Bonus!

&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY [u(cobj,age)]=Experimental Weaponry-Consistent-Penalty
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY`STATUS`OFF_CONSISTENT`ATTACK`PENALTY`STAT`2 [u(Cobj,age)]=Minor
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved troublesome! Minor Penalty!

&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS [u(cobj,age)]=Experimental Weaponry-Forceful-Bonus
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Solid
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved beneficial! Solid Bonus!

&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY [u(cobj,age)]=Experimental Weaponry-Consistent-Penalty
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY`STATUS`OFF_FORCEFUL`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Minor
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved troublesome! Minor Penalty!

&STATUS`QRK_EXSANGUINATION [u(cobj,age)]=Exsanguination
&STATUS`QRK_EXSANGUINATION`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT))=>0,{th u(setq,incdamagemul,add(incdamagemul,u(scatter,8)));@attach %!/INC`EANNOUNCE=EXSANGUINATION,[ansi(hw,name(%q<atker>))]'s blows savage [ansi(h,%n)]'s aggravated wounds! Small bonus to damage!}
&STATUS`QRK_EXSANGUINATION`ON_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(%4,words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DOT)))=1,{@attach %!/INC`HYPE=%0,1,Exsanguination Bonus}

&STATUS`QRK_HEAVYWEAPONRY [u(cobj,age)]=Heavy Weaponry
&STATUS`QRK_HEAVYWEAPONRY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_HEAVYWEAPONRY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_HEAVYWEAPONRY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor

&STATUS`QRK_HYPERMODE [u(cobj,age)]=Hyper Mode
&STATUS`QRK_HYPERMODE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`QRK_HYPERMODE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_HYPERMODE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_HYPERMODE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Solid

&STATUS`QRK_KEENEYE [u(cobj,age)]=Keen Eye
&STATUS`QRK_KEENEYE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`QRK_KILLERINSTINCT [u(cobj,age)]=Killer Instinct
&STATUS`QRK_KILLERINSTINCT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_KILLERINSTINCT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_LASTWORD [u(cobj,age)]=Last Word
&STATUS`QRK_LASTWORD`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Massive,0)
&STATUS`QRK_LASTWORD`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Massive,0)
&STATUS`QRK_LASTWORD`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=LAST WORD,[ansi(hw,name(%0))] readies for a last stand! Massive Bonus to Power and Precision!

&STATUS`QRK_MIGHTY [u(cobj,age)]=Mighty
&STATUS`QRK_MIGHTY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`QRK_MOMENTUM [u(cobj,age)]=Momentum
&STATUS`QRK_MOMENTUM`DEFENSE_ON_SOLID [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_MOMENTUM_BONUS,,1,0;@attach %!/INC`EANNOUNCE=MOMENTUM,[ansi(h,%n)] readies a retaliation! Significant Bonus to Power!
&STATUS`QRK_MOMENTUM`DEFENSE_ON_CRITICAL [u(cobj,age)]=@attach %!/STATUS`QRK_MOMENTUM`DEFENSE_ON_SOLID

&STATUS`QRK_MOMENTUM_BONUS [u(cobj,age)]=Momentum-Bonus
&STATUS`QRK_MOMENTUM_BONUS`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`QRK_MOMENTUM_BONUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_MOMENTUM_BONUS`BREAK`ADJECTIVE [u(cobj,age)]=Significant

&STATUS`QRK_PREDICTIVETARGETING [u(Cobj,age)]=Predictive Targeting
&STATUS`QRK_PREDICTIVETARGETING`ATTACK_ON_CALCULATE [u(Cobj,age)]=@select/inline eq(%q<def>,get(%0/D`COMBAT`HISTORY`LAST_DEF_CHOICE))=1,{@attach %!/INC`SETSTATUS=%0,%q<atker>,QRK_PREDICTIVETARGETING_ACTIVE,,0,1;@attach %!/INC`EANNOUNCE=PREDICTIVE TARGETING,[ansi(118,name(%q<atker>))] saw through [ansi(118,%n)]'s repeated defense!}

&STATUS`QRK_PREDICTIVETARGETING_ACTIVE [u(cobj,age)]=Predictive Targeting
&STATUS`QRK_PREDICTIVETARGETING_ACTIVE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`QRK_PREDICTIVETARGETING_ACTIVE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_RIPOSTE [u(cobj,age)]=Riposte
&STATUS`QRK_RIPOSTE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(lte(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_HITMUL),0.4),Solid)

&STATUS`QRK_STIMULANTS [u(cobj,age)]=Stimulants
&STATUS`QRK_STIMULANTS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_STIMULANTS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_STIMULANTS`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`QRK_TOXICITY [u(cobj,age)]=Toxicity
&STATUS`QRK_TOXICITY`BLOCK_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DOT DEBUFF)),eq(1,u(setr,toxicrand,rand(1,2))),not(get(%2/D`COMBAT`STATUS`%3`TOXICITY)))=1,{@attach %!/INC`EANNOUNCE=TOXICITY,[ansi(hw,name(%q<src>))] oozes with deadly poison! [ansi(hw,get(u(cobj,age)/STATUS`[before(%3,$)]))] will persist a little longer!;th u(attrib_set,%2,D`COMBAT`STATUS`%3`TOXICITY,1);@select/inline not(%4)=1,{th u(addto,%2,D`COMBAT`STATUS`%3`ATTACK_TURNS,1);th u(addto,%2,D`COMBAT`STATUS`%3`DEFENSE_TURNS,1)}};@attach %!/INC`DEBUG=TOXICITY,Block KillStatus Rand 1d2: %q<toxicrand>/1;th unsetq(toxicrand)

&STATUS`QRK_UNWIELDYSTRENGTH [u(cobj,age)]=Unwieldy Strength
&STATUS`QRK_UNWIELDYSTRENGTH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_UNWIELDYSTRENGTH`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_UNWIELDYSTRENGTH`BANNED`OFF [u(cobj,age)]=1

&STATUS`QRK_VERSATILEATTACKS [u(cobj,age)]=Versatile Attacks
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Moderate
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_WITHERING [u(Cobj,age)]=Withering
&STATUS`QRK_WITHERING`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline words(get(%0/%q<atk>`ACTIVE`STATUS`TAGS`DEBUFF))=>0,{th u(setq,damage,mul(%q<damage>,sub(1.0,u(scatter,7))))}
&STATUS`QRK_WITHERING`ON_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(%4,words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DEBUFF)))=1,{@attach %!/INC`HYPE=%0,1,Withering Bonus}


@@ STATUS - Quirks - Defense

&STATUS`QRK_ABLATIVEBARRIER [u(cobj,age)]=Ablative Barrier
&STATUS`QRK_ABLATIVEBARRIER`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline cand(gte(u(setr,oridamage,%q<damage>),350),not(get(%0/D`COMBAT`HISTORY`QRK_ABLATIVEBARRIER)))=1,{th u(setq,damage,sub(%q<damage>,60));th u(setq,damage,sub(%q<damage>,mul(10,div(%q<damage>,50))));@attach %!/INC`EANNOUNCE=ABLATIVE BARRIER,Damage to [ansi(hw,%n)] reduced by [ansi(117,sub(%q<oridamage>,%q<damage>))] HP!;&D`COMBAT`HISTORY`QRK_ABLATIVEBARRIER %0=1}

&STATUS`QRK_ANTICIPATION [u(cobj,age)]=Anticipation
&STATUS`QRK_ANTICIPATION`DEFENSE_END_TURN [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`HISTORY`%q<atker>`OFF,%q<off>)
&STATUS`QRK_ANTICIPATION`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(eq(get(%0/D`COMBAT`HISTORY`%q<atker>`OFF),%q<off>),fdiv(u(adj,Significant),2))
&STATUS`QRK_ANTICIPATION`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(eq(get(%0/D`COMBAT`HISTORY`%q<atker>`OFF),%q<off>),fdiv(u(adj,Significant),2))
&STATUS`QRK_ANTICIPATION`DEFENSE_ON_CALCULATE [u(cobj,age)]=@select/inline eq(get(%0/D`COMBAT`HISTORY`%q<atker>`OFF),%q<off>)=1,{@attach %!/INC`EANNOUNCE=ANTICIPATION,[ansi(hw,%n)] saw through [ansi(hw,name(%q<atker>))]'s repeated attack\, reducing its effectiveness!}

&STATUS`QRK_CLOAKING [u(cobj,age)]=Cloaking
&STATUS`QRK_CLOAKING`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=@select/inline cand(eq(0.4,%q<hitmul>),eq(1,lte(u(setr,cloakrand,rand(1,100)),30)))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=CLOAKING,[ansi(hw,name(%0))] slips out of reach!};@attach %!/INC`DEBUG=CLOAKING,Random Check 1d100: %q<cloakrand>/30;th unsetq(cloakrand)
&STATUS`QRK_CLOAKING`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`QRK_CONVENIENTKEEPSAKE [u(cobj,age)]=Convenient Keepsake
&STATUS`QRK_CONVENIENTKEEPSAKE`DEFENSE_POST_DAMAGE [u(cobj,age)]=th u(setq,keepsake,u(percent,%0))
&STATUS`QRK_CONVENIENTKEEPSAKE`DEFENSE_END_TURN [u(Cobj,age)]=@select/inline cand(gte(%q<keepsake>,0.3),lte(u(percent,%0),0.0),not(get(%0/D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE)))=1,{@attach %!/INC`EANNOUNCE=CONVENIENT KEEPSAKE,[name(%0)] holds on to their very last hit point!;&D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE %0=1;&D`COMBAT`DAMAGE %0=sub(get(%0/D`COMBAT`HEALTH),1)}

&STATUS`QRK_FORTIFIEDDEFENSES [u(cobj,age)]=Fortified Defense
&STATUS`QRK_FORTIFIEDDEFENSES`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_FORTIFIEDDEFENSES`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=@select/inline cand(gte(%q<hitmul>,1.0),lte(u(setr,fortrand,rand(1,100)),50))={th u(setq,hitmul,0.7);@attach %!/INC`EANNOUNCE=FORTIFIED DEFENSES,[ansi(hw,name(%0))]'s protected from Critical Hits!};@attach %!/INC`DEBUG=FORTIFIED DEFENSES,Crit Downgrade Rand 1d100: %q<fortrand>/50;th unsetq(fortrand)

&STATUS`QRK_HEAVYARMOR [u(cobj,age)]=Heavy Armor
&STATUS`QRK_HEAVYARMOR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`QRK_HEAVYARMOR`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_HITANDRUN [u(Cobj,age)]=Hit and Run
&STATUS`QRK_HITANDRUN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`QRK_HITANDRUN`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_HITANDRUN`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor

&STATUS`QRK_IMMUNIZED [u(cobj,age)]=Immunized
&STATUS`QRK_IMMUNIZED`ON_GAIN_STATUS [u(Cobj,age)]=@select/inline cand(words(setinter(DOT DEBUFF,get(u(cobj,age)/STATUS`[before(%2,$)]`TAGS))),not(get(%0/D`COMBAT`HISTORY`QRK_IMMUNIZED)))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_IMMUNIZED_ACTIVE,,0,2;&D`COMBAT`HISTORY`QRK_IMMUNIZED %0=1}
&STATUS`QRK_IMMUNIZED`STATIC`MAXIMUM`HP [u(Cobj,age)]=35

&STATUS`QRK_IMMUNIZED_ACTIVE [u(cobj,age)]=Immunized-Active
&STATUS`QRK_IMMUNIZED_ACTIVE`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`QRK_IMMUNIZED_ACTIVE`DESCRIPTION [u(Cobj,age)]=Solid Bonus to Endurance
&STATUS`QRK_IMMUNIZED_ACTIVE`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Solid

&STATUS`QRK_LASTCHANCE [u(Cobj,age)]=Last Chance
&STATUS`QRK_LASTCHANCE`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Extreme)
&STATUS`QRK_LASTCHANCE`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Extreme)
&STATUS`QRK_LASTCHANCE`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=LAST CHANCE,[ansi(hw,name(%0))] is not going down just yet! 

&STATUS`QRK_POINTDEFENSE [u(Cobj,age)]=Point Defense
&STATUS`QRK_POINTDEFENSE`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_GUARD_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Guard Rand 1d100: %q<pointrand>/75
&STATUS`QRK_POINTDEFENSE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_MANEUVER_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Maneuver Rand 1d100: %q<pointrand>/75
&STATUS`QRK_POINTDEFENSE`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_RALLY_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Rally Rand 1d100: %q<pointrand>/75

&STATUS`QRK_POINTDEFENSE_GUARD_BONUS [u(Cobj,age)]=Point Defense-Guard-Bonus
&STATUS`QRK_POINTDEFENSE_GUARD_BONUS`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_GUARD_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY [u(Cobj,age)]=Point Defense-Guard-Penalty
&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!

&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS [u(Cobj,age)]=Point Defense-Maneuver-Bonus
&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY [u(Cobj,age)]=Point Defense-Maneuver-Penalty
&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!

&STATUS`QRK_POINTDEFENSE_RALLY_BONUS [u(cobj,age)]=Point Defense-Rally-Bonus
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY [u(Cobj,age)]=Point Defense-Rally-Penalty
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!


&STATUS`QRK_QUICKREFLEXES [u(cobj,age)]=Quick Reflexes
&STATUS`QRK_QUICKREFLEXES`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_REGENERATION [u(cobj,age)]=Regeneration
&STATUS`QRK_REGENERATION`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,5.5)),0),Regeneration}

&STATUS`QRK_RESILIENCE [u(cobj,age)]=Resilience
&STATUS`QRK_RESILIENCE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`QRK_SHIELDUSER [u(cobj,age)]=Shield User
&STATUS`QRK_SHIELDUSER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_SHIELDUSER`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline eq(0.4,%q<hitmul>)=1,{th u(setq,damage,mul(%q<damage>,sub(1.0,u(scatter,20))));@attach %!/INC`EANNOUNCE=SHIELD USER,[ansi(h,%n)] catches the blow on [poss(%0)] mighty shield! Substantial damage reduction!}

&STATUS`QRK_SIEGEMODE [u(Cob,age)]=Siege Mode
&STATUS`QRK_SIEGEMODE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_SIEGEMODE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_SIEGEMODE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`QRK_SIEGEMODE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant

&STATUS`QRK_STANDANDDELIVER [u(Cobj,age)]=Stand and Deliver
&STATUS`QRK_STANDANDDELIVER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_STANDANDDELIVER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_STANDANDDELIVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant

&STATUS`QRK_STAYINGPOWER [u(cobj,age)]=Staying Power
&STATUS`QRK_STAYINGPOWER`STATIC`MAXIMUM`HP [u(cobj,age)]=60

&STATUS`QRK_STRIPPEDDOWN [u(cobj,age)]=Stripped Down
&STATUS`QRK_STRIPPEDDOWN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`QRK_STRIPPEDDOWN`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate

&STATUS`QRK_SURVIVALINSTINCT [u(Cobj,agedb)]=Survival Instinct
&STATUS`QRK_SURVIVALINSTINCT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_SURVIVALINSTINCT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_TENACITY [u(cobj,age)]=Tenacity
&STATUS`QRK_TENACITY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_TENACITY`STATIC`MAXIMUM`HP [u(cobj,age)]=30

&STATUS`QRK_VANISH [u(Cobj,age)]=Vanish
&STATUS`QRK_VANISH`DEFENSE_FINAL_ENDTURN [u(Cobj,age)]=@select/inline cand(gte(%q<hitmul>,1.0),u(percent,%0))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_VANISH_ACTIVE,,0,1}

&STATUS`QRK_VANISH_ACTIVE [u(cobj,age)]=Vanish-Ready
&STATUS`QRK_VANISH_ACTIVE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_VANISH_ACTIVE`DESCRIPTION [u(Cobj,age)]=30% chance of Auto-Dodging Level 2+ Attacks
&STATUS`QRK_VANISH_ACTIVE`DEFENSE_MODIFY_HITMUL [u(cobj,age)]=@select/inline cand(gte(%q<atklevel>,2),lte(u(setr,vanishrand,rand(0,100)),30))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=VANISH,[ansi(118,name(%0))] slips through the danger like some kind of ghost!};@attach %!/INC`DEBUG=VANISH,Vanish Rand 1d100: %q<vanishrand>/30;th unsetq(vanishrand)
&STATUS`QRK_VANISH_ACTIVE`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=VANISH,[ansi(hw,name(%0))]'s form wavers and flickers! Gains 30% chance of Auto-Dodging Level 2+ Attacks!

@@ STATUS - Quirks - Balanced

&STATUS`QRK_ADRENALINE [u(cobj,age)]=Adrenaline
&STATUS`QRK_ADRENALINE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=localize(if(lte(u(setr,percent,u(percent,%0)),0.25),Moderate,if(lte(%q<percent>,0.75),Minor)))
&STATUS`QRK_ADRENALINE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=localize(if(lte(u(setr,percent,u(percent,%0)),0.25),Moderate,if(lte(%q<percent>,0.50),Minor)))
&STATUS`QRK_ADRENALINE`BELOW_75_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is getting into it! Minor bonus to Power!
&STATUS`QRK_ADRENALINE`BELOW_50_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is pumped up for action! Minor bonus to Endurance!
&STATUS`QRK_ADRENALINE`BELOW_25_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is revved to the limit! Moderate Bonus to Power and Endurance!


&STATUS`QRK_BAGOFTRICKS [u(cobj,age)]=Bag of Tricks
&STATUS`QRK_BAGOFTRICKS`PUSH_ON_ACTIVATE [u(cobj,age)]=@select/inline lte(u(setr,bagrand,rand(1,100)),50)=1,{@attach %!/INC`HYPE=%0,floor(fdiv(%q<hypecost>,2)),Bag of Tricks};@attach %!/INC`DEBUG=BAG OF TRICKS,Refund Rand: %q<bagrand>/50;th unsetq(bagrand)

&SCATTER [u(Cobj,age)]=fdiv(mul(%0,add(1.0,mul([if(rand(0,1),-,)]1,0.[rjust(rand(0,u(cust,CORE,SCATTER)),2,0)]))),100)

&STATUS`QRK_BLOODTHIRSTY [u(cobj,age)]=Bloodthirsty
&STATUS`QRK_BLOODTHIRSTY`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@attach %!/INC`HEAL=%q<atker>,u(setr,blood,round(mul(add(%q<damage>,%q<dot>),u(scatter,6.5)),0)),Bloodthirsty,1;@attach %!/INC`EANNOUNCE=BLOODTHIRSTY,[ansi(hw,name(%0))] regains [ansi(118,%q<blood>)] HP!

&STATUS`QRK_DESTINY [u(Cobj,age)]=Destiny
&STATUS`QRK_DESTINY`DEFENSE_ON_CRITICAL [u(cobj,age)]=@select/inline not(get(%0/D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_CRITICAL))=1,{@attach %!/INC`HYPE=%0,2,Destiny;th u(attrib_set,%0,D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_CRITICAL,1)}
&STATUS`QRK_DESTINY`DEFENSE_ON_MISS [u(cobj,age)]=@select/inline not(get(%0/D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_MISS))=1,{@attach %!/INC`HYPE=%0,2,Destiny;th u(attrib_set,%0,D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_MISS,1)}
&STATUS`QRK_DESTINY`ATTACK_ON_CRITICAL [u(cobj,age)]=@select/inline not(get(%q<atker>/D`COMBAT`HISTORY`DESTINY`ATTACK_ON_CRITICAL))=1,{@attach %!/INC`HYPE=%q<atker>,2,Destiny;th u(attrib_set,%q<atker>,D`COMBAT`HISTORY`DESTINY`ATTACK_ON_CRITICAL,1)}
&STATUS`QRK_DESTINY`ATTACK_ON_MISS [u(Cobj,age)]=@select/inline not(get(%q<atker>/D`COMBAT`HISTORY`DESTINY`ATTACK_ON_MISS))=1,{@attach %!/INC`HYPE=%q<atker>,2,Destiny;th u(attrib_set,%q<atker>,D`COMBAT`HISTORY`DESTINY`ATTACK_ON_MISS,1)}

&STATUS`QRK_EXTRAEFFORT [u(Cobj,age)]=Extra Effort
&STATUS`QRK_EXTRAEFFORT`STATIC`GAIN`DRIVE [u(cobj,age)]=5
&STATUS`QRK_EXTRAEFFORT`STATIC`MAXIMUM`HP [u(Cobj,age)]=-50

&STATUS`QRK_FIGHTINGSPIRIT [u(cobj,age)]=Fighting Spirit
&STATUS`QRK_FIGHTINGSPIRIT`STATIC`GAIN`DRIVE [u(Cobj,age)]=2
&STATUS`QRK_FIGHTINGSPIRIT`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=2

&STATUS`QRK_FINESSE [u(cobj,age)]=Finesse
&STATUS`QRK_FINESSE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_FINESSE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_GENIUS [u(cobj,age)]=Genius
&STATUS`QRK_GENIUS`STATIC`GAIN`HYPE [u(cobj,age)]=1

&STATUS`QRK_HONORBOUND [u(cobj,age)]=Honor Bound
&STATUS`QRK_HONORBOUND`ATTACK_END_TURN [u(cobj,age)]=@select/inline not(get(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_HONORBOUND_ACTIVE,,1,1;@attach %!/INC`EANNOUNCE=HONOR BOUND,A curse upon the dishonorable [ansi(hw,%n)]! Stats Penalized!}
&STATUS`QRK_HONORBOUND`ON_ACTIVATE [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`NO_FIRST_BONUS,1);
&STATUS`QRK_HONORBOUND`STATIC`MAXIMUM`HP [u(cobj,age)]=150

&STATUS`QRK_HONORBOUND_ACTIVE [u(Cobj,age)]=Honor Bound-Penalty
&STATUS`QRK_HONORBOUND_ACTIVE`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`ATTACK`PENALTY`STAT`2 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Significant

&STATUS`QRK_IMPROVISATION [u(Cobj,age)]=Improvisation
&STATUS`QRK_IMPROVISATION`DEFENSE_FINAL_ENDTURN [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_IMPROVISATION_[u(setr,improv1,randword(OFF_CONSISTENT OFF_FORCEFUL OFF_EFFICIENT OFF_DRAMATIC DEF_FOCUS DEF_BOLSTER DEF_GUARD DEF_MANEUVER DEF_RALLY))]_BONUS;@attach %!/INC`SETSTATUS=%0,%0,QRK_IMPROVISATION_[u(setr,improv2,randword(OFF_CONSISTENT OFF_FORCEFUL OFF_EFFICIENT OFF_DRAMATIC DEF_FOCUS DEF_BOLSTER DEF_GUARD DEF_MANEUVER DEF_RALLY))]_PENALTY;

&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS [u(cobj,age)]=Improvisation-Consistent-Bonus
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Consistent Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Consistent Attacks
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS [u(cobj,age)]=Improvisation-Forceful-Bonus
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Forceful Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Forceful Attacks
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS [u(cobj,age)]=Improvisation-Efficient-Bonus
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling an Efficient Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Efficient Attacks
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS [u(cobj,age)]=Improvisation-Dramatic-Bonus
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Dramatic Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Dramatic Attacks
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY [u(cobj,age)]=Improvisation-Consistent-Penalty
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`STATUS`OFF_CONSISTENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Consistent Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Consistent Attacks
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY [u(cobj,age)]=Improvisation-Forceful-Penalty
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`STATUS`OFF_FORCEFUL`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Forceful Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Forceful Attacks
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY [u(cobj,age)]=Improvisation-Efficient-Penalty
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling an Efficient Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Efficient Attacks
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY [u(cobj,age)]=Improvisation-Dramatic-Penalty
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`STATUS`OFF_DRAMATIC`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`STATUS`OFF_DRAMATIC`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Dramatic Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Dramatic Attacks
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS [u(cobj,age)]=Improvisation-Focus-Bonus
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Focus Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Focus Defense
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS [u(cobj,age)]=Improvisation-Bolster-Bonus
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Bolster Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Bolster Defense
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS [u(cobj,age)]=Improvisation-Guard-Bonus
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Guard Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Guard Defense
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS [u(cobj,age)]=Improvisation-Maneuver-Bonus
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Maneuver Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Maneuver Defense
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS [u(cobj,age)]=Improvisation-Rally-Bonus
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`STATUS`OFF_EFFICIENT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`STATUS`OFF_EFFICIENT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Rally Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Rally Defense
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY [u(cobj,age)]=Improvisation-Focus-Penalty
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`STATUS`DEF_FOCUS`DEFENSE`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Focus Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Focus Defense
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY [u(cobj,age)]=Improvisation-Bolster-Penalty
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Bolster Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Bolster Defense
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY [u(cobj,age)]=Improvisation-Guard-Penalty
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Guard Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Guard Defense
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY [u(cobj,age)]=Improvisation-Maneuver-Penalty
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`STATUS`DEF_FOCUS`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Maneuver Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Maneuver Defense
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY [u(cobj,age)]=Improvisation-Rally-Penalty
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`STATUS`OFF_EFFICIENT`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`STATUS`OFF_EFFICIENT`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Rally Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Rally Defense
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1


&STATUS`QRK_INSPIRATION [u(cobj,age)]=Inspiration
&STATUS`QRK_INSPIRATION`DEFENSE_END_TURN [u(cobj,age)]=@select/inline cand(gte(u(percent,%0),0.0),lte(u(setr,inrand,rand(1,100)),50))=1,{@attach %!/INC`DRIVE=%0,5,Inspiration};@attach %!/INC`DEBUG=INSPIRATION,Drive Bonus Rand 1d100: %q<inrand>/50

&STATUS`QRK_LASTSTAND [u(Cobj,age)]=Last Stand
&STATUS`QRK_LASTSTAND`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`DRIVE=%0,15,Last Stand

&STATUS`QRK_OVERCHARGED [u(cobj,age)]=Overcharged
&STATUS`QRK_OVERCHARGED`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`STATIC`MAXIMUM`HP [u(Cobj,age)]=-50

&STATUS`QRK_PREPTIME [u(cobj,age)]=Prep Time
&STATUS`QRK_PREPTIME`STATIC`START`HYPE [u(cobj,age)]=3
&STATUS`QRK_PREPTIME`DEFENSE_ON_CALCULATE [u(cobj,age)]=@select/inline cand(gte(%q<atklevel>,3),not(get(%0/D`COMBAT`HISTORY`QRK_PREPTIME)))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_PREPTIME_ACTIVE,,0,1;@attach %!/INC`EANNOUNCE=PREP TIME,[ansi(hw,%n)] was ready for these hijinx! Solid Bonus to Endurance and Mitigation!;&D`COMBAT`HISTORY`QRK_PREPTIME %0=1}

&STATUS`QRK_PREPTIME_ACTIVE [u(cobj,age)]=Prep Time-Bonus
&STATUS`QRK_PREPTIME_ACTIVE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_PREPTIME_ACTIVE`DESCRIPTION [u(cobj,age)]=Solid Bonus to Endurance and Mitigation
&STATUS`QRK_PREPTIME_ACTIVE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_PREPTIME_ACTIVE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid

&STATUS`QRK_REPERTOIRE [u(Cobj,age)]=Repertoire
&STATUS`QRK_REPERTOIRE`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_REPERTOIRE_DEFENSE,,0,1;@attach %!/INC`EANNOUNCE=REPERTOIRE,[ansi(h,%n)] knuckles down with a strategy! Minor Bonus to Endurance and Mitigation!
&STATUS`QRK_REPERTOIRE`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`QRK_REPERTOIRE`DEF`1`ACTIVATE
&STATUS`QRK_REPERTOIRE`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_REPERTOIRE_OFFENSE,,1,0;@attach %!/INC`EANNOUNCE=REPERTOIRE,[ansi(h,%n)] knuckles down with a strategy! Minor Bonus to Power and Precision!
&STATUS`QRK_REPERTOIRE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`QRK_REPERTOIRE`DEF`3`ACTIVATE

&STATUS`QRK_REPERTOIRE_DEFENSE [u(cobj,age)]=Repertoire-Defense
&STATUS`QRK_REPERTOIRE_DEFENSE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_REPERTOIRE_DEFENSE`DESCRIPTION [u(cobj,age)]=Minor Bonus to Endurance and Mitigation
&STATUS`QRK_REPERTOIRE_DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_REPERTOIRE_DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_REPERTOIRE_OFFENSE [u(cobj,age)]=Repertoire-Offense
&STATUS`QRK_REPERTOIRE_OFFENSE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_REPERTOIRE_OFFENSE`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision
&STATUS`QRK_REPERTOIRE_OFFENSE`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_REPERTOIRE_OFFENSE`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_REVENGE [u(cobj,age)]=Revenge
&STATUS`QRK_REVENGE`DEFENSE_ON_STRIKE [u(cobj,age)]=@select/inline gte(%q<hitmul>,0.7)=1,{@attach %!/INC`DRIVE=%#,get(%#/%q<atk>`ATK),Revenge,1;@attach %!/INC`EANNOUNCE=REVENGE,[ansi(hw,%n)] gains [ansi(118,get(%#/%q<atk>`ATK))] [ansi(118,Drive)]!}
&STATUS`QRK_REVENGE`STATIC`GAIN`DRIVE [u(Cobj,age)]=1

&STATUS`QRK_SELFLESS [u(Cobj,age)]=Selfless
&STATUS`QRK_SELFLESS`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_SELFLESS`DEFENSE_END_TURN [u(cobj,age)]=@select/inline cand(isdbref(u(setr,sup,get(%0/D`COMBAT`SUPPORTING))),not(strmatch(num(%q<sup>),num(%0))),gt(u(setr,odrive,get(%q<sup>/D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS)),0))=1,{@attach %!/INC`DRIVE=%0,round(mul(%q<odrive>,0.2),0),Selfless;&D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS %q<sup>=0}

&STATUS`QRK_SOLIDITY [u(cobj,age)]=Solidity
&STATUS`QRK_SOLIDITY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_SOLIDITY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor

&STATUS`QRK_TEAMSUPPORT [u(Cobj,age)]=Team Support
&STATUS`QRK_TEAMSUPPORT`ON_SUPPORT [u(cobj,age)]=@attach %!/INC`SETSTATUS=%2,%0,QRK_TEAMSUPPORT_SUPPORT,,X,X

&STATUS`QRK_TEAMSUPPORT_SUPPORT [u(cobj,age)]=Team Support
&STATUS`QRK_TEAMSUPPORT_SUPPORT`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,5)),0),Team Support}

&STATUS`QRK_UNBREAKABLE [u(cobj,age)]=Unbreakable
&STATUS`QRK_UNBREAKABLE`STATIC`GAIN`DRIVE [u(cobj,age)]=2
&STATUS`QRK_UNBREAKABLE`DEFENSE`PROTECT`DRIVE_LOSS [u(cobj,age)]=1

@@ STATUS - Pushes

&STATUS`PUSH_ATTACK [u(cobj,age)]=Attack
&STATUS`PUSH_ATTACK`ATTACK_TURNS [u(cobj,age)]=1
&STATUS`PUSH_ATTACK`DEFENSE_TURNS [u(cobj,age)]=0
&STATUS`PUSH_ATTACK`ATTACK_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,add(%q<xcon>,switch(get(%0/%q<atk>`STATUS`%1`COST),2,0.24,4,0.48,6,0.72)))
&STATUS`PUSH_ATTACK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY BUFF
&STATUS`PUSH_ATTACK`DESCRIPTION [u(cobj,age)]=Variable Attack increase
&STATUS`PUSH_ATTACK`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Standard,4,Substantial,6,Overwhelming)

&STATUS`PUSH_DEFENSE [u(cobj,age)]=Defense
&STATUS`PUSH_DEFENSE`DEFENSE_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,sub(%q<xcon>,mul(-1,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,0.2,4,0.4,6,0.6))))
&STATUS`PUSH_DEFENSE`TAGS [u(cobj,age)]=PUSH PUSH_DEFENSE DISPLAY BUFF
&STATUS`PUSH_DEFENSE`DESCRIPTION [u(cobj,age)]=Variable Defense increase
&STATUS`PUSH_DEFENSE`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Standard,4,Substantial,6,Overwhelming)

&STATUS`PUSH_BALANCE [u(cobj,age)]=Balance
&STATUS`PUSH_BALANCE`ATTACK_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,add(%q<xcon>,switch(get(%0/%q<atk>`STATUS`%1`COST),2,0.12,4,0.24,6,0.36)))
&STATUS`PUSH_BALANCE`DEFENSE_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,add(%q<xcon>,mul(-1,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,0.1,4,0.2,6,0.3))))
&STATUS`PUSH_BALANCE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK PUSH_DEFENSE DISPLAY
&STATUS`PUSH_BALANCE`DESCRIPTION [u(cobj,age)]=Variable increase to Attack and Defense
&STATUS`PUSH_BALANCE`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Small,4,Standard,6,Considerable)

&STATUS`PUSH_BUFF_POWER [u(cobj,age)]=Buff-Power
&STATUS`PUSH_BUFF_POWER`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_POWER`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0,%0,%1) Bonus to Power
&STATUS`PUSH_BUFF_POWER`ATTACK_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_POWER`BREAK`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0,%0,%1)

&STATUS`PUSH_BUFF_ENDURANCE [u(cobj,age)]=Buff-Endurance
&STATUS`PUSH_BUFF_ENDURANCE`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1,%0,%1) Bonus to Endurance
&STATUS`PUSH_BUFF_ENDURANCE`DEFENSE_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_ENDURANCE`BREAK`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1,%0,%1)

&STATUS`PUSH_BUFF_PRECISION [u(cobj,age)]=Buff-Precision
&STATUS`PUSH_BUFF_PRECISION`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_PRECISION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_PRECISION`DEFENSE`BONUS`STAT`2,%0,%1) Bonus to Precision
&STATUS`PUSH_BUFF_PRECISION`ATTACK_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_PRECISION`BREAK`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_BUFF_PRECISION`ATTACK`BONUS`STAT`2,%0,%1)

&STATUS`PUSH_BUFF_MITIGATION [u(cobj,age)]=Buff-Mitigation
&STATUS`PUSH_BUFF_MITIGATION`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_MITIGATION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3,%0,%1) Bonus to Mitigation
&STATUS`PUSH_BUFF_MITIGATION`DEFENSE_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_MITIGATION`BREAK`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_POWER [u(cobj,age)]=Inflict-Debuff-Power
&STATUS`PUSH_INFLICT_DEBUFF_POWER`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_POWER,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],2,0;@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] now suffers from a [ansi(hw,Power Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_POWER`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_INFLICT_DEBUFF_POWER`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Power

&STATUS`PUSH_DEBUFF_POWER [u(cobj,age)]=Debuff-Power
&STATUS`PUSH_DEBUFF_POWER`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_POWER`DESCRIPTION [u(cobj,age)]=u(switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior),%0,%1) Penalty to Power
&STATUS`PUSH_DEBUFF_POWER`CURE`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE [u(cobj,age)]=Inflict-Debuff-Endurance
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_ENDURANCE,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],0,2;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from an [ansi(hw,Endurance Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Endurance


&STATUS`PUSH_DEBUFF_ENDURANCE [u(cobj,age)]=Debuff-Endurance
&STATUS`PUSH_DEBUFF_ENDURANCE`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1,%0,%1) Penalty to Endurance
&STATUS`PUSH_DEBUFF_ENDURANCE`CURE`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_PRECISION [u(cobj,age)]=Inflict-Debuff-Precision
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_PRECISION,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],2,0;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from a [ansi(hw,Precision Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Precision


&STATUS`PUSH_DEBUFF_PRECISION [u(cobj,age)]=Debuff-Precision
&STATUS`PUSH_DEBUFF_PRECISION`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_PRECISION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2,%0,%1) Penalty to Precision
&STATUS`PUSH_DEBUFF_PRECISION`CURE`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION [u(cobj,age)]=Inflict-Debuff-Mitigation
&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_MITIGATION,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],0,2;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from a [ansi(hw,Mitigation Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK

&STATUS`PUSH_DEBUFF_MITIGATION [u(cobj,age)]=Debuff-Mitigation
&STATUS`PUSH_DEBUFF_MITIGATION`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_MITIGATION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3,%0,%1) Penalty to Mitigation
&STATUS`PUSH_DEBUFF_MITIGATION`CURE`ADJECTIVE [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3,%0,%1)


&STATUS`PUSH_INFLICT_DOT [u(cobj,age)]=Inflict-Damage Over Time
&STATUS`PUSH_INFLICT_DOT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,PUSH_DOT,COST=[get(%0/%q<atk>`STATUS`%1`COST)]|DAMAGE=%q<damage>|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)]|INCREMENT=0,0,4;@attach %!/INC`EANNOUNCE=DAMAGE OVER TIME,[ansi(h,%n)] will suffer Damage over Time if not quickly cured!! Uh-oh!
&STATUS`PUSH_INFLICT_DOT`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_INFLICT_DOT`DESCRIPTIION [u(cobj,age)]=Inflicts DoT on Victim

&STATUS`PUSH_DOT [u(cobj,age)]=Damage Over Time
&STATUS`PUSH_DOT`TAGS [u(cobj,age)]=DOT PUSH DISPLAY
&STATUS`PUSH_DOT`DEFENSE`DOT [u(cobj,age)]=u(STATUS`PUSH_DOT`DEFENSE`DOT`[get(%0/D`COMBAT`STATUS`%1`COST)],%0,%1)
&STATUS`PUSH_DOT`DEFENSE`DOT`1 [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,0.08,0.03))),0)
&STATUS`PUSH_DOT`DEFENSE`DOT`3 [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,0.26,0.08))),0)
&STATUS`PUSH_DOT`DEFENSE`DOT`5 [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,0.31,0.2))),0)
&STATUS`PUSH_DOT`DEFENSE`DOT`7 [u(cobj,age)]=bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,0,1,0.49,0.25))),0)
&STATUS`PUSH_DOT`DESCRIPTION [u(Cobj,age)]=Suffers DoT on Defense
&STATUS`PUSH_DOT`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DOT`CURE`INTENSITY`[get(%0/D`COMBAT`STATUS`%1`COST)],%0,%1)
&STATUS`PUSH_DOT`CURE`INTENSITY`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Small,1,Small,Tiny)
&STATUS`PUSH_DOT`CURE`INTENSITY`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Standard,1,Standard,Small)
&STATUS`PUSH_DOT`CURE`INTENSITY`5 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Considerable,1,Considerable,Small)
&STATUS`PUSH_DOT`CURE`INTENSITY`7 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Substantial,1,Substantial,Standard)


&STATUS`PUSH_CURE [u(Cobj,age)]=Cure
&STATUS`PUSH_CURE`ON_ACTIVATE [u(cobj,age)]=@dolist/inline u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,CURE,switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Moderate,5,Significant,7,Superior),switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Small,5,Standard,7,Substantial),%0)={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=CURE,[ansi(hw,%n)] shrugs off negative Status Effects!

&FIL`COSTCOMPARE [u(Cobj,age)]=cor(cand(hasattr(u(cobj,age)/STATUS`%0`%1`ADJECTIVE),lte(u(adj,u(u(cobj,age)/STATUS`%0`%1`ADJECTIVE,%0,%4)),u(adj,%2))),cand(hasattr(u(cobj,age)/STATUS`%0`%1`INTENSITY),lte(get(u(cobj,agedb)/INTENSITY`[u(u(cobj,age)/STATUS`%0`%1`INTENSITY,%0,%4)]),get(u(cobj,agedb)/INTENSITY`%3))))

&STATUS`PUSH_BREAK [u(cobj,age)]=Inflict-Break
&STATUS`PUSH_BREAK`ATTACK_ON_STRIKE [u(cobj,age)]=@dolist/inline u(filter,COSTCOMPARE,get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`BUFF),%b,%b,BREAK,switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Moderate,5,Significant,7,Superior),switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Small,5,Standard,7,Substantial),%0)={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=BREAK,[ansi(hw,%n)] has suffered a Break! Positive Status Effects removed!
&STATUS`PUSH_BREAK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_BREAK`DESCRIPTION [u(Cobj,age)]=Purges Positive Status Effects from target.

&STATUS`PUSH_BOOST [u(cobj,age)]=Boost
&STATUS`PUSH_BOOST`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,4,4,8,6,12),Boost,,1

&STATUS`PUSH_COUPDEGRACE [u(cobj,age)]=Coup de Grace
&STATUS`PUSH_COUPDEGRACE`ATTACK_ON_STRIKE [u(cobj,age)]=th u(setq,adamage,0);@dolist/inline u(setr,towipe,u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,BREAK,Solid,Standard,%0))={th u(setq,adamage,add(%q<adamage>,mul(u(u(cobj,age)/STATUS`[before(%i0,$)]`DEFENSE`DOT,%0,%i0),get(%#/D`COMBAT`STATUS`%i0`ATTACK_TURNS)),mul(u(ladd,iter(u(lattr,u(cobj,age)/STATUS`%i0`*`PENALTY`STAT`*),mul(1.35,u(adj,get(u(cobj,age)/%i0))))),get(%#/D`COMBAT`STATUS`%i0`DEFENSE_TURNS))))};@dolist/inline %q<towipe>={@attach %!/KILLSTATUS=%#,%i0,1};@attach %!/INC`EANNOUNCE=COUP DE GRACE,[ansi(h,%n)]'s negative effects are deftly converted into extra injury!
&STATUS`PUSH_COUPDEGRACE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_COUPDEGRACE`DESCRIPTION [u(Cobj,age)]=Converts Penalties and DOT into extra damage

&STATUS`PUSH_FINISHINGBLOW [u(cobj,age)]=Finishing Blow
&STATUS`PUSH_FINISHINGBLOW`ATTACK_MODIFY_HITMUL [u(cobj,age)]=@select/inline t(%q<hitmul>)=1,{@select/inline gte(%q<hitmul>,1.0)=0,{th u(setq,hitmul,1.0)};@attach %!/INC`EANNOUNCE=FINISHING BLOW,[ansi(hw,name(%q<atker>))]'s attack shakes the heavens!}
&STATUS`PUSH_FINISHINGBLOW`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_FINISHINGBLOW`DESCRIPTION [u(Cobj,age)]=Any hit becomes a guaranteed Critical Hit

&KILLSTATUS [u(Cobj,age)]=th u(setq,blockkill,0);@select/inline strmatch(num(u(setr,src,get(%0/D`COMBAT`STATUS`%1`SOURCE))),num(%0))=0,{@dolist/inline get(%q<src>/D`COMBAT`STATUS)={@attach %!/STATUS`[before(%i0,$)]`BLOCK_OPPONENT_KILL_STATUS=%q<src>,%i0,%0,%1,%2};@select/inline %q<blockkill>=0,{@dolist/inline get(%q<src>/D`COMBAT`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_OPPONENT_KILL_STATUS=%q<src>,%i0,%0,%1,%2}}};@select/inline %q<blockkill>=0,{@dolist/inline setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1)={@attach %!/STATUS`[before(%i0,$)]`ON_KILL_OTHER_STATUS=%0,%1,%2};@attach %!/STATUS`[before(%1,$)]`ON_KILL_STATUS=%0,%1,%2;@attach %!/WIPE=%0,D`COMBAT`STATUS`%1;th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%1));th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%1));th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`[before(%1,$)],setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`[before(%1,$)]),%1));@dolist/inline get(u(cobj,age)/STATUS`[before(%1,$)]`TAGS)={th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`TAGS`%i0,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`%i0),%1))};th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1))};

&STATUS`PUSH_SECONDWIND [u(Cobj,age)]=Second Wind
&STATUS`PUSH_SECONDWIND`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`HEAL=%0,floor(mul(get(%0/D`COMBAT`HEALTH),0.15)),Second Wind;@dolist/inline u(filter,CURABLE,edit(u(lattr,%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,),%b,%b,%0,99999999)={@attach %!/KILLSTATUS=%0,%i0,1};&D`COMBAT`HISTORY`SECONDWIND %0=1;@attach %!/INC`EANNOUNCE=SECOND WIND,[ansi(h,%n)] rises to the challenge! Negative effects Purged.
&STATUS`PUSH_SECONDWIND`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Major
&STATUS`PUSH_SECONDWIND`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Major

&STATUS`PUSH_ULTIMATEATTACK [u(cobj,age)]=Ultimate Attack
&STATUS`PUSH_ULTIMATEATTACK`ATTACK_ON_HITCHECK [u(cobj,age)]=th u(setq,accuracymod,mul(%q<accuracymod>,0.9));
&STATUS`PUSH_ULTIMATEATTACK`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,0.5));@attach %!/INC`EANNOUNCE=ULTIMATE ATTACK,[ansi(hw,name(%q<atker>))]'s power surges wildly! Attack Power Up!
&STATUS`PUSH_ULTIMATEATTACK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_ULTIMATEATTACK`DESCRIPTION [u(cobj,age)]=+50% damage but penalty to accuracy.

&STATUS`PUSH_EXHAUST [u(cobj,age)]=Exhaust
&STATUS`PUSH_EXHAUST`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,-[bound(sub(switch(get(%0/%q<atk>`STATUS`%1`COST),2,4,4,8,6,12),u(ladd,iter(edit(lattr(%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,),u(getstatus,%0,%i0,DEFENSE,PROTECT`DRIVE_LOSS)))),0)],Exhaust
&STATUS`PUSH_EXHAUST`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_EXHAUST`DESCRIPTION [u(cobj,age)]=

&STATUS`PUSH_INDOMITABILITY [u(Cobj,age)]=Indomitability
&STATUS`PUSH_INDOMITABILITY`ATTACK_BEFORE_LAUNCH [u(cobj,age)]=@select/inline hasattr(%#/D`COMBAT`HISTORY`PUSH_INDOMITABILITY)=1,{@attach %!/INC`EANNOUNCE=INDOMITABILITY,[ansi(h,%n)]'s protection wears off!;@attach %!/KILLSTATUS=%#,%1,1},0,{&D`COMBAT`HISTORY`PUSH_INDOMITABILITY %#=1;@attach %!/INC`EANNOUNCE=INDOMITABILITY,[ansi(hw,%n)]'s Defenses are Ret-2-Tank!}
&STATUS`PUSH_INDOMITABILITY`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline hasattr(%#/D`COMBAT`HISTORY`PUSH_INDOMITABILITY)=1,{th u(setq,damage,mul(%q<damage>,0.7));@attach %!/INC`EANNOUNCE=INDOMITABILITY, [ansi(hw,%n)] must be made of metal! Damage was greatly reduced.}
&STATUS`PUSH_INDOMITABILITY`TAGS [u(cobj,age)]=PUSH DISPLAY
&STATUS`PUSH_INDOMITABILITY`DESCRIPTION [u(cobj,age)]=Greatly reduce damage until you next attack.


@@ COMBAT CODE

&CMD`COMBAT [u(cobj,age)]=$^(?s)\+(mantle|attack|defend|stats|sheet|reset|push|queue|cancel|health|boss|scan|support|keeps|forgive|quirk|pull|tank|restrain|sell|hardsell|takehit)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:th u(setq,command,%1);th u(setq,sysname,COMBAT);@attach %!/INC`GETSWITCH=%2;@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`%q<sysname>`%q<command>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4,%5
@set [u(cobj,age)]/CMD`COMBAT=regexp

&COMBAT`PUSH`PLAYER [u(cobj,age)]=LIST
&COMBAT`PUSH`ADMIN [u(cobj,age)]=

@@ Takehit
&INC`COMBAT`TAKEHIT`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat-ready!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Consequences severity field empty.;@attach %!/INC`PARTIAL=%0,MILD|MODERATE|SEVERE|NONE,|,severity;&D`COMBAT`TAKEHIT %#=switch(%q<severity>,NONE,0,MILD,1,MODERATE,2,SEVERE,3);@attach %!/INC`EANNOUNCE=TAKEHIT,[ansi(hw,%n)] will voluntarily take [capstr(lcstr(switch(%q<severity>,NONE,No,%q<severity>)))] Consequences this day!

@@ Tank

&INC`COMBAT`TANK`MAIN [u(cobj,age)]=@attach %!/INC`VALID`POSINT=%0;@attach %!/INC`MSG=You will Tank %q<value> opponents when you next +reset!;&D`CSYS`TANK %#=%q<value>

@@ Quirk
&COMBAT`QUIRk`PLAYER [u(cobj,age)]=ADD|REMOVE|WIPE

&INC`COMBAT`QUIRK`MANTLE [u(Cobj,age)]=@check u(setr,clink_id,get(%#/D`CSYS`MANTLE`LINK))=@attach %!/INC`MSG=ERROR: No Mantle selected!;@stop get(%#/D`CSYS`MANTLE`LOCKED)=@attach %!/INC`MSG=ERROR: This Mantle is read-only.

&INC`COMBAT`QUIRK`TARGET [u(Cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Quirk name entered!;@check u(setr,quirk_id,u(FIND_TRAIT,QRK,%0))=@attach %!/INC`MSG=ERROR: Could not find Quirk named '%0'.

&INC`COMBAT`QUIRK`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`MSG=You are currently using Quirks: [iter(u(mysql,SELECT`MANTLE_LINK`QUIRK,%q<clink_id>),default(u(cobj,agedb)/QRK`%i0,<unset>),%b,\,%b)]

&INC`COMBAT`QUIRK`ADD [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;th u(setq,maxquirks,add(3,get(u(cobj,age)/STATUS`[get(u(cobj,agedb)/ARC`[get(%#/D`CSYS`MANTLE`ARCHETYPE)]`STATUS)]`STATIC`MAXIMUM`QUIRKS)));@stop gte(u(mysql,COUNT`MANTLE_LINK`QUIRK,%q<clink_id>),%q<maxquirks>)=@attach %!/INC`MSG=ERROR: You are already at your maximum of %q<maxquirks> Quirks.;@attach %!/INC`COMBAT`QUIRK`TARGET;@stop u(mysql,EXIST`MANTLE_LINK`QUIRK,%q<clink_id>,%q<quirk_id>)=@attach %!/INC`MSG=ERROR: You already are using that Quirk.;@attach %!/INC`DOSQL=ADD`MANTLE_LINK`QUIRK,%q<clink_id>,%q<quirk_id>;@attach %!/INC`MSG=You have selected the '[default(u(cobj,agedb)/QRK`%q<quirk_id>,<unset>)]' Quirk! You must +reset for this to reflect in your +stats.

&INC`COMBAT`QUIRK`REMOVE [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`COMBAT`QUIRK`TARGET;@check u(mysql,EXIST`MANTLE_LINK`QUIRK,%q<clink_id>,%q<quirk_id>)=@attach %!/INC`MSG=ERROR: You are not using that Quirk.;@attach %!/INC`DOSQL=REMOVE`MANTLE_LINK`QUIRK,%q<clink_id>,%q<quirk_id>;@attach %!/INC`MSG=You have removed the '[default(u(cobj,agedb)/QRK`%q<quirk_id>,<unset>)]' Quirk! You must +reset for this to reflect in your +stats.

&INC`COMBAT`QUIRK`WIPE [u(Cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will remove all Quirks from your Mantle. Are you sure? Enter the command again to verify.,WIPE %q<clink_id> QUIRKS;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`QUIRK,%q<clink_id>;@attach %!/INC`MSG=All Quirks wiped! You must +reset for this to reflect in your +stats.

&Q`EXIST`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT trait_value FROM vol_clink_trait where trait_type=2 AND clink_id=? AND trait_id=?
&Q`ADD`MANTLE_LINK`QUIRK [u(cobj,age)]=INSERT INTO vol_clink_trait (clink_id,trait_id,trait_type,trait_value) VALUES (?,?,2,1)
&Q`REMOVE`MANTLE_LINK`QUIRK [u(cobj,age)]=DELETE FROM vol_clink_trait WHERE clink_id=? AND trait_type=2 AND trait_id=?
&Q`WIPE`MANTLE_LINK`QUIRK [u(cobj,age)]=DELETE FROM vol_clink_trait WHERE clink_id=? AND trait_type=2
&Q`SELECT`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT trait_id FROM vol_clink_trait WHERE clink_id=? AND trait_type=2
&Q`COUNT`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT COUNT(*) FROM vol_clink_trait WHERE clink_id=? AND trait_type=2


@@ Forgive
&COMBAT`FORGIVE`ADMIN [u(cobj,age)]=ALL

&INC`COMBAT`FORGIVE`ALL [u(cobj,age)]=@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not combat-ready!;@check nattr(%q<t1>/D`CONSEQUENCES`**)=@attach %!/INC`MSG=ERROR: %q<t1name> suffers from no consequences.;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will clear all Consequences from %q<t1name> and force them to reset. Do not use in the middle of a fight. Are you sure? Enter the same command again to continue.,FORGIVE ALL %q<t1>;@attach %!/WIPE=%q<t1>,D`CONSEQUENCES;@attach %!/INC`MSG=Consequences forgiven!;@attach %!/INC`MSG`CHAN=Forgave All Consequences for %q<t1name>;@attach %!/INC`MSG=Your combat Consequences have been fully forgiven and combat status reset!,%q<t1>;@attach %!/INC`COMBAT`READYCHARACTER=%q<t1objid>,get(%q<t1>/D`CSYS`MANTLE),get(%q<t1>/D`CSYS`MANTLE`LINK),get(%q<t1>/D`CSYS`MANTLE`LOCKED)

&INC`COMBAT`FORGIVE`MAIN [u(cobj,age)]=

@@ Support
&INC`COMBAT`SUPPORT`MAIN [u(cobj,age)]=@check hasattr(%#/D`COMBAT`SUPPORTING)=@attach %!/INC`MSG=ERROR: You are not a Synergist Archetype!;@check gt(u(percent,%#),0)=@attach %!/INC`MSG=ERROR: You are KO'd!;@check strmatch(objid(get(%#/D`COMBAT`SUPPORTING)),%:)=@attach %!/INC`MSG=ERROR: Support Effect has already been assigned!;@attach %!/INC`CHECKPC=%0,2;@check nattr(%q<t2>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t2name> is not combat ready!;@check gt(u(percent,%q<t2>),0)=@attach %!/INC`MSG=ERROR: %q<t2name> is KO'd!;@check strmatch(loc(%q<t2>),%l)=@attach %!/INC`MSG=ERROR: %q<t2name> is not present!;@check hasflag(%q<t2>,CONNECTED)=@attach %!/INC`MSG=ERROR: %q<t2name> is not connected!;@check strlen(u(setr,supactive,get(%#/D`COMBAT`ACTIVE`STATUS`[u(setr,supname,get(%#/D`COMBAT`SUPPORT))])))=@attach %!/INC`MSG=ERROR: Code Error. Synergist is not properly configured. Contact Volund.;@attach %!/KILLSTATUS=%#,%q<supactive>;@attach %!/INC`SETSTATUS=%q<t2>,%#,%q<supname>,,X,X;&D`COMBAT`SUPPORTING %#=%q<t2objid>;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_SUPPORT=%#,%i0,%q<t2objid>};@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] lends Synergist Support to [ansi(hw,%q<t2name>)]!;@attach %!/WIPE=%#,D`COMBACK

@@ Cancel

&INC`COMBAT`CANCEL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBACK`**)=@attach %!/INC`MSG=ERROR: You cannot restore a previous state now.;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will restore combat state before launching any attacks or using Pushes. Are you sure? Enter the same command again to verify.,COMBAT RESTORE;@dolist/inline get(%#/D`COMCHECK`ATTACKED)={@attach %!/WIPE=%i0,D`COMBAT`Q`%#;@pemit %i0=[ansi(90,COMBAT:)]%B[ansi(hw,%n)] withdrew their attack against you!};@attach %!/WIPE=%#,D`COMCHECK`ATTACKED;@attach %!/WIPE=%#,D`COMBAT;@attach %!/INC`MVTREE=%#,D`COMBACK,%#,D`COMBAT:@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] undid canceled all combat actions!

@@ Scan
&INC`COMBAT`SCAN`MAIN [u(cobj,age)]=@pemit %#=u(header,Combatants);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(15 15 10 10 10 12,Name,Archetype,Weight,Drive,HP,Consequences));@pemit %#=u(separator);@dolist/inline u(filter,COMBATREADY,lplayers(%l))={@pemit %#=align(15 15 10 10 10 12,u(moniker,%i0),u(GET`ARCHETYPE,%i0)[if(get(%i0/D`COMBAT`MANTLE`LOCKED),\(P\))],ansi(u(scalecolor,get(%i0/D`COMBAT`STATS`4)),u(fancyweight,%i0)),get(%i0/D`COMBAT`DRIVE`STATUS),ansi(u(ryg,sub(100,bound(u(setr,hp,round(mul(u(percent,%i0),100),0)),0))),%q<hp>\%),u(fancycon,%i0))};@pemit %#=u(footer)

&FANCYCON [u(cobj,age)]=switch(get(%0/D`CONSEQUENCES),1,ansi(228,Mild),2,ansi(215,Moderate),3,ansi(202,Severe),ansi(hx,None))

&FIL`COMBATREADY [u(cobj,age)]=cand(hasflag(%0,CONNECTED),nattr(%0/D`COMBAT`**))

@@ MANTLE SELECT
&COMBAT`MANTLE`PLAYER [u(cobj,age)]=CLAIM|RELEASE|LOAN|REVOKE
&COMBAT`MANTLE`ADMIN [u(cobj,age)]=PUBLISH|RAWPUBLISH|UNPUBLISH

&INC`COMBAT`MANTLE`PUBLISH [u(cobj,age)]=@attach %!/INC`FINDMANTLELINK=%q<t1id>,%0;@attach %!/INC`LOAD`MANTLE=%q<mantle_id>,1;@attach %!/INC`VALID`GROUPLOCK=%2;th u(call`3,volp_lock,0,%q<mantle_id>,'LOAN','[sqlescape(%q<value>)]');@attach %!/INC`MSG=You have published Mantle %q<m1displaynum> '%q<m1name>' to: %q<value> (%q<valueformat)

&INC`COMBAT`MANTLE`RAWPUBLISH [u(cobj,age)]=@attach %!/INC`FINDMANTLELINK=%q<t1id>,%0;@attach %!/INC`LOAD`MANTLE=%q<mantle_id>,1;@attach %!/INC`VALID`LOCK=%2;th u(call`3,volp_lock,0,%q<mantle_id>,'LOAN','[sqlescape(%q<value>)]');@attach %!/INC`MSG=You have published Mantle %q<m1displaynum> '%q<m1name>' to: %q<value> (%q<valueformat>)

&INC`COMBAT`MANTLE`UNPUBLISH [u(cobj,age)]=@attach %!/INC`FINDMANTLELINK=%q<t1id>,%0;@attach %!/INC`LOAD`MANTLE=%q<mantle_id>,1;th u(call`3,volp_lock,0,%q<mantle_id>,'LOAN',NULL);@attach %!/INC`MSG=You have unpublished Mantle %q<m1displaynum> '%q<m1name>'

&INC`COMBAT`MANTLE`CLAIM [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`COMBAT`MANTLE`CLAIM`LIST},{@attach %!/INC`COMBAT`MANTLE`CLAIM`GET}

&INC`COMBAT`MANTLE`CLAIM`GET [u(cobj,age)]=@check words(u(setr,mantles,u(filter,GLOBAL_LOCK,u(mysql3,LIST`GLOBAL`CLAIMS),chr(176),chr(176),%#)),chr(176))=@attach %!/INC`MSG=ERROR: No Global Mantles to assume!;th u(setq,ids,iter(%q<mantles>,first(%i0,chr(177)),chr(176),%B));@attach %!/INC`FINDGLOBAL=%0,%q<ids>;@stop u(mysql,EXISTS`MANTLE_LINK_ID,%q<t1id>,%q<mantle_id>)=@attach %!/INC`MSG=You already claimed that Mantle!;@attach %!/INC`LINKGLOBAL=%q<t1id>,%q<mantle_id>;@attach %!/INC`MSG=Mantle Claimed!

&Q`EXISTS`MANTLE_LINK_ID [u(cobj,age)]=SELECT mantle_id FROM volv_mantle_link WHERE mantle_id=? AND character_id=? LIMIT 1

&INC`FINDGLOBAL [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No mantle selected!;@select/inline t(match(%1,%0))=1,{th u(setq,mantle_id,%0)},0,{@check cor(u(setr,mantle_id,u(mysql,SELECT`MANTLE_GLOBAL_NAME`EXACT,%0,u(sql`in`number,%1))),u(setr,mantle_id,u(mysql,SELECT`MANTLE_GLOBAL_NAME`WILD,sqlescape(%0),u(SQL`IN`NUMBER,%1))))=@attach %!/INC`MSG=ERROR: Mantle '%1' not found!};

&INC`LINKGLOBAL [u(cobj,age)]=@attach %!/INC`DOSQL=NEW`MANTLE_LINK,%0,%1,u(mysql,COUNT`MANTLE_LINKS,%0),1;

&Q`SELECT`MANTLE_GLOBAL_NAME`EXACT [u(cobj,age)]=SELECT mantle_id FROM volv_mantle WHERE mantle_name=? AND mantle_id IN (!) LIMIT 1
&Q`SELECT`MANTLE_GLOBAL_NAME`WILD [u(cobj,age)]=SELECT mantle_id FROM volv_mantle WHERE mantle_name LIKE '!%%' AND mantle_id IN (!)

&INC`COMBAT`MANTLE`CLAIM`LIST [u(cobj,age)]=@check words(u(setr,mantles,u(filter,GLOBAL_LOCK,u(mysql3,LIST`GLOBAL`CLAIMS),chr(176),chr(176),%#)),chr(176))=@attach %!/INC`MSG=ERROR: No Global Mantles to assume!;@pemit %#=u(header,Global Mantles);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(4 14 9 9 9 9 8 11,ID,Name,Power,Endurance,Precision,Mitigatio,Weight,Archetype));@pemit %#=u(separator);@dolist/inline/delimit [chr(176)] %q<mantles>={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(4 14 9 9 9 9 8 11,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),u(VIEW`STAT,elements(%q<stats>,1)),u(VIEW`STAT,elements(%q<stats>,2)),u(VIEW`STAT,elements(%q<stats>,3)),u(VIEW`STAT,elements(%q<stats>,4)),u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unpublished),ansi(hx,N/A)))};@pemit %#=u(footer)

&FIL`GLOBAL_LOCK [u(Cobj,age)]=cor(u(tester,%1),u(isadmin,%1),testlock(elements(%0,5,chr(177)),%1))

&Q`LIST`GLOBAL`CLAIMS [u(cobj,age)]=SELECT mantle_id,mantle_name,mantle_stats,mantle_archetype,mantle_global_lock FROM volv_mantle WHERE mantle_global_lock IS NOT NULL


&Q`LOCK`CLINK [u(cobj,age)]=UPDATE vol_clink SET clink_loan_lock=? WHERE clink_id=?
&Q`UNLOCK`CLINK [u(cobj,age)]=UPDATE vol_clink SET clink_loan_lock=NULL WHERE clink_id=?

&INC`COMBAT`MANTLE`MAIN [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`COMBAT`MANTLE`SHOWMANTLES},{@attach %!/INC`COMBAT`MANTLE`SELECT}

&INC`COMBAT`MANTLE`SHOWMANTLES [u(cobj,age)]=@check words(u(setr,mantles,u(mysql3,VIEW`MANTLE_LINKS,%q<t1id>)),chr(176))=@attach %!/INC`MSG=ERROR: No mantles to list.;@pemit %#=u(header,Character Editor: %q<t1name>);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(2 12 9 9 9 9 8 11 3,ID,Name,Power,Endurance,Precision,Mititigat,Weight,Archetype,Acl));@dolist/inline/delimit [chr(176)] %q<mantles>={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(2 12 9 9 9 9 8 11 3,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),u(VIEW`STAT,elements(%q<stats>,1)),u(VIEW`STAT,elements(%q<stats>,2)),u(VIEW`STAT,elements(%q<stats>,3)),u(VIEW`STAT,elements(%q<stats>,4)),u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unpublished),ansi(hx,N/A)),elements(%q<stats>,6))};@pemit %#=u(footer)

&VIEW`STAT [u(Cobj,age)]=switch(%0,1,Poor,2,Average,3,Good,4,Great,5,Excellent,?)

&INC`COMBAT`MANTLE`SELECT [u(cobj,age)]=@stop cand(gt(get(%#/D`COMBAT`DAMAGE),0),not(get(%#/D`COMBAT`MANTLE`LOCKED)))=@attach %!/INC`MSG=ERROR: Your current Mantle has damage and must be checked for Consequences. Please use +reset before changing mantles.;@attach %!/INC`FINDMANTLELINK=%q<t1id>,%0;&D`CSYS`MANTLE %#=%q<mantle_id>;&D`CSYS`MANTLE`LINK %#=%q<link_id>;&D`CSYS`MANTLE`LOCKED %#=%q<link_locked>;&D`CSYS`MANTLE`ARCHETYPE %#=%q<archetype_id>;@attach %!/INC`MSG=Mantle selected.

&Q`MANTLE`APPROVED [u(cobj,age)]=SELECT link.approved from csys_player_pilots as link LEFT JOIN csys_pilots as pilot on link.pilot_id=pilot.id where pilot.id=? AND link.player_id=? LIMIT 1
&Q`FIND`MANTLE [u(cobj,age)]=SELECT mantle_id from volv_mantle_link WHERE character_id=? AND (mantle_name=? OR mantle_link_display_num=?) ORDER BY mantle_name LIMIT 1
&Q`FIND`MANTLE`PARTIAL [u(cobj,age)]=SELECT mantle_id from volv_mantle_link WHERE character_id=? AND mantle_name LIKE '!%%' ORDER BY mantle_name LIMIT 1

@@ CSETUP

&INC`CHARGEN`CSETUP`MAIN [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Permission denied.;@attach %!/INC`CHECKPC=%0,1;@attach %!/INC`FINDMANTLELINK=%q<t1id>,%q<t1name>;&D`CSYS`MANTLE %q<t1>=%q<mantle_id>;&D`CSYS`MANTLE`LINK %q<t1>=%q<link_id>;&D`CSYS`MANTLE`LOCKED %q<t1>=%q<link_locked>;&D`CSYS`MANTLE`ARCHETYPE %q<t1>=%q<archetype_id>;@attach %!/INC`COMBAT`READYCHARACTER=%q<t1objid>,%q<mantle_id>,get(%q<t1>/D`CSYS`MANTLE`LINK),get(%q<t1>/D`CSYS`MANTLE`LOCKED);@attach %!/INC`MSG=You have setup %q<t1name> for battle!

@@ BOSS
&INC`COMBAT`BOSS`MAIN [u(cobj,age)]=@attach %!/INC`VALID`POSINT=%0;@select/inline %q<value>=>1,{@attach %!/INC`ANNOUNCE=%n is ready to tussle with %0 people! Cue the Boss music!},1,{@attach %!/INC`ANNOUNCE=[ansi(90,COMBAT:)] %n disables %p Boss mode.};&D`BOSS %#=%q<value>

@@ RADAR
&INC`COMBAT`RADAR`MAIN [u(cobj,age)]=@select/inline strlen(%0)=>0,{@attach %!/INC`CHECKPC=%0,1;th u(setq,radar,%q<t1>)},{th u(setq,radar,u(filter,RADAR,u(lvplayers,%l)))};@check words(%q<radar>)=@attach %!/INC`MSG=Nobody to show up on your radar. Bummer!;@pemit %#=u(header,Radar Display);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(20 25 12 8 10,Pilot,Mecha,Size,Health,Heat));@pemit %#=u(separator);@dolist/inline %q<radar>={@pemit %#=align(20 25 12 8 10,u(getproperty,%i0,BANNER)[if(strmatch(u(setr,pilname,get(%i0/D`COMBAT`STATS`PILOT)),name(%i0)),,%b\(as %q<pilname>\))],get(%i0/D`COMBAT`STATS`MECHA),u(mechsize,%i0),u(RADARHP,%i0),u(heatstatus,%i0))};@pemit %#=u(footer)

&FIL`RADAR [u(cobj,age)]=t(cand(nattr(%0/D`COMBAT`**),not(get(%0/D`OBSERVER))))

&RADARHP [u(cobj,age)]=switch(before(mul(u(percent,%0),100),.),100,Perfect,>79,Excellent,>59,Good,>39,Fine,>19,Damaged,>0,Critical,Scrap)

@@ READY CHARACTER

&INC`COMBAT`READYCHARACTER [u(cobj,age)]=@attach %!/WIPE=%0,D`COMBAT;@attach %!/INC`COMBAT`READYCHARACTER`MANTLE;@attach %!/INC`COMBAT`READYCHARACTER`FINISH

&INC`COMBAT`READYCHARACTER`MANTLE [u(cobj,age)]=th u(setq,mdata,u(mysql3,READY`MANTLE,%1));&D`COMBAT`MANTLE`LOCKED %0=%3;th u(setq,mstats,elements(%q<mdata>,1,chr(177)));&D`COMBAT`WEIGHT %0=u(setr,wt,elements(get(u(cobj,agedb)/WEIGHTS),elements(%q<mstats>,5),|));&D`COMBAT`WEIGHT`ORIGINAL %0=%q<wt>;@dolist/inline %q<mstats>={&D`COMBAT`STATS`[sub(inum(0),1)] %0=add(default(u(cobj,agedb)/ENTITY`0`STAT`[sub(inum(0),1)]`MAPPING`%i0,%i0),mul(default(u(cobj,agedb)/ENTITY`0`STAT`[sub(inum(0),1)]`ACCWORTH,0),u(setr,accol,elements(elements(%q<mdata>,3,chr(177)),sub(inum(0),1)))));&D`COMBAT`STATS`[sub(inum(0),1)]`ACC %0=%q<accol>;th u(addto,%0,D`COMBAT`ACCOLADES,%q<accol>);&D`COMBAT`STATS`[sub(inum(0),1)]`DISPLAY %0=%i0};&D`COMBAT`ARCHETYPE %0=u(setr,arcid,elements(%q<mdata>,2,chr(177)));@select/inline strlen(u(setr,arcname,get(u(cobj,agedb)/ARC`%q<arcid>`STATUS)))=>0,{@attach %!/INC`SETSTATUS=%0,%0,get(u(cobj,agedb)/ARC`%q<arcid>`STATUS),,X,X;@select/inline strlen(u(setr,supname,get(u(cobj,age)/STATUS`%q<arcname>`SUPPORT)))=>0,{@attach %!/INC`SETSTATUS=%0,%0,%q<supname>,,X,X;&D`COMBAT`SUPPORTING %0=%0;&D`COMBAT`SUPPORT %0=%q<supname>}};&D`COMBAT`QUIRKS %0=sortkey(#lambda/get(u(cobj,agedb)/QRK`\%0),u(mysql,READY`QUIRKS,%2),i)

&Q`READY`MANTLE [u(cobj,age)]=SELECT mantle_stats,mantle_archetype,mantle_accolades FROM volv_mantle WHERE mantle_id=? LIMIT 1
&Q`READY`QUIRKS [u(cobj,age)]=SELECT trait_id FROM vol_clink_trait WHERE clink_id=? AND trait_type=2 AND trait_value>0

&INC`COMBAT`READYCHARACTER`FINISH [u(cobj,age)]=@attach %!/INC`COMBAT`READYCHARACTER`FINISH`STARTING;@attach %!/INC`COMBAT`READYCHARACTER`FINISH`WEIGHT;@dolist/inline get(%0/D`COMBAT`QUIRKS)={@attach %!/INC`SETSTATUS=%0,%0,get(u(cobj,agedb)/QRK`%i0`STATUS),,X,X};@attach/localize %!/INC`COMBAT`READYCHARACTER`FINISH`STATIC;th u(attrib_set,%0,D`COMBAT`HEALTH`ORIGINAL,get(%0/D`COMBAT`HEALTH));@select/inline t(get(%0/D`CONSEQUENCES))=1,{th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH),switch(get(%0/D`CONSEQUENCES),1,0.9,2,0.75,3,0.6),default(%0/D`CSYS`TANK,1)),0))},0,{th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH),default(%0/D`CSYS`TANK,1)),0))};&D`CSYS`TANK %0=1

@@ @attach %!/INC`COMBAT`READYCHARACTER`FINISH`CALC;@attach %!/INC`COMBAT`READYCHARACTER`FINISH`STATS;

&INC`COMBAT`READYCHARACTER`FINISH`STARTING [u(cobj,age)]=&D`COMBAT`HEALTH %0=1000;&D`COMBAT`DRIVE %0=70;&D`COMBAT`DRIVE`GAIN %0=5;&D`COMBAT`DRIVE`MAXIMUM %0=100;&D`COMBAT`DRIVE`COST %0=0;&D`COMBAT`DRIVE`EXHAUSTION_MULTIPLIER %0=1;&D`COMBAT`DRIVE`PENALTY_MULTIPLIER %0=1;&D`COMBAT`DRIVE`BONUS_MULTIPLIER %0=1;&D`COMBAT`DAMAGE %0=0;&D`COMBAT`HYPE %0=0;&D`COMBAT`HYPE`MAXIMUM %0=10;&D`COMBAT`HYPE`GAIN %0=2

&INC`COMBAT`READYCHARACTER`FINISH`WEIGHT [u(cobj,age)]=

&INC`COMBAT`READYCHARACTER`FINISH`STATIC [u(cobj,age)]=@dolist/inline edit(u(lattr,%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={th u(addto,%0,D`COMBAT`HEALTH,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`HP));th u(addto,%0,D`COMBAT`DRIVE`GAIN,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`GAIN`DRIVE));th u(addto,%0,D`COMBAT`DRIVE,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`START`DRIVE));th u(addto,%0,D`COMBAT`DRIVE`MAXIMUM,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`DRIVE));th u(addto,%0,D`COMBAT`HYPE`GAIN,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`GAIN`HYPE));th u(addto,%0,D`COMBAT`HYPE,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`START`HYPE));th u(addto,%0,D`COMBAT`HYPE`MAXIMUM,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`HYPE));th u(attrib_set,%0,D`COMBAT`BANNED`OFF,setunion(get(%0/D`COMBAT`BANNED`OFF),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`OFF)));th u(attrib_set,%0,D`COMBAT`BANNED`DEF,setunion(get(%0/D`COMBAT`BANNED`DEF),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`DEF)));th u(attrib_set,%0,D`COMBAT`BANNED`PUSH,setunion(get(%0/D`COMBAT`BANNED`PUSH),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`PUSH)));@dolist/inline EXHAUSTION PENALTY BONUS={th u(addto,%0,D`COMBAT`DRIVE`%i0_MULTIPLIER,get(u(cobj,age)/STATUS`[before(%i1,$)]`DRIVE`%i0_MULTIPLIER))}};&D`COMBAT`DRIVE`STATUS %0=u(drivestatus,%0)

&ADDTO [u(cobj,age)]=u(attrib_set,%0,%1,add(%2,default(%0/%1,0)))


@@ - RESET
&INC`COMBAT`RESET`MAIN [u(cobj,age)]=@check isint(u(setr,m1id,get(%#/D`CSYS`MANTLE)))=@attach %!/INC`MSG=ERROR: Your Mantle is not set.;@select/inline t(nattr(%#/D`COMBAT`**))=1,{@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will reset you to base combat readiness\, clear any attacks\, and apply Consequences as applicable. ARE YOU SURE? Enter the same command again within ten seconds to continue.,RESET CSYS};@select/inline cand(hasattr(%#/D`COMBAT`SUPPORTING),not(strmatch(get(%#/D`COMBAT`SUPPORTING),%:)))=1,{@attach %!/KILLSTATUS=get(%#/D`COMBAT`SUPPORTING),first(get(get(%#/D`COMBAT`SUPPORTING)/D`COMBAT`ACTIVE`STATUS`[get(%#/D`COMBAT`SUPPORT)]))};@select/inline cand(nattr(%#/D`COMBAT`**),not(get(%#/D`CSYS`MANTLE`LOCKED)))=>0,{@attach %!/INC`COMBAT`RESET`MAIN`CONSEQUENCES};@select/inline default(%#/D`CSYS`TANK,1)=>1,{@attach %!/INC`EANNOUNCE=TANK,[ansi(hw,%n)] resets! Ready to Tank [default(%#/D`CSYS`TANK,1)] opponents!},{@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] has reset!};@attach %!/INC`COMBAT`READYCHARACTER=%:,%q<m1id>,get(%#/D`CSYS`MANTLE`LINK),get(%#/D`CSYS`MANTLE`LOCKED)

&INC`CONSEQUENCES`SET [u(cobj,age)]=@attach %!/WIPE=%#,D`CONSEQUENCES;th u(attrib_set,%#,D`CONSEQUENCES,%1);th u(attrib_set,%#,D`CONSEQUENCES`TIMEOUT,add(get(%#/D`COMBAT`DAMAGE`TIMESTAMP),mul(60,60,24,switch(%1,1,7,2,14,3,28))));th u(addto,%#,D`CONSEQUENCES`SCENES,switch(%1,1,1,2,1,3,2,0));@attach %!/INC`EPRIVATE=CONSEQUENCES,You now suffer [switch(%1,1,Mild,2,Moderate,3,Severe)] Consequences! Maximum HP temporarily reduced!,%#

&INC`COMBAT`RESET`MAIN`CONSEQUENCES [u(cobj,age)]=@select/inline default(%#/D`COMBAT`KEEPS,0)=0,{th u(setq,newcon,if(lte(u(percent,%#),0.35),1,0))},1,{th u(setq,newcon,if(lt(u(percent,%#),0.25),3,if(lt(u(percent,%#),0.5),2,1)))};th u(setq,newcon,max(%q<newcon>,default(%#/D`COMBAT`TAKEHIT,0)));@select/inline gt(%q<newcon>,default(%#/D`CONSEQUENCES,0))=1,{@attach %!/INC`CONSEQUENCES`SET=%#,%q<newcon>};@attach %!/INC`CONSEQUENCES`DOWNGRADE;

&INC`CONSEQUENCES`DOWNGRADE [u(cobj,age)]=@select/inline t(hasattr(%#/D`CONSEQUENCES))=1,{@select/inline gte(u(setr,overtime,sub(add(secs(),%q<overtime>),get(%#/D`CONSEQUENCES`TIMEOUT))))=1,{@attach %!/INC`CONSEQUENCES`DOWNGRADE`DO},0,{@select/inline gte(sub(get(%#/D`FINISHED),get(%#/D`FINISHED`SPENT),get(%#/D`CONSEQUENCES`SCENES)))=1,{th u(addto,%#,D`FINISHED`SPENT,get(%#/D`CONSEQUENCES`SCENES));@attach %!/INC`CONSEQUENCES`DOWNGRADE`DO}}}

&INC`CONSEQUENCES`DOWNGRADE`DO [u(cobj,age)]=@select/inline get(%#/D`CONSEQUENCES)=1,{@attach %!/INC`MSG=You no longer suffer any combat Consequences. Full HP restored!;@attach %!/WIPE=%#,D`CONSEQUENCES},{@attach %!/INC`CONSEQUENCES`SET=%#,sub(get(%#/D`CONSEQUENCES),1);@attach %!/INC`CONSEQUENCES`DOWNGRADE}

&SCENE`CHANGE_STATUS [u(cobj,age)]=@select/inline cand(eq(%2,3),t(%4))=1,{@dolist/inline [u(filter,ISOBJID,u(mysql,SCENE`ACTORS,%0))]={th u(addto,%i0,D`FINISHED,1)}}

&Q`SCENE`ACTORS [u(cobj,age)]=SELECT character_objid FROM volv_actor_agg WHERE scene_id=? AND action_count>0

@@ - KEEPS
&INC`COMBAT`KEEPS`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@check get(%#/D`COMBAT`ARCHETYPE)=@attach %!/INC`MSG=ERROR: Unshaped Mantles may not use +keeps.;@stop get(%#/D`COMBAT`KEEPS)=@attach %!/INC`MSG=ERROR: Keeps is already active! Go the distance!;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] Consequences await. Are you SURE you want to use Keeps this fight? Type +keeps again to verify!,KEEPS;th u(attrib_set,%#,D`COMBAT`PULL,0);th u(attrib_set,%#,D`COMBAT`WEIGHT,u(setr,newwt,u(WEIGHT`UPGRADE,get(%#/D`COMBAT`WEIGHT`ORIGINAL))));th u(attrib_set,%#,D`COMBAT`KEEPS,1);@attach %!/INC`SETSTATUS=%#,%#,SPC_KEEPS,,1,1;@attach %!/INC`EANNOUNCE=KEEPS,Look out! [ansi(hw,%n)] is fighting for Keeps! Weight upgraded to [ansi(hw,capstr(%q<newwt>))]

&KEEPBONUS [u(Cobj,age)]=3

&STATUS`SPC_KEEPS [u(Cobj,age)]=Keeps
&STATUS`SPC_KEEPS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_ATTACKED,0))
&STATUS`SPC_KEEPS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED,0))
&STATUS`SPC_KEEPS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_ATTACKED,0))
&STATUS`SPC_KEEPS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED,0))

@@ - STATS

@@ SELL
&INC`COMBAT`SELL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`SELL,0)=0,{@attach %!/INC`EPRIVATE=SELL,The other guy is seemingly awfully scary now.,%#},1,{@attach %!/INC`EPRIVATE=SELL,Who are you kidding? They're not scary at all!,%#};&D`COMBAT`HARDSELL %#=0;&D`COMBAT`SELL %#=not(get(%#/D`COMBAT`SELL))

@@ HARDSELL
&INC`COMBAT`HARDSELL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`HARDSELL,0)=0,{@attach %!/INC`EPRIVATE=HARDSELL,The other guy is seemingly INCREDIBLY scary now.,%#},1,{@attach %!/INC`EPRIVATE=HARDSELL,Who are you kidding? They're not scary at all! Not even a bit!,%#};&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=not(get(%#/D`COMBAT`HARDSELL))

@@ - PULL
&INC`COMBAT`PULL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@stop get(%#/D`COMBAT`KEEPS)=@attach %!/INC`MSG=ERROR: Keeps is active! There's no backing down now. Go the distance!;@stop strmatch(LIGHT,get(%#/D`COMBAT`WEIGHT`ORIGINAL))=@attach %!/INC`MSG=ERROR: Maybe if you were a little beefier...;@select/inline default(%#/D`COMBAT`PULL,0)=0,{th u(attrib_set,%#,D`COMBAT`WEIGHT,u(setr,newwt,u(WEIGHT`DOWNGRADE,get(%#/D`COMBAT`WEIGHT`ORIGINAL))));th u(attrib_set,%#,D`COMBAT`PULL,1);@attach %!/INC`EANNOUNCE=PULL,[ansi(hw,%n)] decides to take it easy for now. Weight downgraded to [ansi(hw,capstr(%q<newwt>))]!},1,{th u(attrib_set,%#,D`COMBAT`WEIGHT,get(%#/D`COMBAT`WEIGHT`ORIGINAL));@attach %!/INC`EANNOUNCE=PULL,[ansi(hw,%n)] stops holding back! Original Weight class restored.;&D`COMBAT`PULL %#=0}

@@ - RESTRAIN
&INC`COMBAT`RESTRAIN`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`RESTRAIN,0)=0,{@attach %!/INC`EANNOUNCE=RESTRAIN,[ansi(hw,%n)] pulls [poss(%#)] punches a little!},1,{@attach %!/INC`EANNOUNCE=RESTRAIN,No holding back anymore! [ansi(hw,%n)] is going at it full steam!};th u(attrib_set,%#,D`COMBAT`RESTRAIN,not(get(%#/D`COMBAT`RESTRAIN)))

&TESTER [u(cobj,age)]=testlock(V`GROUP`6301:<=9001|V`ADMIN:>0|FLAG^ROYALTY|FLAG^WIZARD,%0)

&SCALECOLOR [u(Cobj,age)]=switch(%0,1,45,2,113,3,220,4,198,5,196)
&SCALECOLOR`WEIGHT [u(Cobj,age)]=switch(%0,LIGHT,45,MEDIUM,113,HEAVY,220,SUPERHEAVY,198,BOSS,196)

&FANCYWEIGHT [u(cobj,age)]=ansi(u(setr,qcolor,u(scalecolor`weight,get(%0/D`COMBAT`WEIGHT))),[if(get(%0/D`COMBAT`KEEPS),+,if(get(%0/D`COMBAT`PULL),-))][capstr(lcstr(if(%1,left(get(%0/D`COMBAT`WEIGHT),1),get(%0/D`COMBAT`WEIGHT))))])

&INC`COMBAT`SHEET`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`STATS`MAIN
&INC`COMBAT`STATS`MAIN [u(cobj,age)]=@attach %!/INC`CHECKPC=u(strfirstof,if(u(tester,%#),%0),%#),1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not readied for battle.;@pemit %#=u(header,%q<t1name> - Stats);@attach %!/INC`COMBAT`STATS`DISPLAY;@pemit %#=u(footer)


&INC`COMBAT`STATS`DISPLAY [u(cobj,age)]=@pemit %#=align(1. 50 1. 23 1.,ansi(u(color,%#,BORDER),|),u(setr,startsec,u(fancyweight,%q<t1>)[repeat(*,get(%q<t1>/D`COMBAT`STATS`5`ORIG))]%b[ansi(hw,default(u(cobj,agedb)/ARC`[default(%q<t1>/D`COMBAT`ARCHETYPE,0)],Unpublished))]%B[ansi(220,repeat(*,get(%q<t1>/D`COMBAT`ACCOLADES)))])[rjust(u(fancycon,%q<t1>),sub(50,strlen(%q<startsec>),10))]%R[rjust(ansi(h,HP:),6)] [ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(u(setr,perc,mul(%i0,5)),100),u(percent,%q<t1>)),ansi(u(ryg,sub(100,%q<perc>)),|),%B),%b,)][ansi(h,>>)]%B[ansi(h,[sub(get(%q<t1>/D`COMBAT`HEALTH),get(%q<t1>/D`COMBAT`DAMAGE))]/[get(%q<t1>/D`COMBAT`HEALTH)]%B\([before(round(mul(u(percent,%q<t1>),100),0),.)]\%\))]%R[rjust(ansi(h,Drive:),6)] [ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(mul(%i0,5),100),fdiv(get(%q<t1>/D`COMBAT`DRIVE),get(%q<t1>/D`COMBAT`DRIVE`MAXIMUM))),ansi(u(drivebar,%i0),|),%b),%b,)][ansi(h,>>)]%B[ansi(h,[get(%q<t1>/D`COMBAT`DRIVE)]/[get(%q<t1>/D`COMBAT`DRIVE`MAXIMUM)]%B\([get(%q<t1>/D`COMBAT`DRIVE`STATUS)]\))]%R[rjust(ansi(h,Hype:),6)] [ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(mul(%i0,5),100),fdiv(get(%q<t1>/D`COMBAT`HYPE),get(%q<t1>/D`COMBAT`HYPE`MAXIMUM))),ansi(u(hypebar,%i0),|),%b),%b,)][ansi(h,>>)]%B[ansi(h,[get(%q<t1>/D`COMBAT`HYPE)]/[get(%q<t1>/D`COMBAT`HYPE`MAXIMUM)])],ansi(u(color,%#,BORDER),|),center(ansi(%q<qcolor>,Quirks),23)%R[iter(get(%q<t1>/D`COMBAT`QUIRKS),ansi(hw,default(u(cobj,agedb)/QRK`%i0,<unknown>)),%B,%R)],ansi(u(color,%#,BORDER),|));@pemit %#=u(separator);@pemit %#=align(1. 76 1.,ansi(u(color,%#,BORDER),|),u(SHEET`STAT,%q<t1>,POW,0)[u(SHEET`STAT,%q<t1>,PRE,2)]%R[u(SHEET`STAT,%q<t1>,END,1)][u(SHEET`STAT,%q<t1>,MIT,3)],ansi(u(color,%#,BORDER),|));

&DRIVEBAR [u(cobj,age)]=switch(1,t(match(1 2 3 4,%0)),27,t(match(5 6 7 8 9 10,%0)),75,t(match(11 12 13 14 15 16,%0)),117,t(match(17 18 19 20,%0)),159)

&HYPEBAR [u(cobj,age)]=switch(1,t(match(1 2,%0)),56,t(match(3 4,%0)),93,t(match(5 6,%0)),129,t(match(7 8,%0)),165,t(match(9 10,%0)),201,t(match(11 12,%0)),207,t(match(13 14,%0)),213,t(match(15 16,%0)),219,t(match(17 18,%0)),225,t(match(19 20,%0)),231)

&SHEET`STAT [u(cobj,age)]=localize(ansi(hw,%1:)%B[ljust(ansi(switch(u(setr,val,get(%0/D`COMBAT`STATS`%2`DISPLAY)),1,208,2,191,3,76,4,39,5,141),u(VIEW`STAT,%q<val>)%B[repeat(*,get(%0/D`COMBAT`STATS`%2`ACC))]),20)])


@@ - ATTACK
&INC`COMBAT`ATTACK`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`ATTACK`MAIN`TARGET;@attach %!/INC`COMBAT`ATTACK`MAIN`ATTACK;@@ @attach %!/INC`COMBAT`ATTACK`MAIN`SELF_EFFECTS;@@ @attach %!/INC`COMBAT`ATTACK`MAIN`BONUSES;@attach %!/INC`COMBAT`ATTACK`MAIN`LAUNCH;@attach %!/INC`COMBAT`ATTACK`MAIN`ENDTURN

&INC`COMBAT`ATTACK`MAIN`TARGET [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Mantle's set and use +reset.;@stop gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Nobody entered to attack.;@check strlen(%2)=@attach %!/INC`MSG=ERROR: No attack name entered.;th u(setq,allplayers,u(setr,players,lvplayers(%l)));@dolist/inline/delimit \, %0={@check isdbref(u(setr,ply,namegrab(%q<players>,%i0)))=@attach %!/INC`MSG=ERROR: '%i0' does not match a present player.;th u(setq,players,setdiff(%q<players>,%q<ply>))};th u(setq,targets,setdiff(%q<allplayers>,%q<players>));@dolist/inline %q<targets>={@check nattr(%i0/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: [name(%i0)] is not ready for battle.;@stop hasattr(%i0/D`COMBAT`Q`%#)=@attach %!/INC`MSG=ERROR: You have already attacked [name(%i0)]!;@stop gte(get(%i0/D`COMBAT`DAMAGE),get(%i0/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: [name(%i0)] is already down!}

&INC`COMBAT`ATTACK`MAIN`ATTACK [u(cobj,age)]=@attach %!/INC`VALID`POSINT=before(%2,/);@check match(get(u(cobj,agedb)/ATTACKS),u(setr,atklevel,%q<value>),|)=@attach %!/INC`MSG=ERROR: No Attack Number for %q<value>!;@check strlen(before(after(%2,/),:))=@attach %!/INC`MSG=ERROR: Must enter an Attack Style!;@check u(setr,off,u(FIND_TRAIT,OFF,before(after(%2,/),:)))=@attach %!/INC`MSG=ERROR: Not an Attack Style!;@stop t(match(get(%#/D`COMBAT`BANNED`OFF),%q<off>))=@attach %!/INC`MSG=ERROR: You may not use that Offense!;th u(setq,atkname,after(after(%2,/),:));@attach %!/INC`SETSTATUS=%#,%#,get(u(cobj,agedb)/OFF`%q<off>`STATUS),LEVEL=%q<atklevel>,get(u(cobj,agedb)/OFF`%q<off>`ATTACK_TURNS),get(u(cobj,agedb)/OFF`%q<off>`DEFENSE_TURNS);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`OFF`%q<off>`ACTIVATE=%#,%i0};@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_BEFORE_LAUNCH=%#,%i0}

&GET`ARCHETYPE [u(Cobj,age)]=localize(if(u(setr,arc,get(%0/D`COMBAT`ARCHETYPE)),u(u(cobj,agedb)/ARC`%q<arc>[if(%1,`%1)]),Unshaped))

@@ &INC`COMBAT`ATTACK`MAIN`SELF_EFFECTS [u(cobj,age)]=@dolist/inline/nobreak [get(%#/%q<atk>`EFFECTS`PRIORITY)]={@attach %!/EFFECT`%i0`PRIORITY=%#};@dolist/inline/nobreak setunion(setunion(get(%#/%q<atk>`EFFECTS`SELF`LINGER),get(%#/%q<atk>`EFFECTS`SELF`INSTANT)),filterbool(#lambda/match(v(EFFECT`\%0`CATEGORIES),self),%q<extraeff>))={@attach %!/INC`SETSTATUS=%#,%i0};th u(setq,extargeffs,filterbool(#lambda/match(v(EFFECT`\%0`CATEGORIES),target),%q<extraeff>));

@@ &INC`COMBAT`ATTACK`MAIN`BONUSES [u(cobj,age)]=th u(setq,bonuses,add(get(%#/%q<atk>`PRECALC`ATTACK),u(heatbonus,%#),u(dynamic,%#,ATTACK,ATTACK)));th u(setq,multiplier,add(get(%#/%q<atk>`PRECALC`ATTACK`MULTIPLIER),u(dynamic,%#,ATTACK,ATTACK`MULTIPLIER)));

&FIL`TAGFILTER [u(cobj,age)]=t(match(v(%1`[before(%0,~)]`%2),%3))

&INC`DRIVE [u(Cobj,age)]=th u(addto,%0,D`COMBAT`DRIVE,%1);@select/inline gte(get(%0/D`COMBAT`DRIVE),get(%0/D`COMBAT`DRIVE`MAXIMUM))=1,{&D`COMBAT`DRIVE %0=get(%0/D`COMBAT`DRIVE`MAXIMUM)};@select/inline not(%3)=1,{@attach %!/INC`ANNOUNCE=[ansi(hw,name(%0))] [if(lte(%1,0),loses,gains)] [ansi(118,abs(%1))] [ansi(118,Drive)] from [ansi(hw,%2)]!};&D`COMBAT`DRIVE`STATUS %0=u(drivestatus,%0);@select/inline cand(not(%4),gte(%1,0))=1,{th u(addto,%0,D`COMBAT`DRIVE`TALLY,u(strfirstof,%5,%1))}

&INC`HYPE [u(Cobj,age)]=th u(addto,%0,D`COMBAT`HYPE,%1);@select/inline gte(get(%0/D`COMBAT`HYPE),get(%0/D`COMBAT`HYPE`MAXIMUM))=1,{&D`COMBAT`HYPE %0=get(%0/D`COMBAT`HYPE`MAXIMUM)};@select/inline not(%3)=1,{@attach %!/INC`ANNOUNCE=[ansi(hw,name(%0))] [if(gte(%1,0),gains,loses)] [ansi(118,abs(%1))] [ansi(118,Hype)] from [ansi(hw,%2)]!}

&INC`COMBAT`ATTACK`MAIN`LAUNCH [u(cobj,age)]=th [u(setq,fullname,[if(strlen(%q<atkname>),'%q<atkname>' \([get(u(cobj,agedb)/OFF`%q<off>)] Level %q<atklevel>\),[get(u(cobj,agedb)/OFF`%q<off>)] Level %q<atklevel>)])];th u(setq,boss,default(%#/D`COMBAT`BOSS,1));@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_BEFORE_LAUNCH=%#,%i0};@select/inline u(setr,dafter,add(get(%#/D`COMBAT`DRIVE),mul(u(setr,dcost,add(u(cost,ATTACKS,%q<atklevel>`COST),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%#,%i0,ATTACK,DRIVE_COST))))),-1)))=<-25,{@attach %!/INC`DRIVE=%#,mul(%q<dcost>,-1),attack costs!,1;@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] tries to launch a [ansi(u(scalecolor,%q<atklevel>),u(u(cobj,agedb)/ATTACKS`%q<atklevel>`DESCRIPTION) [u(u(cobj,agedb)/OFF`%q<off>)])]%B[if(strlen(%q<atkname>),%q<atkname>,attack)] at [u(itemize,iter(u(sortname,%q<targets>),ansi(hw,name(%i0)),%B,\,|),|,and,\,)]! ... but can't summon the strength!;@select/inline gt(u(setr,overe,u(overexert,%#)),0)=1,{@attach %!/INC`DAMAGE=%#,floor(mul(get(%#/D`COMBAT`HEALTH),%q<overe>)),Exhaustion!}},{@dolist/inline/nobreak %q<targets>={@attach %!/INC`COMBAT`ATTACK`LAUNCH=%#,%i0,%q<extargeffs>,%q<fullname>};&D`COMCHECK`ATTACKED %#=%q<targets>;@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] launched a [ansi(u(scalecolor,%q<atklevel>),u(u(cobj,agedb)/ATTACKS`%q<atklevel>`DESCRIPTION) [u(u(cobj,agedb)/OFF`%q<off>)])]%B[if(strlen(%q<atkname>),%q<atkname>,attack)] at [u(itemize,iter(u(sortname,%q<targets>),ansi(hw,name(%i0)),%B,\,|),|,and,\,)]!;@attach %!/INC`PRIVATE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] attacked you! Respond with [ansi(hw,+defend %n=<choice>)],%q<targets>;@attach %!/INC`DRIVE=%#,mul(%q<dcost>,-1),attack costs!,1,1;@select/inline gt(u(setr,overe,u(overexert,%#)),0)=1,{@attach %!/INC`DAMAGE=%#,floor(mul(get(%#/D`COMBAT`HEALTH),%q<overe>)),Exhaustion!};@select/inline u(setr,dot,round(u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%#,%i0,ATTACK,DOT))),0))=>0,{@attach %!/INC`DAMAGE=%#,%q<dot>,Damage Over Time}};

&INC`COMBAT`ATTACK`LAUNCH [u(cobj,age)]=th u(attrib_set,%1,u(setr,atkattr,D`COMBAT`Q`%0),%3);@dolist/inline edit(u(lattr,%#/D`COMBAT`STATS`*),D`COMBAT`STATS`,)={th u(attrib_set,%1,%q<atkattr>`STATS`%i0,get(%#/D`COMBAT`STATS`%i0));th u(attrib_set,%1,%q<atkattr>`STATS`%i0`MOD,u(calcstatmod,%#,%i0,ATTACK,%q<off>))};&%q<atkattr>`ATK %1=%q<atklevel>;&%q<atkattr>`OFF %1=%q<off>;&%q<atkattr>`ARCHETYPE %1=get(%0/D`COMBAT`ARCHETYPE);&%q<atkattr>`WEIGHT %1=get(%0/D`COMBAT`WEIGHT);&%q<atkattr>`TIMESTAMP %1=secs();@attach %!/INC`CPTREE=%#,D`COMBAT`STATUS,%1,%q<atkattr>`STATUS;@attach %!/INC`CPTREE=%#,D`COMBAT`ACTIVE,%1,%q<atkattr>`ACTIVE;@dolist/inline SELL HARDSELL PULL KEEPS RESTRAIN WEIGHT={@cpattr %#/D`COMBAT`##=%1/%q<atkattr>`##};th u(attrib_set,%1,%q<atkattr>`DRIVESTATUS,u(drivestatus,%#));@attach %!/INC`CPTREE=%0,D`COMBAT`DRIVE,%1,%q<atkattr>`DRIVE

&INC`COMBAT`ATTACK`MAIN`ENDTURN [u(cobj,age)]=th u(addto,%#,D`COMBAT`NUMBERS`TIMES_ATTACKED,1);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_END_TURN=%#,%i0};@attach/nobreak %!/INC`COMBAT`ATTACK`MAIN`ENDTURN`STATUS=%#;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`OFF`%q<off>`END_TURN=%#,%i0};&D`COMBAT`HYPE`USED %#=0;&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=0;&D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS %#=%q<dcost>;&D`COMBAT`DRIVE`TALLY %#=0

&INC`COMBAT`ATTACK`MAIN`ENDTURN`STATUS [u(cobj,age)]=@dolist/inline/nobreak get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK)={@select/inline u(setr,srem,get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS))=X,{},>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%i0`ATTACK_TURNS,sub(%q<srem>,1));@stop get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS);th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%i0));@stop cor(strmatch(get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS),X),gt(u(lmax,iter(ATTACK DEFENSE,get(%0/D`COMBAT`STATUS`%i1`%i0_TURNS))),0));@attach %!/KILLSTATUS=%0,%i0}};

&INC`DAMAGE [u(cobj,age)]=@select/inline not(%4)=1,{@attach %!/INC`ANNOUNCE=[if(%3,%3,[u(moniker,%0)] took [ansi(h,%1)] damage from %2!)]};th u(setq,predam,get(%0/D`COMBAT`DAMAGE));th u(setq,prebon,u(healthbonus,%0));th u(addto,%0,D`COMBAT`DAMAGE,%1);th u(setq,postbon,u(healthbonus,%0));th u(setq,afterper,u(percent,%0));@dolist/inline/nobreak iter(revwords(lnum(0,19)),mul(%i0,5))={@attach %!/INC`DAMAGETIER=%0,%i0};@select/inline cand(lte(%q<afterper>,0),not(%4))=1,{@attach %!/INC`ANNOUNCE=[ansi(hr,name(%0) has been Defeated! *BOOM*)]};&D`COMBAT`DAMAGE`TIMESTAMP %0=secs()

&INC`DAMAGETIER [u(cobj,age)]=@select/inline cand(lte(%q<afterper>,fdiv(%1,100)),not(hasattr(%0/D`COMBAT`PERCENT`%1)))=1,{&D`COMBAT`PERCENT`%1 %0=1;@dolist/inline/nobreak get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`BELOW_%1_HEALTH=%0,%i0}};


@@ - DEFEND
&INC`COMBAT`DEFEND`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`DEFEND`MAIN`TARGET;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE;@attach %!/INC`COMBAT`DEFEND`MAIN`STRIKE;@attach %!/INC`COMBAT`DEFEND`MAIN`ENDTURN;@attach %!/INC`COMBAT`DEFEND`MAIN`DEBUG

&INC`COMBAT`DEFEND`MAIN`TARGET [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Mantle's set and use +reset.;@stop gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check nattr(%#/D`COMBAT`Q`*)=@attach %!/INC`MSG=ERROR: You have no attacks to deal with!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Nobody entered to defend against.;@check isdbref(u(setr,atker,namegrab(iter(lattr(%#/D`COMBAT`Q`*),last(%i0,`)),%0)))=@attach %!/INC`MSG=ERROR: No Attacker called '%0'!;th u(setq,atk,D`COMBAT`Q`%q<atker>);@check strlen(%2)=@attach %!/INC`MSG=ERROR: No defense method entered.;@check u(setr,def,u(FIND_TRAIT,DEF,%2))=@attach %!/INC`MSG=ERROR: No Defense named '%2'!;@stop t(match(get(%#/D`COMBAT`BANNED`DEF),%q<def>))=@attach %!/INC`MSG=ERROR: You may not use that Defense!;th u(setq,off,get(%#/%q<atk>`OFF));@attach %!/INC`SETSTATUS=%#,%#,get(u(cobj,agedb)/DEF`%q<def>`STATUS),,get(u(cobj,agedb)/DEF`%q<def>`ATTACK_TURNS),get(u(cobj,agedb)/DEF`%q<def>`DEFENSE_TURNS);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`DEF`%q<def>`ACTIVATE=%#,%i0}

&DYNAMIC [u(cobj,age)]=add(u(ladd,iter(get(%0/D`COMBAT`ACTIVE_EFFECTS`%1),udefault(%!/EFFECT`[before(%i0,~)]`%2,0,%0),|,%b)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE_BOOSTS`%1),udefault(%!/BOOST`[before(%i0,~)]`%2,0,%0),|,%b)),u(ladd,iter(get(%0/D`COMBAT`ABILITIES`%1),udefault(%!/ABIL`[before(%i0,~)]`%2,0,%0,after(%i0,~)),|,%b)))

&GET`WEIGHT [u(cobj,age)]=localize(if(cand(strlen(u(setr,wt,get(%0/D`COMBAT`WEIGHT))),hasattr(u(cobj,agedb)/WEIGHTS`%q<wt>)),u(u(cobj,agedb)/WEIGHTS`%q<wt>[if(%1,`%1)])))

&GET`DRIVE [u(cobj,age)]=localize(if(cand(strlen(u(setr,dr,get(%0/D`COMBAT`DRIVE`STATUS))),hasattr(u(cobj,agedb)/DRIVES`%q<dr>)),u(u(cobj,agedb)/DRIVES`%q<dr>[if(%1,`%1)])))

&CALCSTATMOD [u(cobj,age)]=add(u(adj,u(GET`DRIVE,%0,%2`BONUS`STAT`%1)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(getstatus,%0,%i0,%2,BONUS`STAT`%1))),mul(-1,add(u(adj,u(GET`DRIVE,%0,%2`PENALTY`STAT`%1)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(getstatus,%0,%i0,%2,PENALTY`STAT`%1))))))

&CALCOFF [u(cobj,age)]=add(1,fdiv(sub(fdiv(%0,u(u(cobj,agedb)/ENTITY`0`STAT`%1`DIAL)),1),1.5))

&CALCDEF [u(cobj,age)]=add(1,fdiv(sub(fdiv(u(u(cobj,agedb)/ENTITY`0`STAT`%1`DIAL),%0),1),1.5))

&INC`RUNSTATUS [u(Cobj,age)]=@dolist/inline edit(u(lattr,%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`%i0`%1=%0,%2,%3,%4,%5,%6,%7,%8,%9}

&MEDEFSTAT [u(Cobj,age)]=get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)

&INC`COMBAT`DEFEND`MAIN`CALCULATE [u(cobj,age)]=th u(setq,atklevel,get(%#/%q<atk>`ATK));@dolist/inline u(setr,atkeratkstat,get(%#/%q<atk>`ACTIVE`STATUS`ATTACK))={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_CALCULATE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_CALCULATE=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`BALANCE;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGEMOD;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ACCURACYMOD;@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_HITCHECK=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_HITCHECK=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>;th u(setq,dot,round(u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,DOT))),0));@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_PRE_REROLL=%#,%i0};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_PRE_REROLL=%#,%i0};@select/inline not(%q<disablereroll>)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_REROLL=%#,%i0}};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_MODIFY_HITMUL=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_REROLL=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_MODIFY_HITMUL=%#,%i0};@select/inline gte(%q<hitmul>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_STRIKE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_STRIKE=%#,%i0}};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGE;th u(setq,htype,if(gt(%q<hitmul>,0.0),if(gte(%q<hitmul>,1.0),CRITICAL,if(gte(%q<hitmul>,0.7),SOLID,CLOSE)),MISS));@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_%q<htype>=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_%q<htype>=%#,%i0};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_INCREASE_DAMAGE=%#,%i0};th u(setq,damage,round(mul(%q<damage>,%q<incdamagemul>),0));th u(setq,incdamagemul,1);@select/inline gt(%q<damage>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_DECREASE_DAMAGE=%#,%i0}};@select/inline gt(%q<damage>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_NEGATE_DAMAGE=%#,%i0}};@select/inline gt(%q<damage>,0)=1,{@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_INCREASE_DAMAGE=%#,%i0};th u(setq,damage,round(mul(%q<damage>,%q<incdamagemul>),0));th u(setq,incdamagemul,1)};@select/inline gt(%q<damage>,0)=1,{@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_DECREASE_DAMAGE=%#,%i0}};@select/inline gt(%q<damage>,0)=1,{@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_NEGATE_DAMAGE=%#,%i0}};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DNORMALIZE;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`NORMALIZE;@select/inline gt(%q<damage>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_POST_DAMAGE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_POST_DAMAGE=%#,%i0}};@select/inline gte(%q<hitmul>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_INFLICT_STATUS=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_INFLICT_STATUS=%#,%i0}};

&CALCSTAT`ATK [u(cobj,age)]=add(get(%0/%1`STATS`%2),default(u(cobj,agedb)/WEIGHTS`[get(%0/%1`WEIGHT)]`BONUS,0),mul(-3,default(%0/%1`RESTRAIN,0)))
&CALCSTAT [u(cobj,age)]=add(get(%0/D`COMBAT`STATS`%1),default(u(cobj,agedb)/WEIGHTS`[get(%0/D`COMBAT`WEIGHT)]`BONUS,0),mul(-3,default(%0/D`COMBAT`RESTRAIN,0)))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`BALANCE [u(cobj,age)]=@dolist/inline 0-1 1-0 2-3 3-2={@select/inline u(setr,diff,sub(u(setr,astat,u(CALCSTAT`ATK,%#,%q<atk>,before(%i0,-))),u(setr,dstat,u(CALCSTAT,%#,after(%i0,-)))))=0,{th u(setq,bdstat[after(%i0,-)],%q<dstat>);th u(setq,bastat[before(%i0,-)],%q<astat>)},>0,{th u(setq,bdiff,abs(%q<diff>));th u(setq,bdstat[after(%i0,-)],%q<dstat>);th u(setq,bastat[before(%i0,-)],add(%q<dstat>,fdiv(%q<bdiff>,u(cust,CORE,BALANCE))))},<0,{th u(setq,bdiff,abs(%q<diff>));th u(setq,bdstat[after(%i0,-)],add(%q<astat>,fdiv(%q<bdiff>,u(cust,CORE,BALANCE))));th u(setq,bastat[before(%i0,-)],%q<astat>)}};th unsetq(astat dstat)

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGEMOD [u(cobj,age)]=th u(setq,damagemod,mul(u(calcoff,add(%q<bastat0>,get(%#/%q<atk>`STATS`0`MOD)),0),u(calcdef,add(%q<bdstat1>,u(calcstatmod,%#,1,DEFENSE,%q<def>)),1),if(get(%#/%q<atk>`HARDSELL),0.9,if(get(%#/%q<atk>`SELL),0.95,1)),if(get(%#/D`COMBAT`HARDSELL),1.1,if(get(%#/D`COMBAT`SELL),1.05,1))));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ACCURACYMOD [u(Cobj,age)]=th u(setq,accuracymod,mul(u(calcoff,add(%q<bastat2>,get(%#/%q<atk>`STATS`2`MOD)),2),u(calcdef,add(%q<bdstat3>,u(calcstatmod,%#,3,DEFENSE,%q<def>)),3),if(get(%#/%q<atk>`HARDSELL),0.75,if(get(%#/%q<atk>`SELL),0.85,1)),if(get(%#/D`COMBAT`HARDSELL),1.25,if(get(%#/D`COMBAT`SELL),1.15,1))));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL [u(Cobj,age)]=@select/inline hasattr(%#/D`ROLLFORCE)=1,{th u(setq,roll,get(%#/D`ROLLFORCE));@attach %!/WIPE=%#,D`ROLLFORCE},0,{th u(setq,roll,die(1,100))};

&FULLDAMAGE [u(cobj,age)]=add(%q<damage>,%q<dot>)

&THRESHOLD [u(cobj,age)]=switch(1,eq(%0,1),0,cand(lt(%0,1.0),gte(%0,0.63)),1,lt(%0,0.63),2,cand(gte(%0,1.0),lte(%0,1.3666)),3,cand(gt(%0,1.3666),lte(%0,1.5388)),4,gte(%0,1.5388),5)

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD [u(cobj,age)]=th u(setq,tmode,u(THRESHOLD,%q<accuracymod>));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`0 [u(cobj,age)]=th u(setq,hitmul,switch(%q<roll>,<=10,0.0,<=50,0.4,<=90,0.7,>=91,1.0))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`1 [u(cobj,age)]=th u(setq,athresh,mul(sub(1,%q<accuracymod>),24.54));th u(setq,hitmul,if(lte(%q<roll>,round(add(10,%q<athresh>),0)),0.0,if(lte(%q<roll>,round(mul(5,add(10,%q<athresh>)),0)),0.4,if(cand(gt(%q<roll>,round(mul(5,add(10,%q<athresh>)),0)),lte(%q<roll>,round(add(90,%q<athresh>),0))),0.7,if(gt(%q<roll>,round(add(90,%q<athresh>),0)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`2 [u(cobj,age)]=th u(setq,athresh,mul(sub(1,%q<accuracymod>),135.65));th u(setq,hitmul,if(lte(%q<roll>,round(add(19,%q<athresh>),0)),0.0,if(cand(gt(%q<roll>,round(add(19,%q<athresh>),0)),lt(%q<roll>,95)),0.4,if(cand(lt(%q<roll>,100),gte(%q<roll>,95)),0.7,if(eq(%q<roll>,100),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`3 [u(cobj,age)]=th u(setq,athresh,mul(sub(%q<accuracymod>,1),24.54));th u(setq,hitmul,if(lte(%q<roll>,round(sub(10,%q<athresh>),0)),0.0,if(lte(%q<roll>,round(mul(5,sub(10,%q<athresh>)),0)),0.4,if(cand(gt(%q<roll>,round(mul(5,sub(10,%q<athresh>)),0)),lte(%q<roll>,round(sub(90,%q<athresh>),0))),0.7,if(gt(%q<roll>,round(sub(90,%q<athresh>),0)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`4 [u(cobj,age)]=th u(setq,athresh,mul(sub(%q<accuracymod>,1.3666),180.18));th u(setq,hitmul,if(eq(%q<roll>,1),0.0,if(lte(%q<roll>,5),0.4,if(cand(gt(%q<roll>,5),lte(%q<roll>,round(sub(81,%q<athresh>),0))),0.7,if(gt(%q<roll>,sub(81,%q<athresh>)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`5 [u(cobj,age)]=th u(setq,hitmul,if(eq(%q<roll>,1),0.0,if(lte(%q<roll>,5),0.4,if(cand(gt(%q<roll>,5),lte(%q<roll>,50)),0.7,if(gt(%q<roll>,50),add(1.0,mul(1.076,sub(%q<accuracymod>,1.588))))))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DNORMALIZE [u(cobj,age)]=th u(setq,origdamage,%q<damage>);@select/inline gt(%q<damage>,0)=1,{th u(setr,damage,u(setr,dnormdamage,fdiv(%q<damage>,add(1,fdiv(mul(get(%#/%q<atk>`DRIVE`TALLY),2.4),100)))))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`NORMALIZE [u(cobj,age)]=@select/inline gt(%q<damage>,0)=1,{th u(setq,damage,u(setr,normdamage,round(add(u(setr,yfac,mul(get(%#/D`COMBAT`HEALTH`ORIGINAL),u(cust,ATTACKS,%q<atklevel>`PERCENTAGE))),fdiv(sub(%q<damage>,%q<yfac>),u(cust,CORE,NORMALIZE))),0)))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGE [u(cobj,age)]=th u(setq,xconorig,get(u(cobj,agedb)/ATTACKS`%q<atklevel>));th u(setr,damage,u(setr,preflux,mul(u(cust,CORE,BASEDAMAGE),%q<damagemod>,add(%q<xconorig>,%q<xcon>),%q<hitmul>)));th u(setq,fudge,add(1.0,u(setr,flux,mul([if(rand(0,1),-,)]1,0.[rjust(rand(0,u(cust,CORE,FUDGESCATTER)),2,0)]))));th u(setr,startdamage,u(setr,damage,floor(mul(add(%q<damage>,%q<adamage>),%q<fudge>))));th u(setq,incdamagemul,1.0)

&INC`COMBAT`DEFEND`MAIN`STRIKE [u(cobj,age)]=th u(setq,boss,default(%#/D`COMBAT`BOSS,1));@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] [ansi(118,get(u(cobj,agedb)/DEF`%q<def>`ACTION))] against [ansi(hw,name(%q<atker>))]! [ansi(118,if(%q<hitmul>,if(gte(%q<hitmul>,1.0),A Critical Hit![u(setq,htype,CRITICAL)],if(gte(%q<hitmul>,0.7),A Solid Hit![u(setq,htype,SOLID)],A Close Call![u(setq,htype,CLOSE)])),It Missed![u(setq,htype,MISS)]))];@attach %!/INC`ANNOUNCE=[u(u(cobj,agedb)/DEF`%q<def>`%q<htype>,%q<atklevel>,ansi(hw,%n),ansi(hw,name(%q<atker>)),ansi(,u(u(cobj,agedb)/OFF`[get(%#/%q<atk>`OFF)]`DESCRIPTION,%q<atklevel>)))]%B[ansi(226,%q<damage>)] [ansi(hw,damage)]![if(%q<dot>,%B[ansi(hr,%q<dot>)] more from Damage over Time!)];@attach %!/INC`DAMAGE=%#,add(%q<damage>,%q<dot>),Normal Combat,,1;@select/inline gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=1,{@attach %!/INC`ANNOUNCE=[ansi(hr,%n has been defeated!)]};th u(setq,trgbons,iter(0 1 2 3,u(calcstatmod,%#,%i0,DEFENSE,%q<def>)));

&INC`COMBAT`DEFEND`MAIN`ENDTURN [u(cobj,age)]=&D`COMBAT`HISTORY`LAST_DEF_CHOICE %#=%q<def>;th u(addto,%#,D`COMBAT`NUMBERS`TIMES_DEFENDED,1);@attach %!/INC`DRIVE=%#,add(get(%#/D`COMBAT`DRIVE`GAIN),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,BONUS`DRIVE_GAIN)))),Passive Gain,1,,5;@attach %!/INC`HYPE=%#,get(%#/D`COMBAT`HYPE`GAIN),Passive Gain,1;th u(attrib_set,%#,D`COMBAT`HISTORY`LAST_SUFFERED_HITMUL,%q<hitmul>);th u(attrib_set,%#,D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE,%q<damage>);@dolist/inline edit(lattr(%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_PRE_BONUS=%#,%i0};@select/inline u(setr,ftb,cand(not(get(%#/D`COMBAT`NO_FIRST_BONUS)),eq(get(%#/D`COMBAT`NUMBERS`TIMES_DEFENDED),1),not(get(%#/D`COMBAT`NUMBERS`TIMES_ATTACKED))))=1,{@attach %!/INC`DRIVE=%#,15,First Turn Bonus,1};@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] passively gains [ansi(118,if(%q<ftb>,add(get(%#/D`COMBAT`DRIVE`GAIN),15),get(%#/D`COMBAT`DRIVE`GAIN)))] [ansi(118,Drive)] [if(%q<ftb>,\(First Turn Defense Bonus!\)%B)]and [ansi(118,get(%#/D`COMBAT`HYPE`GAIN))] [ansi(118,Hype)]!;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_END_TURN=%#,%i0};@dolist/inline get(%#/%q<atk>`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_DEFENSE_ENDTURN=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`ENDTURN`STATUS=%#;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_FINAL_ENDTURN=%#,%i0};&D`COMBAT`HYPE`USED %#=0;&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=0;@attach %!/INC`CPTREE=%#,D`COMBAT,%#,D`COMBACK

&INC`COMBAT`DEFEND`MAIN`ENDTURN`STATUS [u(cobj,age)]=@dolist/inline/nobreak u(setr,sall,get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE))={th u(addto,%0,D`COMBAT`STATUS`%i0`INCREMENT,1);@select/inline u(setr,srem,get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS))=X,{},>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%i0`DEFENSE_TURNS,sub(%q<srem>,1));@stop get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS);th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%i0));@stop cor(strmatch(get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS),X),gt(u(lmax,iter(ATTACK DEFENSE,get(%0/D`COMBAT`STATUS`%i1`%i0_TURNS))),0));@attach %!/KILLSTATUS=%0,%i0}};

&INC`COMBAT`DEFEND`MAIN`DEBUG [u(cobj,age)]=th u(setq,testers,u(filter,TESTER,lplayers(%l)));@pemit/list %q<testers>=center(Debug - %?,78,ansi(hm,=))%R[align(3 11 11 11 11 7 7 1 7,Rll,SrcStats,SrcBons,TrgStats,TrgBons,Acc,Dmg,B,HitChk)]%R[align(3 11 11 11 11 7 7 1 7,%q<roll>,iter(0 1 2 3,round(u(calcstat`atk,%#,%q<atk>,%i0),0))%R[iter(0 1 2 3,round(r(bastat%i0),0))],iter(0 1 2 3,get(%#/%q<atk>`STATS`%i0`MOD)),iter(0 1 2 3,u(calcstat,%#,%i0))%R[iter(0 1 2 3,round(r(bdstat%i0),0))],%q<trgbons>,%q<accuracymod>,%q<damagemod>,%q<tmode>,%q<hitmul>)]%R[center(StaticDam: [round(%q<preflux>,2)] - Flux: %q<flux> - XCON: %q<xconorig> + [add(%q<xcon>,0)],78,ansi(hm,-))]%R[center(OrigDamage: %q<origdamage> - DriveDam: [sub(%q<origdamage>,%q<dnormdamage>)] - Normalize: [sub(%q<dnormdamage>,%q<normdamage>)],78,ansi(hm,-))];@attach %!/WIPE=%#,%q<atk>;

&FIL`TESTER [u(cobj,age)]=cand(u(tester,%0),get(%0/D`MATRIX),hasflag(%0,CONNECTED))

&OVEREXERT [u(cobj,age)]=localize(mul(get(%0/D`COMBAT`DRIVE`EXHAUSTION_MULTIPLIER),get(u(cobj,agedb)/DRIVES`[get(%0/D`COMBAT`DRIVE`STATUS)]`DAMAGE)))

@@ PUSH CODE
&INC`COMBAT`PUSH`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready.;@stop gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Push entered to activate.;@check strlen(u(setr,push,u(FIND_MULTI,PUSH,%0)))=@attach %!/INC`MSG=ERROR: Push not found!;@stop gt(words(%q<push>),1)=@attach %!/INC`MSG=ERROR: That matches Pushes: [iter(%q<push>,get(u(cobj,agedb)/PUSH`%i0),%b,\,%b)]. Please be more specific.;@select/inline words(u(setr,hypecost,get(u(cobj,agedb)/PUSH`%q<push>`CHOICES)),|)=>1,{@check strlen(%1)=@attach %!/INC`MSG=ERROR: No cost chosen!;@attach %!/INC`PARTIAL=%1,%q<hypecost>,|,hypecost};@check gte(u(setr,starthype,get(%#/D`COMBAT`HYPE)),%q<hypecost>)=@attach %!/INC`MSG=ERROR: Not enough Hype!;@attach [u(cobj,agedb)]/PUSH`%q<push>`ACTIVATE=%#,%2;th u(addto,%#,D`COMBAT`HYPE,mul(-1,%q<hypecost>));th u(setq,afterhype,get(%#/D`COMBAT`HYPE));@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>%B))][ansi(hw,%n)] uses a [ansi(118,Push)]!;@pemit %#=[ansi(90,COMBAT:)] You used [ansi(118,Push)]: [get(u(cobj,agedb)/PUSH`%q<push>)];th u(setq,testers,u(filter,TESTER,lplayers(%l)));@pemit/list %q<testers>=[ansi(90,COMBAT:)] [ansi(177,MATRIX:)]%b%n used: [get(u(cobj,agedb)/PUSH`%q<push>)][if(%q<pushchoice>,%B\(%q<pushchoice>\))];@dolist/inline edit(lattr(%#/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`[before(%i0,$)]`PUSH_ON_ACTIVATE=%#,%i0,%q<push>,%q<statid>};th u(addto,%#,D`COMBAT`HYPE`USED,%q<hypecost>)


&INC`COMBAT`PUSH`LIST [u(cobj,age)]=@pemit %#=u(header,Available Pushes);@dolist/inline u(sortattr,u(lattr,u(cobj,agedb)/PUSH`*))={@pemit %#=u(separator,get(u(cobj,agedb)/%i0));@dolist/inline/delimit | [get(u(Cobj,agedb)/%i0`CHOICES)]={@pemit %#=[ansi(h,%i0 Hype:)]%B[get(u(cobj,agedb)/%i1`%i0)]}};@pemit %#=u(footer)

&INC`HEAL [u(cobj,age)]=&D`COMBAT`DAMAGE %0=bound(sub(get(%0/D`COMBAT`DAMAGE),u(setr,regain,%1)),0,get(%0/D`COMBAT`HEALTH));@select/inline not(%3)=1,{@attach %!/INC`ANNOUNCE=[name(%0)] gained %1 Health from: %2}

@@ QUEUE CODE
&INC`COMBAT`QUEUE`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Pilot/Mecha are set and use +reset.;@check nattr(%#/D`COMBAT`Q`**)=@attach %!/INC`MSG=ERROR: You have no incoming attacks to deal with!;@pemit %#=u(header,Combat Queue);@pemit %#=ansi(u(color,%#,COLOR,COLUMN_NAMES),align(17 18 1 10 15 12,Source,Name,L,Type,Mechanism,Effect));@pemit %#=u(separator);@dolist/inline sortkey(#lambda/get(%#/\%0`TIMESTAMP),lattr(%#/D`COMBAT`Q`*))={@pemit %#=align(17 18 1 10 15 12,u(moniker,last(%i0,`)),get(%#/%i0),switch(get(%#/%i0`LEVEL),>9,S,get(%#/%i0`LEVEL)),default(%!/TYPE`[get(%#/%i0`TYPE)],<unknown>),default(%!/MECHANISM`[get(%#/%i0`MECHANISM)],<unknown>)%b\([if(match(1 2 6,get(%#/%i0`MECHANISM)),Mel,Rng)]\),iter(get(%#/%i0`EFFECTS),default(%!/EFFECT`%i0,<unknown>)))};@pemit %#=u(footer)

@@ HEALTH CODE
&INC`COMBAT`HEALTh`MAIN [u(cobj,age)]=@attach %!/INC`CHECKPC=u(strfirstof,%0,%#),1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not readied for battle.;@pemit %#=u(header,%q<t1name> - Health);@select/inline strmatch(%q<t1>,%#)=1,{@attach %!/INC`COMBAT`STATS`DISPLAY};@pemit %#=u(subheader,Effects);@pemit %#=align(1. 36 1. 37 1.,ansi(u(color,%#,BORDER),|),center(ansi(g,Attack Effects),36)[u(trimlines,%R[u(FUN`LIST_STATUS,%q<t1>,ATTACK)])],ansi(u(color,%#,BORDER),|),center(ansi(g,Defense Effects),37)[u(trimlines,%R[u(FUN`LIST_STATUS,%q<t1>,DEFENSE)])],ansi(u(color,%#,BORDER),|));@pemit %#=u(footer)

&FUN`LIST_STATUS [u(Cobj,age)]=iter(sortkey(#lambda/get(%!/STATUS`\[before(\%0,$)\]),u(filter,DISPLAY,get(%0/D`COMBAT`ACTIVE`STATUS`%1),%b,%b,%0,%1),i),\([get(%0/D`COMBAT`STATUS`%i0`%1_TURNS)]\)%B[ansi(hw,\[[ucstr(get(%0/D`COMBAT`STATUS`%i0))]\])] - [u(%!/STATUS`[before(%i0,$)]`DESCRIPTION,%0,%i0)],%b,%r)

&FIL`DISPLAY [u(cobj,age)]=t(match(get(%!/STATUS`[before(%0,$)]`TAGS),DISPLAY))

@@ @pemit %#=ACTIVE BOOSTS: [itemize(iter(get(%#/D`COMBAT`ACTIVE_BOOSTS),default(%!/BOOST`[u(setr,id,before(%i0,~))],<unset>)%b\([add(u(getstat,%#,D`COMBAT`ACTIVE_BOOSTS`ATTACK,%q<id>),0)]/[add(u(getstat,%#,D`COMBAT`ACTIVE_BOOSTS`DEFENSE,%q<id>),0)]\),%b,|),|,and,\,)];@pemit %#=ACTIVE EFFECTS: [itemize(iter(get(%#/D`COMBAT`ACTIVE_EFFECTS),default(%!/EFFECT`[u(setr,id,before(%i0,~))],<unset>)%b\([add(u(getstat,%#,D`COMBAT`ACTIVE_EFFECTS`ATTACK,%q<id>),0)]/[add(u(getstat,%#,D`COMBAT`ACTIVE_EFFECTS`DEFENSE,%q<id>),0)]\),%b,|),|,and,\,)];@pemit %#=u(footer)



@@ +bbpost 6/CSYS: Character Editor=The commands [ansi(h,+select\, +view\, +create\, +delete\, +add\, +remove\, +set\, +mode)] are the core of the Combat System editor. It works on the following principle:%R%RWhen you [ansi(h,+select)] something, this becomes your focus point, or +mode. Selecting a PLAYER with [ansi(h,+select player=<playername>)] will initialize them for the combat system, create a DEFAULT PILOT if they don't have one already, and put you in Player/Pilot Mode. (If they already HAVE a pilot, you will then need to [ansi(h,+select pilot=<pilot name or id>)] to target that.)%R%RWhile in Player/Pilot mode, the [ansi(h,+create)] command can be used to [ansi(h,+create pilot=<new pilot name>)] or [ansi(h,+create mecha=<new mecha name>)], which will shift your focus.%R%RShifting to MECHA MODE allows for [ansi(h,+create attack=<attack name>)].%R%RSimilarly, in each mode the functions of the +add, +remove, and +set commands change. For PILOT and MECHA mode, +set will let you target things like name, agi, mel, and similar properties. For example, [ansi(h,+set agi=60)]. Changes are saved immediately, but will only be reflected on players using it when they +reset.%R%RIn PLAYER or MECHA mode, the +add and +remove commands can be used to add/remove ABILITIES or BOOSTS. In ATTACK mode, it can only be used for Effects. The full list of available traits is on the csys design document, I'm not gonna list it here. Example: [ansi(h,+add abil=Attacker)]%R%RA more comprehensive guide will be written in the future, but I expect this to be intuitive enough for you guys to experiment.%R%R[ansi(hr,FOR NOW)] I have created a character called [ansi(h,MP-Holder)]. While I haven't quite worked out all the commands for handling MP Mecha and Generic Pilots, please feel free to create various pilot and mech builds on this guy. When we're ready I can mass-assign whatever's on him as generic/mp stuff for everyone to test.

@@ +bbpost 6/CSYS: Combat Commands=[ansi(h,+reset)] to get ready for combat! This will clear EVERYTHING right now. Sorry, switching pilots and mechas mid-flight isn't currently supported, although it won't be hard to add that in either. I mean you can, but you're starting the fight fresh. Not fair.%R%R[ansi(h,+boost <name>)] to activate a boost. They're listed in +stats.%R%R[ansi(h,+free <name>=<level> <type> <mechanism>)] to set a Free attack. /rem and /clear haven't been implemented yet, but entering the same name will overwrite the old entry. Free attacks are bound to your mecha and switch accordingly.%R%R[ansi(h,+attack <player>=<attack name>)] - Attack someone. You can (untested) use [ansi(h,+attack <player1>\,<player2>,\,<player3>\,...=<attack name>)] for multi-targeting. In theory.%R%R[ansi(h,+defend <attacker>=<response>)]. Where response is AVOID, BLOCK, STEADY, VENT, ALLOW, or SURRENDER.%R%RKNOWN ISSUES:%RA: There's currently no health display anywhere. Or active buffs/debuffs.%RB: Or an incoming attack display.%RC: Boss modes haven't been implemented yet.
@@ +bbpost 6/CSYS: Approval Commands=[ansi(hc,Player Commands)]%R[ansi(h,+submit <thing>)] to submit a designed Mecha or Pilot for approval. Once submitted they cannot be modified except by admin.%R%R[ansi(hc,Admin Commands)]%R[ansi(h,+set approved=<0 or 1>)] - This is to be used when you've used the character editor and selected the relevant mecha/pilot. Setting it to 0 clears the pending review and returns it to unapproved. Setting to 1 marks it approved so players can use it.%R[ansi(h,+key/add Csys=<player>)] - adds a player to the Csys Tester list. (see below.) Use +key/rem csys=<name> to revoke tester abilities.%R%RTesters can use unapproved mechs/pilots and can toggle on/off debug displays.%R%R[ansi(hc,Tester Commands)]%R[ansi(h,+matrix)] - This command toggles on/off the debug display. Only usable by admin and Csys Testers.
