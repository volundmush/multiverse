th u(NEWCOBJ,Adaptive Game Engine Combat System <AGE>,age,,,,WIZARD SAFE !NO_COMMAND,INHERIT SIDEFX SAFE)
th u(NEWCOBJ,Adaptive Game Engine Database <AGEDB>,agedb,,age,1,WIZARD SAFE !NO_COMMAND,INHERIT SIDEFX SAFE)

&ISADMIN [u(cobj,age)]=cor(u(parent(%!)/isadmin,%0),u(tester,%0))

&SYSTEM`SWITCHES [u(cobj,age)]=setunion(u(%q<sysname>`%q<command>`PLAYER),if(cor(u(isadmin,%#),u(tester,%#)),u(%q<sysname>`%q<command>`ADMIN)),|,|)
&SYSTEM`NAME [u(cobj,age)]=u(strfirstof,%q<sysname>,COMBAT)
&SYSTEM`COLORS [u(cobj,age)]=COMBAT
&SYSTEM`OPTIONS [u(cobj,age)]=COMBAT

&FUN`VERSION [u(cobj,age)]=default(%#/D`CSYS`VERSION,1)

@lock/use [u(cobj,age)]=FUN`VERSION/1

&INC`EANNOUNCE [u(cobj,age)]=@attach %!/INC`MSG`ROOM=[ansi(m,COMBAT:)]%B[ansi(177,%0:)]%B%1,,,,,1
&INC`ANNOUNCE [u(Cobj,age)]=@attach %!/INC`MSG`ROOM=[ansi(m,COMBAT:)]%B%0,,,,,1
&INC`EPRIVATE [u(cobj,age)]=@attach %!/INC`MSG=[ansi(m,COMBAT:)]%B[ansi(117,%0:)]%B%1,%2,,,1
&INC`PRIVATE [u(cobj,age)]=@attach %!/INC`MSG=[ansi(m,COMBAT:)]%B%0,%1,,,1
&INC`DEBUG [u(cobj,age)]=@select/inline words(u(setr,testlist,u(filter,TESTER,lplayers(%l))))=>0,{@attach %!/INC`MSG`ROOM=[ansi(117,DEBUG:)][ansi(117,%0:)]%B%1,%q<testlist>,,,,1};


@@ -- Section for AGE Config.

&INC`VALID`ADJECTIVE [u(cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Adjective entered!;@select/inline isint(%0)=1,{@attach %!/INC`VALID`INT},0,{@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/ADJECTIVES)  ,|,value};th u(setq,valueformat,%q<value>);

&CMD`AGE [u(cobj,age)]=$^(?s)\+(ageconfig)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:@check cor(hasflag(%#,WIZARD),cor(u(isadmin,%#),u(tester,%#)))=@attach %!/INC`MSG=ERROR: Permission denied.;th u(setq,command,%1);th u(setq,sysname,AGE);@attach %!/INC`GETSWITCH=%2;@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`%q<sysname>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4,%5
@set [u(cobj,age)]/CMD`AGE=regexp

&AGE`AGECONFIG`PLAYER [u(cobj,age)]=
&AGE`AGECONFIG`ADMIN [u(cobj,age)]=ADJECTIVE|DRIVE|WEIGHT|STAT|ATTACK|ARCHETYPE|CONSEQUENCES|CONFIG|BOSS

&INC`AGE`CONFIG [u(cobj,age)]=@attach %!/INC`CONFIG=%0,%2

&CONFIG`OPTIONS [u(cobj,age)]=EXEMPT_DISTRICT|BOSS_EXTRA_HP

&CONFIG`EXEMPT_DISTRICT [u(cobj,age)]=The District dbref for rooms exempt from Consequences checks.
&CONFIG`EXEMPT_DISTRICT`DEFAULT [u(cobj,age)]=
&CONFIG`EXEMPT_DISTRICT`VALID [u(cobj,age)]=DBREF

&CONFIG`BOSS_EXTRA_HP [u(cobj,age)]=How much extra HP obtained. Formula is: BaseHP * (1 + (BOSS_EXTRA_HP * Opponents))
&CONFIG`BOSS_EXTRA_HP`DEFAULT [u(cobj,age)]=0.5
&CONFIG`BOSS_EXTRA_HP`VALID [u(cobj,age)]=NUMBER

&INC`AGE`MAIN [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`MAIN`DISPLAY},{@attach %!/INC`AGE`MAIN`SET}

&INC`AGE`MAIN`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Core Values);@dolist/inline/delimit | [get(u(cobj,agedb)/CORES)]={@pemit %#=%i0: [default(u(cobj,agedb)/CORE`%i0`CUSTOM,u(cobj,agedb)/CORE`%i0,??)]};@pemit %#=u(footer)

&INC`AGE`MAIN`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/CORES),|,Core;@attach %!/INC`VALID`NUMBER=%2;&CORE`%q<CORE>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set AGE %q<core> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set AGE Core '%q<core>' To: %q<value>

&CORES [u(cobj,agedb)]=BALANCE|NORMALIZE|BASEDAMAGE|FUDGESCATTER|SCATTER

&CORE`BALANCE [u(cobj,agedb)]=1.15
&CORE`NORMALIZE [u(cobj,agedb)]=1.3
&CORE`BASEDAMAGE [u(cobj,agedb)]=110
&CORE`FUDGESCATTER [u(cobj,agedb)]=5
&CORE`SCATTER [u(cobj,agedb)]=10

&INC`AGE`ADJECTIVE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ADJECTIVE`DISPLAY},{@attach %!/INC`AGE`ADJECTIVE`SET}

&INC`AGE`ADJECTIVE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Adjectives);@dolist/inline/delimit | [get(u(cobj,agedb)/ADJECTIVES)]={@pemit %#=%i0: [default(u(cobj,agedb)/ADJECTIVES`%i0`CUSTOM,u(cobj,agedb)/ADJECTIVES`%i0,??)]};@pemit %#=u(footer)

&INC`AGE`ADJECTIVE`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/ADJECTIVES),|,Adjective;@attach %!/INC`VALID`INT=%2;&ADJECTIVES`%q<adjective>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set %q<adjective> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Adjective '%q<adjective>' To: %q<value>

&ADJECTIVES [u(cobj,agedb)]=Minor|Moderate|Solid|Significant|Major|Superior|Massive|Extreme

&ADJECTIVES`MINOR [u(cobj,agedb)]=3
&ADJECTIVES`MODERATE [u(cobj,agedb)]=6
&ADJECTIVES`SOLID [u(cobj,agedb)]=9
&ADJECTIVES`SIGNIFICANT [u(cobj,agedb)]=12
&ADJECTIVES`MAJOR [u(cobj,agedb)]=15
&ADJECTIVES`SUPERIOR [u(cobj,agedb)]=20
&ADJECTIVES`MASSIVE [u(cobj,agedb)]=25
&ADJECTIVES`EXTREME [u(cobj,agedb)]=30

&ADJ [u(cobj,age)]=if(isnum(%0),%0,get(u(cobj,agedb)/ADJECTIVES`%0))

&ADJINC [u(cobj,age)]=localize([u(setq,total,add(%1,match(u(setr,adj,get(u(cobj,agedb)/ADJECTIVES)),%0,|)))][switch(%q<total>,<1,0,>8,Extreme,elements(%q<adj>,%q<total>,|))])

@@ &CUST [u(cobj,age)]=u(strfirstof,get(u(cobj,agedb)/%0`%1`CUSTOM),get(u(cobj,agedb)/%0`%1))

&CUST [u(cobj,age)]=default(%l/%0`%1`CUSTOM,u(cobj,agedb)/%0`%1`CUSTOM,get(u(cobj,agedb)/%0`%1))

@@ u(strfirstof,get(u(cobj,agedb)/%0`%1`CUSTOM),get(u(cobj,agedb)/%0`%1))

&PERCENTAGES`TINY [u(cobj,agedb)]=1
&PERCENTAGES`SMALL [u(cobj,agedb)]=2
&PERCENTAGES`STANDARD [u(cobj,agedb)]=3
&PERCENTAGES`CONSIDERABLE [u(cobj,agedb)]=4
&PERCENTAGES`SUBSTANTIAL [u(cobj,agedb)]=5
&PERCENTAGES`OVERWHELMING [u(cobj,agedb)]=6


@@ - Drive Config

&INC`AGE`DRIVE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`DRIVE`DISPLAY},{@attach %!/INC`AGE`DRIVE`SET}

&INC`AGE`DRIVE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - DRIVE Config);@pemit %#=ansi(u(color,%#,SYSTEm,COLUMN_NAMES),align(12 12 8 8 8,Name,MinDrive,Bonus,Penalty,Damage\%));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/DRIVES)]={@pemit %#=align(12 12 8 8 8,%i0,u(cust,DRIVES,%i0),u(cust,DRIVES,%i0`BONUS),u(cust,DRIVES,%i0`PENALTY),u(cust,DRIVES,%i0`DAMAGE))};@pemit %#=u(footer)

&INC`AGE`DRIVE`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,get(u(cobj,agedb)/DRIVES),|,DRIVE;@select/inline strlen(%1)=>1,{@attach %!/INC`PARTIAL=%1,BONUS|PENALTY|DAMAGE,|,Option;@attach %!/INC`AGE`DRIVE`SET`%q<option>},{@attach %!/INC`AGE`DRIVE`SET`MINDRIVE}

&INC`AGE`DRIVE`SET`MINDRIVE [u(cobj,age)]=@attach %!/INC`VALID`POSINT=%2;&DRIVES`%q<DRIVE>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE Tier %q<DRIVE> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE Tier '%q<DRIVE>' To: %q<value>

&INC`AGE`DRIVE`SET`BONUS [u(cobj,age)]=@attach %!/INC`VALID`ADJECTIVE=%2;&DRIVES`%q<DRIVE>`BONUS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Bonus to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Bonus To: %q<value>
&INC`AGE`DRIVE`SET`PENALTY [u(cobj,age)]=@attach %!/INC`VALID`ADJECTIVE=%2;&DRIVES`%q<DRIVE>`PENALTY`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Penalty to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Penalty To: %q<value>
&INC`AGE`DRIVE`SET`DAMAGE [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&DRIVES`%q<DRIVE>`DAMAGE`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set DRIVE %q<DRIVE> Damage to: %q<value>.;@attach %!/INC`MSG`CHAN=Set DRIVE '%q<DRIVE>' Damage To: %q<value>

&DRIVES [u(cobj,agedb)]=Primed|Ready|Lagging|Overextended|Wavering|Spent

&DRIVES`PRIMED [u(cobj,agedb)]=80
&DRIVES`PRIMED`ATTACK`BONUS`STAT`1 [u(cobj,agedb)]=Moderate
&DRIVES`PRIMED`ATTACK`BONUS`STAT`3 [u(cobj,agedb)]=Moderate
&DRIVES`PRIMED`DEFENSE`BONUS`STAT`1 [u(cobj,agedb)]=Moderate
&DRIVES`PRIMED`DEFENSE`BONUS`STAT`3 [u(cobj,agedb)]=Moderate
&DRIVES`PRIMED`CHECK [u(cobj,agedb)]=gt(get(%0/D`COMBAT`DRIVE),mul(get(%0/D`COMBAT`OPPONENTS),u(u(cobj,age)/cust,DRIVES,PRIMED)))

&DRIVES`READY [u(cobj,agedb)]=55
&DRIVES`READY`CHECK [u(cobj,agedb)]=gt(get(%0/D`COMBAT`DRIVE),mul(get(%0/D`COMBAT`OPPONENTS),u(u(cobj,age)/cust,DRIVES,READY)))

&DRIVES`LAGGING [u(cobj,agedb)]=20
&DRIVES`LAGGING`ATTACK`PENALTY`STAT`0 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`ATTACK`PENALTY`STAT`1 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`ATTACK`PENALTY`STAT`2 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`ATTACK`PENALTY`STAT`3 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Minor
&DRIVES`LAGGING`CHECK [u(cobj,agedb)]=gt(get(%0/D`COMBAT`DRIVE),mul(get(%0/D`COMBAT`OPPONENTS),u(u(cobj,age)/cust,DRIVES,LAGGING)))

&DRIVES`OVEREXTENDED [u(cobj,agedb)]=0
&DRIVES`OVEREXTENDED`ATTACK`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`ATTACK`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`ATTACK`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`ATTACK`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`OVEREXTENDED`CHECK [u(cobj,agedb)]=gt(get(%0/D`COMBAT`DRIVE),mul(get(%0/D`COMBAT`OPPONENTS),u(u(cobj,age)/cust,DRIVES,OVEREXTENDED)))

&DRIVES`WAVERING [u(cobj,agedb)]=-25
&DRIVES`WAVERING`ATTACK`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`ATTACK`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`ATTACK`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`ATTACK`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`WAVERING`DAMAGE [u(cobj,agedb)]=0.2
&DRIVES`WAVERING`CHECK [u(cobj,agedb)]=gt(get(%0/D`COMBAT`DRIVE),mul(get(%0/D`COMBAT`OPPONENTS),u(u(cobj,age)/cust,DRIVES,WAVERING)))

&DRIVES`SPENT [u(cobj,agedb)]=-1000
&DRIVES`SPENT`ATTACK`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`ATTACK`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`ATTACK`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`ATTACK`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`0 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`1 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`2 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DEFENSE`PENALTY`STAT`3 [u(cobj,agedb)]=Solid
&DRIVES`SPENT`DAMAGE [u(cobj,agedb)]=1000
&DRIVES`SPENT`CHECK [u(Cobj,agedb)]=1

&DRIVESTATUS [u(cobj,age)]=first(squish(iter(get(u(cobj,agedb)/DRIVES),if(u(u(cobj,agedb)/DRIVES`%i0`CHECK,%0),%i0[ibreak()]),|,|),|),|)

@@ Damage Age Config --

&DAMAGES [u(cobj,agedb)]=Perfect|Excellent|Good|Damaged|Critical|Disabled|Scrap

&DAMAGES`PERFECT [u(cobj,agedb)]=1
&DAMAGES`EXCELLENT [u(cobj,agedb)]=0.76
&DAMAGES`GOOD [u(cobj,agedb)]=0.501
&DAMAGES`DAMAGED [u(cobj,agedb)]=0.251
&DAMAGES`CRITICAL [u(cobj,agedb)]=0.01
&DAMAGES`DISABLED [u(cobj,agedb)]=-0.249
&DAMAGES`SCRAP [u(cobj,agedb)]=-99999

&HITPERCENT [u(cobj,age)]=mul(get(%0/D`COMBAT`HEALTH[if(%2,`ORIGINAL)]),%1)
&PERCENT [u(cobj,age)]=fdiv(sub(get(%0/D`COMBAT`HEALTH),get(%0/D`COMBAT`DAMAGE)),get(%0/D`COMBAT`HEALTH[if(%1,`ORIGINAL)]))
&DPERCENT [u(cobj,age)]=fdiv(get(%0/D`COMBAT`DRIVE),get(%0/D`COMBAT`DRIVE`MAXIMUM))
&HPERCENT [u(cobj,age)]=fdiv(get(%0/D`COMBAT`HYPE),get(%0/D`COMBAT`HYPE`MAXIMUM))

&DSTAGE [u(cobj,age)]=localize([u(setq,perc,u(percent,%0))][first(iter(get(u(cobj,agedb)/DAMAGES),if(gte(u(cust,DAMAGES,%i0),%q<perc>),%i0[ibreak()]),|,%b))])

&DSTAGENUM [u(cobj,age)]=match(get(u(cobj,agedb)/DAMAGES),u(dstage,%0),|)

@@ Weight Age Config--

&INC`AGE`WEIGHT [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`WEIGHT`DISPLAY},{@attach %!/INC`AGE`WEIGHT`SET}

&INC`AGE`WEIGHT`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Weight Config);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(12 12 8 8 8,Name,Threshold,Bonus,Penalty,Tunings));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/WEIGHTS)]={@pemit %#=align(12 12 8 8 8,%i0,u(cust,WEIGHTS,%i0),u(cust,WEIGHTS,%i0`BONUS),u(cust,WEIGHTS,%i0`PENALTY),u(cust,WEIGHTS,%i0`TUNINGS))};@pemit %#=u(footer,Global: [u(cust,WEIGHTS,GLOBAL)])

&INC`AGE`WEIGHT`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,[get(u(cobj,agedb)/WEIGHTS)],|,Weight;@attach %!/INC`PARTIAL=%1,BONUS,|,Option;@attach %!/INC`AGE`WEIGHT`SET`%q<option>

&INC`AGE`WEIGHT`SET`THRESHOLD [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&WEIGHTS`%q<Tech>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Tech %q<Tech> Threshold to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Tech '%q<Tech>' Threshold To: %q<value>
&INC`AGE`WEIGHT`SET`BONUS [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&WEIGHTS`%q<weight>`BONUS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Weight %q<weight> Bonus to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Weight '%q<weight>' Bonus To: %q<value>

&WEIGHTS [u(cobj,agedb)]=LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS

&WEIGHTS`LIGHT [u(cobj,agedb)]=Light
&WEIGHTS`LIGHT`BONUS [u(cobj,agedb)]=0

&WEIGHTS`MEDIUM [u(cobj,agedb)]=Medium
&WEIGHTS`MEDIUM`BONUS [u(cobj,agedb)]=6

&WEIGHTS`HEAVY [u(cobj,agedb)]=Heavy
&WEIGHTS`HEAVY`BONUS [u(cobj,agedb)]=12

&WEIGHTS`SUPERHEAVY [u(cobj,agedb)]=Superheavy
&WEIGHTS`SUPERHEAVY`BONUS [u(cobj,agedb)]=21

&WEIGHTS`BOSS [u(cobj,agedb)]=Boss
&WEIGHTS`BOSS`BONUS [u(cobj,agedb)]=24

&WEIGHT [u(cobj,age)]=localize([u(setq,glob,u(cust,TECHS,GLOBAL))][switch(%0,-1,X,first(squish(iter(get(u(cobj,agedb)/TECHS),if(gte(sub(%0,%q<glob>),u(cust,TECHS,%i0)),%i0[ibreak()]),|,%b))))])

&WEIGHT`UPGRADE [u(cobj,age)]=switch(%0,LIGHT,MEDIUM,MEDIUM,HEAVY,HEAVY,SUPERHEAVY,SUPERHEAVY,SUPERHEAVY,BOSS,BOSS)
&WEIGHT`DOWNGRADE [u(cobj,age)]=switch(%0,LIGHT,LIGHT,MEDIUM,LIGHT,HEAVY,MEDIUM,SUPERHEAVY,SUPERHEAVY,BOSS,BOSS)

@@ Stats ------

&ENTITY`0 [u(cobj,agedb)]=Mantle

&ENTITY`0`STAT`0 [u(cobj,agedb)]=Power
&ENTITY`0`STAT`0`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`0`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`0`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`0`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`0`SCALE [u(cobj,agedb)]=1.05
&ENTITY`0`STAT`0`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`0`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`0`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`0`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`0`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`0`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`1 [u(cobj,agedb)]=Endurance
&ENTITY`0`STAT`1`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`1`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`1`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`1`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`1`SCALE [u(cobj,agedb)]=1.05
&ENTITY`0`STAT`1`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`1`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`1`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`1`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`1`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`1`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`2 [u(cobj,agedb)]=Precision
&ENTITY`0`STAT`2`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`2`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`2`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`2`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`2`SCALE [u(cobj,agedb)]=1.05
&ENTITY`0`STAT`2`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`2`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`2`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`2`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`2`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`2`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`3 [u(cobj,agedb)]=Mitigation
&ENTITY`0`STAT`3`MINIMUM [u(cobj,agedb)]=1
&ENTITY`0`STAT`3`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`3`DEFAULT [u(cobj,agedb)]=2
&ENTITY`0`STAT`3`DIAL [u(cobj,agedb)]=55
&ENTITY`0`STAT`3`SCALE [u(cobj,agedb)]=1.05
&ENTITY`0`STAT`3`ACCWORTH [u(cobj,agedb)]=2

&ENTITY`0`STAT`3`MAPPING`1 [u(cobj,agedb)]=40
&ENTITY`0`STAT`3`MAPPING`2 [u(cobj,agedb)]=50
&ENTITY`0`STAT`3`MAPPING`3 [u(cobj,agedb)]=60
&ENTITY`0`STAT`3`MAPPING`4 [u(cobj,agedb)]=70
&ENTITY`0`STAT`3`MAPPING`5 [u(cobj,agedb)]=80

&ENTITY`0`STAT`4 [u(cobj,agedb)]=Weight
&ENTITY`0`STAT`4`MINIMUM [u(cobj,agedb)]=0
&ENTITY`0`STAT`4`MAXIMUM [u(cobj,agedb)]=5
&ENTITY`0`STAT`4`DEFAULT [u(cobj,agedb)]=2

&STATS [u(cobj,age)]=iter(u(sortattr,lattr(u(cobj,agedb)/ENTITY`%0`STAT`*)),get(u(cobj,agedb)/%i0),%b,|)

&CUSTSTAT [u(cobj,age)]=u(strfirstof,get(u(cobj,agedb)/ENTITY`%0`STAT`%1`CUSTOM),get(u(cobj,agedb)/ENTITY`%0`STAT`%1))

&INC`AGE`STAT [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`STAT`DISPLAY},{@attach %!/INC`AGE`STAT`SET}

&INC`AGE`STAT`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - STAT Config);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(12 8 8 8 8 8 8 8,Name,Minimum,Maximum,Default,Dial,Scale,AccWorth,Mapping));@pemit %#=u(separator);@dolist/inline 0 1 2 3={@pemit %#=align(12 8 8 8 8 8 8 8,get(u(cobj,agedb)/ENTITY`0`STAT`%i0),u(custstat,0,%i0`MINIMUM),u(custstat,0,%i0`MAXIMUM),u(custstat,0,%i0`DEFAULT),u(custstat,0,%i0`DIAL),u(custstat,0,%i0`SCALE),u(custstat,0,%i0`ACCWORTH),iter(u(sortattr,u(lattr,u(cobj,agedb)/ENTITY`0`STAT`%i0`MAPPING`*)),last(%i0,`): [get(u(cobj,agedb)/%i0)],%b,%R))};@pemit %#=u(footer)

&INC`AGE`STAT`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,u(u(cobj,age)/STATS),|,STAT;th u(setq,statnum,sub(match(u(u(cobj,age)/STATS),%q<stat>,|),1));@check strlen(%1)=@attach %!/INC`MSG=ERROR: Must enter an option!;@attach %!/INC`PARTIAL=before(%1,/),MINIMUM|MAXIMUM|DEFAULT|MAPPING|ACCWORTH|DIAL|SCALE,|,Option;@attach %!/INC`AGE`STAT`SET`%q<option>

&STATS [u(cobj,age)]=POWER|ENDURANCE|PRECISION|MITIGATION

&INC`AGE`STAT`SET`MINIMUM [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MINIMUM`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Minimum to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Minimum To: %q<value>
&INC`AGE`STAT`SET`MAXIMUM [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MAXIMUM`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Maximum to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Maximum To: %q<value>
&INC`AGE`STAT`SET`DIAL [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`DIAL`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Dial to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Dial To: %q<value>
&INC`AGE`STAT`SET`DEFAULT [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`DEFAULT`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Default to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Default To: %q<value>
&INC`AGE`STAT`SET`SCALE [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&ENTITY`0`STAT`%q<statnum>`SCALE`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Scale to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Scale To: %q<value>

&INC`AGE`STAT`SET`MAPPING [u(cobj,age)]=@check strlen(after(%1,/))=@attach %!/INC`MSG=ERROR: Must enter a Mapping #! 1-5!;@attach %!?INC`PARTIAL=after(%1,/),1|2|3|4|5,|,map;@attach %!/INC`VALID`INT=%2;&ENTITY`0`STAT`%q<statnum>`MAPPING`%q<map>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set STAT %q<STAT> Mapping %q<map> to: %q<value>.;@attach %!/INC`MSG`CHAN=Set STAT '%q<STAT>' Mapping %q<map> To: %q<value>


@@ Attacks Config
&INC`AGE`ATTACK [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ATTACK`DISPLAY},{@attach %!/INC`AGE`ATTACK`SET}

&INC`AGE`ATTACK`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - ATTACK Config);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(12 12 12 8,Name,Multiplier,Percentage,Cost));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/ATTACKS)]={@pemit %#=align(12 12 12 8,%i0,u(cust,ATTACKS,%i0),u(cust,ATTACKS,%i0`PERCENTAGE),u(cust,ATTACKS,%i0`COST))};@pemit %#=u(footer)

&INC`AGE`ATTACK`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,[get(u(cobj,agedb)/ATTACKS)],|,ATTACK;@check strlen;@attach %!/INC`PARTIAL=%1,COST|MULTIPLIER|PERCENTAGE,|,Option;@attach %!/INC`AGE`ATTACK`SET`%q<option>

&INC`AGE`ATTACK`SET`COST [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&ATTACKS`%q<attack>`COST`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Cost to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' cost To: %q<value>
&INC`AGE`ATTACK`SET`MULTIPLIER [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&ATTACKS`%q<attack>`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Multiplier to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' Multiplier To: %q<value>
&INC`AGE`ATTACK`SET`PERCENTAGE [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&ATTACKS`%q<attack>`PERCENTAGE`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Attack %q<attack> Percentage to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Attack '%q<attack>' Percentage To: %q<value>

&ATTACKS [u(cobj,agedb)]=1|2|3|4|5

&ATTACKS`1 [u(cobj,agedb)]=0.9
&ATTACKS`1`COST [u(cobj,agedb)]=-5
&ATTACKS`1`PERCENTAGE [u(cobj,agedb)]=0.065
&ATTACKS`1`DESCRIPTION [u(cobj,agedb)]=Light

&ATTACKS`2 [u(cobj,agedb)]=2.0
&ATTACKS`2`COST [u(cobj,agedb)]=10
&ATTACKS`2`PERCENTAGE [u(cobj,agedb)]=0.162
&ATTACKS`2`DESCRIPTION [u(cobj,agedb)]=Standard

&ATTACKS`3 [u(cobj,agedb)]=3.0
&ATTACKS`3`COST [u(cobj,agedb)]=25
&ATTACKS`3`PERCENTAGE [u(cobj,agedb)]=0.225
&ATTACKS`3`DESCRIPTION [u(cobj,agedb)]=Heavy

&ATTACKS`4 [u(cobj,agedb)]=4.0
&ATTACKS`4`COST [u(cobj,agedb)]=45
&ATTACKS`4`PERCENTAGE [u(cobj,agedb)]=0.294
&ATTACKS`4`DESCRIPTION [u(cobj,agedb)]=Massive

&ATTACKS`5 [u(cobj,agedb)]=5.0
&ATTACKS`5`COST [u(cobj,agedb)]=65
&ATTACKS`5`PERCENTAGE [u(cobj,agedb)]=0.355
&ATTACKS`5`DESCRIPTION [u(cobj,agedb)]=Finishing

@@ INTENSITY data


Tiny
Small
Standard
Considerable
Substantial
Overwhelming

&INTENSITY`TINY [u(cobj,agedb)]=1
&INTENSITY`SMALL [u(cobj,agedb)]=2
&INTENSITY`STANDARD [u(Cobj,agedb)]=3
&INTENSITY`CONSIDERABLE [u(cobj,agedb)]=4
&INTENSITY`SUBSTANTIAL [u(cobj,agedb)]=5
&INTENSITY`OVERWHELMING [u(Cobj,agedb)]=6
&INTENSITY`OVERRIDE [u(cobj,agedb)]=999999

@@ Boss data

&INC`AGE`BOSS [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`BOSS`DISPLAY},{@attach %!/INC`AGE`BOSS`SET}

&INC`AGE`BOSS`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - BOSS Config);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(2 12 10 10 9 9 9 9,#,Bonus_HP,DMG_MUL,DEF_MUL,Casual,Normal,Serious,Boss));@pemit %#=u(separator);@dolist/inline/delimit | [get(u(cobj,agedb)/BOSSES)]={@pemit %#=align(>2 12 10 10 9 9 9 9,%i0,u(cust,BOSS,%i0`BONUS_HP),u(cust,BOSS,%i0`DMG_MUL),u(cust,BOSS,%i0`DEF_MUL),u(cust,BOSS,%i0`CASUAL),u(cust,BOSS,%i0`NORMAL),u(cust,BOSS,%i0`SERIOUS),u(cust,BOSS,%i0`BOSS))};@pemit %#=u(footer)

&INC`AGE`BOSS`SET [u(cobj,age)]=@attach %!/INC`PARTIAL=%0,[get(u(cobj,agedb)/BOSSES)],|,BOSS;@attach %!/INC`PARTIAL=%1,BONUS_HP|DMG_MUL|DEF_MUL|SERIOUS|NORMAL|CASUAL|BOSS,|,Option;@attach %!/INC`AGE`BOSS`SET`%q<option>

&INC`AGE`BOSS`SET`BONUS_HP [u(cobj,age)]=@attach %!/INC`VALID`INT=%2;&BOSS`%q<boss>`BONUS_HP`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> Bonus_HP to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' Bonus_HP To: %q<value>
&INC`AGE`BOSS`SET`DMG_MUL [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`DMG_MUL`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> DMG_MUL to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' DMG_MUL To: %q<value>
&INC`AGE`BOSS`SET`DEF_MUL [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`DEF_MUL`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> DEF_MUL to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' DEF_MUL To: %q<value>
&INC`AGE`BOSS`SET`CASUAL [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`CASUAL`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> CASUAL to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' CASUAL To: %q<value>
&INC`AGE`BOSS`SET`NORMAL [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`NORMAL`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> NORMAL to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' NORMAL To: %q<value>
&INC`AGE`BOSS`SET`SERIOUS [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`SERIOUS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> SERIOUS to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' SERIOUS To: %q<value>
&INC`AGE`BOSS`SET`BOSS [u(cobj,age)]=@attach %!/INC`VALID`NUMBER=%2;&BOSS`%q<boss>`BOSS`CUSTOM [u(cobj,agedb)]=%q<value>;@attach %!/INC`MSG=Set Bonus %q<boss> BOSS to: %q<value>.;@attach %!/INC`MSG`CHAN=Set Boss '%q<boss>' BOSS To: %q<value>

&BOSSES [u(cobj,agedb)]=2|3|4|5|6|7|8|9|10


&BOSS`2`DMG_MUL [u(cobj,agedb)]=1.12
&BOSS`2`DEF_MUL [u(cobj,agedb)]=0.84
&BOSS`2`SERIOUS [u(cobj,agedb)]=0.975
&BOSS`2`NORMAL [u(cobj,agedb)]=0.95
&BOSS`2`CASUAL [u(cobj,agedb)]=0.925

&BOSS`3`DMG_MUL [u(cobj,agedb)]=1.20
&BOSS`3`DEF_MUL [u(cobj,agedb)]=0.80
&BOSS`3`SERIOUS [u(cobj,agedb)]=0.966
&BOSS`3`NORMAL [u(cobj,agedb)]=0.938
&BOSS`3`CASUAL [u(cobj,agedb)]=0.906

&BOSS`4`DMG_MUL [u(cobj,agedb)]=1.23
&BOSS`4`DEF_MUL [u(cobj,agedb)]=0.768
&BOSS`4`SERIOUS [u(cobj,agedb)]=0.956
&BOSS`4`NORMAL [u(cobj,agedb)]=0.925
&BOSS`4`CASUAL [u(cobj,agedb)]=0.887

&BOSS`5`DMG_MUL [u(cobj,agedb)]=1.25
&BOSS`5`DEF_MUL [u(cobj,agedb)]=0.75
&BOSS`5`SERIOUS [u(cobj,agedb)]=0.947
&BOSS`5`NORMAL [u(cobj,agedb)]=0.913
&BOSS`5`CASUAL [u(cobj,agedb)]=0.867

&BOSS`6`DMG_MUL [u(cobj,agedb)]=1.27
&BOSS`6`DEF_MUL [u(cobj,agedb)]=0.7408
&BOSS`6`SERIOUS [u(cobj,agedb)]=0.938
&BOSS`6`NORMAL [u(cobj,agedb)]=0.9
&BOSS`6`CASUAL [u(cobj,agedb)]=0.85

&BOSS`7`DMG_MUL [u(cobj,agedb)]=1.29
&BOSS`7`DEF_MUL [u(cobj,agedb)]=0.7371
&BOSS`7`SERIOUS [u(cobj,agedb)]=0.928
&BOSS`7`NORMAL [u(cobj,agedb)]=0.888
&BOSS`7`CASUAL [u(cobj,agedb)]=0.831

&BOSS`8`DMG_MUL [u(cobj,agedb)]=1.30
&BOSS`8`DEF_MUL [u(cobj,agedb)]=0.7313
&BOSS`8`SERIOUS [u(cobj,agedb)]=0.919
&BOSS`8`NORMAL [u(cobj,agedb)]=0.875
&BOSS`8`CASUAL [u(cobj,agedb)]=0.813

&BOSS`9`DMG_MUL [u(cobj,agedb)]=1.31
&BOSS`9`DEF_MUL [u(cobj,agedb)]=0.7278
&BOSS`9`SERIOUS [u(cobj,agedb)]=0.909
&BOSS`9`NORMAL [u(cobj,agedb)]=0.863
&BOSS`9`CASUAL [u(cobj,agedb)]=0.794

&BOSS`10`DMG_MUL [u(cobj,agedb)]=1.32
&BOSS`10`DEF_MUL [u(cobj,agedb)]=0.7260
&BOSS`10`SERIOUS [u(cobj,agedb)]=0.9
&BOSS`10`NORMAL [u(cobj,agedb)]=0.85
&BOSS`10`CASUAL [u(cobj,agedb)]=0.775




@@ Offense and Defense
&OFF`1 [u(cobj,agedb)]=Consistent
&OFF`1`STATUS [u(Cobj,agedb)]=OFF_CONSISTENT
&OFF`1`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`1`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`1`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,precision strike,<=4,lethal strike,5,mortal strike)

&OFF`2 [u(cobj,agedb)]=Forceful
&OFF`2`STATUS [u(Cobj,agedb)]=OFF_FORCEFUL
&OFF`2`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`2`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`2`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,heavy blow,<=4,mighty blow,5,savage blow)

&OFF`3 [u(cobj,agedb)]=Efficient
&OFF`3`STATUS [u(Cobj,agedb)]=OFF_EFFICIENT
&OFF`3`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`3`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`3`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,effective attack,<=4,expert attack,5,perfect attack)

&OFF`4 [u(cobj,agedb)]=Dramatic
&OFF`4`STATUS [u(Cobj,agedb)]=OFF_DRAMATIC
&OFF`4`ATTACK_TURNS [u(cobj,agedb)]=1
&OFF`4`DEFENSE_TURNS [u(Cobj,agedb)]=0
&OFF`4`DESCRIPTION [u(cobj,agedb)]=switch(%0,<=2,dynamic offensive,<=4,decisive offensive,5,absolute offensive)


&DEF`1 [u(cobj,agedb)]=Focus
&DEF`1`STATUS [u(Cobj,agedb)]=DEF_FOCUS
&DEF`1`ATTACK_TURNS [u(cobj,agedb)]=1
&DEF`1`DEFENSE_TURNS [u(Cobj,agedb)]=0
&DEF`1`ACTION [u(cobj,agedb)]=Focuses
&DEF`1`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 isn't even distracted by %2's %3!,<=4,%1 is able to ignore %2's %3!,5,%1 maintains laser focus in the face of %2's %3! It's the perfect opportunity!)
&DEF`1`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 takes %2's %3 in stride!,<=4,%1 stays ready through %2's %3!,5,%1 somehow keeps their position after %2's %3!)
&DEF`1`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 puts mind over matter when hit with %2's %3!,<=4,%1 hangs on to their preparation through %2's %3!,5,%1 struggles to stay focused at all after %2's %3!)
&DEF`1`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 suffers serious damage from %2's %3 for their effort!,<=4,%1 doesn't even try to stop %2's %3\, and pays for it!,5,%1 suffers the full fury of %2's %3! let's hope it was worth it!)

&DEF`2 [u(cobj,agedb)]=Bolster
&DEF`2`STATUS [u(Cobj,agedb)]=DEF_BOLSTER
&DEF`2`ATTACK_TURNS [u(cobj,agedb)]=1
&DEF`2`DEFENSE_TURNS [u(Cobj,agedb)]=0
&DEF`2`ACTION [u(cobj,agedb)]=Bolsters
&DEF`2`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 is untouched by %2's %3!,<=4,%1 is unscathed by %2's %3!,5,%1 has the perfect chance to one-up %2's %3! Let's see the damage!)
&DEF`2`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 wrestles with %2's %3!,<=4,%1 is able to wait out %2's %3!,5,%1 scrapes through %2's %3!)
&DEF`2`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 eats %2's %3 in the exchange!,<=4,%1 powers through %2's %3!,5,%1 takes a lot of damage trading with %2's %3!)
&DEF`2`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 receives %2's %3 badly!,<=4,%1 takes %2's %3 straight to the face!,5,%1 grossly underestimates %2's %3\, and suffers the consequences! That had to hurt!)

&DEF`3 [u(cobj,agedb)]=Guard
&DEF`3`STATUS [u(Cobj,agedb)]=DEF_GUARD
&DEF`3`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`3`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`3`ACTION [u(cobj,agedb)]=Guards
&DEF`3`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 stopped %2's %3 cold!,<=4,%1 completely blocked %2's %3!,5,%1 is somehow completely unphased by %2's %3! Impressive!)
&DEF`3`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 rolls with %2's %3!,<=4,%1 held back %2's %3!,5,%1 barely resisted %2's %3!)
&DEF`3`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 holds out against %2's %3!,<=4,%1 struggles against %2's %3!,5,%1 somehow endures %2's %3!)
&DEF`3`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1's guard is pierced by %2's %3!,<=4,%1 couldn't hold out against %2's %3!,5,%1 is completely overpowered by %2's %3! It's just too strong!)

&DEF`4 [u(cobj,agedb)]=Maneuver
&DEF`4`STATUS [u(Cobj,agedb)]=DEF_MANEUVER
&DEF`4`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`4`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`4`ACTION [u(cobj,agedb)]=Maneuvers
&DEF`4`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 easily avoids being struck by %2's %3!,<=4,%1 eludes %2's otherwise %3!,5,%1 negates %2's %3 completely! Good thinking!)
&DEF`4`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 avoids %2's %3 at the last minute!,<=4,%1 manages to fend off %2's %3!,5,%1 barely escapes destruction by %2's %3!)
&DEF`4`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 partly dulls %2's %3!,<=4,%1 only blunts %2's %3!,5,%1 can only do so much against %2's %3!)
&DEF`4`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1 is caught flat-footed by %2's %3!,<=4,%1 takes the full brunt of %2's %3!,5,%1 is helpless before %2's %3! No escaping this one!)

&DEF`5 [u(cobj,agedb)]=Rally
&DEF`5`STATUS [u(Cobj,agedb)]=DEF_RALLY
&DEF`5`ATTACK_TURNS [u(cobj,agedb)]=0
&DEF`5`DEFENSE_TURNS [u(Cobj,agedb)]=1
&DEF`5`ACTION [u(cobj,agedb)]=Rallies
&DEF`5`MISS [u(cobj,agedb)]=switch(%0,<=2,%1 is totally undaunted by %2's %3!,<=4,%1 isn't threatened by %2's %3!,5,%1 laughs in the face of death at %2's %3! Confidence surges!)
&DEF`5`CLOSE [u(cobj,agedb)]=switch(%0,<=2,%1 shrugs off %2's %3!,<=4,%1 comes out on top from %2's %3!,5,%1 dramatically emerges from the aftermath of %2's %3!)
&DEF`5`SOLID [u(cobj,agedb)]=switch(%0,<=2,%1 determinedly pushes through %2's %3!,<=4,%1 suffers the brunt of %2's %3 to catch a breath!,5,%1 holds on and staggers through %2's %3!)
&DEF`5`CRITICAL [u(cobj,agedb)]=switch(%0,<=2,%1's defiance only makes %2's %3 worse!,<=4,%1 pays dearly for standing in the way of %2's %3!,5,%1 is utterly crushed by %2's %3! It'll be hard to come back from that one!)

@@ Traits 

&TRAIT`0 [u(cobj,agedb)]=Stat
&TRAIT`0`PREFIX [u(cobj,agedb)]=STA
&TRAIT`1 [u(cobj,agedb)]=Archetype
&TRAIT`1`PREFIX [u(cobj,agedb)]=ARC
&TRAIT`2 [u(cobj,agedb)]=Quirk
&TRAIT`2`PREFIX [u(cobj,agedb)]=QRK
&TRAIT`3 [u(cobj,agedb)]=Accolade
&TRAIT`3`PREFIX [u(cobj,agedb)]=ACC
&TRAIT`4 [u(Cobj,agedb)]=Signature
&TRAIT`4`PREFIX [u(cobj,agedb)]=SIG
&TRAIT`5 [u(cobj,agedb)]=Meister
&TRAIT`5`PREFIX [u(cobj,agedb)]=MEI

@@ Archetypes
&INC`AGE`ARCHETYPE [u(cobj,age)]=@select/inline strlen(%0)=0,{@attach %!/INC`AGE`ARCHETYPE`DISPLAY},{@attach %!/INC`AGE`ARCHETYPE`SET}

&INC`AGE`ARCHETYPE`DISPLAY [u(cobj,age)]=@pemit %#=u(header,AGE - Archetype Config);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(4 40,ID,Name));@pemit %#=u(separator);@dolist/inline u(sortattr,u(lattr,u(cobj,agedb)/ARC`*))={@pemit %#=align(4 40,last(%i0,`),default(u(cobj,agedb)/%i0,<Unset>))};@pemit %#=u(footer)

&INC`AGE`ARCHETYPE`SET [u(cobj,age)]=@stop 1=@attach %!/INC`MSG=ERROR: SEt is not supported!;@attach %!/INC`PARTIAL=%0,u(u(cobj,age)/ARCHETYPES),|,ARCHETYPE;th u(setq,ARCHETYPEnum,sub(match(u(u(cobj,age)/ARCHETYPES),%q<ARCHETYPE>,|),1));


@@ Generalists
&ARC`0 [u(cobj,agedb)]=Unshaped

&ARC`1 [u(cobj,agedb)]=All-Star
&ARC`1`STATUS [u(cobj,agedb)]=ARC_ALLSTAR

&ARC`2 [u(cobj,agedb)]=Marksman
&ARC`2`STATUS [u(cobj,agedb)]=ARC_MARKSMAN

&ARC`3 [u(cobj,agedb)]=Bruiser
&ARC`3`STATUS [u(cobj,agedb)]=ARC_BRUISER

&ARC`4 [u(cobj,agedb)]=Tough Guy
&ARC`4`STATUS [u(cobj,agedb)]=ARC_TOUGHGUY

&ARC`5 [u(cobj,agedb)]=Vigilant
&ARC`5`STATUS [u(cobj,agedb)]=ARC_VIGILANT

&ARC`6 [u(cobj,agedb)]=Hero
&ARC`6`STATUS [u(cobj,agedb)]=ARC_HERO

&ARC`7 [u(cobj,agedb)]=Duelist
&ARC`7`STATUS [u(cobj,agedb)]=ARC_DUELIST

&ARC`8 [u(cobj,agedb)]=Slugger
&ARC`8`STATUS [u(cobj,agedb)]=ARC_SLUGGER

&ARC`9 [u(cobj,agedb)]=Striker
&ARC`9`STATUS [u(cobj,agedb)]=ARC_STRIKER

&ARC`10 [u(cobj,agedb)]=Defender
&ARC`10`STATUS [u(cobj,agedb)]=ARC_DEFENDER

&ARC`11 [u(cobj,agedb)]=Freestylist
&ARC`11`STATUS [u(cobj,agedb)]=ARC_FREESTYLIST

&ARC`12 [u(cobj,agedb)]=Challenger
&ARC`12`STATUS [u(cobj,agedb)]=ARC_CHALLENGER


@@ Specialists

&ARC`100 [u(cobj,agedb)]=Ace
&ARC`100`STATUS [u(cobj,agedb)]=ARC_ACE

&ARC`101 [u(cobj,agedb)]=Arsenal
&ARC`101`STATUS [u(Cobj,agedb)]=ARC_ARSENAL

&ARC`102 [u(cobj,agedb)]=Aspirant
&ARC`102`STATUS [u(cobj,agedb)]=ARC_ASPIRANT

&ARC`103 [u(cobj,agedb)]=Assassin
&ARC`103`STATUS [u(cobj,agedb)]=ARC_ASSASSIN

&ARC`104 [u(cobj,agedb)]=Berserker
&ARC`104`STATUS [u(Cobj,agedb)]=ARC_BERSERKER

&ARC`105 [u(cobj,agedb)]=Big Four
&ARC`105`STATUS [u(cobj,agedb)]=ARC_BIGFOUR

&ARC`106 [u(cobj,agedb)]=Blaster
&ARC`106`STATUS [u(Cobj,agedb)]=ARC_BLASTER

&ARC`107 [u(cobj,agedb)]=Demoralizer
&ARC`107`STATUS [u(Cobj,agedb)]=ARC_DEMORALIZER

&ARC`108 [u(cobj,agedb)]=Destroyer
&ARC`108`STATUS [u(Cobj,agedb)]=ARC_DESTROYER

&ARC`109 [u(cobj,agedb)]=Fencer
&ARC`109`STATUS [u(Cobj,agedb)]=ARC_FENCER

&ARC`110 [u(cobj,agedb)]=Fury
&ARC`110`STATUS [u(Cobj,agedb)]=ARC_FURY

&ARC`111 [u(cobj,agedb)]=Gambler
&ARC`111`STATUS [u(Cobj,agedb)]=ARC_GAMBLER

&ARC`112 [u(cobj,agedb)]=Grappler
&ARC`112`STATUS [u(Cobj,agedb)]=ARC_GRAPPLER

&ARC`113 [u(cobj,agedb)]=Ghost
&ARC`113`STATUS [u(Cobj,agedb)]=ARC_GHOST

&ARC`114 [u(cobj,agedb)]=Glass Cannon
&ARC`114`STATUS [u(Cobj,agedb)]=ARC_GLASSCANNON

&ARC`115 [u(cobj,agedb)]=Hot Blooded
&ARC`115`STATUS [u(Cobj,agedb)]=ARC_HOTBLOODED

&ARC`116 [u(cobj,agedb)]=Immortal
&ARC`116`STATUS [u(Cobj,agedb)]=ARC_IMMORTAL

&ARC`117 [u(cobj,agedb)]=Juggernaut
&ARC`117`STATUS [u(Cobj,agedb)]=ARC_JUGGERNAUT

&ARC`118 [u(cobj,agedb)]=Operator
&ARC`118`STATUS [u(Cobj,agedb)]=ARC_OPERATOR

&ARC`119 [u(cobj,agedb)]=Predator
&ARC`119`STATUS [u(Cobj,agedb)]=ARC_PREDATOR

&ARC`120 [u(cobj,agedb)]=Showoff
&ARC`120`STATUS [u(Cobj,agedb)]=ARC_SHOWOFF

&ARC`121 [u(cobj,agedb)]=Sniper
&ARC`121`STATUS [u(Cobj,agedb)]=ARC_SNIPER

&ARC`122 [u(cobj,agedb)]=Survivor
&ARC`122`STATUS [u(Cobj,agedb)]=ARC_SURVIVOR

&ARC`123 [u(cobj,agedb)]=Uncontrollable
&ARC`123`STATUS [u(Cobj,agedb)]=ARC_UNCONTROLLABLE

&ARC`124 [u(cobj,agedb)]=Meister
&ARC`124`STATUS [u(cobj,agedb)]=ARC_MEISTER

@@ Synergists

&ARC`200 [u(Cobj,agedb)]=Aegis
&ARC`200`STATUS [u(cobj,agedb)]=ARC_AEGIS

&ARC`201 [u(Cobj,agedb)]=Conspirator
&ARC`201`STATUS [u(cobj,agedb)]=ARC_CONSPIRATOR

&ARC`202 [u(Cobj,agedb)]=Engineer
&ARC`202`STATUS [u(cobj,agedb)]=ARC_ENGINEER

&ARC`203 [u(Cobj,agedb)]=Icon
&ARC`203`STATUS [u(cobj,agedb)]=ARC_ICON

&ARC`204 [u(Cobj,agedb)]=Martyr
&ARC`204`STATUS [u(cobj,agedb)]=ARC_MARTYR

&ARC`205 [u(Cobj,agedb)]=Mastermind
&ARC`205`STATUS [u(cobj,agedb)]=ARC_MASTERMIND

&ARC`206 [u(Cobj,agedb)]=Panacea
&ARC`206`STATUS [u(cobj,agedb)]=ARC_PANACEA

&ARC`207 [u(Cobj,agedb)]=Overlord
&ARC`207`STATUS [u(cobj,agedb)]=ARC_OVERLORD

&ARC`208 [u(Cobj,agedb)]=Royal
&ARC`208`STATUS [u(cobj,agedb)]=ARC_ROYAL

&ARC`209 [u(Cobj,agedb)]=Saint
&ARC`209`STATUS [u(cobj,agedb)]=ARC_SAINT

&ARC`210 [u(Cobj,agedb)]=Spotter
&ARC`210`STATUS [u(cobj,agedb)]=ARC_SPOTTER

&ARC`211 [u(Cobj,agedb)]=Tactician
&ARC`211`STATUS [u(cobj,agedb)]=ARC_TACTICIAN

&ARC`212 [u(Cobj,agedb)]=Witch
&ARC`212`STATUS [u(cobj,agedb)]=ARC_WITCH





@@ Quirks

&QRK`1 [u(cobj,agedb)]=Aim Assist
&QRK`1`STATUS [u(cobj,agedb)]=QRK_AIMASSIST

&QRK`2 [u(cobj,agedb)]=Calibrated Weaponry
&QRK`2`STATUS [u(cobj,agedb)]=QRK_CALIBRATEDWEAPONRY

&QRK`3 [u(cobj,agedb)]=Certain Kill
&QRK`3`STATUS [u(cobj,agedb)]=QRK_CERTAINKILL

&QRK`4 [u(cobj,agedb)]=Heavy Weaponry
&QRK`4`STATUS [u(Cobj,agedb)]=QRK_HEAVYWEAPONRY

&QRK`5 [u(cobj,agedb)]=Keen Eye
&QRK`5`STATUS [u(cobj,agedb)]=QRK_KEENEYE

&QRK`6 [u(Cobj,agedb)]=Killer Instinct
&QRK`6`STATUS [u(Cobj,agedb)]=QRK_KILLERINSTINCT

&QRK`7 [u(cobj,agedb)]=Last Word
&QRK`7`STATUS [u(cobj,agedb)]=QRK_LASTWORD

&QRK`8 [u(cobj,agedb)]=Mighty
&QRK`8`STATUS [u(Cobj,agedb)]=QRK_MIGHTY

&QRK`9 [u(cobj,agedb)]=Experimental Weaponry
&QRK`9`STATUS [u(cobj,agedb)]=QRK_EXPERIMENTALWEAPONRY

&QRK`10 [u(cobj,agedb)]=Elegant Stance
&QRK`10`STATUS [u(Cobj,agedb)]=QRK_ELEGANTSTANCE

&QRK`11 [u(cobj,agedb)]=Hyper Mode
&QRK`11`STATUS [u(Cobj,agedb)]=QRK_HYPERMODE

&QRK`12 [u(cobj,agedb)]=Momentum
&QRK`12`STATUS [u(Cobj,agedb)]=QRK_MOMENTUM

&QRK`13 [u(cobj,agedb)]=Riposte
&QRK`13`STATUS [u(Cobj,agedb)]=QRK_RIPOSTE

&QRK`14 [u(cobj,agedb)]=Stimulants
&QRK`14`STATUS [u(Cobj,agedb)]=QRK_STIMULANTS

&QRK`15 [u(cobj,agedb)]=Unwieldy Strength
&QRK`15`STATUS [u(Cobj,agedb)]=QRK_UNWIELDYSTRENGTH

&QRK`16 [u(cobj,agedb)]=Versatile Attacks
&QRK`16`STATUS [u(Cobj,agedb)]=QRK_VERSATILEATTACKS

&QRK`17 [u(cobj,agedb)]=Predictive Targeting
&QRK`17`STATUS [u(cobj,agedb)]=QRK_PREDICTIVETARGETING

&QRK`18 [u(cobj,agedb)]=Exsanguination
&QRK`18`STATUS [u(cobj,agedb)]=QRK_EXSANGUINATION

&QRK`19 [u(cobj,agedb)]=Toxicity
&QRK`19`STATUS [u(cobj,agedb)]=QRK_TOXICITY

&QRK`20 [u(cobj,agedb)]=Withering
&QRK`20`STATUS [u(cobj,agedb)]=QRK_WITHERING



@@ Defense Quirks
&QRK`100 [u(cobj,agedb)]=Cloaking
&QRK`100`STATUS [u(cobj,agedb)]=QRK_CLOAKING

&QRK`101 [u(cobj,agedb)]=Fortified Defenses
&QRK`101`STATUS [u(cobj,agedb)]=QRK_FORTIFIEDDEFENSES

&QRK`102 [u(cobj,agedb)]=Heavy Armor
&QRK`102`STATUS [u(cobj,agedb)]=QRK_HEAVYARMOR

&QRK`103 [u(cobj,agedb)]=Quick Reflexes
&QRK`103`STATUS [u(cobj,agedb)]=QRK_QUICKREFLEXES

&QRK`104 [u(cobj,agedb)]=Resilience
&QRK`104`STATUS [u(cobj,agedb)]=QRK_RESILIENCE

&QRK`105 [u(cobj,agedb)]=Staying Power
&QRK`105`STATUS [u(cobj,agedb)]=QRK_STAYINGPOWER

&QRK`106 [u(cobj,agedb)]=Tenacity
&QRK`106`STATUS [u(cobj,agedb)]=QRK_TENACITY

&QRK`107 [u(Cobj,agedb)]=Ablative Barrier
&QRK`107`STATUS [u(Cobj,agedb)]=QRK_ABLATIVEBARRIER

&QRK`108 [u(cobj,agedb)]=Anticipation
&QRK`108`STATUS [u(cobj,agedb)]=QRK_ANTICIPATION

&QRK`109 [u(cobj,agedb)]=Convenient Keepsake
&QRK`109`STATUS [u(Cobj,agedb)]=QRK_CONVENIENTKEEPSAKE

&QRK`110 [u(cobj,agedb)]=Hit and Run
&QRK`110`STATUS [u(Cobj,agedb)]=QRK_HITANDRUN

&QRK`111 [u(cobj,agedb)]=Immunized
&QRK`111`STATUS [u(cobj,agedb)]=QRK_IMMUNIZED

&QRK`112 [u(cobj,agedb)]=Last Chance
&QRK`112`STATUS [u(Cobj,agedb)]=QRK_LASTCHANCE

&QRK`113 [u(cobj,agedb)]=Point Defense
&QRK`113`STATUS [u(Cobj,agedb)]=QRK_POINTDEFENSE

&QRK`114 [u(cobj,agedb)]=Regeneration
&QRK`114`STATUS [u(cobj,agedb)]=QRK_REGENERATION

&QRK`115 [u(cobj,agedb)]=Siege Mode
&QRK`115`STATUS [u(cobj,agedb)]=QRK_SIEGEMODE

&QRK`116 [u(cobj,agedb)]=Stand and Deliver
&QRK`116`STATUS [u(cobj,agedb)]=QRK_STANDANDDELIVER

&QRK`117 [u(cobj,agedb)]=Stripped Down
&QRK`117`STATUS [u(cobj,agedb)]=QRK_STRIPPEDDOWN

&QRK`118 [u(cobj,agedb)]=Survival Instinct
&QRK`118`STATUS [u(cobj,agedb)]=QRK_SURVIVALINSTINCT

&QRK`119 [u(cobj,agedb)]=Vanish
&QRK`119`STATUS [u(cobj,agedb)]=QRK_VANISH

&QRK`120 [u(cobj,agedb)]=Deflection
&QRK`120`STATUS [u(cobj,agedb)]=QRK_DEFLECTION

@@ Balanced Quirks
&QRK`200 [u(cobj,agedb)]=Bloodthirsty
&QRK`200`STATUS [u(cobj,agedb)]=QRK_BLOODTHIRSTY

&QRK`201 [u(cobj,agedb)]=Efficiency
&QRK`201`STATUS [u(cobj,agedb)]=QRK_EFFICIENCY

&QRK`202 [u(cobj,agedb)]=Finesse
&QRK`202`STATUS [u(cobj,agedb)]=QRK_FINESSE

&QRK`203 [u(cobj,agedb)]=Genius
&QRK`203`STATUS [u(Cobj,agedb)]=QRK_GENIUS

&QRK`204 [u(cobj,agedb)]=Revenge
&QRK`204`STATUS [u(cobj,agedb)]=QRK_REVENGE

&QRK`205 [u(cobj,agedb)]=Solidity
&QRK`205`STATUS [u(cobj,agedb)]=QRK_SOLIDITY

&QRK`206 [u(cobj,agedb)]=Adrenaline
&QRK`206`STATUS [u(Cobj,agedb)]=QRK_ADRENALINE

&QRK`207 [u(cobj,agedb)]=Bag of Tricks
&QRK`207`STATUS [u(Cobj,agedb)]=QRK_BAGOFTRICKS

&QRK`208 [u(cobj,agedb)]=Destiny
&QRK`208`STATUS [u(cobj,agedb)]=QRK_DESTINY

&QRK`209 [u(cobj,agedb)]=Fighting Spirit
&QRK`209`STATUS [u(Cobj,agedb)]=QRK_FIGHTINGSPIRIT

&QRK`210 [u(cobj,agedb)]=Honor Bound
&QRK`210`STATUS [u(cobj,agedb)]=QRK_HONORBOUND

&QRK`211 [u(cobj,agedb)]=Improvisation
&QRK`211`STATUS [u(cobj,agedb)]=QRK_IMPROVISATION

&QRK`212 [u(cobj,agedb)]=Inspiration
&QRk`212`STATUS [u(Cobj,agedb)]=QRK_INSPIRATION

&QRK`213 [u(cobj,agedb)]=Last Stand
&QRK`213`STATUS [u(cobj,agedb)]=QRK_LASTSTAND

&QRK`214 [u(cobj,agedb)]=Overcharged
&QRK`214`STATUS [u(cobj,agedb)]=QRK_OVERCHARGED

&QRK`215 [u(Cobj,agedb)]=Prep Time
&QRK`215`STATUS [u(Cobj,agedb)]=QRK_PREPTIME

&QRK`216 [u(cobj,agedb)]=Repertoire
&QRK`216`STATUS [u(cobj,agedb)]=QRK_REPERTOIRE

&QRK`217 [u(cobj,agedb)]=Unbreakable
&QRK`217`STATUS [u(cobj,agedb)]=QRK_UNBREAKABLE

&QRK`218 [u(cobj,agedb)]=Selfless
&QRK`218`STATUS [u(cobj,agedb)]=QRK_SELFLESS

&QRK`219 [u(cobj,agedb)]=Team Support
&QRK`219`STATUS [u(cobj,agedb)]=QRK_TEAMSUPPORT

@@ Section for SIGNATURES

&SIG`1 [u(cobj,agedb)]=Impervious
&SIG`1`STATUS [u(cobj,agedb)]=SIG_IMPERVIOUS

&SIG`2 [u(cobj,agedb)]=Killer Move
&SIG`2`STATUS [u(cobj,agedb)]=SIG_KILLERMOVE

&SIG`3 [u(cobj,agedb)]=Execution
&SIG`3`STATUS [u(cobj,agedb)]=SIG_EXECUTION

&SIG`4 [u(cobj,agedb)]=Enervation
&SIG`4`STATUS [u(cobj,agedb)]=SIG_ENERVATION

&SIG`5 [u(cobj,agedb)]=Resurrection
&SIG`5`STATUS [u(cobj,agedb)]=SIG_RESURRECTION

&SIG`6 [u(cobj,agedb)]=Turbo Overdrive
&SIG`6`STATUS [u(cobj,agedb)]=SIG_TURBOOVERDRIVE

&SIG`7 [u(cobj,agedb)]=Maximum Hype
&SIG`7`STATUS [u(cobj,agedb)]=SIG_MAXIMUMHYPE

&SIG`8 [u(cobj,agedb)]=Ultimate Defense
&SIG`8`STATUS [u(cobj,agedb)]=SIG_ULTIMATEDEFENSE

&SIG`9 [u(cobj,agedb)]=Untouchable
&SIG`9`STATUS [u(cobj,agedb)]=SIG_UNTOUCHABLE

&SIG`10 [u(cobj,agedb)]=Perfect Strike
&SIG`10`STATUS [u(cobj,agedb)]=SIG_PERFECTSTRIKE

&SIG`11 [u(cobj,agedb)]=Just That Good
&SIG`11`STATUS [u(cobj,agedb)]=SIG_JUSTTHATGOOD

&SIG`12 [u(cobj,agedb)]=Multi-Stage Defense
&SIG`12`STATUS [u(cobj,agedb)]=SIG_MULTISTAGEDEFENSE

&SIG`13 [u(cobj,agedb)]=Combo Multiplier
&SIG`13`STATUS [u(cobj,agedb)]=SIG_COMBOMULTIPLIER

&SIG`14 [u(cobj,agedb)]=Armor Slayer
&SIG`14`STATUS [u(cobj,agedb)]=SIG_ARMORSLAYER

&SIG`15 [u(cobj,agedb)]=EX Action
&SIG`15`STATUS [u(cobj,agedb)]=SIG_EXACTION


@@ ---- Section for version Switch....

&CMD`CSWITCH [u(cobj,age)]=$+cswitch *:@attach %!/INC`VALID`POSINT=%0;@check match(1,%q<value>)=@attach %!/INC`MSG=ERROR: Csys Version %q<value> is not available. Choices: 1;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will switch your Combat System version to %q<value>. Your current status and settings will be cleared.,COMBAT SWITCH %q<value>;@attach %!/INC`MSG=You have switched combat system versions.;@attach %!/INC`MSG`ROOM=Switched to Combat system version: %q<value>;&D`CSYS`VERSION %#=%q<value>

&VERSION [u(cobj,age)]=default(%0/D`CSYS`VERSION,1)

@@ ---- VIEWS
@SQL CREATE OR REPLACE VIEW volv_centity AS SELECT c.centity_id AS centity_id,e.entity_name AS centity_name,c.centity_type as centity_type,c.centity_version AS centity_version,c.centity_owner AS centity_owner,e2.entity_name AS centity_owner_name,e2.entity_type AS centity_owner_type,e2.entity_objid AS centity_owner_objid,c.centity_date_created AS centity_date_created,UNIX_TIMESTAMP(c.centity_date_created) AS centity_date_created_secs,c.centity_claim_lock AS centity_claim_lock,c.centity_approved AS centity_approved FROM vol_centity AS c LEFT JOIN vol_entity AS e ON c.centity_id=e.entity_id LEFT JOIN vol_entity AS e2 ON c.centity_owner=e2.entity_id

@SQL CREATE OR REPLACE VIEW volv_clink AS SELECT cl.clink_id AS clink_id,cl.character_id AS character_id,e.entity_name AS character_name,e.entity_objid AS character_objid,cl.clink_approved AS clink_approved,cl.clink_loan_from AS clink_loan_from,e2.entity_name AS loan_from_name,e2.entity_objid AS loan_from_objid,cl.clink_type AS clink_type,cl.clink_locked AS clink_locked,cl.consequences_date_gained AS consequences_date_gained,UNIX_TIMESTAMP(cl.consequences_date_gained) AS consequences_date_gained_secs,cl.consequences_date_timeout AS consequences_date_timeout,UNIX_TIMESTAMP(cl.consequences_date_timeout) AS consequences_date_timeout_secs,cl.consequences_scenes AS consequences_scenes,cen.* FROM vol_clink AS cl LEFT JOIN volv_centity AS cen ON cen.centity_id=cl.centity_id LEFT JOIN vol_entity AS e ON cl.character_id=e.entity_id LEFT JOIN vol_entity AS e2 ON cl.clink_loan_from=e2.entity_id;

@SQl CREATE OR REPLACE VIEW volv_mantle AS SELECT c.centity_id AS mantle_id,c.centity_name AS mantle_name,c.centity_owner_name AS mantle_owner_name,c.centity_owner_objid AS mantle_owner_objid,c.centity_owner AS mantle_owner_id,c.centity_date_created AS mantle_date_created,c.centity_date_created_secs AS mantle_date_created_secs,c.centity_version AS mantle_version,s.mantle_stats,s.mantle_accolades,ct.trait_value AS mantle_archetype,c.centity_claim_lock AS mantle_claim_lock FROM volv_centity AS c LEFT JOIN volv_mantle_stats AS s ON s.mantle_id=c.centity_id LEFT JOIN vol_ctrait AS ct ON ct.centity_id=c.centity_id AND trait_type=1 AND trait_id=0 WHERE c.centity_type=0

@@ ----- ARMORY

&CMD`ARMORY [u(cobj,age)]=$^(?s)\+(mantle)(?\:/(\S+))?(?\: +(.+?))?(?\:=(.*))?$:th u(setq,sysname,ARMORY);th u(setq,command,u(capnames,%1));@attach %!/%1`INIT;@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`GETSWITCH=%2;@attach %!/INC`%q<sysname>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4
@set [u(cobj,age)]/CMD`ARMORY=regexp

&ARMORY`MANTLE`PLAYER [u(cobj,age)]=VIEW|CLAIM|RELEASE|GRANT|REVOKE|LIST
&ARMORY`MANTLE`ADMIN [u(cobj,age)]=CREATE|DELETE|TRANSFER|SELECT|DELETE|ADD|REMOVE|SET|LOCK|RAWLOCK|UNLOCK|CENSUS

&MANTLE`INIT [u(cobj,age)]=th u(setq,etype,MANTLE);th u(setq,eid,0)

&INC`ATARGET [u(Cobj,age)]=@check strlen(before(%0,/))=@attach %!/INC`MSG=ERROR: Must target an Owner! Example Syntax: Character/%n\, Group/Justice League, or Global.;@attach %!/INC`PARTIAL=before(%0,/),CHARACTER|GROUP|GLOBAL,|,tchoice;@select/inline %q<tchoice>=GLOBAL,{th u(setq,tar%1id,NULL);th u(setq,tar%1type,GLOBAL);th u(setq,tar%1name,GLOBAL)},CHARACTER,{@attach %!/INC`CHECKPC=after(%0,/),99;th u(setq,tar%1id,r(t99id));th u(setq,tar%1name,r(t99name));th u(setq,tar%1type,CHARACTER)},GROUP,{@attach %!/INC`VALID`GROUP=after(%0,/);th u(setq,tar%1id,get(%q<value>/D`ID));th u(setq,tar%1type,GROUP);th u(setq,tar%1name,name(%q<value>))}
@@ %0 - The TARGET. %1 - The slot to load it into. 1, 2, 3, etc.

@@ ENTITY TYPE: 1 - character, 5 - group, 9 - combat system entity

&INC`VALID`CNAME [u(cobj,age)]=@attach %!/INC`VALID`ENAME=%0,Combat Entity

&INC`VALID`CENTITY [u(cobj,age)]=@attach %!/INC`SEARCHSQL=%0,%q<etype>,CENTITY,%1,%2,%q<eid>,u(version,%#)
&Q`FIND`CENTITY`LIST [u(cobj,age)]=SELECT centity_name FROM volv_centity WHERE centity_owner=? AND centity_type=? AND centity_version=?
&Q`FIND`CENTITY`EXACT [u(cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_name=? AND centity_owner=? AND centity_type=? AND centity_version=? LIMIT 1
&Q`FIND`CENTITY`EXACT`ID [u(cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_id=? AND centity_owner=? AND centity_type=? AND centity_version=? LIMIT 1
&Q`FIND`CENTITY`WILD [u(cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_name LIKE '!%' AND centity_owner=? AND centity_type=? AND centity_version=? LIMIT 1
&Q`LOAD`CENTITY [u(cobj,age)]=SELECT centity_id,centity_name,centity_owner,centity_owner_name,centity_owner_objid,centity_owner_type,centity_date_created_secs,centity_type,centity_version,centity_claim_lock FROM volv_centity WHERE centity_id=?
&FIELD`CENTITY [u(Cobj,age)]=id name owner ownername ownerobjid ownertype datecreated type version claimlock

&INC`VALID`ETARGET [u(cobj,age)]=@select/inline isint(%0)=1,{th u(setq,value,%0)},0,{@attach %!/INC`VALID`ENAME=%0}

&INC`CTARGET [u(cobj,age)]=@attach %!/INC`VALID`CENTITY=%0,%1,%2

@@ --------- ARMORY SECTION FOR CREATE

&INC`ARMORY`CREATE [u(cobj,age)]=@attach %!/INC`ATARGET=%0,1;@attach %!/INC`VALID`ENAME=%1;@stop u(mysql,EXIST`CENTITY,%q<eid>,u(VERSION,%#),%q<tar1id>,%q<value>,%q<value>)=@attach %!/INC`MSG=ERROR: Another %q<etype> already uses that name!;@attach %!/INC`DOSQL=CREATE`CENTITY`1/cid,%q<value>;@attach %!/INC`DOSQL=CREATE`CENTITY`2,%q<cid>,u(VERSION,%#),%q<tar1id>,%q<eid>;@dolist/inline u(lattr,u(cobj,agedb)/ENTITY`%q<eid>`STAT`*)={@attach %!/INC`DOSQL=NEW`CENTITY_TRAIT,%q<cid>,last(%i0,`),0,get(u(cobj,agedb)/%i0`DEFAULT)};@attach %!/INC`ARMORY`CREATE`%q<etype>;@attach %!/INC`ARMORY`CREATE`%q<etype>`%q<tar1type>;@attach %!/INC`MSG=Created %q<etype> '%q<cid>: %q<value>' for '%q<tar1type>: %q<tar1name>'. It is SELECTED for editing.;&D`ARMORY`%q<etype> %#=%q<cid>;&D`ARMORY`%q<etype>`NAME %#=%q<value>;&D`ARMORY`%q<etype>`OWNER %#=%q<tar1name>;&D`ARMORY`%q<etype>`TYPE %#=%q<tar1type>;&D`ARMORY`%q<etype>`OWNER_ID %#=%q<tar1id>;@attach %!/INC`MSG`CHAN=Created %q<etype> '%q<cid>: %q<value>' for '%q<tar1type>: %q<tar1name>'

&INC`ARMORY`CREATE`MANTLE [u(cobj,age)]=
&INC`ARMORY`CREATE`MANTLE`GLOBAL [u(cobj,age)]=
&INC`ARMORY`CREATE`MANTLE`CHARACTER [u(cobj,age)]=@attach %!/INC`DOSQL=NEW`CENTITY_LINK/clink_id,%q<tar1id>,%q<cid>,0,NULL,0
&INC`ARMORY`CREATE`MANTLE`GROUP [u(cobj,age)]=

&Q`EXIST`CENTITY [u(cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_type=? AND centity_version=? AND centity_owner=? AND (centity_name=? OR centity_id=?)

&Q`CREATE`CENTITY`1 [u(cobj,age)]=INSERT INTO vol_entity (entity_name,entity_type) VALUES (?,9)
&Q`CREATE`CENTITY`2 [u(cobj,age)]=INSERT INTO vol_centity (centity_id,centity_version,centity_date_created,centity_owner,centity_type) VALUES (?,?,UTC_TIMESTAMP(),?,?)

&Q`NEW`CENTITY_TRAIT [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,?,?)

&Q`NEW`CENTITY_LINK [u(cobj,age)]=INSERT INTO vol_clink (character_id,centity_id,clink_type,clink_loan_from,clink_locked) VALUES (?,?,?,!,?)

@@ ---------- ARMORY SECTION FOR DELETE
&INC`ARMORY`DELETE [u(cobj,age)]=@attach %!/INC`ATARGET=%0,1;@select/inline isint(%1)=1,{th u(setq,value,%1)},0,{@attach %!/INC`VALID`ENAME=%1};@check u(setr,found,u(mysql3,FIND`CENTITY`EXACT[if(isint(%q<value>),`ID)],%q<value>,%q<tar1id>,%q<eid>,u(VERSION,%#)))=@attach %!/INC`MSG=ERROR: A %q<etype> does not use that name or ID! Deletions require EXACT MATCHES. (Name or ID);@attach %!/INC`LOADSQL=CENTITY,elements(%q<found>,1,chr(177)),1,;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will DELETE the %q<etype> '%q<centity1.id>: %q<centity1.name>'. This will affect everyone who is linked to it. Enter the same command again to verify.,DELETE %q<etype> %q<centity1.id>];@attach %!/INC`DOSQL=DELETE`CENTITY,%q<centity1.id>;@attach %!/INC`ARMORY`DELETE`%q<etype>;@attach %!/INC`ARMORY`DELETE`%q<etype>`%q<tar1type>;@attach %!/INC`MSG=[ansi(hr,DELETED)] %q<etype> '%q<centity1.id>: %q<centity1.name>' for '%q<tar1type>: %q<tar1name>'.;@attach %!/INC`MSG`CHAN=[ansi(hr,DELETED)] %q<etype> '%q<centity1.id>: %q<centity1.name>' for '%q<tar1type>: %q<tar1name>'

&Q`DELETE`CENTITY [u(cobj,age)]=DELETE FROM vol_entity WHERE entity_id=?

&INC`ARMORY`DELETE`MANTLE [u(cobj,age)]=
&INC`ARMORY`DELETE`MANTLE`GLOBAL [u(cobj,age)]=
&INC`ARMORY`DELETE`MANTLE`CHARACTER [u(cobj,age)]=
&INC`ARMORY`DELETE`MANTLE`GROUP [u(cobj,age)]=


@@ ---------- ARMORY SECTION FOR SELECT
&INC`ARMORY`SELECT [u(cobj,age)]=@attach %!/INC`ATARGET=%0,1;@attach %!/INC`CTARGET=%1,1,%q<tar1id>;@attach %!/INC`MSG=Selected %q<etype> '%q<centity1.id>: %q<centity1.name>' for '%q<tar1type>: %q<tar1name>'.;&D`ARMORY`%q<etype> %#=%q<centity1.id>;&D`ARMORY`%q<etype>`NAME %#=%q<centity1.name>;&D`ARMORY`%q<etype>`OWNER %#=%q<tar1name>;&D`ARMORY`%q<etype>`TYPE %#=%q<tar1type>;&D`ARMORY`%q<etype>`OWNER_ID %#=%q<tar1id>;@attach %!/INC`ARMORY`SELECT`%q<etype>;@attach %!/INC`ARMORY`SELECT`%q<etype>`%q<tar1type>

&INC`ARMORY`SELECT`MANTLE [u(cobj,age)]=
&INC`ARMORY`SELECT`MANTLE`GLOBAL [u(cobj,age)]=
&INC`ARMORY`SELECT`MANTLE`CHARACTER [u(cobj,age)]=
&INC`ARMORY`SELECT`MANTLE`GROUP [u(cobj,age)]=


@@ ---------- ARMORY SECTION FOR LIST
&INC`ARMORY`LIST [u(cobj,age)]=@attach %!/INC`ATARGET=u(strfirstof,%0,CHARACTER/%#),1;@attach %!/INC`ARMORY`LIST`%q<etype>;@attach %!/INC`ARMORY`LIST`%q<etype>`%q<tar1type>

&INC`ARMORY`LIST`MANTLE [u(cobj,age)]=th u(setq,display_ids,u(mysql3,IDS`RETRIEVE,%q<tar1id>,0,u(version,%#)));@select/inline cor(u(isadmin,%#),eq(get(%#/D`ID),%q<tar1id>))=0,{th u(setq,display_ids,filterbool(#lambda/testlock(elements(\%0,2,chr(177)),%#),%q<display_ids>,chr(176),chr(176)))};@check strlen(%q<display_ids>)=@attach %!/INC`MSG=ERROR: No %q<tar1type> %q<etype>S to list.;th u(setq,display_ids,iter(%q<display_ids>,first(%i0,chr(177)),chr(176),%b))

&FUN`MANTLELINE [u(cobj,age)]=align(5 20 18 14 8,%0,%1,if(cand(not(isint(%5)),not(u(isadmin,%#))),???,trim(iter(ldelete(%2,5,chr(176)),ljust(switch(inum(0),5,if(elements(%i0,2,chr(177)),ansi(hy,*),%b),ansi(u(statcolor,elements(%i0,1,chr(177))),u(VIEW`STAT3,elements(%i0,1,chr(177)))[if(elements(%i0,2,chr(177)),+)])),3),chr(176),%b))),u(cust,ARC,u(strfirstof,%3,0)),u(VIEW`WEIGHT,%4))


&Q`LIST`MANTLE_STATS [u(cobj,age)]=SELECT trait_value,trait_flags_1 FROM vol_ctrait WHERE centity_id=? AND trait_type=0 ORDER BY trait_id
&Q`LIST`MANTLE_NAME [u(cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_id=? LIMIT 1
&Q`LIST`MANTLE_ARCHETYPE [u(cobj,age)]=SELECT mantle_archetype FROm volv_mantle WHERE mantle_id=? LIMIT 1
&Q`LIST`MANTLE_OWNER [u(cobj,age)]=SELECT centity_owner FROM vol_centity WHERe centity_id=? LIMIT 1

&INC`ARMORY`LIST`MANTLE`UNIVERSAL [u(cobj,age)]=@pemit %#=ansi(u(color,%#,AGE,COLUMN_NAMES),align(5 20 18 14 8,ID,Name,iter(Po En Pr Mi Dr,%i0%B),Archetype,Weight));@pemit %#=u(separator);@dolist/inline %q<display_ids>={th u(setq,mdata,u(mysql3,LIST`MANTLE_NAME,%i0));th u(setq,mstats,u(mysql3,LIST`MANTLE_STATS,%i0));th u(setq,marc,u(mysql,LIST`MANTLE_ARCHETYPE,%i0));th u(setq,mown,u(mysql,LIST`MANTLE_OWNER,%i0));@pemit %#=u(FUN`MANTLELINE,%i0,elements(%q<mdata>,2,chr(177)),%q<mstats>,%q<marc>,elements(elements(%q<mstats>,5,chr(176)),1,chr(177)),%q<mown>)};@pemit %#=u(footer)

&INC`ARMORY`LIST`MANTLE`GLOBAL [u(cobj,age)]=@pemit %#=u(header,Global [capstr(lcstr(%q<etype>s))]);@attach %!/INC`ARMORY`LIST`MANTLE`UNIVERSAL

&INC`ARMORY`LIST`MANTLE`CHARACTER [u(cobj,age)]=@pemit %#=u(header,%q<tar1name>'s [capstr(lcstr(%q<etype>s))]);@attach %!/INC`ARMORY`LIST`MANTLE`UNIVERSAL;@select/inline cand(words(u(setr,display_ids,u(mysql,IDS`EXTRA,%q<tar1id>,0,u(VERSION,%#)))),cor(u(isadmin,%#),eq(get(%#/D`ID),%q<tar1id>)))=1,{@pemit %#=u(header,%q<tar1name>'s Borrowed [capstr(lcstr(%q<etype>)s)]);@attach %!/INC`ARMORY`LIST`MANTLE`UNIVERSAL}

&INC`ARMORY`LIST`MANTLE`GROUP [u(cobj,age)]=@pemit %#=u(header,%q<tar1name>'s [capstr(lcstr(%q<etype>s))]);@attach %!/INC`ARMORY`LIST`MANTLE`UNIVERSAL


&Q`IDS`EXTRA [u(cobj,age)]=SELECT centity_id FROM volv_clink WHERE character_id=? AND centity_type=? AND centity_version=? AND clink_locked=1 ORDER BY centity_name
&Q`IDS`RETRIEVE [u(Cobj,age)]=SELECT centity_id,centity_claim_lock FROM volv_centity WHERE centity_owner=? and centity_type=? AND centity_version=? ORDER BY centity_name



@@ ---------- ARMORY SECTION FOR VIEW
&INC`ARMORY`VIEW [u(cobj,age)]=@attach %!/INC`ATARGET=%0,1;@attach %!/INC`CTARGET=%1;@attach %!/INC`ARMORY`VIEW`%q<etype>;@attach %!/INC`ARMORY`VIEW`%q<etype>`%q<tar1type>

&INC`ARMORY`VIEW`MANTLE [u(cobj,age)]=
&INC`ARMORY`VIEW`MANTLE`GLOBAL [u(cobj,age)]=
&INC`ARMORY`VIEW`MANTLE`CHARACTER [u(cobj,age)]=
&INC`ARMORY`VIEW`MANTLE`GROUP [u(cobj,age)]=



@@ display code snippets
&INC`SHOWSELECT [u(cobj,age)]=@pemit %#=u(header,Character Editor: %q<t1name>);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(2 19 6 6 6 6 12 16,ID,Name,Pow,End,Pre,Mit,Weight,Archetype));@dolist/inline/delimit [chr(176)] [u(mysql3,VIEW`MANTLE_LINKS,%q<t1id>)]={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,accs,elements(%q<row>,6,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(2 19 6 6 6 6 12 16,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),elements(%q<stats>,1)[u(FUN`ACC,elements(%q<accs>,1))],elements(%q<stats>,2)[u(FUN`ACC,elements(%q<accs>,2))],elements(%q<stats>,3)[u(FUN`ACC,elements(%q<accs>,3))],elements(%q<stats>,4)[u(FUN`ACC,elements(%q<accs>,4))],u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unshaped),ansi(hx,N/A)))};@pemit %#=u(footer)

&VIEW`WEIGHT [u(cobj,age)]=switch(%0,1,Light,2,Medium,3,Heavy,4,Superheavy,5,Boss,<Unset>)

&FUN`ACC [u(Cobj,age)]=if(gte(%0,3),*%0,repeat(*,%0))


&INC`COMBAT`MANTLE`CLAIM`LIST [u(cobj,age)]=@check words(u(setr,mantles,u(filter,GLOBAL_LOCK,u(mysql3,LIST`GLOBAL`CLAIMS),chr(176),chr(176),%#)),chr(176))=@attach %!/INC`MSG=ERROR: No Global Mantles to assume!;@pemit %#=u(header,Global Mantles);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(4 14 9 9 9 9 8 11,ID,Name,Power,Endurance,Precision,Mitigatio,Weight,Archetype));@pemit %#=u(separator);@dolist/inline/delimit [chr(176)] %q<mantles>={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(4 14 9 9 9 9 8 11,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),if(u(isadmin,%#),u(VIEW`STAT,elements(%q<stats>,1)),Public),if(u(isadmin,%#),u(VIEW`STAT,elements(%q<stats>,2)),Public),if(u(isadmin,%#),u(VIEW`STAT,elements(%q<stats>,3)),Public),if(u(isadmin,%#),u(VIEW`STAT,elements(%q<stats>,4)),Public),u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unpublished),ansi(hx,N/A)))};@pemit %#=u(footer)

&INC`COMBAT`MANTLE`SHOWMANTLES [u(cobj,age)]=@check words(u(setr,mantles,u(mysql3,VIEW`MANTLE_LINKS,%q<t1id>)),chr(176))=@attach %!/INC`MSG=ERROR: No mantles to list.;@pemit %#=u(header,Character Editor: %q<t1name>);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(2 12 9 9 9 9 8 11 3,ID,Name,Power,Endurance,Precision,Mititigat,Weight,Archetype,Acl));@dolist/inline/delimit [chr(176)] %q<mantles>={th u(setq,row,u(choosegame,%i0,%d0));th u(setq,stats,elements(%q<row>,3,chr(177)));th u(setq,arc,elements(%q<row>,4,chr(177)));@pemit %#=align(2 12 9 9 9 9 8 11 3,elements(%q<row>,1,chr(177)),elements(%q<row>,2,chr(177)),if(elements(%q<row>,7,chr(177)),Public,u(VIEW`STAT,elements(%q<stats>,1))),if(elements(%q<row>,7,chr(177)),Public,u(VIEW`STAT,elements(%q<stats>,2))),if(elements(%q<row>,7,chr(177)),Public,u(VIEW`STAT,elements(%q<stats>,3))),if(elements(%q<row>,7,chr(177)),Public,u(VIEW`STAT,elements(%q<stats>,4))),u(VIEW`WEIGHT,elements(%q<stats>,5)),if(cand(%q<arc>,hasattr(u(cobj,agedb)/ARC`%q<arc>)),default(u(cobj,agedb)/ARC`%q<arc>,Unpublished),ansi(hx,N/A)),elements(%q<stats>,6))};@pemit %#=u(footer)


@@ --------- ARMORY SECTION SUPPLEMENTAL
&INC`LOADSELECT [u(cobj,age)]=@check strlen(u(setr,value,get(%#/D`ARMORY`%q<etype>)))=@attach %!/INC`MSG=ERROR: Nothing is Selected!;@check u(setr,found,u(mysql3,FIND`CENTITY`EXACT[if(isint(%q<value>),`ID)],%q<value>,get(%#/D`ARMORY`%q<etype>`OWNER_ID),%q<eid>,u(VERSION,%#)))=@attach %!/INC`MSG=ERROR: %q<etype> not found! It may have been deleted. use /select again!;@attach %!/INC`LOADSQL=CENTITY,elements(%q<found>,1,chr(177)),1;th unsetq(found);@attach %!/INC`LOADSELECT`%q<etype>

&INC`LOADSELECT`MANTLE [u(cobj,age)]=

@@ --------- ARMORY SECTION FOR SET
&INC`ARMORY`SET [u(cobj,age)]=@attach %!/INC`LOADSELECT;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Must choose a parameter to set!;@attach %!/INC`PARTIAL=%0,u(ARMORY`SET`%q<etype>,%#),|,choice;@attach %!/INC`ARMORY`SET`%q<etype>`%q<choice>;@attach %!/INC`MSG=You set [u(setr,msg,[get(%#/D`ARMORY`%q<etype>`OWNER)]'s %q<etype> "%q<centity1.id>: %q<centity1.name>" %q<choice> to: %q<value>)];@attach %!/INC`MSG`CHAN=Set %q<msg>

&ARMORY`SET`MANTLE [u(cobj,age)]=NAME|POWER|ENDURANCE|PRECISION|MITIGATION|WEIGHT|ARCHETYPE[if(u(tester,%0),|APPROVED|POWBON|ENDBON|PREBON|MITBON|DRIVEBON)]

&INC`ARMORY`SET`CENTITY`NAME [u(cobj,age)]=@attach %!/INC`VALID`ENAME=%1;@stop cand(u(setr,fid2,first(u(mysql2,EXIST`CENTITY,%q<eid>,u(VERSION,%#),get(%#/D`ARMORY`%q<etype>`OWNER_ID),%q<value>,%q<value>),|)),neq(%q<centity1.id>,%q<fid2>))=@attach %!/INC`MSG=ERROR: %q<etype> names must be unique per Owner.;@attach %!/INC`DOSQL=CENTITY`RENAME,%q<value>,%q<centity1.id>;&D`ARMORY`%q<etype>`NAME %#=%q<value>

&Q`CENTITY`RENAME [u(cobj,age)]=UPDATE vol_entity SET entity_name=? WHERE entity_id=?

&INC`ARMORY`SET`CENTITY`APPROVED [u(cobj,age)]=@check isint(%1)=@attach %!/INC`MSG=ERROR: Approved must be 0 (false) or 1 (true).;@attach %!/INC`DOSQL=SET`CENTITY_APPROVED,%1,%q<centity1.id>;@attach %!/INC`ARMORY`SET`CENTITY`APPROVED`%q<etype>
&INC`ARMORY`SET`CENTITY`APPROVED`CHARACTER [u(cobj,age)]=@attach %!/INC`DOSQL=SET`CLINK_APPROVED,%1,%q<centity1.id>,get(%#/D`ARMORY`%q<etype>`OWNER_ID)

&INC`ARMORY`SET`CENTITY`TRAIT [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@check and(isint(%1),gte(%1,u(setr,mintrait,u(cust,ENTITY`%q<eid>,STAT`%2`MINIMUM))),lte(%2,u(setr,maxtrait,u(cust,ENTITY`%q<eid>,STAT`%2`MAXIMUM))))=@attach %!/INC`MSG=ERROR: %q<choice> must be a whole number between %q<mintrait>-%q<maxtrait>.;@attach %!/INC`DOSQL=SET`CENTITY_STAT,u(setr,value,%1),%q<centity1.id>,%2,%3;

&Q`SET`CENTITY_STAT [u(cobj,age)]=UPDATE vol_ctrait SET trait_value=? WHERE centity_id=? AND trait_id=? AND trait_type=?

&INC`ARMORY`SET`CENTITY`TRAITFLAG1 [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@check cand(isint(%1),gte(%1,0))=@attach %!/INC`MSG=ERROR: %q<choice> must be a whole number.;@attach %!/INC`DOSQL=SET`CENTITY_STATFLAG1,%1,%q<centity1.id>,%2,%3;th u(setq,value,%1)

&Q`SET`CENTITY_STATFLAG1 [u(cobj,age)]=UPDATE vol_ctrait SET trait_flags_1=? WHERE centity_id=? AND trait_id=? AND trait_type=?

&INC`ARMORY`SET`MANTLE`NAME [u(cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`NAME
&INC`ARMORY`SET`MANTLE`POWER [u(cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAIT=%0,%1,0,0
&INC`ARMORY`SET`MANTLE`ENDURANCE [u(cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAIT=%0,%1,1,0
&INC`ARMORY`SET`MANTLE`PRECISION [u(cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAIT=%0,%1,2,0
&INC`ARMORY`SET`MANTLE`MITIGATION [u(cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAIT=%0,%1,3,0
&INC`ARMORY`SET`MANTLE`POWBON [u(Cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAITFLAG1=%0,%1,0,0
&INC`ARMORY`SET`MANTLE`ENDBON [u(Cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAITFLAG1=%0,%1,1,0
&INC`ARMORY`SET`MANTLE`PREBON [u(Cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAITFLAG1=%0,%1,2,0
&INC`ARMORY`SET`MANTLE`MITBON [u(Cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAITFLAG1=%0,%1,3,0
&INC`ARMORY`SET`MANTLE`DRIVEBON [u(Cobj,age)]=@attach %!/INC`ARMORY`SET`CENTITY`TRAITFLAG1=%0,%1,4,0

&INC`ARMORY`SET`MANTLE`WEIGHT [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: Nothing entered to set %q<choice> to!;@attach %!/INC`PARTIAL=%1,LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS,|,weight;@attach %!/INC`ARMORY`SET`CENTITY`TRAIT=%0,match(LIGHT|MEDIUM|HEAVY|SUPERHEAVY|BOSS,%q<weight>,|),4,0;th u(setq,value,%q<weight>)

&INC`ARMORY`SET`MANTLE`ARCHETYPE [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: Archetype field empty!;@check isint(u(setr,archetype_id,u(FIND_TRAIT,ARC,%1)))=@attach %!/INC`MSG=ERROR: Could not find Archetype!;@attach %!/INC`DOSQL=SET`MANTLE`ARCHETYPE,%q<centity1.id>,0,1,%q<archetype_id>;th u(setq,value,u(cust,ARC,%q<archetype_id>))

&Q`SET`MANTLE`ARCHETYPE [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,?,?) ON DUPLICATE KEY UPDATE trait_value=VALUES(trait_value)

&FIND_TRAIT [u(cobj,age)]=localize(if(strlen(u(setr,found,u(filter,EXACT_TRAIT,u(setr,all,u(lattr,u(cobj,agedb)/%0`*)),%b,%b,%1))),last(%q<found>,`),last(first(u(filter,WILD_TRAIT,%q<all>,%b,%b,%1)),`)))

&FIND_MULTI [u(cobj,age)]=localize(if(strlen(u(setr,found,u(filter,EXACT_TRAIT,u(setr,all,u(lattr,u(cobj,agedb)/%0`*)),%b,%b,%1))),last(%q<found>,`),sortkey(#lambda/strlen(get(u(cobj,agedb)/%0`\%0)),iter(u(filter,WILD_TRAIT,%q<all>,%b,%b,%1),last(%i0,`)))))

&FIL`EXACT_TRAIT [u(cobj,age)]=strmatch(%1,get(u(cobj,agedb)/%0))
&FIL`WILD_TRAIT [u(cobj,age)]=strmatch(get(u(cobj,agedb)/%0),%1*)

@@ ---- ARMORY SECTION FOR ADD
&INC`ARMORY`ADD [u(cobj,age)]=@attach %!/INC`LOADSELECT;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Must choose a parameter to add!;@attach %!/INC`PARTIAL=%0,u(ARMORY`ADD`%q<etype>,%#),|,choice;@attach %!/INC`ARMORY`ADD`%q<etype>`%q<choice>;@attach %!/INC`MSG=You added '%q<value>' to [u(setr,msg,[get(%#/D`ARMORY`%q<etype>`OWNER)]'s %q<etype> "%q<centity1.id>: %q<centity1.name>" %q<choice> list.)];@attach %!/INC`MSG`CHAN=Added '%q<value>' to %q<msg>

&ARMORY`ADD`MANTLE [u(Cobj,age)]=QUIRK

&INC`ARMORY`ADD`CENTITY`TRAIT [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: No %2 entered to add.;@check u(setr,trait_id,u(FIND_TRAIT,%3,%1))=@attach %!/INC`MSG=ERROR: Could not find %2 named '%1'.;@stop u(mysql,EXIST`CENTITY_TRAIT,%q<centity1.id>,%q<trait_id>,%4)=@attach %!/INC`MSG=ERROR: %q<etype> already has that %2.;@attach %!/INC`DOSQL=ADD`CENTITY_TRAIT,%q<centity1.id>,%q<trait_id>,%4,1;th u(setq,value,u(cust,%3,%q<trait_id>))

&Q`EXIST`CENTITY_TRAIT [u(cobj,age)]=SELECT trait_value FROM vol_ctrait WHERE centity_id=? AND trait_id=? AND trait_type=? 
&Q`ADD`CENTITY_TRAIT [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,?,?) ON DUPLICATE KEY UPDATE trait_value=VALUES(trait_value)

&INC`ARMORY`ADD`MANTLE`QUIRK [u(cobj,age)]=@attach %!/INC`ARMORY`ADD`CENTITY`TRAIT=%0,%1,Quirk,QRK,2

@@ ---- ARMORY SECTION FOR REMOVE
&INC`ARMORY`REMOVE [u(cobj,age)]=@attach %!/INC`LOADSELECT;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Must choose a parameter to add!;@attach %!/INC`PARTIAL=%0,u(ARMORY`REMOVE`%q<etype>,%#),|,choice;@attach %!/INC`ARMORY`REMOVE`%q<etype>`%q<choice>;@attach %!/INC`MSG=You removed '%q<value>' from [u(setr,msg,[get(%#/D`ARMORY`%q<etype>`OWNER)]'s %q<etype> "%q<centity1.id>: %q<centity1.name>" %q<choice> list.)];@attach %!/INC`MSG`CHAN=Removed '%q<value>' from %q<msg>

&ARMORY`REMOVE`MANTLE [u(cobj,age)]=u(ARMORY`ADD`MANTLE,%0)

&INC`ARMORY`REMOVE`CENTITY`TRAIT [u(cobj,age)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: No %2 entered to remove.;@check u(setr,trait_id,u(FIND_TRAIT,%3,%1))=@attach %!/INC`MSG=ERROR: Could not find %2 named '%1'.;@check u(mysql,EXIST`CENTITY_TRAIT,%q<centity1.id>,%q<trait_id>,%4)=@attach %!/INC`MSG=ERROR: %q<etype> lacks that %2.;@attach %!/INC`DOSQL=DELETE`CENTITY_TRAIT,%q<centity1.id>,%q<trait_id>,%4;th u(setq,value,u(cust,%3,%q<trait_id>))

&Q`DELETE`CENTITY_TRAIT [u(cobj,age)]=DELETE FROM vol_ctrait WHERE centity_id=? AND trait_id=? AND trait_type=?

&INC`ARMORY`REMOVE`MANTLE`QUIRK [u(cobj,age)]=@attach %!/INC`ARMORY`REMOVE`CENTITY`TRAIT=%0,%1,Quirk,QRK,2


@@ ----- ARMORY SECTION FOR TRANSFER
&INC`ARMORY`TRANSFER [u(cobj,age)]=@attach %!/INC`LOADSELECT;@attach %!/INC`ATARGET=%0,1;@select/inline strlen(%1)=>0,{@attach %!/INC`VALID`ENAME=%1};@stop cand(u(setr,fid2,first(u(mysql2,EXIST`CENTITY,%q<eid>,u(VERSION,%#),%q<tar1id>,u(strfirstof,%q<value>,%q<centity1.name>),u(strfirstof,%q<value>,%q<centity1.name>)),|)),neq(%q<centity1.id>,%q<fid2>))=@attach %!/INC`MSG=ERROR: %q<etype> names must be unique per Owner.;@attach %!/INC`ARMORY`TRANSFER`CENTITY;@attach %!/INC`ARMORY`TRANSFER`CENTITY`%q<etype>;&D`ARMORY`%q<etype>`TYPE %#=%q<tar1type>;&D`ARMORY`%q<etype>`OWNER %#=%q<tar1name>;&D`ARMORY`%q<etype>`OWNER_ID %#=%q<tar1id>;&D`ARMORY`%q<etype>`NAME %#=u(strfirstof,%q<value>,%q<centity1.name>);@attach %!/INC`MSG=You transferred [u(setr,msg,%q<centity1.ownername>'s %q<etype> "%q<centity1.id>: %q<centity1.name>" to: %q<tar1type>: %q<tar1name>)];@attach %!/INC`MSG`CHAN=Transferred %q<msg>

&INC`ARMORY`TRANSFER`CENTITY [u(cobj,age)]=@attach %!/INC`DOSQL=TRANSFER`CENTITY,switch(%q<tar1id>,NULL,SET_NULL,%q<tar1id>),%q<centity1.id>

&Q`TRANSFER`CENTITY [u(cobj,age)]=UPDATE vol_centity SET centity_owner=? WHERE centity_id=?

&INC`ARMORY`TRANSFER`CENTITY`CHARACTER [u(cobj,age)]=@attach %!/INC`DOSQL=TRANSFER`CLINK,%q<tar1id>,%q<centity1.id>;

&Q`TRANSFER`CLINK [u(cobj,age)]=UPDATE vol_clink SET character_id=? WHERE centity_id=? AND clink_parent IS NULL

@@ ----- ARMORY SECTION FOR CLONE
&INC`ARMORY`CLONE [u(cobj,age)]=@attach %!/INC`LOADSELECT;@attach %!/INC`ATARGET=%0,1;@select/inline strlen(%1)=>0,{@attach %!/INC`VALID`ENAME=%1};@stop cand(u(setr,fid2,first(u(mysql2,EXIST`CENTITY,%q<eid>,u(VERSION,%#),%q<tar1id>,u(strfirstof,%q<value>,%q<centity1.name>),u(strfirstof,%q<value>,%q<centity1.name>)),|)),neq(%q<centity1.id>,%q<fid2>))=@attach %!/INC`MSG=ERROR: %q<etype> names must be unique per Owner.;@attach %!/INC`ARMORY`CLONE`CENTITY;@attach %!/INC`ARMORY`CLONE`CENTITY`%q<etype>;

&INC`ARMORY`CLONE`CENTITY [u(cobj,age)]=@attach %!/INC`DOSQL=CLONE`CENTITY`1/newid,u(strfirstof,%q<value>,%q<centity1.name>);@attach %!/INC`DOSQL=CLONE`CENTITY`2,%q<newid>,%q<tar1id>,%q<centity1.id>;@attach %!/INC`DOSQL=CLONE`CENTITY`3,%q<newid>,%q<centity1.id>

&Q`CLONE`CENTITY`1 [u(cobj,age)]=INSERT INTO vol_entity (entity_type,entity_name) VALUES (9,?)
&Q`CLONE`CENTITY`2 [u(cobj,age)]=INSERT INTO vol_centity (centity_id,centity_date_created,centity_version,centity_type,centity_owner,centity_lock,centity_approved) SELECT ?,UTC_TIMESTAMP(),centity_version,centity_type,?,centity_lock,centity_approved FROM vol_centity WHERE centity_id=?
&Q`CLONE`CENTITY`3 [u(Cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value,trait_flags_1,trait_flags_2) SELECT ?,trait_id,trait_type,trait_value,trait_flags_1,trait_flags_2 FROM vol_ctrait WHERE centity_id=?

&INC`ARMORY`CLONE`CENTITY`CHARACTER [u(cobj,age)]=@attach %!/INC`DOSQL=CLONE`CLINK,%q<tar1id>,%q<newid>,%q<centity1.id>,get(%0/D`ARMORY`%q<etype>`OWNER_ID);

&Q`CLONE`CLINK [u(cobj,age)]=INSERT INTO vol_clink (character_id,centity_id,clink_approved,clink_type,clink_locked) SELECT (?,?,clink_approved,clink_type,clink_locked) FROM vol_clink WHERE centity_id=? AND character_id=?

@@ ---------- ARMORY SECTION FOR LOANSYS

@@ Lock
&INC`ARMORY`UNLOCK [u(cobj,age)]=@attach %!/INC`ARMORY`LOCK=#TRUE,%1,1
&INC`ARMORY`RAWLOCK [u(cobj,age)]=@attach %!/INC`ARMORY`LOCK=%0,%1,1
&INC`ARMORY`LOCK [u(cobj,age)]=@attach %!/INC`LOADSELECT;@attach %!/INC`VALID`[if(%2,LOCK,GROUPLOCK)]=%0;@attach %!/INC`DOSQL=LOCK`CENTITY,%q<value>,%q<centity1.id>;@attach %!/INC`MSG=Locked [u(setr,msg,%q<centity1.ownername>'s %q<etype> "%q<centity1.id>: %q<centity1.name>" to: %q<valueformat>)];@attach %!/INC`MSG`CHAN=Locked %q<msg>

&Q`LOCK`CENTITY [u(cobj,age)]=UPDATE vol_centity SET centity_claim_lock=? WHERE centity_id=?



@@ Claim
&INC`ARMORY`CLAIM [u(cobj,age)]=@attach %!/INC`ATARGET=%0,1;@attach %!/INC`ARMORY`CLAIM`%q<tar1type>;@attach %!/INC`VALID`ETARGET=%1;@check strlen(u(setr,claimable,filterbool(#lambda/testlock(elements(\%0,2,chr(177)),%#),u(mysql3,LIST`CLAIMABLE,%q<tar1id>,u(VERSION,%#),%q<eid>),chr(176),chr(176))))=@attach %!/INC`MSG=ERROR: %q<tar1type> %q<tar1name> has no claimable %q<etype>S you can access!;th u(setq,claimids,u(SQL`IN`NUMBER,iter(%q<claimable>,first(%i0,chr(177)),chr(176),%b)));@check strlen(u(setr,found,u(mysql,SELECT`CENTITY_NAME_IDFILTER,%q<claimids>,%q<value>,%q<value>,%q<value>)))=@attach %!/INC`MSG=ERROR: Cannot find %q<etype> called %q<value>;@stop u(mysql,EXIST`CLAIM,%q<t1id>,first(%q<found>,chr(177)))=@attach %!/INC`MSG=ERROR: You already have a link to that %q<etype>!;@attach %!/INC`DOSQL=CLAIM`%q<etype>,%q<t1id>,u(setr,claimid,first(%q<found>,chr(177))),%q<tar1id>;@attach %!/INC`ARMORY`CLAIM`%q<etype>;@attach %!/INC`ARMORY`CLAIM`%q<etype>`%q<tar1type>;@attach %!/INC`MSG=You claim [u(setr,msg,"%q<claimid>: [rest(%q<found>,chr(177))]" from %q<tar1type>: %q<tar1name>.)];@attach %!/INC`MSG`CHAN=Claimed %q<msg>

&Q`EXIST`CLAIM [u(cobj,age)]=SELECT centity_id FROM vol_clink WHERE character_id=? AND centity_id=? LIMIT 1

&Q`LIST`CLAIMABLE [u(cobj,age)]=SELECT centity_id,centity_claim_lock FROM volv_centity WHERE centity_owner=? AND centity_version=? AND centity_type=? ORDER BY CHAR_LENGTH(centity_name)

&Q`SELECT`CENTITY_NAME_IDFILTER [u(Cobj,age)]=SELECT centity_id,centity_name FROM volv_centity WHERE centity_id IN (!) AND (centity_id=? OR (centity_name=? OR centity_name LIKE '!%')) ORDER BY CHAR_LENGTH(centity_name) LIMIT 1

&Q`CLAIM`MANTLE [u(cobj,age)]=INSERT INTO vol_clink (character_id,centity_id,clink_approved,clink_loan_from,clink_locked) VALUES (?,?,1,?,1)

@@ Release
&INC`ARMORY`RELEASE [u(cobj,age)]=@attach %!/INC`VALID`ETARGET=%0;@check u(setr,found,u(mysql3,RELEASE`%q<etype>,%q<t1id>,u(VERSION,%#),%q<eid>,%q<value>,%q<value>,sqlescape(%q<value>)))=@attach %!/INC`MSG=ERROR: No loaned %q<etype> found by that name or ID!;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will remove %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]" from your character. You may not have the permissions to re-claim it. Are you sure? Enter the same command again to verify.,RELEASE %q<etype> %q<found>;@attach %!/INC`DOSQL=DELETE`CLINK,elements(%q<found>,1,chr(177));@attach %!/INC`MSG=You released your claim on [elements(%q<found>,4,chr(177))]'s %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"!;@attach %!/INC`MSG`CHAN=Released claim on [elements(%q<found>,4,chr(177))]'s' %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"

&Q`RELEASE`MANTLE [u(cobj,age)]=SELECT clink_id,centity_id,centity_name,centity_owner_name FROM volv_clink WHERE character_id=? AND centity_version=? AND centity_type=? AND clink_locked>0 AND (centity_id=? OR (centity_name=? OR centity_name LIKE '!%')) ORDER BY CHAR_LENGTH(centity_name) LIMIT 1

&Q`DELETE`CLINK [u(cobj,age)]=DELETE FROM vol_clink WHERE clink_id=?

@@ Grant
&INC`ARMORY`GRANT [u(cobj,age)]=@attach %!/INC`VALID`ETARGET=%0;@attach %!/INC`CHECKPC=%1,2;@check strlen(u(setr,found,u(mysql3,GRANT`%q<etype>,%q<t1id>,u(VERSION,%#),%q<eid>,%q<value>,%q<value>,sqlescape(%q<value>),%q<t1id>)))=@attach %!/INC`MSG=ERROR: Cannot find an owned %q<etype> named %q<value>!;@stop u(mysql,EXIST`CLAIM,%q<t2id>,elements(%q<found>,2,chr(177)))=@attach %!/INC`MSG=ERROR: %q<t2name> already has a link to that %q<etype>!;@attach %!/INC`DOSQL=CLAIM`%q<etype>,%q<t2id>,elements(%q<found>,2,chr(177)),%q<t1id>;@attach %!/INC`MSG=You have granted %q<t1name> your %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]";@attach %!/INC`MSG=%n granted you %p %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"!,%q<t2>;@attach %!/INC`MSG`CHAN=%n granted %q<t2name> %p %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"!

&Q`GRANT`MANTLE [u(Cobj,age)]=SELECT clink_id,centity_id,centity_name FROM volv_clink WHERE character_id=? AND centity_version=? AND centity_type=? AND clink_locked=0 AND (centity_id=? OR (centity_name=? OR centity_name LIKE '!%')) AND centity_owner=? ORDER BY CHAR_LENGTH(centity_name) LIMIT 1

@@ Revoke
&INC`ARMORY`REVOKE [u(cobj,age)]=@attach %!/INC`VALID`ETARGET=%0;@attach %!/INC`CHECKPC=%1,2;@check strlen(u(setr,found,u(mysql3,REVOKE`%q<etype>,%q<t2id>,u(VERSION,%#),%q<eid>,%q<value>,%q<value>,sqlescape(%q<value>),%q<t1id>)))=@attach %!/INC`MSG=ERROR: Cannot find a granted %q<etype> named %q<value>!;@attach %!/INC`DOSQL=DELETE`CLINK,elements(%q<found>,1,chr(177));@attach %!/INC`MSG=You have revoked %q<t1name>'s access to your %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]";@attach %!/INC`MSG=%n revoked your access to %p %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"!,%q<t2>;@attach %!/INC`MSG`CHAN=%n revoked %q<t1name>'s access to %p %q<etype> "[elements(%q<found>,2,chr(177))]: [elements(%q<found>,3,chr(177))]"!

&Q`REVOKE`MANTLE [u(cobj,age)]=SELECT clink_id,centity_id,centity_name FROM volv_clink WHERE character_id=? AND centity_version=? AND centity_type=? AND (centity_id=? OR (centity_name=? OR centity_name LIKE '!%')) AND centity_owner=? ORDER BY CHAR_LENGTH(centity_name)

&VIEW`STAT [u(Cobj,age)]=switch(%0,1,Poor,2,Average,3,Good,4,Great,5,Excellent,?)
&VIEW`STAT2 [u(Cobj,age)]=switch(%0,1,D,2,C,3,B,4,A,5,S,?)
&VIEW`STAT3 [u(Cobj,age)]=switch(%0,1,Pr,2,Av,3,Gd,4,Gr,5,Ex,??)

@@ ---- ARMORY section for MAIN
&INC`ARMORY`MAIN [u(cobj,age)]=@select/inline strlen(%0)=>0,{@attach %!/INC`VALID`ETARGET;@check strlen(u(setr,found,u(mysql3,CHOOSE`%q<etype>,%q<t1id>,u(VERSION,%#),%q<eid>,%q<value>,%q<value>,sqlescape(%q<value>))))=@attach %!/INC`MSG=ERROR: Cannot find a %q<etype> called %q<value>!;@select/inline cor(get(%0/D`COMBAT`DAMAGE),nattr(%0/D`COMBAT`Q`**))=1,{@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] You appear to be in combat. Changing %q<etype>S will force a +reset. Are you sure? Enter the same command again to continue.,ARMORY CHANGE %q<etype> [first(%q<found>,chr(177))]};@attach %!/INC`ARMORY`MAIN`%q<etype>;@attach %!/INC`MSG=You are now ready to rock as the %q<etype> "[elements(%q<found>,1,chr(177))]: [elements(%q<found>,2,chr(177))]"},0,{@attach %!/INC`ARMORY`LIST}

&INC`ARMORY`MAIN`MANTLE [u(cobj,age)]=@dolist/inline/delimit | 1~ID|2~NAME|3~LINK|4~ARCHETYPE|5~LOCKED={th u(attrib_set,%#,D`ARMORY`MAIN`%q<etype>`[after(%i0,~)],elements(%q<found>,before(%i0,~),chr(177)))}

&Q`CHOOSE`MANTLE [u(cobj,age)]=SELECT l.centity_id,l.centity_name,l.clink_id,t.trait_value,l.clink_locked FROM volv_clink AS l LEFT JOIN vol_ctrait AS t ON t.centity_id=l.centity_id AND t.trait_type=1 AND trait_id=0 WHERE l.character_id=? AND l.centity_version=? AND l.centity_type=? AND (l.centity_id=? OR (l.centity_name=? OR l.centity_name LIKE '!%')) ORDER BY CHAR_LENGTH(l.centity_name) LIMIT 1

@@ ---- ARMORY section for CENSUS
@sql CREATE OR REPLACE VIEW volv_mantle_census_stats AS SELECT centity_id,SUM(trait_value) AS stat_sum FROM vol_ctrait WHERE trait_type=0 AND trait_id<4 GROUP BY centity_id;

@sql CREATE OR REPLACE VIEW volv_mantle_census AS SELECT c.centity_id,c.centity_version,c.centity_type,e.entity_name as centity_name,c.centity_owner,ch.character_name as owner_name,c.centity_claim_lock,c.centity_approved,stats.stat_sum,w.trait_value AS weight_value,a.trait_value AS archetype_id FROM vol_centity AS c LEFT JOIN vol_entity AS e ON c.centity_id=e.entity_id LEFT JOIN volv_character AS ch ON ch.character_id=c.centity_owner LEFT JOIN volv_mantle_census_stats as stats ON c.centity_id=stats.centity_id LEFT JOIN vol_ctrait AS w ON c.centity_id=w.centity_id AND w.trait_type=0 AND w.trait_id=4 LEFT JOIN vol_ctrait AS a ON c.centity_id=a.centity_id AND a.trait_type=1 AND a.trait_id=0 WHERE ch.character_is_deleted=0 AND ch.character_is_guest=0 AND a.trait_value IS NOT NULL AND a.trait_value>0;

@sql CREATE OR REPLACE VIEW volv_mantle_census_weight AS SELECT weight_value,stat_sum,GROUP_CONCAT(centity_owner ORDER BY owner_name) AS owner_ids,GROUP_CONCAT(owner_name ORDER BY owner_name SEPARATOR '|') AS owner_names FROM volv_mantle_census GROUP BY weight_value,stat_sum ORDER BY weight_value DESC,stat_sum DESC;

&Q`CENSUS`WEIGHT_SUMS [u(cobj,age)]=SELECT DISTINCT weight_value,stat_sum FROM volv_mantle_census WHERE centity_name=owner_name AND centity_owner NOT IN (!) ORDER BY weight_value DESC,stat_sum DESC;

&Q`CENSUS`WEIGHT_SUM_NAMES [u(cobj,age)]=SELECT GROUP_CONCAT(owner_name ORDER BY owner_name SEPARATOR '|') AS owner_names FROM volv_mantle_census WHERE centity_name=owner_name AND centity_owner NOT IN (!) AND weight_value=? AND stat_sum=? GROUP BY weight_value,stat_sum ORDER BY weight_value DESC,stat_sum DESC;

@sql CREATE OR REPLACE VIEW volv_mantle_census_trait AS select c.centity_id,c.centity_version,c.centity_type,e.entity_name AS centity_name,c.centity_owner,ch.character_name AS owner_name,c.centity_claim_lock,c.centity_approved,t.trait_type,t.trait_id,t.trait_value FROM vol_ctrait AS t LEFT JOIN vol_centity AS c ON t.centity_id=c.centity_id LEFT JOIN vol_entity AS e ON c.centity_id=e.entity_id LEFT JOIN volv_character AS ch ON c.centity_owner=ch.character_id WHERE ch.character_is_deleted=0 AND ch.character_is_guest=0 AND a.trait_value IS NOT NULL AND a.trait_value>0;

&Q`CENSUS`TRAITS_USED_IDS [u(cobj,age)]=SELECT DISTINCT trait_id FROM volv_mantle_census_trait WHERE centity_owner NOT IN (!) AND trait_type=? AND trait_id>0 and trait_value>0 ORDER BY trait_id

&Q`CENSUS`TRAITS_USED_NAMES [u(cobj,age)]=SELECT GROUP_CONCAT(owner_name ORDER BY owner_name SEPARATOR '|') as owner_names FROM volv_mantle_census_trait WHERE centity_owner NOT IN (!) AND trait_value>0 AND trait_type=? AND trait_id=? GROUP BY trait_type,trait_id ORDER BY trait_id

&Q`CENSUS`ARCHETYPES_USED_IDS [u(cobj,age)]=SELECT DISTINCT trait_value FROM volv_mantle_census_trait WHERE centity_owner NOT IN (!) AND trait_type=1 AND trait_id=0 and trait_value>0 ORDER BY trait_id

&Q`CENSUS`ARCHETYPES_USED_NAMES [u(cobj,age)]=SELECT GROUP_CONCAT(owner_name ORDER BY owner_name SEPARATOR '|') as owner_names FROM volv_mantle_census_trait WHERE centity_owner NOT IN (!) AND trait_value=? AND trait_type=1 AND trait_id=0 GROUP BY trait_type,trait_id ORDER BY trait_id

&INC`ARMORY`CENSUS [u(cobj,age)]=th u(setq,adminids,u(SQL`IN`NUMBER,iter(lsearch(all,type,player,elock,V`ADMIN:>0),get(%i0/D`ID))));@pemit %#=u(header,Census: Power Classes);@dolist/inline/delimit [chr(176)] [u(mysql3,CENSUS`WEIGHT_SUMS,%q<adminids>)]={th u(setq,weight,elements(%i0,1,chr(177)));th u(setq,sum,elements(%i0,2,chr(177)));th u(setq,weightletter,left(elements(get(u(cobj,agedb)/WEIGHTS),%q<weight>,|),1));@pemit %#=u(separator,Power Class: %q<sum>%q<weightletter>);@pemit %#=iter(u(mysql,CENSUS`WEIGHT_SUM_NAMES,%q<adminids>,%q<weight>,%q<sum>),%i0,|,\,%b)};@pemit %#=u(header,Census: Archetypes);th u(setq,attrs,u(sortattrs,lattr(u(cobj,agedb)/ARC`*)));th u(setq,ids,iter(%q<attrs>,after(%i0,`)));th u(setq,usedids,u(mysql,CENSUS`ARCHETYPES_USED_IDS,%q<adminids>));@dolist/inline %q<usedids>={@pemit %#=u(separator,Archetype: [default(u(cobj,agedb)/ARC`%i0,<unknown>)]);@pemit %#=iter(u(mysql,CENSUS`ARCHETYPES_USED_NAMES,%q<adminids>,%i0),%i0,|,\,%b)};@select/inline words(u(setr,unused,setdiff(%q<ids>,%q<usedids>)))=>0,{@pemit %#=u(separator,Unused Archetypes);@pemit %#=iter(%q<unused>,default(u(cobj,agedb)/ARC`%i0,<unknown>),%b,\,%b)};@dolist/inline/delimit | Quirks~QRK~2~Quirk|Signatures~SIG~4~Signature|Meisters~SIG~5~Meister={@pemit %#=u(header,Census: [elements(%i0,1,~)]);th u(setq,attrs,u(sortattrs,lattr(u(cobj,agedb)/[elements(%i0,2,~)]`*)));th u(setq,ids,iter(%q<attrs>,after(%i0,`)));th u(setq,usedids,u(mysql,CENSUS`TRAITS_USED_IDS,%q<adminids>,elements(%i0,3,~)));@dolist/inline %q<usedids>={@pemit %#=u(separator,elements(%i1,4,~): [default(u(cobj,agedb)/[elements(%i1,2,~)]`%i0,<unknown>)]);@pemit %#=iter(u(mysql,CENSUS`TRAITS_USED_NAMES,%q<adminids>,elements(%i1,3,~),%i0),%i0,|,\,%b)};@select/inline words(u(setr,unused,setdiff(%q<ids>,%q<usedids>)))=>0,{@pemit %#=u(separator,Unused [elements(%i0,1,~)]);@pemit %#=iter(%q<unused>,default(u(cobj,agedb)/[elements(%i0,2,~)]`%i0,<unknown>),%b,\,%b)}};@pemit %#=u(footer)




@@ ---- ARMORY help section
&SHLP`ARMORY [u(cobj,age)]=The Armory System is a generic framework for creating and maintaining different Combat System entities. Each game may implement its own commands such as +pilot or +armor which may have unique differences listed in sub-files of this one. This file covers the general concepts. Replace the +armory command with whatever's relevant for this game like +mantle/list!%R%R[ansi(hc,Concepts)]%R[align(5 [sub(u(width,%#),6)],,[ansi(h,target)] - All Combat Entities are OWNED BY one of three possible things: a specific CHARACTER\, a specific GROUP\, or the GLOBAL list - effectively owned by admin or the game itself. Whenever a <target> is called for\, it is entered as follows: Character/<Name>\, Group/<Name>\, or Global. This does take partial match! You can do C/<name> and so on.)]%R%R[ansi(hc,Commands)]%R[align(5 [sub(u(width,%#),6)],,[ansi(h,+armory/list <target>)] - Lists what a target owns. For characters it also lists whatever they're borrowing. Un-privileged players can only see Combat Entities if they pass its Claim Lock \(see below\).%R[ansi(h,+armory/create <target>=<name>)] - Creates a new Combat Entity owned by <target>. It will have all default stats and be auto-selected for editing.%R[ansi(h,+armory/delete <target>=<name>)] - Delete a Combat Entity. This CANNOT be undone! So be careful. <name> must be the exact name for sanity-checking but is not case-sensitive.%R[ansi(h,+armory/select <target>=<name>)] - Selects a Combat Entity for editing. This is useful for commands listed below.%R[ansi(h,+armory/transfer <target>\[=<name>\])] - Transfer the selected Combat Entity to a different owner. An optional name can be provided to rename it on the fly if the owner already has a Combat Entity of this name.%R[ansi(h,+armory/clone <target>\[=<name>\])] - Creates an identical copy of the selected Combat Entity and gives it to <target>. This is NOT the same as a loaned/borrowed Combat Entity - it is a standalone copy.%R[ansi(h,+armory/lock <lockstring>)] - Set the Claim Lock on a Combat Entity. This defaults to #FALSE \(nobody\). /lock uses the LockGen \(+help LockGen\) system. use /rawlock to instead use PennMUSH locks. /unlock simply sets it #TRUE \(everyone can see/claim it\).%R[ansi(h,+armory/set name=<new name>)] - Renames the selected Combat Entity. This is only a tiny bit of what /set can do though. See subfiles.)]
+shelp/add Character/Armory=[u(cobj,age)]/SHLP`ARMORY

&SHLP`ARMORY`MANTLE [u(cobj,age)]=Note: these commands first require you to use +mantle/select <target>=<mantlename>!%R%R[ansi(hc,Commands)]%R[align(5 [sub(u(width,%#),6)],,[ansi(h,+mantle/set <stat>=<value>)] - <stat> can be POWER\, ENDURANCE\, PRECISION\, or MITIGATION. <value> takes a number 1-5.%R[ansi(h,+mantle/set Weight=<value>)] - <Value> is the name of the Weight class. Light\, Heavy\, etc.%R[ansi(h,+mantle/set Archetype=<value>)] - <value> is the name of the Archetype.%R[ansi(h,+mantle/add quirk=<value>)] - This is used only for mantles with static Quirks that override player preferences. <value> is the name of a Quirk. If a mantle has even a single static Quirk then it will ignore all player prefs!%R[ansi(h,+mantle/remove quirk=<value>)] - Remove a quirk added via /add.%R[ansi(h,+mantle/set <bonus>=<value>)] - <bonus> can be POWBON\, ENDBON\, PREBON\, MITBON\, or DRIVEBON. Set to 0 or 1. Numbers higher than 1 do not count.%R[ansi(h,+mantle/set approved=<value>)] - Set to 0 \(no\) or 1 \(yes\). Unapproved Mantles cannot be used. \(Not currently implemented\))]
+shelp/addsub Armory/+mantle=[u(cobj,age)]/SHLP`ARMORY`MANTLE

@@ +matrix section
&CMD`MATRIX [u(cobj,age)]=$^(?s)\+(matrix|rollforce|hypeforce|driveforce|switch|damageforce|healforce|csetup)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:th u(setq,sysname,MATRIX);@check cor(u(isadmin,%#),u(tester,%#))=@attach %!/INC`MSG=Try as you might\, you cannot see the Matrix.;@attach %!/INC`%q<sysname>`%1=%3,%4,%5
@set [u(cobj,age)]/CMD`MATRIX=regexp

&INC`MATRIX`MATRIX [u(cobj,age)]=&D`MATRIX %#=not(get(%#/D`MATRIX));@attach %!/INc`MSG=You [if(get(%#/D`MATRIX),will now,will no longer)] see the Matrix.

&INC`MATRIX`START [u(cobj,age)]=@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not battle-ready!;@attach %!/INC`VALID`INT=%2;

&INC`MATRIX`ROLLFORCE [u(cobj,age)]=@attach %!/INC`MATRIX`START;&D`ROLLFORCE %q<t1>=%q<value>;@attach %!/INC`MSG=Okay! %q<t1name>'s' next defense roll will be: %q<value>

&INC`MATRIX`HYPEFORCE [u(cobj,age)]=@attach %!/INC`MATRIX`START;&D`COMBAT`HYPE %q<t1>=%q<value>;@attach %!/INC`MSG=Okay! %q<t1name>'s current Hype is %q<value>. Are you hype about that?

&INC`MATRIX`DAMAGEFORCE [u(cobj,age)]=@attach %!/INC`MATRIX`START;@attach %!/INC`DAMAGE=%q<t1>,%q<value>,Damage Force

&INC`MATRIX`HEALFORCE [u(cobj,age)]=@attach %!/INC`MATRIX`START;@attach %!/INC`HEAL=%q<t1>,%q<value>,Heal Force

&INC`MATRIX`DRIVEFORCE [u(cobj,age)]=@attach %!/INC`MATRIX`START;&D`COMBAT`DRIVE %q<t1>=%q<value>;@attach %!/INC`MSG=Okay! %q<t1name>'s current Drive is %q<value>. Shift into turbo!;th u(attrib_set,%q<t1>,D`COMBAT`DRIVE`STATUS,u(drivestatus,%q<t1>))

@@ PUSHES
&INC`SETSTATUS [u(cobj,age)]=@dolist/inline get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`PRE_SET_STATUS=%0,%1,%2,get(u(cobj,age)/STATUS`%2`TAGS),%4,%5};@select/inline strlen(%q<blockstatus>)=0,{@attach %!/INC`SETSTATUS`[default(u(cobj,age)/STATUS`%2`TYPE,STACK)]}
@@ %0 - Target. %1 - Source. %2 - Status to inflict. %3 - Arguments. %4 - Attack Turn Bonus. %5 - Defense Turn Bonus. (Set to X for indefinite.) %6 - Additional Tags.

&INC`SETSTATUS`IGNORE [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`%2))=>0,{},0,{@attach %!/INC`SETSTATUS`STACK}

&INC`SETSTATUS`REPLACE [u(Cobj,age)]=@select/inline words(u(setr,foundstatus,first(get(%0/D`COMBAT`ACTIVE`STATUS`%2))))=>0,{@attach %!/KILLSTATUS=%0,%q<foundstatus>;@attach %!/INC`SETSTATUS`STACK},0,{@attach %!/INC`SETSTATUS`STACK}

&INC`SETSTATUS`QUEUE [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`%2))=>0,{th u(attrib_set,%0,D`COMBAT`QUEUE`%2,insert(get(%0/D`COMBAT`QUEUE`%2),-1,%1~%3~%4~%5,^))},0,{@attach %!/INC`SETSTATUS`STACK}

&INC`SETSTATUS`ADD [u(cobj,age)]=@select/inline words(u(setr,foundstatus,first(get(%0/D`COMBAT`ACTIVE`STATUS`%2))))=>0,{@select/inline %4=X,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<foundstatus>`ATTACK_TURNS,X)},{@select/inline get(%0/D`COMBAT`STATUS`%q<foundstatus>`ATTACK_TURNS)=X,{},{th u(addto,%0,D`COMBAT`STATUS`%q<foundstatus>`ATTACK_TURNS,%4)}};@select/inline %5=X,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<foundstatus>`DEFENSE_TURNS,X)},{@select/inline get(%0/D`COMBAT`STATUS`%q<foundstatus>`DEFENSE_TURNS)=X,{},{th u(addto,%0,D`COMBAT`STATUS`%q<foundstatus>`DEFENSE_TURNS,%5)}};th u(attrib_set,%0,D`COMBAT`STATUS`%q<foundstatus>`SOURCE,setunion(get(%0/D`COMBAT`STATUS`%q<foundstatus>`SOURCE),%1))},0,{@attach %!/INC`SETSTATUS`STACK}

&INC`SETSTATUS`STACK [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`STATUS,u(setr,next,add(1,get(%0/D`COMBAT`STATUS))));@cpattr [u(cobj,age)]/STATUS`%2=%0/D`COMBAT`STATUS`[u(setr,statid,%2$%q<next>)];th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`%2,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`%2),%q<statid>));th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`SOURCE,%1);@select/inline match(get(u(cobj,age)/STATUS`%2`ATTACK_TURNS) %4 %q<statusatkturns>,X)=>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS,X)},0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS,add(get(u(cobj,age)/STATUS`%2`ATTACK_TURNS),%4,%q<statusatkturns>))};@select/inline t(get(%0/D`COMBAT`STATUS`%q<statid>`ATTACK_TURNS))=1,{th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%q<statid>))};@select/inline match(get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS) %5 %q<statusdefturns>,X)=>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS,X)},0,{th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS,add(get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS),%5,%q<statusdefturns>))};@select/inline t(get(%0/D`COMBAT`STATUS`%q<statid>`DEFENSE_TURNS))=1,{th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%q<statid>))};@dolist/inline/nobreak/delimit | %3|%q<statargs>={@check strlen(%i0);th u(attrib_set,%0,D`COMBAT`STATUS`%q<statid>`[before(%i0,=)],after(%i0,=))};@dolist/inline setunion(get(u(cobj,age)/STATUS`%2`TAGS),%6)={th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`TAGS`%i0,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`%i0),%q<statid>))};th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS,setunion(get(%0/D`COMBAT`ACTIVE`STATUS),%q<statid>));@attach %!/STATUS`%2`ON_ACTIVATE=%0,%q<statid>;th unsetq(status???turns);@dolist/inline get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_GAIN_STATUS=%0,%1,%q<statid>,%3,%4,%5};@dolist/inline get(%1/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_INFLICT_STATUS=%1,%0,%q<statid>}



&PUSH`1 [u(cobj,agedb)]=Attack
&PUSH`1`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`1`2 [u(cobj,agedb)]=The next attack deals a Standard degree of more damage.
&PUSH`1`4 [u(cobj,agedb)]=The next attack deals a Substantial degree of more damage.
&PUSH`1`6 [u(cobj,agedb)]=The next attack deals an Overwhelming degree of more damage.
&PUSH`1`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_ATTACK,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Standard,4,Substantial,6,Overwhelming)]

&PUSH`2 [u(cobj,agedb)]=Defense
&PUSH`2`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`2`2 [u(cobj,agedb)]=The next attack against you deals a Standard degree of less damage.
&PUSH`2`4 [u(cobj,agedb)]=The next attack against you deals a Substantial degree of less damage.
&PUSH`2`6 [u(cobj,agedb)]=The next attack against you deals an Overwhelming degree of less damage.
&PUSH`2`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_DEFENSE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Standard,4,Substantial,6,Overwhelming)],0,1

&PUSH`3 [u(cobj,agedb)]=Balance
&PUSH`3`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`3`2 [u(cobj,agedb)]=Your next attack deals a Small degree of more damage, and the next attack against you deals a Small degree of less damage.
&PUSH`3`4 [u(cobj,agedb)]=Your next attack deals a Standard degree of more damage, and the next attack against you deals a Standard degree of less damage.
&PUSH`3`6 [u(cobj,agedb)]=Your next attack deals a Considerable degree of more damage, and the next attack against you deals a Considerable degree of less damage.
&PUSH`3`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_BALANCE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,2,Small,4,Standard,6,Considerable)],1,1

&PUSH`4 [u(cobj,agedb)]=Buff
&PUSH`4`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`4`1 [u(cobj,agedb)]=You gain a Buff that grants a Minor bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`3 [u(cobj,agedb)]=You gain a Buff that grants a Solid bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`5 [u(cobj,agedb)]=You gain a Buff that grants a Major bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`7 [u(cobj,agedb)]=You gain a Buff that grants a Superior bonus to Precision, Power, Endurance, or Mitigation, for your next 2 turns.
&PUSH`4`ACTIVATE [u(cobj,agedb)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: You must choose a stat! Syntax: +push Buff/#=<stat>;@attach %!/INC`PARTIAL=%1,POWER|PRECISION|ENDURANCE|MITIGATION,|,pushchoice;@attach %!/INC`SETSTATUS=%#,%#,PUSH_BUFF_%q<pushchoice>,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Minor,3,Solid,5,Major,7,Superior)]

&PUSH`5 [u(cobj,agedb)]=Debuff
&PUSH`5`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`5`1 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Minor penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`3 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Solid penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`5 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Major penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`7 [u(cobj,agedb)]=Your next attack applies a Debuff that imposes a Superior penalty to Precision, Power, Endurance, or Mitigation, for the target’s next 2 turns.
&PUSH`5`ACTIVATE [u(cobj,agedb)]=@check strlen(%1)=@attach %!/INC`MSG=ERROR: You must choose a stat! Syntax: +push Debuff/#=<stat>;@attach %!/INC`PARTIAL=%1,POWER|PRECISION|ENDURANCE|MITIGATION,|,pushchoice;@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_DEBUFF_%q<pushchoice>,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Minor,3,Solid,5,Major,7,Superior)],1,0

&PUSH`6 [u(cobj,agedb)]=Damage Over Time
&PUSH`6`CHOICES [u(cobj,agedb)]=1|3|5|7
&PUSH`6`1 [u(cobj,agedb)]=A Small amount of damage from your next attack will be dealt to the target at the beginning of their turn, then a Tiny amount for their next 2 turns.
&PUSH`6`3 [u(cobj,agedb)]=A Standard amount of damage from your next attack will be dealt to the target at the beginning of their turn, then a Small amount for their next 2 turns.
&PUSH`6`5 [u(cobj,agedb)]=A Considerable amount of damage from your next attack will be dealt to the target at the beginning of their turn, then a Standard amount for their next 2 turns.
&PUSH`6`7 [u(cobj,agedb)]=A Substantial amount of damage from your next attack will be dealt to the target at the beginning of their turn, then a Standard amount for their next 2 turns.
&PUSH`6`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_DOT,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,1,Tiny,3,Standard,5,Considerable,7,Substantial)],1,0

&PUSH`7 [u(cobj,agedb)]=Cure
&PUSH`7`CHOICES [u(cobj,agedb)]=3|5|7
&PUSH`7`3 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Moderate/Small severity or lower.
&PUSH`7`5 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Significant/Standard severity or lower.
&PUSH`7`7 [u(cobj,agedb)]=You are cured of all Debuff or Damage Over Time effects of Superior/Substantial severity or lower.
&PUSH`7`ACTIVATE [u(cobj,agedb)]=@check words(u(setr,tocure,u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,CURE,switch(%2,3,Moderate,5,Significant,7,Superior),switch(%2,3,Small,5,Standard,7,Substantial),%0)))=@attach %!/INC`MSG=ERROR: Nothing to cure! Either no applicable Statuses found or existing Statuses are too potent.;@dolist/inline %q<tocure>={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=CURE,[ansi(hw,%n)] shrugs off negative Status Effects!

&PUSH`8 [u(cobj,agedb)]=Break
&PUSH`8`CHOICES [u(cobj,agedb)]=3|5|7
&PUSH`8`3 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Moderate bonus or lower if it deals damage.
&PUSH`8`5 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Significant bonus or lower if it deals damage.
&PUSH`8`7 [u(cobj,agedb)]=Your next attack removes all Buff effects of a Superior bonus or lower if it deals damage.
&PUSH`8`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INFLICT_BREAK,COST=%q<hypecost>,1,0

&PUSH`9 [u(cobj,agedb)]=Boost
&PUSH`9`CHOICES [u(cobj,agedb)]=2|4|6
&PUSH`9`2 [u(cobj,agedb)]=You immediately gain 4 Drive.
&PUSH`9`4 [u(cobj,agedb)]=You immediately gain 8 Drive.
&PUSH`9`6 [u(cobj,agedb)]=You immediately gain 12 Drive.
&PUSH`9`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_BOOST,COST=%q<hypecost>,0,0

&PUSH`10 [u(cobj,agedb)]=Coup de Grace
&PUSH`10`CHOICES [u(cobj,agedb)]=3|5
&PUSH`10`3 [u(cobj,agedb)]=Your next attack converts all Debuff and Damage Over Time effects of Solid/Standard severity or lower into immediate heavy damage.
&PUSH`10`5 [u(cobj,agedb)]=Your next attack converts all Debuff and Damage Over Time effects currently on the target into immediate heavy damage.
&PUSH`10`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_COUPDEGRACE,COST=%q<hypecost>|DISPLAY=[switch(%q<hypecost>,3,Solid,5,All)],1,0

&PUSH`11 [u(cobj,agedb)]=Finishing Blow
&PUSH`11`CHOICES [u(cobj,agedb)]=10
&PUSH`11`10 [u(cobj,agedb)]=Your next attack, so long as it does not result in a Miss, automatically becomes a Critical Hit after its final result is decided, but is somewhat less damaging.
&PUSH`11`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_FINISHINGBLOW,COST=%q<hypecost>,1,0

&PUSH`12 [u(cobj,agedb)]=Second Wind
&PUSH`12`CHOICES [u(cobj,agedb)]=10
&PUSH`12`10 [u(cobj,agedb)]=You immediately recover 15% of your Max HP and all Debuffs and Damage over Time effects applied to you are cured, but you receive a Significant penalty to Endurance and Mitigation for one round. This Push can be used once per opponent. Debuff clearing happens on the final use.
&PUSH`12`ACTIVATE [u(cobj,agedb)]=@stop gte(get(%#/D`COMBAT`HISTORY`SECONDWIND),get(%#/D`COMBAT`OPPONENTS))=@attach %!/INC`MSG=ERROR: You have already used Second Wind this fight!;@attach %!/INC`SETSTATUS=%#,%#,PUSH_SECONDWIND,COST=%q<hypecost>,0,1

&PUSH`13 [u(cobj,agedb)]=Ultimate Attack
&PUSH`13`CHOICES [u(cobj,agedb)]=10
&PUSH`13`10 [u(cobj,agedb)]=Your next attack deals +50% its normal amount of damage.
&PUSH`13`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_ULTIMATEATTACK,COST=%q<hypecost>,1,0

&PUSH`14 [u(Cobj,agedb)]=Exhaust
&PUSH`14`CHOICES [u(Cobj,agedb)]=2|4|6
&PUSH`14`2 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 5 if it deals damage.
&PUSH`14`4 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 10 if it deals damage.
&PUSH`14`6 [u(cobj,agedb)]=Your next attack decreases your Opponent's Drive by 15 if it deals damage.
&PUSH`14`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_EXHAUST,COST=%q<hypecost>|DISPLAY=%q<hypecost>,1,0

&PUSH`15 [u(cobj,agedb)]=Indomitability
&PUSH`15`CHOICES [u(cobj,agedb)]=10
&PUSH`15`10 [u(cobj,agedb)]=After your next attack, take 45% less damage from the next attack. (When fighting multiple opponents, activate this just before +attack'ing the last one.)
&PUSH`15`ACTIVATE [u(cobj,agedb)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INDOMITABILITY_PREPARE,COST=%q<hypecost>,1,0

@@ STATUS Section 
&GETSTATUS [u(cobj,age)]=add(if(isnum(u(setr,adjbon,u(STATUS`[before(%1,$)]`%2`%3,%0,%1))),%q<adjbon>,u(adj,u(adjinc,%q<adjbon>,u(ladd,iter(get(u(setr,src,get(%0/D`COMBAT`STATUS`%1`SOURCE))/D`COMBAT`ACTIVE`STATUS),get(u(cobj,age)/STATUS`[before(%i0,$)]`OPPONENT`STATUS`[before(%1,$)]`%2`%3`UPGRADE)))))),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(adj,u(STATUS`[before(%i0,$)]`STATUS`[before(%1,$)]`%2`%3,%0,%i0,%1)))))
@@ Arguments. %0 - the character. %1 - the status name. %2 - Attack/Defense. %3 - The attribute to grab.


@@ STATUS - Offenses

&STATUS`OFF_CONSISTENT [u(cobj,age)]=Consistent
&STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`OFF_FORCEFUL [u(cobj,age)]=Forceful
&STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`OFF_EFFICIENT [u(cobj,age)]=Consistent
&STATUS`OFF_EFFICIENT`ATTACK`DRIVE_COST [u(cobj,age)]=mul(get(%0/D`COMBAT`STATUS`%1`LEVEL),-2)
&STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor


&STATUS`OFF_DRAMATIC [u(cobj,age)]=Dramatic
&STATUS`OFF_DRAMATIC`ATTACK_END_TURN [u(cobj,age)]=@select/inline t(u(setr,gainhype,switch(%q<atklevel>,1,switch(die(1,2),2,1,0),2,add(1,switch(die(1,5),1,1,0)),3,add(1,switch(die(1,5),1,0,1)),4,add(2,switch(die(1,5),1,0,1)),5,add(3,switch(die(1,2),1,1,0)))))=1,{@attach %!/INC`HYPE=%0,%q<gainhype>,DRAMATIC ATTACK}

@@ STATUS - Defenses
&STATUS`DEF_FOCUS [u(cobj,age)]=Focus
&STATUS`DEF_FOCUS`TYPE [u(cobj,age)]=ADD
&STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`DEF_FOCUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`DEF_FOCUS`DESCRIPTION [u(Cobj,age)]=Moderate Bonus to Precision

&STATUS`DEF_BOLSTER [u(cobj,age)]=Bolster
&STATUS`DEF_BOLSTER`TYPE [u(cobj,age)]=ADD
&STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`DEF_BOLSTER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`DEF_BOLSTER`DESCRIPTION [u(Cobj,age)]=Moderate Bonus to Power

&STATUS`DEF_GUARD [u(cobj,age)]=Guard
&STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`DEF_MANEUVER [u(Cobj,age)]=Maneuver
&STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

&STATUS`DEF_RALLY [u(cobj,age)]=Rally
&STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=5
&STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN`EXEMPT [u(cobj,age)]=5
&STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

@@ STATUS - Archetypes - Generalists

&STATUS`ARC_ALLSTAR [u(cobj,age)]=All-Star
&STATUS`ARC_ALLSTAR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_ALLSTAR`STATIC`MAXIMUM`HP [u(cobj,age)]=15
&STATUS`ARC_ALLSTAR`STATIC`GAIN`DRIVE [u(cobj,age)]=5

&STATUS`ARC_MARKSMAN [u(cobj,age)]=Marksman
&STATUS`ARC_MARKSMAN`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_MARKSMAN`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_MARKSMAN`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_MARKSMAN`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Moderate
&STATUS`ARC_MARKSMAN`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor

&STATUS`ARC_BRUISER [u(cobj,age)]=Bruiser
&STATUS`ARC_BRUISER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_BRUISER`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_BRUISER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_BRUISER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_BRUISER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`ARC_TOUGHGUY [u(cobj,age)]=Tough Guy
&STATUS`ARC_TOUGHGUY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_TOUGHGUY`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_TOUGHGUY`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_TOUGHGUY`STATIC`MAXIMUM`HP [u(cobj,age)]=30

&STATUS`ARC_VIGILANT [u(cobj,age)]=Vigilant
&STATUS`ARC_VIGILANT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_VIGILANT`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_VIGILANT`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_VIGILANT`STATIC`GAIN`DRIVE [u(cobj,age)]=1

&STATUS`ARC_HERO [u(cobj,age)]=Hero
&STATUS`ARC_HERO`STATIC`GAIN`DRIVE [u(Cobj,age)]=5
&STATUS`ARC_HERO`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=3
&STATUS`ARC_HERO`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_HERO`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_HERO`STATIC`MAXIMUM`HP [u(cobj,age)]=75

&STATUS`ARC_DUELIST [u(cobj,age)]=Duelist
&STATUS`ARC_DUELIST`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_DUELIST`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate


&STATUS`ARC_SLUGGER [u(Cobj,age)]=Slugger
&STATUS`ARC_SLUGGER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SLUGGER`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_STRIKER [u(cobj,age)]=Striker
&STATUS`ARC_STRIKER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_STRIKER`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_STRIKER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_STRIKER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_DEFENDER [u(Cobj,age)]=Defender
&STATUS`ARC_DEFENDER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_DEFENDER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_DEFENDER`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_DEFENDER`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_DEFENDER`STATIC`MAXIMUM`HP [u(cobj,age)]=15

&STATUS`ARC_FREESTYLIST [u(cobj,age)]=Freestylist
&STATUS`ARC_FREESTYLIST`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_FREESTYLIST`STATUS`DEF_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_FREESTYLIST`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=2

&STATUS`ARC_CHALLENGER [u(Cobj,age)]=Challenger
&STATUS`ARC_CHALLENGER`STATIC`MAXIMUM`HP [u(cobj,age)]=120
&STATUS`ARC_CHALLENGER`STATIC`MAXIMUM`DRIVE [u(cobj,age)]=20
&STATUS`ARC_CHALLENGER`STATIC`START`DRIVE [u(cobj,age)]=20
&STATUS`ARC_CHALLENGER`STATIC`START`HYPE [u(cobj,age)]=2

@@ STATUS - ARchetypes - Specialists

&STATUS`ARC_ACE [u(cobj,age)]=Ace
&STATUS`ARC_ACE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Moderate,Ready,Minor)
&STATUS`ARC_ACE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Minor,Ready,Minor)
&STATUS`ARC_ACE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Moderate,Ready,Minor)
&STATUS`ARC_ACE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),PRIMED,Minor,Ready,Minor)
&STATUS`ARC_ACE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid,OVEREXTENDED,Solid,LAGGING,Minor)
&STATUS`ARC_ACE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=switch(u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS)),WAVERING,Solid,SPENT,Solid,OVEREXTENDED,Solid,LAGGING,Minor)
&STATUS`ARC_ACE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`DRIVE`STATUS),WAVERING,Solid,SPENT,Solid,OVEREXTENDED,Solid,LAGGING,Minor)
&STATUS`ARC_ACE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS)),WAVERING,Solid,SPENT,Solid,OVEREXTENDED,Solid,LAGGING,Minor)
&STATUS`ARC_ACE`ATTACK`DRIVE_COST [u(cobj,age)]=-5
&STATUS`ARC_ACE`DRIVE`EXHAUSTION_MULTIPLIER [u(Cobj,age)]=1

&STATUS`ARC_ARSENAL [u(cobj,age)]=Arsenal
&STATUS`ARC_ARSENAL`STATIC`GAIN`HYPE [u(cobj,age)]=2
&STATUS`ARC_ARSENAL`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_ARSENAL`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`ARC_ARSENAL`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)
&STATUS`ARC_ARSENAL`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Moderate,0)

&STATUS`ARC_ARSENAL`STATUS`DEF_BOLSTER`DEFENSE`BONUS`STAT`0 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),Major,0)
&STATUS`ARC_ARSENAL`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)
&STATUS`ARC_ARSENAL`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(gte(get(%0/D`COMBAT`HYPE`USED),2),fdiv(u(adj,Major),2),0)


&STATUS`ARC_ASPIRANT [u(cobj,age)]=Aspirant
&STATUS`ARC_ASPIRANT`STATIC`MAXIMUM`HP [u(cobj,age)]=120

&STATUS`ARC_ASPIRANT`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_PRECISION,,2,0;
&STATUS`ARC_ASPIRANT`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_PRECISION,,2,0;

&STATUS`ARC_ASPIRANT`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_POWER,,2,0;
&STATUS`ARC_ASPIRANT`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_POWER,,2,0;

&STATUS`ARC_ASPIRANT`OFF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_DRIVE,,0,2;
&STATUS`ARC_ASPIRANT`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_DRIVE,,0,2;

&STATUS`ARC_ASPIRANT`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_ENDURANCE,,0,2;

&STATUS`ARC_ASPIRANT`OFF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_HYPE,,0,2;

&STATUS`ARC_ASPIRANT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ASPIRANT_MITIGATION,,0,2;

&STATUS`ARC_ASPIRANT`STATIC`START`HYPE [u(cobj,age)]=2


&STATUS`ARC_ASPIRANT_FIRST [u(Cobj,age)]=Aspirant-FirstTurn
&STATUS`ARC_ASPIRANT_FIRST`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_FIRST`DESCRIPTION [u(cobj,age)]=Minor Buff to all Stats.
&STATUS`ARC_ASPIRANT_FIRST`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ASPIRANT_FIRST`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ASPIRANT_PRECISION [u(cobj,age)]=Aspirant-Precision
&STATUS`ARC_ASPIRANT_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_ASPIRANT_PRECISION`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_PRECISION`DESCRIPTION [u(cobj,age)]=Moderate buff to Precision.

&STATUS`ARC_ASPIRANT_POWER [u(cobj,age)]=Aspirant-Power
&STATUS`ARC_ASPIRANT_POWER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_ASPIRANT_POWER`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_POWER`DESCRIPTION [u(cobj,age)]=Moderate buff to Power.

&STATUS`ARC_ASPIRANT_ENDURANCE [u(cobj,age)]=Aspirant-Endurance
&STATUS`ARC_ASPIRANT_ENDURANCE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_ASPIRANT_ENDURANCE`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_ENDURANCE`DESCRIPTION [u(cobj,age)]=Moderate buff to Endurance.

&STATUS`ARC_ASPIRANT_MITIGATION [u(cobj,age)]=Aspirant-Mitigation
&STATUS`ARC_ASPIRANT_MITIGATION`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_ASPIRANT_MITIGATION`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_MITIGATION`DESCRIPTION [u(cobj,age)]=Moderate buff to Mitigation.

&STATUS`ARC_ASPIRANT_HYPE [u(Cobj,age)]=Aspirant-Hype
&STATUS`ARC_ASPIRANT_HYPE`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_HYPE`DESCRIPTION [u(cobj,age)]=Gain 1 Hype every Defense.
&STATUS`ARC_ASPIRANT_HYPE`DEFENSE`BONUS`HYPE_GAIN [u(cobj,age)]=1
&STATUS`ARC_ASPIRANT_HYPE`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=ASPIRANT,[ansi(h,%n)] gains [ansi(hg,Bonus)] Hype!

&STATUS`ARC_ASPIRANT_DRIVE [u(cobj,age)]=Aspirant-Drive
&STATUS`ARC_ASPIRANT_DRIVE`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_ASPIRANT_DRIVE`DESCRIPTION [u(cobj,age)]=Gain 3 Drive every Defense.
&STATUS`ARC_ASPIRANT_DRIVE`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=3
&STATUS`ARC_ASPIRANT_DRIVE`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=ASPIRANT,[ansi(h,%n)] gains [ansi(hg,Bonus)] Drive!

&STATUS`ARC_ASSASSIN [u(Cobj,age)]=Assassin
&STATUS`ARC_ASSASSIN`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%#,ARC_ASSASSIN_FOCUS,,1,0;
&STATUS`ARC_ASSASSIN`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%#,%#,ARC_ASSASSIN_MANEUVER,,0,1;
&STATUS`ARC_ASSASSIN`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`ARC_ASSASSIN`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Moderate

&STATUS`ARC_ASSASSIN_FOCUS [u(cobj,age)]=Assassin-Focus

&STATUS`ARC_ASSASSIN_FOCUS`ATTACK_INCREASE_HITMUL [u(Cobj,age)]=@select/inline and(Eq(%q<hitmul>,0.7),lte(u(setr,assrand,rand(0,100)),35))=1,{th u(setq,assmod,1);@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] deftly hits where it hurts! Critical Hit!;th u(setq,hitmul,1.0)};@attach %!/INC`DEBUG=ASSASSIN-FOCUS,Solid>Crit Upgrade Random: %q<assrand>/35;th unsetq(assrand)
&STATUS`ARC_ASSASSIN_FOCUS`ATTACK_INCREASE_DAMAGE [u(Cobj,age)]=@@ @select/inline and(not(%q<assmod>),gte(%q<orighitmul>,1.0))=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] blitzes through [ansi(hw,%n)]'s Defenses!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,35)))}
&STATUS`ARC_ASSASSIN_FOCUS`ATTACK_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline eq(%q<hitmul>,0.4)=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] misses [ansi(hw,%n)]'s vitals! Damage decreased!;th u(setq,atkdecdamagemul,linsert(%q<atkdecdamagemul>,-1,u(setr,assfoatkdecmul,u(scatter,25))));@attach %!/INC`DEBUG=ASSASSIN>Focus,Attack Decrease Damage Multiplier: -%q<assfoatkdecmul>;th unsetq(assfoatdecmul)}

&STATUS`ARC_ASSASSIN_MANEUVER [u(cobj,age)]=Assassin-Maneuver
&STATUS`ARC_ASSASSIN_MANEUVER`DEFENSE_INCREASE_DAMAGE_2 [u(cobj,age)]=@@ @select/inline gte(%q<hitmul>,1)=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,%n)] is too lightly armored!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,20)))}
&STATUS`ARC_ASSASSIN_MANEUVER`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline eq(0.4,%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=ASSASSIN,[ansi(hw,name(%q<atker>))] barely touches [ansi(hw,%n)] at all!;th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,assmandefmul,u(scatter,35))));@attach %!/INC`DEBUG=ASSASSIN>Maneuver,Defense Decrease Damage Multiplier: -%q<assmandefmul>;th unsetq(assmandefmul)}

&STATUS`ARC_BERSERKER [u(cobj,age)]=Berserker
&STATUS`ARC_BERSERKER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(lte(u(setr,berper,u(percent,%0)),0.25),Extreme,if(lte(%q<berper>,0.5),Superior,if(lte(%q<berper>,0.75),Significant,Solid)))
&STATUS`ARC_BERSERKER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=if(lte(u(setr,berper,u(percent,%0)),0.25),Solid,if(lte(%q<berper>,0.5),Moderate,if(lte(%q<berper>,0.75),Minor,0)))
&STATUS`ARC_BERSERKER`STATIC`MAXIMUM`HP [u(Cobj,age)]=120
@@ &STATUS`ARC_BERSERKER`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
@@ &STATUS`ARC_BERSERKER`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_BERSERKER`BELOW_75_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is starting to get angry!
&STATUS`ARC_BERSERKER`BELOW_50_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is getting mighty pissed!
&STATUS`ARC_BERSERKER`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=BERSERKER,[ansi(hw,name(%0))] is totally hulked out with rage!

&STATUS`ARC_BIGFOUR [u(cobj,age)]=Big Four
&STATUS`ARC_BIGFOUR`STATIC`MAXIMUM`QUIRKS [u(cobj,age)]=2
&STATUS`ARC_BIGFOUR`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Minor
&STATUS`ARC_BIGFOUR`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=Minor

&STATUS`ARC_BLASTER [u(Cobj,age)]=Blaster
&STATUS`ARC_BLASTER`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_BLASTER_CONSISTENT,FROM=%1,1,0
&STATUS`ARC_BLASTER`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_BLASTER_FORCEFUL,FROM=%1|EXTRADAM=[u(setr,popforce,u(pop,%0,D`COMBAT`STATUS`%1`FORCEFUL))],1,0;@select/inline t(%q<popforce>)=1,{@attach %!/INC`DEBUG=BLASTER>Forceful,Popping %q<popforce> damage from FORCEFUL queue.},0,{@attach %!/INC`DEBUG=BLASTER>Forceful,No damage to pop from FORCEFUL queue.}
&STATUS`ARC_BLASTER`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_BLASTER_DRAMATIC,FROM=%1,1,0
&STATUS`ARC_BLASTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Major
&STATUS`ARC_BLASTER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_BLASTER`ATTACK_POST_DAMAGE [u(cobj,age)]=th u(append,%q<atker>,D`COMBAT`STATUS`%1`FORCEFUL,mul(%q<damage>,0.12));@attach %!/INC`DEBUG=BLASTER>Post Damage,Appended [mul(%q<DAMAGE>,0.12)] damage to FORCEFUL queue.
&STATUS`ARC_BLASTER`ATTACK_BEFORE_LAUNCH [u(cobj,age)]=@select/inline t(u(setr,blasterdam,u(pop,%0,D`COMBAT`STATUS`%1`DRAMATIC)))=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_BLASTER_LASER,FROM=%1|EXTRADAM=%q<blasterdam>,1,0;@attach %!/INC`EANNOUNCE=BLASTER,ansi(h,%n) is firing %p laser! Beware boosted damage!;@attach %!/INC`DEBUG=BLASTER>Dramatic,Popping %q<blasterdam> damage from DRAMATIC queue.},0,{@attach %!/INC`DEBUG=BLASTER>Dramatic,No damage to pop from DRAMATIC queue.};th unsetq(blasterdam)

&STATUS`ARC_BLASTER_DRAMATIC [u(cobj,age)]=Blaster-Dramatic
&STATUS`ARC_BLASTER_DRAMATIC`ATTACK_DECREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,atkdecdamagemul,linsert(%q<atkdecdamagemul>,-1,0.5));@attach %!/INC`EANNOUNCE=BLASTER,[ansi(h,name(%q<atker>))]'s building up a mighty charge!
&STATUS`ARC_BLASTER_DRAMATIC`ATTACK_POST_DAMAGE [u(cobj,age)]=th u(append,%q<atker>,D`COMBAT`STATUS`[get(%0/%q<atk>`STATUS`%1`FROM)]`DRAMATIC,u(setr,dramdam,mul(%q<damage>,1.12)));@attach %!/INC`DEBUG=BLASTER>Dramatic,Appending %q<dramdam> to DRAMATIC damage queue.;th unsetq(dramdam)

&STATUS`ARC_BLASTER_FORCEFUL [u(cobj,age)]=Blaster-Forceful
&STATUS`ARC_BLASTER_FORCEFUL`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=@select/inline t(u(setr,blasterdamfor,get(%0/%q<atk>`STATUS`%1`EXTRADAM)))=1,{@attach %!/INC`EANNOUNCE=BLASTER,ansi(h,name(%q<atker>)) packs extra whallop into [poss(%q<atker>)] shots!;th u(setq,damage,add(u(setr,preblas,%q<damage>),%q<blasterdamfor>));@attach %!/INC`DEBUG=BLASTER>Forceful ATTACK_INCREASAE_DAMAGE,Adding %q<blasterdamfor> to original %q<preblas> damage = %q<damage>},0,{};th unsetq(blasterdamfor)

&STATUS`ARC_BLASTER_CONSISTENT [u(cobj,age)]=Blaster-Consistent
&STATUS`ARC_BLASTER_CONSISTENT`ATTACK_INCREASE_HITMUL [u(cobj,age)]=@select/inline t(%q<hitmul>)=1,{@select/inline %q<hitmul>=1.0,{@select/inline gte(%q<orighitmul>,1)=1,{th u(setq,arcblasternatcrit,1)}},{@select/inline lte(u(setr,blasterrand,rand(1,100)),25)=1,{th u(setq,hitmul,switch(%q<hitmul>,0.4,0.7,0.7,1.0));@attach %!/INC`EANNOUNCE=BLASTER,ansi(h,name(%q<atker>))'s blast hits a weak point! Strike upgraded to a [switch(%q<hitmul>,0.7,Solid,1.0,Critial Hit)]!}};@attach %!/INC`DEBUG=BLASTER-CONSISTENT: Attack Increase Hitmul Rand: %q<blasterrand>/25;th unsetq(blasterrand)}
&STATUS`ARC_BLASTER_CONSISTENT`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=@select/inline %q<arcblasternatcrit>=1,{th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,u(setr,blasteratkinc,u(scatter,10))));@attach %!/INC`DEBUG=BLASTER-Consistent-Natural Crit,Attack Increase Damage Multiplier: %q<blasteratkinc>;th unsetq(blasteratkinc)};th unsetq(arcblasternatcrit)

&STATUS`ARC_BLASTER_LASER [u(Cobj,age)]=Blaster-Laser
&STATUS`ARC_BLASTER_LASER`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=@select/inline t(u(setr,blasterdamlas,get(%0/%q<atk>`STATUS`%1`EXTRADAM))=1,{@attach %!/INC`EANNOUNCE=BLASTER,ansi(h,name(%q<atker>)) is firing [poss(%q<atker>)] laser! Beware boosted damage!;th u(setq,damage,add(%q<damage>,%q<blasterdamlas>))};th unsetq(blasterdamlas)

&STATUS`ARC_DEMORALIZER [u(cobj,age)]=Demoralizer
&STATUS`ARC_DEMORALIZER`STATIC`GAIN`DRIVE [u(Cobj,age)]=1
&STATUS`ARC_DEMORALIZER`STATIC`MAXIMUM`HP [u(cobj,age)]=50
&STATUS`ARC_DEMORALIZER`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_DEMORALIZER_SCALABLE,ADJ=Minor|AMOUNT=[get(first(%q<targets>)/D`COMBAT`OPPONENTS)],1,0;
&STATUS`ARC_DEMORALIZER`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_DEMORALIZER_SCALABLE,ADJ=Moderate|AMOUNT=[get(first(%q<targets>)/D`COMBAT`OPPONENTS)],1,0;
&STATUS`ARC_DEMORALIZER`ATTACK_POST_DAMAGE [u(cobj,age)]=@select/inline %q<off>=3,{th u(setq,olddrive,get(%0/D`COMBAT`DRIVE));@attach %!/INC`DRIVE=%0,-[add(mul(2,%q<atklevel>),sub(get(%0/D`COMBAT`OPPONENTS),1))],DEMORALIZER;@select/inline lt(get(%0/D`COMBAT`DRIVE),%q<olddrive>)=1,{@attach %!/INC`DRIVE=%q<atker>,1,DEMORALIZER}},4,{@attach %!/INC`HYPE=%#,-[add(%q<atklevel>,floordiv(sub(get(%0/D`COMBAT`OPPONENTS),1),2))],DEMORALIZER}
&STATUS`ARC_DEMORALIZER`ATTACK_END_TURN [u(cobj,age)]=@select/inline %q<off>=4,{@attach %!/INC`SETSTATUS=%0,%0,ARC_DEMORALIZER_POWER,,2,0}
&STATUS`ARC_DEMORALIZER`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=add(u(adj,u(cust,DRIVES,[get(%#/%q<atk>`DRIVESTATUS)]`ATTACK`PENALTY`STAT`0)),u(adj,if(nattr(%#/%q<atk>`STATUS`PUSH_*),0,Minor)))
&STATUS`ARC_DEMORALIZER`DEFENSE`BONUS`STAT`3 [u(Cobj,age)]=add(u(adj,u(cust,DRIVES,[get(%#/%q<atk>`DRIVESTATUS)]`ATTACK`PENALTY`STAT`2)),u(adj,if(nattr(%#/%q<atk>`STATUS`PUSH_*),0,Minor)))

&STATUS`ARC_DEMORALIZER_SCALABLE [u(cobj,age)]=Demoralizer-Debuff
&STATUS`ARC_DEMORALIZER_SCALABLE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=fdiv(u(ladd,iter(lnum(get(%0/D`COMBAT`STATUS`%1`AMOUNT)),u(adj,get(%0/D`COMBAT`STATUS`%1`ADJ)))),2)
&STATUS`ARC_DEMORALIZER_SCALABLE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=fdiv(u(ladd,iter(lnum(get(%0/D`COMBAT`STATUS`%1`AMOUNT)),u(adj,get(%0/D`COMBAT`STATUS`%1`ADJ)))),2)

&STATUS`ARC_DEMORALIZER_POWER [u(cobj,age)]=Demoralizer-Power
&STATUS`ARC_DEMORALIZER_POWER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`ARC_DEMORALIZER_POWER`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Moderate

&STATUS`ARC_DESTROYER [u(cobj,age)]=Destroyer
&STATUS`ARC_DESTROYER`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline %q<off>=1,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_DESTROYER_DOT,DAMAGE=%q<damage>|INCREMENT=0,0,mul(4,get(%0/D`COMBAT`OPPONENTS))},2,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_DESTROYER_FORCEFUL,,0,2;@attach %!/INC`EANNOUNCE=DESTROYER,[ansi(h,%n)] now suffers from a Moderate Penalty to Endurance and Mitigation!},3,{@attach %!/INC`DRIVE=%0,mul(%q<atklevel>,-2),DESTROYER},4,{@attach %!/INC`HEAL=%q<atker>,u(setr,healed,round(mul(%q<damage>,u(scatter,17)),0)),,DESTROYER,[ansi(hw,name(%q<atker>))] recovers [ansi(hg,%q<healed>)] HP!;th unsetq(healed)}
&STATUS`ARC_DESTROYER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`ARC_DESTROYER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`ARC_DESTROYER`STATIC`MAXIMUM`HP [u(Cobj,age)]=-50

&STATUS`ARC_DESTROYER_FORCEFUL [u(cobj,age)]=Destroyer-Forceful
&STATUS`ARC_DESTROYER_FORCEFUL`TAGS [u(cobj,age)]=DISPLAY DEBUFF
&STATUS`ARC_DESTROYER_FORCEFUL`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Endurance and Mitigation
&STATUS`ARC_DESTROYER_FORCEFUL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_DESTROYER_FORCEFUL`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_DESTROYER_FORCEFUL`CURE`INTENSITY [u(cobj,age)]=Moderate


&STATUS`ARC_DESTROYER_DOT [u(Cobj,age)]=Destroyer-DOT
&STATUS`ARC_DESTROYER_DOT`DESCRIPTION [u(cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_DESTROYER_DOT`TAGS [u(cobj,age)]=DOT DISPLAY
&STATUS`ARC_DESTROYER_DOT`DEFENSE`DOT [u(cobj,age)]=if(eq(mod(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0),bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,9.5,4.5)))),0),0)

&STATUS`ARC_DESTROYER_DOT`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=DESTROYER,[ansi(h,%n)] suffers a grievous wound! Cure it quickly or suffer Damage over Time!
&STATUS`ARC_DESTROYER_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),1,Small,2,Small,Tiny)

&STATUS`ARC_FENCER [u(cobj,age)]=Fencer
&STATUS`ARC_FENCER`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_GUARD,,0,1
&STATUS`ARC_FENCER`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_MANEUVER,,1,0
&STATUS`ARC_FENCER`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_FENCER_FOCUS,,1,0

&STATUS`ARC_FENCER`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Minor
&STATUS`ARC_FENCER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_FENCER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Minor
&STATUS`ARC_FENCER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`ARC_FENCER`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Minor),2)

&STATUS`ARC_FENCER_FOCUS [u(Cobj,age)]=Fencer-Focus
&STATUS`ARC_FENCER_FOCUS`ATTACK_ON_STRIKE [u(Cobj,age)]=@select/inline gte(%q<hitmul>,0.7)=1,{@attach %!/INC`DRIVE=%q<atker>,5,FENCER}

&STATUS`ARC_FENCER_GUARD [u(cobj,age)]=Fencer-Guard
&STATUS`ARC_FENCER_GUARD`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline and(eq(%q<hitmul>,0.4),lte(u(setr,frand,rand(0,100)),30))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=FENCER,[ansi(hw,%n)] deftly parries the blow!};@attach %!/INC`DEBUG=FENCER-GUARD,Close>Miss Downgrade Rand: %q<frand>;th unsetq(frand)

&STATUS`ARC_FENCER_MANEUVER [u(cobj,age)]=Fencer-Maneuver
&STATUS`ARC_FENCER_MANEUVER`ATTACK_INCREASE_DAMAGE_2 [u(Cobj,age)]=th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,u(setr,fencermul,u(scatter,switch(%q<hitmul>,0.7,20,1.0,10,0)))));@attach %!/INC`EANNOUNCE=FENCER,[ansi(hw,name(%q<atker>))] finds an an advantageous angle! Damage increased!;@attach %!/INC`DEBUG=FENCER>Maneuver,Attack Increase Damage Multiplier: %q<fencermul>;th unsetq(fencermul)

&STATUS`ARC_FURY [u(cobj,age)]=Fury
&STATUS`ARC_FURY`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,atkincdamagemul,add(%q<atkincdamagemul>,u(setr,furyatkmul,u(scatter,25))));@attach %!/INC`DEBUG=FURY,Attack Increase Damage Multiplier: %q<furyatkmul>;th unsetq(furyatkmul)
&STATUS`ARC_FURY`ATTACK_POST_DAMAGE [u(Cobj,age)]=@attach %!/INC`DAMAGE=%q<atker>,round(mul(%q<startdamage>,u(scatter,5)),0),Fury Backlash;@attach %!/INC`DRIVE=%q<atker>,5,FURY
&STATUS`ARC_FURY`ATTACK_ON_CRITICAL [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,5,FURY
&STATUS`ARC_FURY`ATTACK_ON_MISS [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,-5,FURY
&STATUS`ARC_FURY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_FURY`BANNED`OFF [u(Cobj,age)]=3
&STATUS`ARC_FURY`STATIC`GAIN`DRIVE [u(Cobj,age)]=-5

&STATUS`ARC_GAMBLER [u(cobj,age)]=Gambler
&STATUS`ARC_GAMBLER`STATIC`MAXIMUM`HP [u(cobj,age)]=45
&STATUS`ARC_GAMBLER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=[null(if(%q<gamble1>,,u(setq,gamble1,rand(1,100))))][switch(%q<gamble1>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,Solid,0)]
&STATUS`ARC_GAMBLER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=[null(if(%q<gamble2>,,u(setq,gamble2,rand(1,100))))][switch(%q<gamble2>,<=75,0,Minor)]
&STATUS`ARC_GAMBLER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=GAMBLER,[ansi(hw,%n)] spins the slots! [switch(%q<gamble2>,>75,Minor Penalty,Solid Bonus)] to Endurance and Mitigation!;@attach %!/INC`DEBUG=GAMBLER,Defense Stat Bonus Rand: %q<gamble2>/75;@attach %!/INC`[u(setr,gam3,randword(HYPE DRIVE))]=%0,switch(%q<gam3>,DRIVE,5,HYPE,1),Gambler;
&STATUS`ARC_GAMBLER`ATTACK_END_TURN [u(cobj,age)]=@attach %!/INC`EANNOUNCE=GAMBLER,[ansi(hw,%n)] spins the slots! [switch(%q<gamble1>,>75,Minor Penalty,Solid Bonus)] to Precision and Power!;@attach %!/INC`DEBUG=GAMBLER,Attack Bonus Rand: %q<gamble1>/75

&STATUS`ARC_GRAPPLER [u(Cobj,age)]=Grappler
&STATUS`ARC_GRAPPLER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GRAPPLER_READY,STAT=[u(setr,grapstat,switch(%q<def>,1,PRECISION,2,POWER,3,ENDURANCE,4,MITIGATION))]|A_TURNS=[switch(%q<def>,1,1,2,1,3,0,4,0)]|D_TURNS=[switch(%q<def>,1,0,2,0,3,1,4,1)],1,0;@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(hw,%n)] readies a Significant %q<grapstat> Penalizing attack!
&STATUS`ARC_GRAPPLER`ATTACK_ON_CALCULATE [u(cobj,age)]=@select/inline nattr(%0/D`COMBAT`STATUS`PUSH_DEBUFF_*)=>0,{@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(h,%n)]'s Debuffs are intensified by [ansi(hw,name(%q<atker>))]'s crushing expertise!}
&STATUS`ARC_GRAPPLER`ATTACK`DRIVE_COST [u(cobj,age)]=null(if(get(%q<targets>/D`COMBAT`STATUS`ACTIVE`TAGS`DEBUFF),-3,0))
&STATUS`ARC_GRAPPLER`STATIC`GAIN`HYPE [u(cobj,age)]=1

&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2`UPGRADE [u(cobj,age)]=1
&STATUS`ARC_GRAPPLER`OPPONENT`STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3`UPGRADE [u(cobj,age)]=1

&STATUS`ARC_GRAPPLER`PUSH_ON_ACTIVATE [u(Cobj,age)]=@select/inline eq(%2,5)=0,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GRAPPLER_PUSH,,1,0;@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(hw,%n)] gains a bonus to Precision!}
&STATUS`ARC_GRAPPLER`ON_OPPONENT_KILL_STATUS [u(cobj,age)]
@@ @select/inline t(match(v(STATUS`[before(%3,$)]`TAGS),DEBUFF))=1,{@attach %!/INC`HYPE=%0,1,GRAPPLER}

&STATUS`ARC_GRAPPLER_PUSH [u(Cobj,age)]=Grappler-Push
&STATUS`ARC_GRAPPLER_PUSH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GRAPPLER_PUSH`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GRAPPLER_PUSH`DESCRIPTION [u(cobj,age)]=Minor Buff to Precision
&STATUS`ARC_GRAPPLER_PUSH`BREAK`INTENSITY [u(cobj,age)]=Minor
&STATUS`ARC_GRAPPLER_PUSH`TYPE [u(cobj,age)]=IGNORE

&STATUS`ARC_GRAPPLER_READY [u(cobj,age)]=Grappler-Ready
&STATUS`ARC_GRAPPLER_READY`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_GRAPPLER_[get(%0/%q<atk>`STATUS`%1`STAT)],,get(%0/%q<atk>`STATUS`%1`A_TURNS),get(%0/%q<atk>`STATUS`%1`D_TURNS);@attach %!/INC`EANNOUNCE=GRAPPLER,[ansi(hw,%n)] suffers a [capstr(get(%0/%q<atk>`STATUS`%1`STAT))] debuff!

&STATUS`ARC_GRAPPLER_PRECISION [u(Cobj,age)]=Grappler-PrecisionDebuff
&STATUS`ARC_GRAPPLER_PRECISION`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_GRAPPLER_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_PRECISION`DESCRIPTION [u(cobj,age)]=Significant Penalty to Precision
&STATUS`ARC_GRAPPLER_PRECISION`TYPE [u(cobj,age)]=ADD

&STATUS`ARC_GRAPPLER_POWER [u(cobj,age)]=Grappler-PowerDebuff
&STATUS`ARC_GRAPPLER_POWER`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_GRAPPLER_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_POWER`DESCRIPTION [u(cobj,age)]=Significant Penalty to Power
&STATUS`ARC_GRAPPLER_POWER`TYPE [u(cobj,age)]=ADD

&STATUS`ARC_GRAPPLER_ENDURANCE [u(cobj,age)]=Grappler-EnduranceDebuff
&STATUS`ARC_GRAPPLER_ENDURANCE`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_GRAPPLER_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_ENDURANCE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Endurance
&STATUS`ARC_GRAPPLER_ENDURANCE`TYPE [u(cobj,age)]=ADD

&STATUS`ARC_GRAPPLER_MITIGATION [u(cobj,age)]=Grappler-MitigationDebuff
&STATUS`ARC_GRAPPLER_MITIGATION`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_GRAPPLER_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_GRAPPLER_MITIGATION`DESCRIPTION [u(cobj,age)]=Significant Penalty to Mitigation
&STATUS`ARC_GRAPPLER_MITIGATION`TYPE [u(cobj,age)]=ADD

&STATUS`ARC_GHOST [u(cobj,age)]=Ghost
&STATUS`ARC_GHOST`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=th u(setq,ghost_downgrade,lte(u(setr,ghostrand,rand(1,100)),u(setr,ghostcheck,switch(%q<def>,1,20,2,20,3,25,4,25,5,30))));@select/inline cand(%q<hitmul>,%q<ghost_downgrade>)=1,{th u(setq,hitmul,switch(%q<hitmul>,0.0,0.0,0.4,0,0.7,0.4,1.0,0.7));@attach %!/INC`EANNOUNCE=GHOST,[ansi(hw,%n)] somehow eludes the brunt of the attack! Severity downgraded!};@attach %!/INC`DEBUG=GHOST,Hit Downgrade Rand: %q<ghostrand>/%q<ghostcheck>;th unsetq(ghostrand ghostcheck)
&STATUS`ARC_GHOST`DEFENSE_PRE_REROLL [u(cobj,age)]=@select/inline cand(not(%q<hitmul>),match(3 4,%q<def>))=1,{th u(setq,disablereroll,1)}
&STATUS`ARC_GHOST`DEFENSE_ON_MISS [u(cobj,age)]=@select/inline %q<def>=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GHOST_BUFF,,1,0;@attach %!/INC`EANNOUNCE=GHOST,[ansi(h,%n)] phases to a better vantage for attack. Major bonus to Power!},2,{@attach %!/INC`SETSTATUS=%0,%0,ARC_GHOST_BUFF,,1,0;@attach %!/INC`EANNOUNCE=GHOST,[ansi(h,%n)] phases to a better vantage for attack. Major bonus to Power!},5,{@attach %!/INC`HYPE=%0,1,GHOST}
&STATUS`ARC_GHOST`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`ARC_GHOST`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(%q<def>,5,Significant,0)
&STATUS`ARC_GHOST`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`ARC_GHOST_BUFF [u(Cobj,age)]=Ghost-PowerBuff
&STATUS`ARC_GHOST_BUFF`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Major
&STATUS`ARC_GHOST_BUFF`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`ARC_GHOST_BUFF`DESCRIPTION [u(cobj,age)]=Major Bonus to Power
&STATUS`ARC_GHOST_BUFF`BREAK`INTENSITY [u(Cobj,age)]=Major

&STATUS`ARC_GLASSCANNON [u(cobj,age)]=Glass Cannon
&STATUS`ARC_GLASSCANNON`STATIC`MAXIMUM`HP [u(cobj,age)]=-100
&STATUS`ARC_GLASSCANNON`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Major
&STATUS`ARC_GLASSCANNON`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Major
&STATUS`ARC_GLASSCANNON`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GLASSCANNON_FOCUS,,1,1
&STATUS`ARC_GLASSCANNON`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_GLASSCANNON_BOLSTER,,1,1

&STATUS`ARC_GLASSCANNON_FOCUS [u(Cobj,age)]=Glass Cannon-Focus
&STATUS`ARC_GLASSCANNON_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_FOCUS`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GLASSCANNON_FOCUS`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision, Minor Penalty to Endurance
&STATUS`ARC_GLASSCANNON_FOCUS`BREAK`INTENSITY [u(Cobj,age)]=Minor

&STATUS`ARC_GLASSCANNON_BOLSTER [u(Cobj,age)]=Glass Cannon-Bolster
&STATUS`ARC_GLASSCANNON_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_GLASSCANNON_BOLSTER`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_GLASSCANNON_BOLSTER`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision, Minor Penalty to Mitigation
&STATUS`ARC_GLASSCANNON_BOLSTER`BREAK`INTENSITY [u(Cobj,age)]=Minor

&STATUS`ARC_HOTBLOODED [u(Cobj,age)]=Hot Blooded
&STATUS`ARC_HOTBLOODED`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(match(LAGGING OVEREXTENDED,get(%0/D`COMBAT`DRIVE`STATUS)),u(cust,DRIVES,get(%0/D`COMBAT`DRIVE`STATUS)`ATTACK`PENALTY`STAT`0))
&STATUS`ARC_HOTBLOODED`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(match(LAGGING OVEREXTENDED,get(%0/D`COMBAT`DRIVE`STATUS)),u(cust,DRIVES,get(%0/D`COMBAT`DRIVE`STATUS)`ATTACK`PENALTY`STAT`2))
&STATUS`ARC_HOTBLOODED`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(match(LAGGING OVEREXTENDED,u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS))),u(cust,DRIVES,u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS))`DEFENSE`PENALTY`STAT`1))
&STATUS`ARC_HOTBLOODED`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(match(LAGGING OVEREXTENDED,u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS))),u(cust,DRIVES,u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS))`DEFENSE`PENALTY`STAT`3))



&STATUS`ARC_HOTBLOODED`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_HOTBLOODED_CONSISTENT,,1,0
&STATUS`ARC_HOTBLOODED`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_HOTBLOODED_FORCEFUL,,1,0
&STATUS`ARC_HOTBLOODED`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_HOTBLOODED`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Minor
&STATUS`ARC_HOTBLOODED`ATTACK`OVEREXERT_MAX_PERCENTAGE [u(cobj,age)]=0.1

&STATUS`ARC_HOTBLOODED_CONSISTENT [u(Cobj,age)]=Hot Blooded-Consistent
&STATUS`ARC_HOTBLOODED_CONSISTENT`ATTACK`DRIVE_COST [u(cobj,age)]=-5

&STATUS`ARC_HOTBLOODED_FORCEFUL [u(Cobj,age)]=Hot Blooded-Forceful
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`DRIVE_COST [u(cobj,age)]=5
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_HOTBLOODED_FORCEFUL`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant


&STATUS`ARC_IMMORTAL [u(Cobj,age)]=Immortal
&STATUS`ARC_IMMORTAL`TAGS [u(cobj,age)]=FIFO_DAMAGE
&STATUS`ARC_IMMORTAL`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_IMMORTAL`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_IMMORTAL`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`ARC_IMMORTAL`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(u(setr,arcreg,u(pop,%0,D`COMBAT`STATUS`%1`FIFO_DAMAGE)),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(%q<arcreg>,u(scatter,14)),0)),,IMMORTAL REGENERATION,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed arcreg)}


&STATUS`ARC_JUGGERNAUT [u(cobj,age)]=Juggernaut
&STATUS`ARC_JUGGERNAUT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_JUGGERNAUT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_JUGGERNAUT`STATIC`MAXIMUM`HP [u(cobj,age)]=120
&STATUS`ARC_JUGGERNAUT`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_GUARD,,0,1
&STATUS`ARC_JUGGERNAUT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_MANEUVER,,0,1
&STATUS`ARC_JUGGERNAUT`DEF`5`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_JUGGERNAUT_RALLY,,0,1;

&STATUS`ARC_JUGGERNAUT_GUARD [u(cobj,age)]=Juggernaut-Guard
&STATUS`ARC_JUGGERNAUT_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_JUGGERNAUT_GUARD`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline and(gte(%q<hitmul>,1.0),lte(u(setr,jugrand,rand(1,100)),75))=1,{th u(setq,hitmul,0.7);@attach %!/INC`EANNOUNCE=JUGGERNAUT,[ansi(hw,%n)] plows through the attack without exposing weakness! Critical Hit downgraded.};@attach %!/INC`DEBUG=JUGGERNAUT,Critical Hit Downgrade Rand: %q<jugrand>;th unsetq(jugrand)

&STATUS`ARC_JUGGERNAUT_MANEUVER [u(cobj,age)]=Juggernaut-Maneuver
&STATUS`ARC_JUGGERNAUT_MANEUVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_JUGGERNAUT_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_JUGGERNAUT_RALLY [u(cobj,age)]=Juggernaut-Rally
&STATUS`ARC_JUGGERNAUT_RALLY`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Minor
&STATUS`ARC_JUGGERNAUT_RALLY`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`HEAL=%0,u(setr,jugheal,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,12)),0)),,JUGGERNAUT,[ansi(hw,name(%0))] readies for more action... and regenerates [ansi(h,%q<jugheal> HP)]!;th unsetq(jugheal)



&STATUS`ARC_OPERATOR [u(cobj,age)]=Operator
&STATUS`ARC_OPERATOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_FOCUSBOLSTER,,1,0
&STATUS`ARC_OPERATOR`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_FOCUSBOLSTER,,1,0
&STATUS`ARC_OPERATOR`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_GUARDMANEUVER,,0,1
&STATUS`ARC_OPERATOR`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_GUARDMANEUVER,,0,1
&STATUS`ARC_OPERATOR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_OPERATOR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`ARC_OPERATOR_FOCUSBOLSTER [u(cobj,age)]=Operator-FocusBolster
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`ATTACK_ON_MISS [u(cobj,age)]=@dolist/inline get(%#/%q<atk>`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_INFLICT_STATUS=%#,%i0};@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,name(%q<atker>))]'s tactics will not be shut down that easily!
&STATUS`ARC_OPERATOR_FOCUSBOLSTER`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select gte(fdiv(%q<damage>,get(%0/D`COMBAT`HEALTH`ORIGINAL)),0.2)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_OPERATOR_DEBUFF_OFFENSE,,1,0;@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,%n)] now suffers a Significant penalty to Offense!}

&STATUS`ARC_OPERATOR_GUARDMANEUVER [u(Cobj,age)]=Operator-GuardManeuver
&STATUS`ARC_OPERATOR_GUARDMANEUVER`DEFENSE_ON_MISS [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,-5,OPERATOR
&STATUS`ARC_OPERATOR_GUARDMANEUVER`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select lt(fdiv(%q<damage>,get(%0/D`COMBAT`HEALTH`ORIGINAL)),0.2)=1,{@attach %!/INC`SETSTATUS=%q<atker>,%q<atker>,ARC_OPERATOR_DEBUFF_DEFENSE,,0,1;@attach %!/INC`EANNOUNCE=OPERATOR,[ansi(hw,%n)] now suffers a Significant penalty to Defense!}

&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE [u(cobj,age)]=Operator-DebuffOffense
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`TAGS [u(cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Power and Precision
&STATUS`ARC_OPERATOR_DEBUFF_OFFENSE`CURE`INTENSITY [u(cobj,age)]=Significant

&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE [u(cobj,age)]=Operator-DebuffDefense
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Solid
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`DESCRIPTION [u(cobj,age)]=Significant Penalty to Endurance and Mitigation
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`TAGS [u(cobj,age)]=DISPLAY DEBUFF
&STATUS`ARC_OPERATOR_DEBUFF_DEFENSE`CURE`INTENSITY [u(cobj,age)]=Significant

&STATUS`ARC_PREDATOR [u(cobj,age)]=Predator
&STATUS`ARC_PREDATOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_INFLICT,,1,0
&STATUS`ARC_PREDATOR`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,PREDATOR;@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_MANEUVER,,1,1
&STATUS`ARC_PREDATOR`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PREDATOR_RALLY,,0,1
&STATUS`ARC_PREDATOR`STATIC`MAXIMUM`HP [u(cobj,age)]=-50
&STATUS`ARC_PREDATOR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_PREDATOR_INFLICT [u(cobj,age)]=Predator-Inflict
&STATUS`ARC_PREDATOR_INFLICT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline t(%q<damage>)=1,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_PREDATOR_DOT,DAMAGE=%q<damage>|INCREMENT=-[get(%0/D`COMBAT`OPPONENTS)],0,mul(4,get(%0/D`COMBAT`OPPONENTS));@attach %!/INC`EANNOUNCE=PREDATOR,[ansi(hw,%n)] now sports an aggravated\, bloody wound!}

&STATUS`ARC_PREDATOR_DOT [u(cobj,age)]=Predator-DoT
&STATUS`ARC_PREDATOR_DOT`TAGS [u(cobj,age)]=DOT DISPLAY
&STATUS`ARC_PREDATOR_DOT`DEFENSE`DOT [u(cobj,age)]=if(cand(eq(mod(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0),gte(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),0)),bound(floor(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,24,1,7,2,7)))),0),0)

&STATUS`ARC_PREDATOR_DOT`TAGS [u(Cobj,age)]=DOT DISPLAY
&STATUS`ARC_PREDATOR_DOT`DESCRIPTION [u(Cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_PREDATOR_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Substantial,1,Small,2,Small)


&STATUS`ARC_PREDATOR_MANEUVER [u(Cobj,age)]=Predator-Maneuver
&STATUS`ARC_PREDATOR_MANEUVER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`ARC_PREDATOR_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_PREDATOR_MANEUVER`DESCRIPTION [u(cobj,age)]=Significant Bonus to Precision
&STATUS`ARC_PREDATOR_MANEUVER`TAGS [u(cobj,age)]=BUFF DISPLAY
&STATUS`ARC_PREDATOR_MANEUVER`BREAK`INTENSITY [u(cobj,age)]=Significant

&STATUS`ARC_PREDATOR_RALLY [u(cobj,age)]=Predator-Rally
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=5
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_PREDATOR_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate


&STATUS`ARC_SHOWOFF [u(cobj,age)]=Showoff
&STATUS`ARC_SHOWOFF`STATIC`MAXIMUM`HYPE [u(cobj,age)]=15
&STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,OFF_DRAMATIC,,1,0;@dolist/inline setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1)={@attach %!/STATUS`[before(%i0,$)]`OFF`5`ACTIVATE=%0,%i0}
&STATUS`ARC_SHOWOFF`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`ARC_SHOWOFF`OFF`1`ACTIVATE
&STATUS`ARC_SHOWOFF`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline gt(u(setr,showdef,round(switch(get(%0/D`COMBAT`HYPE),>=[mul(20,get(%0/D`COMBAT`OPPONENTS))],20,>=[mul(15,get(%0/D`COMBAT`OPPONENTS))],15,>=[mul(10,get(%0/D`COMBAT`OPPONENTS))],10,>=[mul(5,get(%0/D`COMBAT`OPPONENTS))],5),0)),0)=1,{th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,showoffdefmul,u(scatter,%q<showdef>))));@attach %!/INC`EANNOUNCE=SHOWOFF,Oh yeah! [ansi(hw,%n)] is feeling it! [switch(%q<showdef>,80,Substantial,85,Considerable,90,Standard,95,Small)] Bonus to Defense!,%0;@attach %!/INC`DEBUG=SHOWOFF,Defense Decrease Damage Multiplier: %q<showoffdefmul>;th unsetq(showoffdefmul showdef)}
&STATUS`ARC_SHOWOFF`PUSH_ON_ACTIVATE [u(cobj,age)]=@select/inline %q<starthype>=>4,{th u(setq,showoffmul,0);@dolist/inline sort(squish(switchall(%q<starthype>,>=5,%B5%B,>=10,%B10%B,>=15,%B15%B)),-n)={@select/inline lt(%q<afterhype>,%i0)=1,{th u(setq,showoffmul,add(%q<showoffmul>,switch(%i0,5,18,10,14,15,10)))}};@select/inline gt(%q<showoffmul>,0)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_SHOWOFF_HYPEBOOST,MULTIPLIER=%q<showoffmul>,get(%0/D`COMBAT`OPPONENTS),0;@attach %!/INC`EANNOUNCE=SHOWOFF,Oh yeah! [ansi(hw,%n)] is feeling it! Bonus to damage!}}

&STATUS`ARC_SHOWOFF_HYPEBOOST [u(cobj,age)]=Showoff-HypeBoost
&STATUS`ARC_SHOWOFF_HYPEBOOST`TAGS [u(cobj,age)]=DISPLAY
&STATUS`ARC_SHOWOFF_HYPEBOOST`DESCRIPTION [u(Cobj,age)]=Increases Attack Power
&STATUS`ARC_SHOWOFF_HYPEBOOST`ATTACK_INCREASE_DAMAGE [u(cobj,age)]=th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,get(%0/%q<atk>`STATUS`%1`MULTIPLIER))))



&STATUS`ARC_SNIPER [u(cobj,age)]=Sniper
&STATUS`ARC_SNIPER`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_FOCUS,,1,0;
&STATUS`ARC_SNIPER`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_MANEUVER,,1,0;
&STATUS`ARC_SNIPER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SNIPER`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`ARC_SNIPER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`ARC_SNIPER`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)


&STATUS`ARC_SNIPER_FOCUS [u(cobj,age)]=Sniper-Focus
&STATUS`ARC_SNIPER_FOCUS`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline gte(%q<hitmul>,1)=1,{@attach %!/INC`SETSTATUS=%0,%0,ARC_SNIPER_DEBUFF,,1,2;@attach %!/INC`EANNOUNCE=SNIPER,[ansi(h,%n)] was soundly disoriented by [ansi(hw,name(%q<atker>))]'s attack! Moderate Penalty to all Stats for 1 round!}
&STATUS`ARC_SNIPER_FOCUS`ATTACK_REROLL [u(cobj,age)]=@select/inline not(%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=SNIPER,[ansi(hw,[name(%q<atker>)])] has them in [poss(%q<atker>)] sights! Attack re-rolled!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>}

&STATUS`ARC_SNIPER_MANEUVER [u(cobj,age)]=Sniper-Maneuver
&STATUS`ARC_SNIPER_MANEUVER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`ARC_SNIPER_MANEUVER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_SNIPER_DEBUFF [u(cobj,age)]=Sniper-Debuff
&STATUS`ARC_SNIPER_DEBUFF`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SNIPER_DEBUFF`TAGS [u(Cobj,age)]=DEBUFF DISPLAY
&STATUS`ARC_SNIPER_DEBUFF`DESCRIPTION [u(cobj,age)]=Moderate Penalty to All
&STATUS`ARC_SNIPER_DEBUFF`CURE`INTENSITY [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR [u(cobj,age)]=Survivor
&STATUS`ARC_SURVIVOR`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_FOCUS,,0,1
&STATUS`ARC_SURVIVOR`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_BOLSTER,,1,1
&STATUS`ARC_SURVIVOR`DEF`3`ACTIVATE [u(cobj,age)]=@select/inline t(match(PRIMED READY LAGGING,get(%0/D`COMBAT`DRIVE`STATUS)))=1,{@attach %!/INC`DRIVE=%0,-5,SURVIVOR};@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_GUARD,,0,1
&STATUS`ARC_SURVIVOR`DEF`4`ACTIVATE [u(cobj,age)]=@select/inline t(match(PRIMED READY LAGGING,get(%0/D`COMBAT`DRIVE`STATUS)))=1,{@attach %!/INC`DRIVE=%0,-5,SURVIVOR};@attach %!/INC`SETSTATUS=%0,%0,ARC_SURVIVOR_MANEUVER,,0,1
&STATUS`ARC_SURVIVOR`BELOW_75_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] hardens [poss(%0)] defense!
&STATUS`ARC_SURVIVOR`BELOW_50_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] holds on even harder now! Defense up!
&STATUS`ARC_SURVIVOR`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=SURVIVOR,[ansi(hw,name(%0))] will not fall here! Defense skyrockets!

&STATUS`ARC_SURVIVOR`STATIC`MAXIMUM`HP [u(cobj,age)]=100
&STATUS`ARC_SURVIVOR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(lt(u(setr,perc,u(percent,%0)),0.25),Major,if(lt(%q<perc>,0.5),Significant,if(lt(%q<perc>,0.75),Solid,Moderate)))
&STATUS`ARC_SURVIVOR`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(lt(u(setr,perc,u(percent,%0)),0.25),Major,if(lt(%q<perc>,0.5),Significant,if(lt(%q<perc>,0.75),Solid,Moderate)))
&STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
@@ &STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=add(u(adj,Minor),if(lte(%q<atklevel>,2),fdiv(u(adj,Moderate),2)))
@@ &STATUS`ARC_SURVIVOR`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=add(u(adj,Minor),if(lte(%q<atklevel>,2),fdiv(u(adj,Moderate),2)))
@@ &STATUS`ARC_SURVIVOR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(gte(%q<atklevel>,3),fdiv(u(adj,Significant),2))
@@ &STATUS`ARC_SURVIVOR`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(gte(%q<atklevel>,3),fdiv(u(adj,Significant),2))

&STATUS`ARC_SURVIVOR_FOCUS [u(cobj,age)]=Survivor-Focus
&STATUS`ARC_SURVIVOR_FOCUS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_FOCUS`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR_BOLSTER [u(cobj,age)]=Survivor-Bolster
&STATUS`ARC_SURVIVOR_BOLSTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_BOLSTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_SURVIVOR_BOLSTER`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate

&STATUS`ARC_SURVIVOR_GUARD [u(cobj,age)]=Survivor-Guard
&STATUS`ARC_SURVIVOR_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant

&STATUS`ARC_SURVIVOR_MANEUVER [u(cobj,age)]=Survivor-Maneuver
&STATUS`ARC_SURVIVOR_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant



&STATUS`ARC_UNCONTROLLABLE [u(cobj,age)]=Uncontrollable
&STATUS`ARC_UNCONTROLLABLE`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_FOCUS,,1,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_BOLSTER,,1,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_GUARD,,0,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_MANEUVER,,0,1;
&STATUS`ARC_UNCONTROLLABLE`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_UNCONTROLLABLE_RALLY,,0,1;

&STATUS`ARC_UNCONTROLLABLE`STATIC`MAXIMUM`HP [u(cobj,age)]=400
&STATUS`ARC_UNCONTROLLABLE`STATIC`GAIN`DRIVE [u(cobj,age)]=10
&STATUS`ARC_UNCONTROLLABLE`STATIC`GAIN`HYPE [u(cobj,age)]=2
&STATUS`ARC_UNCONTROLLABLE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_UNCONTROLLABLE`ATTACK_END_TURN [u(cobj,age)]=@attach %!/INC`DAMAGE=%0,bound(round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),0.1),0),0),Uncontrollable

&STATUS`ARC_UNCONTROLLABLE_BOLSTER [u(cobj,age)]=Uncontrollable-Bolster
&STATUS`ARC_UNCONTROLLABLE_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_FOCUS [u(cobj,age)]=Uncontrollable-Focus
&STATUS`ARC_UNCONTROLLABLE_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_GUARD [u(cobj,age)]=Uncontrollable-Guard
&STATUS`ARC_UNCONTROLLABLE_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_MANEUVER [u(cobj,age)]=Uncontrollable-Maneuver
&STATUS`ARC_UNCONTROLLABLE_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Massive

&STATUS`ARC_UNCONTROLLABLE_RALLY [u(cobj,age)]=Uncontrollable-Rally
&STATUS`ARC_UNCONTROLLABLE_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=10

&STATUS`ARC_MEISTER [u(cobj,age)]=Meister
&STATUS`ARC_MEISTER`STATIC`MAXIMUM`SIGNATURES [u(cobj,age)]=1
&STATUS`ARC_MEISTER`STATIC`GAIN`DRIVE [u(cobj,age)]=2
&STATUS`ARC_MEISTER`STATIC`GAIN`HYPE [u(cobj,age)]=1
&STATUS`ARC_MEISTER`STATIC`MAXIMUM`HP [u(Cobj,age)]=100
&STATUS`ARC_MEISTER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_MEISTER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_MEISTER`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_MEISTER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_AEGIS [u(cobj,age)]=Aegis
&STATUS`ARC_AEGIS`SUPPORT [u(cobj,age)]=SUP_AEGIS
&STATUS`ARC_AEGIS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`ARC_AEGIS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_AEGIS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_AEGIS`STATIC`MAXIMUM`HP [u(cobj,age)]=75

&STATUS`SUP_AEGIS [u(cobj,age)]=Aegis-Support
&STATUS`SUP_AEGIS`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_AEGIS`DESCRIPTION [u(cobj,age)]=Standard Damage Reduction, 25% Chance to block Debuffs/DOTs.
&STATUS`SUP_AEGIS`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,aegisdefmul,u(scatter,10))));@attach %!/INC`DEBUG=AEGIS,Defense Decrease Damage Multiplier: %q<aegisdefmul>;th unsetq(aegisdefmul)
&STATUS`SUP_AEGIS`ON_GAIN_STATUS [u(cobj,age)]=@select/inline and(words(setinter(DEBUFF DOT,get(u(cobj,age)/STATUS`[before(%2,$)]`TAGS))),lte(u(setr,aegisblock,rand(1,100)),25))=1,{@attach %!/KILLSTATUS=%0,%2,1;@attach %!/INC`EANNOUNCE=AEGIS-SUPPORT,[ansi(hw,name(%0))] is protected from evil magic!};@attach %!/INC`DEBUG=AEGIS-SUPPORT,Block DebuffDot 1d100 Roll: %q<aegisblock>/25 \(Responding to %2\);th unsetq(aegisblock)


&STATUS`ARC_CONSPIRATOR [u(cobj,age)]=Conspirator
&STATUS`ARC_CONSPIRATOR`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`ARC_CONSPIRATOR`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`ARC_CONSPIRATOR`SUPPORT [u(Cobj,age)]=SUP_CONSPIRATOR

&STATUS`SUP_CONSPIRATOR [u(cobj,age)]=Conspirator-Support
&STATUS`SUP_CONSPIRATOR`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_CONSPIRATOR`DESCRIPTION [u(Cobj,age)]=Attacks inflict 2*AtkLevel Drive Damage and small DoT
&STATUS`SUP_CONSPIRATOR`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,mul(-2,%q<atklevel>),CONSPIRATOR;@attach %!/INC`SETSTATUS=[get(%0/%q<atk>`STATUS`%1`SOURCE)],%0,ARC_CONSPIRATOR_INFLICT,,1,0
&STATUS`SUP_CONSPIRATOR`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline %q<damage>=>0,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_CONSPIRATOR_DOT,DAMAGE=%q<damage>,0,2;@attach %!/INC`EANNOUNCE=CONSPIRATOR,[ansi(hw,name(%q<atker>))] has landed a crippling blow! [ansi(hw,%n)] now suffers from Damage over Time!}

&STATUS`ARC_CONSPIRATOR_INFLICT [u(cobj,age)]=Conspirator-Inflict
&STATUS`ARC_CONSPIRATOR_INFLICT`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,mul(-2,%q<atklevel>),CONSPIRATOR;
&STATUS`ARC_CONSPIRATOR_INFLICT`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@select/inline %q<damage>=>0,{@attach %!/INC`SETSTATUS=%0,%q<atker>,ARC_CONSPIRATOR_DOT,DAMAGE=%q<damage>|INCREMENT=0,0,mul(4,get(%0/D`COMBAT`OPPONENTS));@attach %!/INC`EANNOUNCE=CONSPIRATOR,[ansi(hw,name(%q<atker>))] has landed a crippling blow! [ansi(hw,%n)] will suffer from Damage over Time if not quickly cured!}

&STATUS`ARC_CONSPIRATOR_DOT [u(cobj,age)]=Conspirator-DoT
&STATUS`ARC_CONSPIRATOR_DOT`DEFENSE`DOT [u(cobj,age)]=if(eq(mod(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0),bound(round(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),u(scatter,switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,9,4))),0),0),0)

&STATUS`ARC_CONSPIRATOR_DOT`TAGS [u(Cobj,age)]=DOT DISPLAY
&STATUS`ARC_CONSPIRATOR_DOT`DESCRIPTION [u(Cobj,age)]=Inflicts DoT on Defense Phase
&STATUS`ARC_CONSPIRATOR_DOT`CURE`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`INCREMENT),0,Small,1,Small,Tiny)


&STATUS`ARC_ENGINEER [u(cobj,age)]=Engineer
&STATUS`ARC_ENGINEER`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_FOCUS,,1,0;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] may receive an attack severity upgrade!
&STATUS`ARC_ENGINEER`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_BOLSTER,,1,0;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] readies a flurry of extra attacks!
&STATUS`ARC_ENGINEER`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_GUARD,,0,1;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] is surrounded by a flickering\, unreliable barrier!
&STATUS`ARC_ENGINEER`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_MANEUVER,,0,1;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] may inflict backlash damage against level 3 attacks or lower. Watch out!
&STATUS`ARC_ENGINEER`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_ENGINEER_RALLY,,1,0;@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s will soars! Drive recovery bolstered.
&STATUS`ARC_ENGINEER`STATIC`GAIN`HYPE [u(cobj,age)]=1
&STATUS`ARC_ENGINEER`SUPPORT [u(Cobj,age)]=SUP_ENGINEER

&STATUS`SUP_ENGINEER [u(cobj,age)]=Engineer-Support
&STATUS`SUP_ENGINEER`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ENGINEER`DESCRIPTION [u(cobj,age)]=+1 Passive Hype Gain, benefits from Synergist Defense actions
&STATUS`SUP_ENGINEER`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,ENGINEER

&STATUS`SUP_ENGINEER_FOCUS [u(cobj,age)]=Engineer-Support-Focus
&STATUS`SUP_ENGINEER_FOCUS`ATTACK_INCREASE_HITMUL [u(cobj,age)]=@select/inline u(setr,enrand,rand(1,100))=<26,{th u(setq,hitmul,if(not(%q<hitmul>),0.4,switch(%q<hitmul>,0.4,0.7,0.7,1.0,1.0,1.0,1.0,%q<hitmul>)));@attach %!/INC`EANNOUNCE=ENGINEER-FOCUS,[ansi(hw,name(%q<atker>))] knows how to make 'em... and how to break 'em! Strike severity upgraded!},{@attach %!/INC`EANNOUNCE=ENGINEER-FOCUS,[ansi(hw,name(%q<atker>))] knows how to make 'em... but not this one!};@attach %!/INC`DEBUG=ENGINEER-FOCUS,Strike Severity Upgrade Rand (1d100): %q<enrand>/26

&STATUS`SUP_ENGINEER_BOLSTER [u(cobj,age)]=Engineer-Support-Bolster
&STATUS`SUP_ENGINEER_BOLSTER`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SUP_ENGINEER_BOLSTER`ATTACK_POST_DAMAGE [u(cobj,age)]=@select/inline %q<atklevel>=<5,{th u(setq,damage,round(mul(%q<damage>,1.[switch(u(setr,eatk,rand(1,3)),1,06,2,12,3,18,0)]),0));@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(%q<atker>))] flurries for %q<eatk> more strikes!},{@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,name(%q<atker>))] attempts to flurry... but fumbles instead!}

&STATUS`SUP_ENGINEER_GUARD [u(cobj,age)]=Engineer-Support-Guard
&STATUS`SUP_ENGINEER_GUARD`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SUP_ENGINEER_GUARD`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline u(setr,enmanrand,rand(1,100))=<51,{th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,engguarddmul,u(scatter,8))));@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,%n)] is girded within impregnable armor!},{@attach %!/INC`EANNOUNCE=ENGINEER-SUPPORT,[ansi(hw,%n)] is girded within mighty armor! ... But to no avail.};@attach %!/INC`DEBUG=ENGINEER-SUPPORT-GUARD,Damage Reduction Chance (1d100): %q<enmanrand>/51 - Defense Decrease Damage Multiplier: %q<engguardmul>;th unsetq(enmanrand engguardmul)

&STATUS`SUP_ENGINEER_MANEUVER [u(cobj,age)]=Engineer-Support-Maneuver
&STATUS`SUP_ENGINEER_MANEUVER`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SUP_ENGINEER_MANEUVER`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select/inline %q<atklevel>=<4,{@select/inline u(setr,enmanrand,rand(1,100))=<51,{@attach %!/INC`DAMAGE=%q<atker>,round(mul(%q<damage>,u(scatter,24)),0),Engineer Support Backlash},{@@ failure goes here};@attach %!/INC`DEBUG=ENGINEER-SUPPORT-MANEUVER,Backlash Damage Chance (1d100): %q<enmanrand>/51;th unsetq(enmanrand)}

&STATUS`SUP_ENGINEER_RALLY [u(cobj,age)]=Engineer-Support-Rally
&STATUS`SUP_ENGINEER_RALLY`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_CLOSE [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,5,ENGINEER
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_SOLID [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,10,ENGINEER
&STATUS`SUP_ENGINEER_RALLY`ATTACK_ON_CRITICAL [u(cobj,age)]=@attach %!/INC`DRIVE=%q<atker>,10,ENGINEER

&STATUS`ARC_ICON [u(cobj,age)]=Icon
&STATUS`ARC_ICON`SUPPORT [u(cobj,age)]=SUP_ICON
&STATUS`ARC_ICON`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=[get(%#/D`COMBAT`SUPPORTING)],5,ICON
&STATUS`ARC_ICON`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_FOCUSBOLSTER,,1,1
&STATUS`ARC_ICON`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_FOCUSBOLSTER,,1,1
&STATUS`ARC_ICON`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_GUARDMANEUVER,,1,1
&STATUS`ARC_ICON`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ICON_GUARDMANEUVER,,1,1
&STATUS`ARC_ICON`STATIC`GAIN`DRIVE [u(cobj,age)]=2

&STATUS`SUP_ICON [u(cobj,age)]=Icon-Support
&STATUS`SUP_ICON`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ICON`DESCRIPTION [u(Cobj,age)]=Minor Bonus to All Stats
&STATUS`SUP_ICON`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`SUP_ICON`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ICON_FOCUSBOLSTER [u(cobj,age)]=Icon-FocusBolster
&STATUS`ARC_ICON_FOCUSBOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_FOCUSBOLSTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`ARC_ICON_GUARDMANEUVER [u(cobj,age)]=Icon-GuardManeuver
&STATUS`ARC_ICON_GUARDMANEUVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_ICON_GUARDMANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor


&STATUS`ARC_MARTYR [u(Cobj,age)]=Martyr
&STATUS`ARC_MARTYR`SUPPORT [u(cobj,age)]=SUP_MARTYR
&STATUS`ARC_MARTYR`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_MARTYR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_MARTYR`STATIC`GAIN`DRIVE [u(Cobj,age)]=5
&STATUS`ARC_MARTYR`STATIC`MAXIMUM`HP [u(Cobj,age)]=-75

&STATUS`SUP_MARTYR [u(Cobj,age)]=Martyr-Support
&STATUS`SUP_MARTYR`DEFENSE_POST_DAMAGE [u(cobj,age)]=@select/inline cand(gte(%q<damage>,0),not(strmatch(get(%0/D`COMBAT`STATUS`%1`SOURCE),%0)),gte(u(percent,get(%0/D`COMBAT`STATUS`%1`SOURCE)),0))=1,{th u(setq,oridamage,%q<damage>);th u(setq,damage,round(mul(%q<oridamage>,sub(1.0,u(scatter,10))),0));@attach %!/INC`DAMAGE=get(%0/D`COMBAT`STATUS`%1`SOURCE),sub(%q<oridamage>,%q<damage>),Take One For the Team};
&STATUS`SUP_MARTYR`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`DRIVE=%0,5,MARTYR
&STATUS`SUP_MARTYR`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_MARTYR`DESCRIPTION [u(cobj,age)]=+5 Passive Drive gain, Synergist receives Standard portion of your injuries

&STATUS`ARC_MASTERMIND [u(cobj,age)]=Mastermind
&STATUS`ARC_MASTERMIND`SUPPORT [u(cobj,age)]=SUP_MASTERMIND
&STATUS`ARC_MASTERMIND`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_MASTERMIND`STATIC`GAIN`DRIVE [u(Cobj,age)]=-2
&STATUS`ARC_MASTERMIND`STATIC`GAIN`HYPE [u(Cobj,age)]=1

&STATUS`SUP_MASTERMIND [u(cobj,age)]=Mastermind-Support
&STATUS`SUP_MASTERMIND`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_MASTERMIND`DESCRIPTION [u(Cobj,age)]=Heal a Small amount of damage you inflict.
&STATUS`SUP_MASTERMIND`ATTACK_SPECIAL_DAMAGE [u(cobj,age)]=@select/inline gt(u(setr,healed,round(mul(add(%q<damage>,%q<dot>),u(scatter,8.5)),0)),0)=1,{@attach %!/INC`HEAL=%q<atker>,%q<healed>,,MASTERMIND-SUPPORT-ATTACK,[ansi(hw,name(%q<atker>))] regenerates [ansi(hg,%q<healed>)] HP!};th unsetq(healed)
&STATUS`SUP_MASTERMIND`DEFENSE_SPECIAL_DAMAGE [u(cobj,age)]=@select/inline gt(u(setr,healed,round(mul(%q<damage>,u(scatter,7)),0)),0)=1,{@attach %!/INC`HEAL=u(setr,healtarget,u(strfirstof,get(%0/D`COMBAT`STATUS`%1`SOURCE),%0)),%q<healed>,,MASTERMIND-SUPPORT-DEFENSE,[ansi(hw,name(%q<healtarget>))] regenerates [ansi(hg,%q<healed>)] HP!};th unsetq(healtarget healed)


&STATUS`ARC_PANACEA [u(cobj,age)]=Panacea
&STATUS`ARC_PANACEA`SUPPORT [u(cobj,age)]=SUP_PANACEA
&STATUS`ARC_PANACEA`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_CLEANSE,,0,1
&STATUS`ARC_PANACEA`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_CLEANSE,,0,1
&STATUS`ARC_PANACEA`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`DRIVE=%0,5,PANACEA
&STATUS`ARC_PANACEA`DEF`4`ACTIVATE [u(cobj,age)]=
&STATUS`ARC_PANACEA`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_PANACEA_RALLY,,0,1

&STATUS`ARC_PANACEA_RALLY [u(cobj,age)]=Panacea-Rally
&STATUS`ARC_PANACEA_RALLY`DEFENSE_END_TURN [u(cobj,age)]=@select/inline get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE)=>0,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,7.5)),0)),,PANACEA,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed)}
&STATUS`ARC_PANACEA_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`ARC_PANACEA_CLEANSE [u(cobj,age)]=Panacea-Cleanse
&STATUS`ARC_PANACEA_CLEANSE`DEFENSE_END_TURN [u(cobj,age)]=@select/inline words(u(setr,panclear,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF))))=>0,{@dolist/inline %q<panclear>={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=PANACEA,[ansi(h,%n)] is cleansed of Negative Effects!}

&STATUS`SUP_PANACEA [u(cobj,age)]=Panacea-Support
&STATUS`SUP_PANACEA`TAGS [u(cobj,age)]=SUPPORT DISPLAY FIFO_DAMAGE
&STATUS`SUP_PANACEA`DESCRIPTION [u(cobj,age)]=Regen a Small amount of suffered damage, Moderate Bonus to Endurance
&STATUS`SUP_PANACEA`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`SUP_PANACEA`ATTACK_END_TURN [u(cobj,age)]=@select/inline t(u(setr,suppan,u(pop,%0,D`COMBAT`STATUS`%1`FIFO_DAMAGE)))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(%q<suppan>,0.055),0)),,PANACEA,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed)}


&STATUS`ARC_OVERLORD [u(Cobj,age)]=Overlord
&STATUS`ARC_OVERLORD`SUPPORT [u(cobj,age)]=SUP_OVERLORD
&STATUS`ARC_OVERLORD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_OVERLORD`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_OVERLORD`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`SUP_OVERLORD [u(cobj,age)]=Overlord-Support
&STATUS`SUP_OVERLORD`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_OVERLORD`DESCRIPTION [u(cobj,age)]=For the Swarm! Your attacks empower your Synergist.
&STATUS`SUP_OVERLORD`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`SUP_OVERLORD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`SUP_OVERLORD`OFF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`DRIVE=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],5,OVERLORD
&STATUS`SUP_OVERLORD`OFF`2`ACTIVATE [u(Cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],2,OVERLORD
&STATUS`SUP_OVERLORD`OFF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],%0,SUP_OVERLORD_EFFICIENT,,2,0;@attach %!/INC`EANNOUNCE=OVERLORD-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`STATUS`%1`SOURCE)))]'s Precision is bolstered!
&STATUS`SUP_OVERLORD`OFF`4`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`STATUS`%1`SOURCE)],%0,SUP_OVERLORD_DRAMATIC,,2,0;@attach %!/INC`EANNOUNCE=OVERLORD-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`STATUS`%1`SOURCE)))]'s Power is bolstered!

&STATUS`SUP_OVERLORD_EFFICIENT [u(cobj,age)]=Overlord-Support-Efficient
&STATUS`SUP_OVERLORD_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_OVERLORD_DRAMATIC [u(cobj,age)]=Overlord-Support-Dramatic
&STATUS`SUP_OVERLORD_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate


&STATUS`ARC_ROYAL [u(Cobj,age)]=Royal
&STATUS`ARC_ROYAL`SUPPORT [u(cobj,age)]=SUP_ROYAL
&STATUS`ARC_ROYAL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_ROYAL`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor

&STATUS`ARC_ROYAL`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ROYAL_PRECISION,,2,0;@attach %!/INC`EANNOUNCE=ROYAL,[ansi(hw,name(%0))] enjoys a Minor Precision Boost!
&STATUS`ARC_ROYAL`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_ROYAL_PRECISION,,2,0;@attach %!/INC`EANNOUNCE=ROYAL,[ansi(hw,name(%0))] enjoys a Minor Precision Boost!
&STATUS`ARC_ROYAL`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,3,ROYAL
&STATUS`ARC_ROYAL`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=%0,1,ROYAL

&STATUS`ARC_ROYAL_PRECISION [u(cobj,age)]=Royal-Precision
&STATUS`ARC_ROYAL_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_ROYAL [u(cobj,age)]=Royal-Support
&STATUS`SUP_ROYAL`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_ROYAL`DESCRIPTION [u(cobj,age)]=+1 Passive Hype, +5 Passive Drive
&STATUS`SUP_ROYAL`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/INC`DRIVE=%0,5,ROYAL-SUPPORT;@attach %!/INC`HYPE=%0,1,ROYAL

&STATUS`ARC_SAINT [u(Cobj,age)]=Saint
&STATUS`ARC_SAINT`SUPPORT [u(cobj,age)]=SUP_SAINT
&STATUS`ARC_SAINT`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SAINT_FOCUSBOLSTER,,1,0;@attach %!/INC`EANNOUNCE=SAINT,[ansi(h,%n)]'s next attack shall damage Drive instead of HP!
&STATUS`ARC_SAINT`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`1`ACTIVATE
&STATUS`ARC_SAINT`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,ARC_SAINT_MANEUVERGUARDRALLY,,0,1;
&STATUS`ARC_SAINT`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`3`ACTIVATE
&STATUS`ARC_SAINT`DEF`5`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SAINT`DEF`3`ACTIVATE
&STATUS`ARC_SAINT`ON_GAIN_STATUS [u(cobj,age)]=@select/inline cand(lt(u(setr,saintblock,rand(1,100)),51),words(setinter(get(u(cobj,age)/%1`TAGS),DOT DEBUFF)),not(strmatch(%1,%0)))=1,{@attach %!/INC`SETSTATUS=%1,%0,[before(%2,$)],%3,%4,%5;@attach %!/INC`EANNOUNCE=[ansi(h,name(%0))] declares a pox on the wicked! [ansi(hw,name(%1))] develops the same condition.};@attach %!/INC`DEBUG=SAINT,Status Block (1d100): %q<saintblock>/51

&STATUS`ARC_SAINT`PRE_SET_STATUS [u(cobj,age)]=@select/inline cand(words(setinter(%3,BUFF)),strmatch(%0,%1))=1,{@select/inline gt(add(%4,get(u(cobj,age)/STATUS`%2`ATTACK_TURNS)),0)=1,{th u(setq,statusatkturns,1)};@select/inline gt(add(%5,get(u(cobj,age)/STATUS`%2`DEFENSE_TURNS)),0)=1,{th u(setq,statusdefturns,1)};@attach %!/INC`EANNOUNCE=SAINT,[ansi(h,%n)]'s mystical resolution further empowers Buffs to last one turn more.}

&STATUS`ARC_SAINT_FOCUSBOLSTER [u(cobj,age)]=Saint-FocusBolster
&STATUS`ARC_SAINT_FOCUSBOLSTER`ATTACK_NEGATE_DAMAGE [u(cobj,age)]=@select/inline gt(u(setr,ndrive,floor(fdiv(%q<damage>,15))),0)=1,{@attach %!/INC`DRIVE=%0,-%q<ndrive>,SAINT};th u(setq,damage,0);

&STATUS`ARC_SAINT_MANEUVERGUARDRALLY [u(cobj,age)]=Saint-ManeuverGuardRally
&STATUS`ARC_SAINT_MANEUVERGUARDRALLY`DEFENSE_NEGATE_DAMAGE [u(cobj,age)]=@select/inline u(setr,ndrive,div(u(setr,saintred,round(mul(%q<damage>,u(scatter,30)),0)),15))=>0,{@attach %!/INC`DRIVE=%0,mul(-1,%q<ndrive>),SAINT};th u(setq,damage,sub(%q<damage>,%q<saintred>));@attach %!/INC`EANNOUNCE=SAINT,[ansi(h,%n)]'s faith keeps them strong! [ansi(h,%q<saintred>)] damage prevented!

&STATUS`SUP_SAINT [u(cobj,age)]=Saint-Support
&STATUS`SUP_SAINT`TAGS [u(cobj,age)]=SUPPORT DISPLAY FIFO_DAMAGE
&STATUS`SUP_SAINT`DESCRIPTION [u(cobj,age)]=Regen a Standard amount of Damage you suffer.
&STATUS`SUP_SAINT`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(gt(u(percent,%0),0),u(setr,supreg,u(pop,%0,D`COMBAT`STATUS`%1`FIFO_DAMAGE)))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(%q<supreg>,u(scatter,14)),0)),,SAINT,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed supreg)}

&STATUS`ARC_SPOTTER [u(Cobj,age)]=Spotter
&STATUS`ARC_SPOTTER`SUPPORT [u(cobj,age)]=SUP_SPOTTER
&STATUS`ARC_SPOTTER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`ARC_SPOTTER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate
&STATUS`ARC_SPOTTER`STATIC`MAXIMUM`HP [u(cobj,age)]=-50
&STATUS`ARC_SPOTTER`DEF`1`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_[u(setr,ranoff,randword(CONSISTENT FORCEFUL EFFICIENT DRAMATIC))],,1,0;@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_[u(setr,randef,randword(FOCUS BOLSTER GUARD FOCUS RALLY))],,0,1;@attach %!/INC`EPRIVATE=SPOTTER-SUPPORT,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] gains a Bonus to %q<ranoff> Attacks and %q<randef> Defenses.,%0 get(%0/D`COMBAT`SUPPORTING)
&STATUS`ARC_SPOTTER`DEF`2`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SPOTTER`DEF`1`ACTIVATE
&STATUS`ARC_SPOTTER`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`SUPPORTING)],2,SPOTTER
&STATUS`ARC_SPOTTER`DEF`4`ACTIVATE [u(Cobj,age)]=@attach %!/STATUS`ARC_SPOTTER`DEF`3`ACTIVATE
&STATUS`ARC_SPOTTER`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_SPOTTER_REROLL,,1,0;@attach %!/INC`EANNOUNCE=SPOTTER,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] is locked onto the foe with eagle eyes! Gains a chance to re-roll a miss.

&STATUS`SUP_SPOTTER_REROLL [u(cobj,age)]=Spotter-Support-Reroll
&STATUS`SUP_SPOTTER_REROLL`ATTACK_REROLL [u(cobj,age)]=@select/inline not(%q<hitmul>)=1,{@attach %!/INC`EANNOUNCE=SPOTTER-SUPPORT,[ansi(hw,[name(%q<atker>)])] stays on target!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>}

&STATUS`SUP_SPOTTER [u(cobj,age)]=Spotter-Support
&STATUS`SUP_SPOTTER`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_SPOTTER`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Precision
&STATUS`SUP_SPOTTER`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_SPOTTER_CONSISTENT [u(cobj,age)]=Spotter-Support-Consistent
&STATUS`SUP_SPOTTER_CONSISTENT`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_FORCEFUL [u(cobj,age)]=Spotter-Support-Forceful
&STATUS`SUP_SPOTTER_FORCEFUL`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_EFFICIENT [u(cobj,age)]=Spotter-Support-Efficient
&STATUS`SUP_SPOTTER_EFFICIENT`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_EFFICIENT`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)

&STATUS`SUP_SPOTTER_DRAMATIC [u(cobj,age)]=Spotter-Support-Dramatic
&STATUS`SUP_SPOTTER_DRAMATIC`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_DRAMATIC`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)

&STATUS`SUP_SPOTTER_FOCUS [u(cobj,age)]=Spotter-Support-Focus
&STATUS`SUP_SPOTTER_FOCUS`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_BOLSTER [u(cobj,age)]=Spotter-Support-Bolster
&STATUS`SUP_SPOTTER_BOLSTER`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_GUARD [u(cobj,age)]=Spotter-Support-Guard
&STATUS`SUP_SPOTTER_GUARD`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_MANEUVER [u(cobj,age)]=Spotter-Support-Maneuver
&STATUS`SUP_SPOTTER_MANEUVER`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid

&STATUS`SUP_SPOTTER_RALLY [u(cobj,age)]=Spotter-Support-Rally
&STATUS`SUP_SPOTTER_RALLY`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`SUP_SPOTTER_RALLY`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)


&STATUS`ARC_TACTICIAN [u(Cobj,age)]=Tactician
&STATUS`ARC_TACTICIAN`SUPPORT [u(cobj,age)]=SUP_TACTICIAN
&STATUS`ARC_TACTICIAN`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`ARC_TACTICIAN`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_TACTICIAN_CONSISTENT,,0,1;@attach %!/INC`EANNOUNCE=TACTICIAN,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] receives a Solid boost to Endurance and Mitigation!
&STATUS`ARC_TACTICIAN`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_TACTICIAN_FORCEFUL,,1,0;@attach %!/INC`EANNOUNCE=TACTICIAN,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))] receives a Moderate boost to Power and Precision!
&STATUS`ARC_TACTICIAN`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=[get(%0/D`COMBAT`SUPPORTING)],5,TACTICIAN
&STATUS`ARC_TACTICIAN`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=[get(%0/D`COMBAT`SUPPORTING)],2,TACTICIAN


&STATUS`SUP_TACTICIAN [u(cobj,age)]=Tactician-Support
&STATUS`SUP_TACTICIAN`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_TACTICIAN`DESCRIPTION [u(cobj,age)]=Minor Bonus to Precision
&STATUS`SUP_TACTICIAN`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_TACTICIAN_FORCEFUL [u(cobj,age)]=Tactician-Support-Forceful
&STATUS`SUP_TACTICIAN_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`SUP_TACTICIAN_FORCEFUL`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_TACTICIAN_CONSISTENT [u(cobj,age)]=Tactician-Support-Consistent
&STATUS`SUP_TACTICIAN_CONSISTENT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`SUP_TACTICIAN_CONSISTENT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid


&STATUS`ARC_WITCH [u(Cobj,age)]=Witch
&STATUS`ARC_WITCH`SUPPORT [u(cobj,age)]=SUP_WITCH
&STATUS`ARC_WITCH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`ARC_WITCH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`ARC_WITCH`BONUS`ATTACK`DRIVE_COST [u(cobj,age)]=-3
&STATUS`ARC_WITCH`STATIC`MAXIMUM`HP [u(Cobj,age)]=-25
&STATUS`ARC_WITCH`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_CONSISTENT,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall inflict a random Minor Debuff!
&STATUS`ARC_WITCH`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_FORCEFUL,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall heal [ansi(hw,%n)]!
&STATUS`ARC_WITCH`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=[get(%0/D`COMBAT`SUPPORTING)],%0,SUP_WITCH_DRAMATIC,,1,0;@attach %!/INC`EANNOUNCE=WITCH,[ansi(hw,name(get(%0/D`COMBAT`SUPPORTING)))]'s next attack shall drain Hype on a Solid hit or better!
&STATUS`ARC_WITCH`ATTACK`DRIVE_COST [u(cobj,age)]=-3

&STATUS`SUP_WITCH [u(cobj,age)]=Witch-Support
&STATUS`SUP_WITCH`TAGS [u(cobj,age)]=SUPPORT DISPLAY
&STATUS`SUP_WITCH`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Precision and Power
&STATUS`SUP_WITCH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`SUP_WITCH`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`SUP_WITCH_CONSISTENT [u(cobj,age)]=Witch-Support-Consistent
&STATUS`SUP_WITCH_CONSISTENT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,SUP_WITCH_DEBUFF_[u(setr,witchrand,randword(POWER ENDURANCE PRECISION MITIGATION))],,1,1;@attach %!/INC`EANNOUNCE=WITCH-SUPPORT,[ansi(hw,name(%0))] now suffers from a Minor [capstr(%q<witchrand>)] Debuff!

&STATUS`SUP_WITCH_DEBUFF_POWER [u(cobj,age)]=Witch-Support-Debuff-Power
&STATUS`SUP_WITCH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_ENDURANCE [u(cobj,age)]=Witch-Support-Debuff-Endurance
&STATUS`SUP_WITCH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_PRECISION [u(cobj,age)]=Witch-Support-Debuff-Precision
&STATUS`SUP_WITCH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_DEBUFF_MITIGATION [u(cobj,age)]=Witch-Support-Debuff-Mitigation
&STATUS`SUP_WITCH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

&STATUS`SUP_WITCH_FORCEFUL [u(cobj,age)]=Witch-Support-Forceful
&STATUS`SUP_WITCH_FORCEFUL`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`HEAL=%q<atker>,u(setr,healed,round(mul(%q<damage>,u(scatter,4.5)),0)),,WITCH,[ansi(hw,name(%q<atker>))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed)

&STATUS`SUP_WITCH_DRAMATIC [u(cobj,age)]=Witch-Support-Dramatic
&STATUS`SUP_WITCH_DRAMATIC`ATTACK_ON_CRITICAL [u(Cobj,age)]=@attach %!/INC`HYPE=%0,-1,WITCH
&STATUS`SUP_WITCH_DRAMATIC`ATTACK_ON_SOLID [u(Cobj,age)]=@attach %!/INC`HYPE=%0,-1,WITCH

@@ STATUS - Quirks - Offense

&STATUS`QRK_AIMASSIST [u(cobj,age)]=Aim Assist
&STATUS`QRK_AIMASSIST`ATTACK_REROLL [u(cobj,age)]=@select/inline cand(not(%q<hitmul>),not(gte(get(%q<atker>/D`COMBAT`STATUS`%1`USED),get(%q<atker>/D`COMBAT`OPPONENTS))),gt(%q<atklevel>,1))=1,{@attach %!/INC`EANNOUNCE=AIM ASSIST,[ansi(hw,[name(%q<atker>)])] sacrifices attack power to stays on target!;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>;th u(addto,%q<atker>,D`COMBAT`STATUS`%1`USED,1);th u(setq,aimassist,1)}
&STATUS`QRK_AIMASSIST`ATTACK_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline t(%q<aimassist>)=1,{th u(setq,atkdecdamagemul,linsert(%q<atkdecdamagemul>,-1,0.5));@attach %!/INC`DEBUG=AIM ASSIST,Attack Decrease Damage Multiplier: 0.5}

&STATUS`QRK_CALIBRATEDWEAPONRY [u(cobj,age)]=Calibrated Weaponry
&STATUS`QRK_CALIBRATEDWEAPONRY`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`QRK_CALIBRATEDWEAPONRY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_CALIBRATEDWEAPONRY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_CERTAINKILL [u(cobj,age)]=Certain Kill
&STATUS`QRK_CERTAINKILL`ATTACK_ON_CRITICAL [u(cobj,age)]=@select/inline %q<orighitmul>=1.0,{@attach %!/INC`EANNOUNCE=CERTAIN KILL,[ansi(hw,name(%q<atker>))]'s blows strike with deadly precision! Critical Damage increased!;th u(setq,incdamagemul,add(%q<incdamagemul>,u(scatter,15)))}
&STATUS`QRK_CERTAINKILL`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_ELEGANTSTANCE [u(cobj,age)]=Elegant Stance
&STATUS`QRK_ELEGANTSTANCE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_ELEGANTSTANCE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Significant
&STATUS`QRK_ELEGANTSTANCE`BANNED`OFF [u(cobj,age)]=2

&STATUS`QRK_EXPERIMENTALWEAPONRY [u(cobj,age)]=Experimental Weaponry
&STATUS`QRK_EXPERIMENTALWEAPONRY`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_EXPERIMENTALWEAPONRY_CONSISTENT_[if(lte(u(setr,experrand,rand(1,100)),75),BONUS,PENALTY)],,1,0;@attach %!/INC`DEBUG=EXPERIMENTAL WEAPONRY,Consistent Bonus/Penalty Chance 1d100: %q<experrand>/75;th unsetq(experrand)
&STATUS`QRK_EXPERIMENTALWEAPONRY`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_EXPERIMENTALWEAPONRY_FORCEFUL_[if(lte(u(setr,experrand,rand(1,100)),75),BONUS,PENALTY)],,1,0;@attach %!/INC`DEBUG=EXPERIMENTAL WEAPONRY,Forceful Bonus/Penalty Chance 1d100: %q<experrand>/75;th unsetq(experrand)

&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS [u(cobj,age)]=Experimental Weaponry-Consistent-Bonus
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Solid
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved beneficial! Solid Bonus!

&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY [u(cobj,age)]=Experimental Weaponry-Consistent-Penalty
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY`STATUS`OFF_CONSISTENT`ATTACK`PENALTY`STAT`2 [u(Cobj,age)]=Minor
&STATUS`QRK_EXPERIMENTALWEAPONRY_CONSISTENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved troublesome! Minor Penalty!

&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS [u(cobj,age)]=Experimental Weaponry-Forceful-Bonus
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(Cobj,age)]=Solid
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved beneficial! Solid Bonus!

&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY [u(cobj,age)]=Experimental Weaponry-Consistent-Penalty
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY`STATUS`OFF_FORCEFUL`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Minor
&STATUS`QRK_EXPERIMENTALWEAPONRY_FORCEFUL_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=EXPERIMENTAL WEAPONRY,[ansi(hw,%n)]'s souped-up gear proved troublesome! Minor Penalty!

&STATUS`QRK_EXSANGUINATION [u(cobj,age)]=Exsanguination
&STATUS`QRK_EXSANGUINATION`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT))=>0,{th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,u(setr,exsangmul,u(scatter,8))));@attach %!/INC`EANNOUNCE=EXSANGUINATION,[ansi(hw,name(%q<atker>))]'s blows savage [ansi(h,%n)]'s aggravated wounds! Small bonus to damage!;@attach %!/INC`DEBUG=EXSANGUINATION,Attack Increase Damage Multiplier: %q<exsangmul>;th unsetq(exsangmul)}
&STATUS`QRK_EXSANGUINATION`ON_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(%4,words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DOT)))=1,{@attach %!/INC`HYPE=%0,1,EXSANGUINATION}

&STATUS`QRK_HEAVYWEAPONRY [u(cobj,age)]=Heavy Weaponry
&STATUS`QRK_HEAVYWEAPONRY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_HEAVYWEAPONRY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_HEAVYWEAPONRY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Minor

&STATUS`QRK_HYPERMODE [u(cobj,age)]=Hyper Mode
&STATUS`QRK_HYPERMODE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_HYPERMODE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_HYPERMODE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`QRK_HYPERMODE`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_KEENEYE [u(cobj,age)]=Keen Eye
&STATUS`QRK_KEENEYE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`QRK_KILLERINSTINCT [u(cobj,age)]=Killer Instinct
&STATUS`QRK_KILLERINSTINCT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_KILLERINSTINCT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_LASTWORD [u(cobj,age)]=Last Word
&STATUS`QRK_LASTWORD`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Massive,0)
&STATUS`QRK_LASTWORD`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Massive,0)
&STATUS`QRK_LASTWORD`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=LAST WORD,[ansi(hw,name(%0))] readies for a last stand! Massive Bonus to Power and Precision!

&STATUS`QRK_MIGHTY [u(cobj,age)]=Mighty
&STATUS`QRK_MIGHTY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`QRK_MOMENTUM [u(cobj,age)]=Momentum
&STATUS`QRK_MOMENTUM`DEFENSE_ON_SOLID [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_MOMENTUM_BONUS,,1,0;@attach %!/INC`EANNOUNCE=MOMENTUM,[ansi(h,%n)] readies a retaliation! Significant Bonus to Power!
&STATUS`QRK_MOMENTUM`DEFENSE_ON_CRITICAL [u(cobj,age)]=@attach %!/STATUS`QRK_MOMENTUM`DEFENSE_ON_SOLID

&STATUS`QRK_MOMENTUM_BONUS [u(cobj,age)]=Momentum-Bonus
&STATUS`QRK_MOMENTUM_BONUS`TYPE [u(Cobj,age)]=ADD
&STATUS`QRK_MOMENTUM_BONUS`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`QRK_MOMENTUM_BONUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_MOMENTUM_BONUS`BREAK`INTENSITY [u(cobj,age)]=Significant

&STATUS`QRK_PREDICTIVETARGETING [u(Cobj,age)]=Predictive Targeting
&STATUS`QRK_PREDICTIVETARGETING`ATTACK_REROLL [u(Cobj,age)]=@select/inline cand(lte(%q<hitmul>,0.4),lte(u(setr,predireroll,die(1,100)),u(setr,predivsroll,switch(%q<hitmul>,0.4,15,0.0,30,0))))=1,{@select/inline gt(u(setr,prediroll,die(1,100)),u(setr,predioldroll,%q<roll>))=1,{th u(setq,prediorighitmul,%q<hitmul>);@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>;@select/inline gt(%q<hitmul>,%q<prediorighitmul>)=1,{@attach %!/INC`EANNOUNCE=PREDICTIVE TARGETING,ansi(hw,name(%q<atker>)) saw through [ansi(hw,%n)]'s defense pattern and upgrades [poss(%q<atker>)] attack to a [switch(%q<hitmul>,1.0,Critical Hit,0.7,Solid Hit,0.4,Close Call,0.0,Miss)]!},0,{th u(setq,hitmul,%q<prediorighitmul>)}};@attach %!/INC`DEBUG=PREDICTIVE TARGETING,Best Attack Re-Roll die: %q<predireroll>/%q<predivsroll>. Old Roll (%q<predioldroll>) vs New Roll (%q<predinewroll>)};th unsetq(predireroll predivsroll prediroll predioldroll prediorighitmul)

&STATUS`QRK_RIPOSTE [u(cobj,age)]=Riposte
&STATUS`QRK_RIPOSTE`DEFENSE_ON_MISS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_RIPOSTE_BONUS,,1,0;@attach %!/INC`EANNOUNCE=RIPOSTE,[ansi(h,%n)] readies a retaliation! Significant Bonus to Precision!
&STATUS`QRK_RIPOSTE`DEFENSE_ON_CLOSE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_RIPOSTE_BONUS,,1,0;@attach %!/INC`EANNOUNCE=RIPOSTE,[ansi(h,%n)] readies a retaliation! Significant Bonus to Precision!

&STATUS`QRK_RIPOSTE_BONUS [u(cobj,age)]=Riposte-Bonus
&STATUS`QRK_RIPOSTE_BONUS`TYPE [u(cobj,age)]=ADD
&STATUS`QRK_RIPOSTE_BONUS`TAGS [u(cobj,age)]=DISPLAY BUFF
&STATUS`QRK_RIPOSTE_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Precision
&STATUS`QRK_RIPOSTE_BONUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`QRK_STIMULANTS [u(cobj,age)]=Stimulants
&STATUS`QRK_STIMULANTS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_STIMULANTS`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_STIMULANTS`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`QRK_TOXICITY [u(cobj,age)]=Toxicity
&STATUS`QRK_TOXICITY`BLOCK_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DOT DEBUFF)),eq(1,u(setr,toxicrand,rand(1,2))),not(get(%2/D`COMBAT`STATUS`%3`TOXICITY)))=1,{@attach %!/INC`EANNOUNCE=TOXICITY,[ansi(hw,name(get(%2/D`COMBAT`STATUS`%3`SOURCE)))] oozes with deadly poison! [ansi(hw,get(u(cobj,age)/STATUS`[before(%3,$)]))] will persist a little longer!;th u(setq,blockkill,1);th u(addto,%2,D`COMBAT`STATUS`%3`TOXICITY,1);@select/inline not(%4)=1,{th u(addto,%2,D`COMBAT`STATUS`%3`ATTACK_TURNS,1);th u(addto,%2,D`COMBAT`STATUS`%3`DEFENSE_TURNS,1)}};@attach %!/INC`DEBUG=TOXICITY,Block KillStatus Rand 1d2: %q<toxicrand>/1;th unsetq(toxicrand)

&STATUS`QRK_UNWIELDYSTRENGTH [u(cobj,age)]=Unwieldy Strength
&STATUS`QRK_UNWIELDYSTRENGTH`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Significant
&STATUS`QRK_UNWIELDYSTRENGTH`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_UNWIELDYSTRENGTH`BANNED`OFF [u(cobj,age)]=1

&STATUS`QRK_VERSATILEATTACKS [u(cobj,age)]=Versatile Attacks
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(Cobj,age)]=Moderate
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_VERSATILEATTACKS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_WITHERING [u(Cobj,age)]=Withering
&STATUS`QRK_WITHERING`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline words(get(%0/%q<atk>`ACTIVE`STATUS`TAGS`DEBUFF))=>0,{th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,witheringdefmul,u(scatter,7))));@attach %!/INC`DEBUG=WITHERING,Defense Decrease Damage Multiplier: %q<witheringdefmul>;th unsetq(witheringdefmul)}
&STATUS`QRK_WITHERING`ON_OPPONENT_KILL_STATUS [u(cobj,age)]=@select/inline cand(%4,words(setinter(get(u(cobj,age)/STATUS`[before(%3,$)]`TAGS),DEBUFF)))=1,{@attach %!/INC`HYPE=%0,1,WITHERING}


@@ STATUS - Quirks - Defense

&STATUS`QRK_ABLATIVEBARRIER [u(cobj,age)]=Ablative Barrier
&STATUS`QRK_ABLATIVEBARRIER`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline cand(gte(u(setr,oridamage,%q<damage>),300),not(get(%0/D`COMBAT`HISTORY`QRK_ABLATIVEBARRIER)))=1,{th u(setq,damage,sub(%q<damage>,60));th u(setq,damage,sub(%q<damage>,mul(10,floor(fdiv(%q<damage>,50)))));@attach %!/INC`EANNOUNCE=ABLATIVE BARRIER,Damage to [ansi(hw,%n)] reduced by [ansi(117,sub(%q<oridamage>,%q<damage>))] HP!;&D`COMBAT`HISTORY`QRK_ABLATIVEBARRIER %0=1}

&STATUS`QRK_ANTICIPATION [u(cobj,age)]=Anticipation
&STATUS`QRK_ANTICIPATION`DEFENSE_REROLL [u(cobj,age)]=@select/inline cand(gte(%q<hitmul>,0.7),lte(u(setr,antireroll,die(1,100)),u(setr,antivsroll,switch(%q<hitmul>,0.7,20,1.0,30,0))))=1,{@select/inline lt(u(setr,anticiroll,die(1,100)),u(setr,antioldroll,%q<roll>))=1,{th u(setq,antiorighitmul,%q<hitmul>);@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>;@select/inline lt(%q<hitmul>,%q<antiorighitmul>)=1,{@attach %!/INC`EANNOUNCE=ANTICIPATION,ansi(hw,%n) saw through [ansi(hw,name(%q<atker>))]'s attack and degraded it to a [switch(%q<hitmul>,0.7,Solid Hit,0.4,Close Call,0.0,Miss!)]},0,{th u(setq,hitmul,%q<antiorighitmul>)}};@attach %!/INC`DEBUG=ANTICIPATION,Best Defense Re-Roll die: %q<antireroll>/%q<antivsroll>. Old Roll (%q<antioldroll>) vs New Roll (%q<antinewroll>)};th unsetq(antireroll antivsroll anticiroll antioldroll antiorighitmul)

&STATUS`QRK_CLOAKING [u(cobj,age)]=Cloaking
&STATUS`QRK_CLOAKING`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline cand(eq(0.4,%q<hitmul>),lte(u(setr,cloakrand,rand(1,100)),30))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=CLOAKING,[ansi(hw,name(%0))] slips out of reach!};@attach %!/INC`DEBUG=CLOAKING,Random Check 1d100: %q<cloakrand>/30;th unsetq(cloakrand)
&STATUS`QRK_CLOAKING`STATIC`MAXIMUM`HP [u(cobj,age)]=-50

&STATUS`QRK_CONVENIENTKEEPSAKE [u(cobj,age)]=Convenient Keepsake
&STATUS`QRK_CONVENIENTKEEPSAKE`DEFENSE_POST_DAMAGE [u(cobj,age)]=th u(setq,keepsake,u(percent,%0,1))
&STATUS`QRK_CONVENIENTKEEPSAKE`DEFENSE_END_TURN [u(Cobj,age)]=@select/inline cand(cor(get(%0/D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE),cand(gte(%q<keepsake>,0.3),lte(u(percent,%0,1),0.0))),not(get(%0/D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE`END)))=1,{@attach %!/INC`EANNOUNCE=CONVENIENT KEEPSAKE,[name(%0)] holds on to [poss(%0)] very last Hit Point!;th u(addto,%0,D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE,1);@select/inline lte(u(percent,%0),0)=1,{&D`COMBAT`DAMAGE %0=sub(get(%0/D`COMBAT`HEALTH),1)}}
&STATUS`QRK_CONVENIENTKEEPSAKE`ATTACK_END_TURN [u(cobj,age)]=@select/inline get(%0/D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE)=>0,{@attach %!/INC`EANNOUNCE=CONVENIENT KEEPSAKE,[ansi(h,%n)] is no longer protected from defeat!;th u(addto,%0,D`COMBAT`HISTORY`QRK_CONVENIENTKEEPSAKE`END,1)}

&STATUS`QRK_FORTIFIEDDEFENSES [u(cobj,age)]=Fortified Defense
&STATUS`QRK_FORTIFIEDDEFENSES`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_FORTIFIEDDEFENSES`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline cand(gte(%q<hitmul>,1.0),lte(u(setr,fortrand,rand(1,100)),50))=1,{th u(setq,hitmul,0.7);@attach %!/INC`EANNOUNCE=FORTIFIED DEFENSES,[ansi(hw,name(%0))]'s protected from Critical Hits!};@attach %!/INC`DEBUG=FORTIFIED DEFENSES,Crit Downgrade Rand 1d100: %q<fortrand>/50;th unsetq(fortrand)

&STATUS`QRK_HEAVYARMOR [u(cobj,age)]=Heavy Armor
&STATUS`QRK_HEAVYARMOR`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`QRK_HEAVYARMOR`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_HITANDRUN [u(Cobj,age)]=Hit and Run
&STATUS`QRK_HITANDRUN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`QRK_HITANDRUN`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_HITANDRUN`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor

&STATUS`QRK_IMMUNIZED [u(cobj,age)]=Immunized
&STATUS`QRK_IMMUNIZED`ON_GAIN_STATUS [u(Cobj,age)]=@select/inline cand(words(setinter(DOT DEBUFF,get(u(cobj,age)/STATUS`[before(%2,$)]`TAGS))),not(gte(get(%0/D`COMBAT`HISTORY`QRK_IMMUNIZED),default(%0/D`COMBAT`OPPONENTS,1))))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_IMMUNIZED_ACTIVE,,0,2;th u(addto,%0,D`COMBAT`HISTORY`QRK_IMMUNIZED,1)}
&STATUS`QRK_IMMUNIZED`STATIC`MAXIMUM`HP [u(Cobj,age)]=35

&STATUS`QRK_IMMUNIZED_ACTIVE [u(cobj,age)]=Immunized-Active
&STATUS`QRK_IMMUNIZED_ACTIVE`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`QRK_IMMUNIZED_ACTIVE`DESCRIPTION [u(Cobj,age)]=Solid Bonus to Endurance
&STATUS`QRK_IMMUNIZED_ACTIVE`DEFENSE`BONUS`STAT`1 [u(Cobj,age)]=Solid

&STATUS`QRK_LASTCHANCE [u(Cobj,age)]=Last Chance
&STATUS`QRK_LASTCHANCE`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Extreme)
&STATUS`QRK_LASTCHANCE`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=if(lte(u(percent,%0),0.25),Extreme)
&STATUS`QRK_LASTCHANCE`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`EANNOUNCE=LAST CHANCE,[ansi(hw,name(%0))] is not going down just yet!

&STATUS`QRK_POINTDEFENSE [u(Cobj,age)]=Point Defense
&STATUS`QRK_POINTDEFENSE`DEF`3`ACTIVATE [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_GUARD_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Guard Rand 1d100: %q<pointrand>/75
&STATUS`QRK_POINTDEFENSE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_MANEUVER_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Maneuver Rand 1d100: %q<pointrand>/75
&STATUS`QRK_POINTDEFENSE`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_POINTDEFENSE_RALLY_[if(lte(u(setr,pointrand,rand(1,100)),75),BONUS,PENALTY)],,0,1;@attach %!/INC`DEBUG=POINT DEFENSE,Rally Rand 1d100: %q<pointrand>/75

&STATUS`QRK_POINTDEFENSE_GUARD_BONUS [u(Cobj,age)]=Point Defense-Guard-Bonus
&STATUS`QRK_POINTDEFENSE_GUARD_BONUS`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_GUARD_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY [u(Cobj,age)]=Point Defense-Guard-Penalty
&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_GUARD_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!

&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS [u(Cobj,age)]=Point Defense-Maneuver-Bonus
&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS`STATUS`DEF_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`QRK_POINTDEFENSE_MANEUVER_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY [u(Cobj,age)]=Point Defense-Maneuver-Penalty
&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY`STATUS`DEF_MANEUVER`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_POINTDEFENSE_MANEUVER_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!

&STATUS`QRK_POINTDEFENSE_RALLY_BONUS [u(cobj,age)]=Point Defense-Rally-Bonus
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`STATUS`DEF_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_POINTDEFENSE_RALLY_BONUS`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] gains a Solid Bonus!

&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY [u(Cobj,age)]=Point Defense-Rally-Penalty
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`STATUS`DEF_RALLY`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=fdiv(u(adj,Minor),2)
&STATUS`QRK_POINTDEFENSE_RALLY_PENALTY`ON_ACTIVATE [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=POINT DEFENSE,[ansi(hw,name(%0))] takes a Minor Penalty!

&POP [u(cobj,age)]=localize(first(u(setr,pop,get(%0/%1)))[null(u(attrib_set,%0,%1,rest(%q<pop>)))])
&APPEND [u(cobj,age)]=localize(u(attrib_set,%0,%1,linsert(get(%0/%1),-1,%2)))

&STATUS`QRK_QUICKREFLEXES [u(cobj,age)]=Quick Reflexes
&STATUS`QRK_QUICKREFLEXES`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

&STATUS`QRK_REGENERATION [u(cobj,age)]=Regeneration
&STATUS`QRK_REGENERATION`TAGS [u(cobj,age)]=FIFO_DAMAGE
&STATUS`QRK_REGENERATION`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(u(setr,qrkreg,u(pop,%0,D`COMBAT`STATUS`%1`FIFO_DAMAGE)),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(%q<qrkreg>,u(scatter,7.5)),0)),,REGENERATION,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed qrkreg)}

&STATUS`QRK_RESILIENCE [u(cobj,age)]=Resilience
&STATUS`QRK_RESILIENCE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate

&STATUS`QRK_DEFLECTION [u(cobj,age)]=Deflection
&STATUS`QRK_DEFLECTION`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_DEFLECTION`DEFENSE_DECREASE_DAMAGE [u(cobj,age)]=@select/inline eq(0.4,%q<hitmul>)=1,{th u(setq,damage,mul(%q<damage>,sub(1.0,u(scatter,20))));@attach %!/INC`EANNOUNCE=DEFLECTION,[ansi(h,%n)] deflects the blow further off-course! Substantial damage reduction!}

&STATUS`QRK_SIEGEMODE [u(Cobj,age)]=Siege Mode
&STATUS`QRK_SIEGEMODE`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_SIEGEMODE`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_SIEGEMODE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant
&STATUS`QRK_SIEGEMODE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant

&STATUS`QRK_STANDANDDELIVER [u(Cobj,age)]=Stand and Deliver
&STATUS`QRK_STANDANDDELIVER`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_STANDANDDELIVER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_STANDANDDELIVER`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Significant

&STATUS`QRK_STAYINGPOWER [u(cobj,age)]=Staying Power
&STATUS`QRK_STAYINGPOWER`STATIC`MAXIMUM`HP [u(cobj,age)]=60

&STATUS`QRK_STRIPPEDDOWN [u(cobj,age)]=Stripped Down
&STATUS`QRK_STRIPPEDDOWN`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Significant
&STATUS`QRK_STRIPPEDDOWN`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate

&STATUS`QRK_SURVIVALINSTINCT [u(Cobj,agedb)]=Survival Instinct
&STATUS`QRK_SURVIVALINSTINCT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_SURVIVALINSTINCT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_TENACITY [u(cobj,age)]=Tenacity
&STATUS`QRK_TENACITY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_TENACITY`STATIC`MAXIMUM`HP [u(cobj,age)]=30

&STATUS`QRK_VANISH [u(Cobj,age)]=Vanish
&STATUS`QRK_VANISH`DEFENSE_FINAL_ENDTURN [u(Cobj,age)]=@select/inline cand(gte(%q<hitmul>,1.0),u(percent,%0))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_VANISH_ACTIVE,,0,1}

&STATUS`QRK_VANISH_ACTIVE [u(cobj,age)]=Vanish-Ready
&STATUS`QRK_VANISH_ACTIVE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_VANISH_ACTIVE`DESCRIPTION [u(Cobj,age)]=30% chance of Auto-Dodging Level 2+ Attacks
&STATUS`QRK_VANISH_ACTIVE`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline cand(gte(%q<atklevel>,2),lte(u(setr,vanishrand,rand(0,100)),30))=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=VANISH,[ansi(118,name(%0))] slips through the danger like some kind of ghost!};@attach %!/INC`DEBUG=VANISH,Vanish Rand 1d100: %q<vanishrand>/30;th unsetq(vanishrand)
&STATUS`QRK_VANISH_ACTIVE`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=VANISH,[ansi(hw,name(%0))]'s form wavers and flickers! Gains 30% chance of Auto-Dodging Level 2+ Attacks!

@@ STATUS - Quirks - Balanced

&STATUS`QRK_ADRENALINE [u(cobj,age)]=Adrenaline
&STATUS`QRK_ADRENALINE`ATTACK`BONUS`STAT`0 [u(cobj,age)]=localize(if(lte(u(setr,percent,u(percent,%0)),0.25),Moderate,if(lte(%q<percent>,0.75),Minor)))
&STATUS`QRK_ADRENALINE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=localize(if(lte(u(setr,percent,u(percent,%0)),0.25),Moderate,if(lte(%q<percent>,0.50),Minor)))
&STATUS`QRK_ADRENALINE`BELOW_75_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is getting into it! Minor bonus to Power!
&STATUS`QRK_ADRENALINE`BELOW_50_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is pumped up for action! Minor bonus to Endurance!
&STATUS`QRK_ADRENALINE`BELOW_25_HEALTH [u(Cobj,age)]=@attach %!/INC`EANNOUNCE=ADRENALINE,[ansi(hw,name(%0))] is revved to the limit! Moderate Bonus to Power and Endurance!


&STATUS`QRK_BAGOFTRICKS [u(cobj,age)]=Bag of Tricks
&STATUS`QRK_BAGOFTRICKS`ATTACK_END_TURN [u(cobj,age)]=@select/inline t(get(%0/D`COMBAT`STATUS`%1`CHARGES))=0,{th u(attrib_set,%0,D`COMBAT`STATUS`%1`CHARGES,1);@attach %!/INC`EANNOUNCE=BAG OF TRICKS,ansi(h,%n) readies their Bag of Tricks!}
&STATUS`QRK_BAGOFTRICKS`PUSH_ON_ACTIVATE [u(cobj,age)]=@select/inline get(%0/D`COMBAT`STATUS`%1`CHARGES)=>0,{@select/inline lte(u(setr,bagrand,rand(1,100)),u(setr,hycost,fdiv(100,add(%q<hypecost>,0))))=1,{@attach %!/INC`HYPE=%0,%q<hypecost>,BAG OF TRICKS,Lucky! [ansi(h,%n)] gains [ansi(118,%q<hypecost>)] Hype!},0,{@attach %!/INC`EANNOUNCE=BAG OF TRICKS,ansi(h,%n) digs around in a Bag of Tricks... nothing! Better luck next time!};th u(addto,%0,D`COMBAT`STATUS`%1`CHARGES,-1);@attach %!/INC`DEBUG=BAG OF TRICKS,Refund Rand: %q<bagrand>/%q<hycost>;th unsetq(bagrand hycost)}



&SCATTER [u(Cobj,age)]=fdiv(mul(%0,add(1.0,mul([if(rand(0,1),-,)]1,0.[rjust(rand(0,u(cust,CORE,SCATTER)),2,0)]))),100)

&STATUS`QRK_BLOODTHIRSTY [u(cobj,age)]=Bloodthirsty
&STATUS`QRK_BLOODTHIRSTY`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=@attach %!/INC`HEAL=%q<atker>,u(setr,blood,round(mul(add(%q<damage>,%q<dot>),u(scatter,8.5)),0)),,BLOODTHIRSTY,[ansi(hw,name(%q<atker>))] regenerates [ansi(hg,%q<blood>)] HP!;th unsetq(blood)

&STATUS`QRK_DESTINY [u(Cobj,age)]=Destiny
&STATUS`QRK_DESTINY`DEFENSE_ON_CRITICAL [u(cobj,age)]=@select/inline gte(get(%0/D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_CRITICAL),default(%0/D`COMBAT`OPPONENTS,1))=0,{@attach %!/INC`HYPE=%0,2,DESTINY;th u(addto,%0,D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_CRITICAL,1)}
&STATUS`QRK_DESTINY`DEFENSE_ON_MISS [u(cobj,age)]=@select/inline gte(get(%0/D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_MISS),default(%0/D`COMBAT`OPPONENTS,1))=0,{@attach %!/INC`HYPE=%0,2,DESTINY;th u(addto,%0,D`COMBAT`HISTORY`DESTINY`DEFENSE_ON_MISS,1)}
&STATUS`QRK_DESTINY`ATTACK_ON_CRITICAL [u(cobj,age)]=@select/inline gte(get(%q<atker>/D`COMBAT`HISTORY`DESTINY`ATTACK_ON_CRITICAL),default(%q<atker>/D`COMBAT`OPPONENTS,1))=0,{@attach %!/INC`HYPE=%q<atker>,2,DESTINY;th u(addto,%q<atker>,D`COMBAT`HISTORY`DESTINY`ATTACK_ON_CRITICAL,1)}
&STATUS`QRK_DESTINY`ATTACK_ON_MISS [u(Cobj,age)]=@select/inline gte(get(%q<atker>/D`COMBAT`HISTORY`DESTINY`ATTACK_ON_MISS),default(%q<atker>/D`COMBAT`OPPONENTS,1))=0,{@attach %!/INC`HYPE=%q<atker>,2,DESTINY;th u(addto,%q<atker>,D`COMBAT`HISTORY`DESTINY`ATTACK_ON_MISS,1)}

&STATUS`QRK_EFFICIENCY [u(Cobj,age)]=Efficiency
&STATUS`QRK_EFFICIENCY`STATIC`GAIN`DRIVE [u(cobj,age)]=1
&STATUS`QRK_EFFICIENCY`ATTACK`DRIVE_COST [u(cobj,age)]=switch(%q<off>,3,-%q<atklevel>,0)

&STATUS`QRK_FIGHTINGSPIRIT [u(cobj,age)]=Fighting Spirit
&STATUS`QRK_FIGHTINGSPIRIT`STATIC`GAIN`DRIVE [u(Cobj,age)]=3
&STATUS`QRK_FIGHTINGSPIRIT`STATUS`DEF_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=2

&STATUS`QRK_FINESSE [u(cobj,age)]=Finesse
&STATUS`QRK_FINESSE`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_FINESSE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_GENIUS [u(cobj,age)]=Genius
&STATUS`QRK_GENIUS`STATIC`GAIN`HYPE [u(cobj,age)]=1

&STATUS`QRK_HONORBOUND [u(cobj,age)]=Honor Bound
&STATUS`QRK_HONORBOUND`ATTACK_END_TURN [u(cobj,age)]=@select/inline not(get(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_HONORBOUND_ACTIVE,,1,1;@attach %!/INC`EANNOUNCE=HONOR BOUND,A curse upon the dishonorable [ansi(hw,%n)]! Stats Penalized!}
&STATUS`QRK_HONORBOUND`ON_ACTIVATE [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`NO_FIRST_BONUS,1);
&STATUS`QRK_HONORBOUND`STATIC`MAXIMUM`HP [u(cobj,age)]=150

&STATUS`QRK_HONORBOUND_ACTIVE [u(Cobj,age)]=Honor Bound-Penalty
&STATUS`QRK_HONORBOUND_ACTIVE`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`ATTACK`PENALTY`STAT`2 [u(Cobj,age)]=Significant
&STATUS`QRK_HONORBOUND_ACTIVE`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Significant

&STATUS`QRK_IMPROVISATION [u(Cobj,age)]=Improvisation
&STATUS`QRK_IMPROVISATION`DEFENSE_FINAL_ENDTURN [u(Cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_IMPROVISATION_[u(setr,improv1,randword(OFF_CONSISTENT OFF_FORCEFUL OFF_EFFICIENT OFF_DRAMATIC DEF_FOCUS DEF_BOLSTER DEF_GUARD DEF_MANEUVER DEF_RALLY))]_BONUS;@attach %!/INC`SETSTATUS=%0,%0,QRK_IMPROVISATION_[u(setr,improv2,randword(OFF_CONSISTENT OFF_FORCEFUL OFF_EFFICIENT OFF_DRAMATIC DEF_FOCUS DEF_BOLSTER DEF_GUARD DEF_MANEUVER DEF_RALLY))]_PENALTY;

&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS [u(cobj,age)]=Improvisation-Consistent-Bonus
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`STATUS`OFF_CONSISTENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Consistent Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Consistent Attacks
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS [u(cobj,age)]=Improvisation-Forceful-Bonus
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`STATUS`OFF_FORCEFUL`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Forceful Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Forceful Attacks
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS [u(cobj,age)]=Improvisation-Efficient-Bonus
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`STATUS`OFF_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling an Efficient Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Efficient Attacks
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS [u(cobj,age)]=Improvisation-Dramatic-Bonus
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`STATUS`OFF_DRAMATIC`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Dramatic Attack would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Dramatic Attacks
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY [u(cobj,age)]=Improvisation-Consistent-Penalty
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`STATUS`OFF_CONSISTENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Consistent Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Consistent Attacks
&STATUS`QRK_IMPROVISATION_OFF_CONSISTENT_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY [u(cobj,age)]=Improvisation-Forceful-Penalty
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`STATUS`OFF_FORCEFUL`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Forceful Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Forceful Attacks
&STATUS`QRK_IMPROVISATION_OFF_FORCEFUL_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY [u(cobj,age)]=Improvisation-Efficient-Penalty
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`STATUS`OFF_EFFICIENT`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling an Efficient Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Efficient Attacks
&STATUS`QRK_IMPROVISATION_OFF_EFFICIENT_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY [u(cobj,age)]=Improvisation-Dramatic-Penalty
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`STATUS`OFF_DRAMATIC`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`STATUS`OFF_DRAMATIC`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Dramatic Attack would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Dramatic Attacks
&STATUS`QRK_IMPROVISATION_OFF_DRAMATIC_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS [u(cobj,age)]=Improvisation-Focus-Bonus
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`2 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Focus Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Focus Defense
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS [u(cobj,age)]=Improvisation-Bolster-Bonus
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`STATUS`DEF_FOCUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Bolster Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Bolster Defense
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_BONUS`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS [u(cobj,age)]=Improvisation-Guard-Bonus
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`STATUS`DEF_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Guard Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Guard Defense
&STATUS`QRK_IMPROVISATION_DEF_GUARD_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS [u(cobj,age)]=Improvisation-Maneuver-Bonus
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`STATUS`DEF_FOCUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Maneuver Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Maneuver Defense
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS [u(cobj,age)]=Improvisation-Rally-Bonus
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`STATUS`OFF_EFFICIENT`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`STATUS`OFF_EFFICIENT`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(u(adj,Solid),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Rally Defense would be a great idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`DESCRIPTION [u(cobj,age)]=Solid Bonus to Rally Defense
&STATUS`QRK_IMPROVISATION_DEF_RALLY_BONUS`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY [u(cobj,age)]=Improvisation-Focus-Penalty
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`STATUS`DEF_FOCUS`DEFENSE`PENALTY`STAT`2 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Focus Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Focus Defense
&STATUS`QRK_IMPROVISATION_DEF_FOCUS_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY [u(cobj,age)]=Improvisation-Bolster-Penalty
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`STATUS`DEF_FOCUS`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Bolster Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Bolster Defense
&STATUS`QRK_IMPROVISATION_DEF_BOLSTER_PENALTY`ATTACK_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY [u(cobj,age)]=Improvisation-Guard-Penalty
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`STATUS`DEF_GUARD`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Guard Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Guard Defense
&STATUS`QRK_IMPROVISATION_DEF_GUARD_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY [u(cobj,age)]=Improvisation-Maneuver-Penalty
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`STATUS`DEF_FOCUS`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Moderate
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Maneuver Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Maneuver Defense
&STATUS`QRK_IMPROVISATION_DEF_MANEUVER_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1

&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY [u(cobj,age)]=Improvisation-Rally-Penalty
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`STATUS`OFF_EFFICIENT`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`STATUS`OFF_EFFICIENT`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=fdiv(u(adj,Moderate),2)
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`EPRIVATE=IMPROVISATION,You get the feeling a Rally Defense would be a terrible idea!,%0
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`DESCRIPTION [u(cobj,age)]=Moderate Penalty to Rally Defense
&STATUS`QRK_IMPROVISATION_DEF_RALLY_PENALTY`DEFENSE_TURNS [u(cobj,age)]=1


&STATUS`QRK_INSPIRATION [u(cobj,age)]=Inspiration
&STATUS`QRK_INSPIRATION`DEFENSE_END_TURN [u(cobj,age)]=@select/inline u(setr,qrkinspir,ceil(fdiv(die(1,100),20)))=1,{@attach %!/INC`DRIVE=%0,5,INSPIRATION},2,{@attach %!/INC`SETSTATUS=%0,%0,QRK_INSPIRATION_POWER,,1,0},3,{@attach %!/INC`HYPE=%0,1,INSPIRATION},4,{@attach %!/INC`SETSTATUS=%0,%0,QRK_INSPIRATION_PRECISION,,1,0},5,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(get(%0/D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE),u(scatter,8)),0)),,INSPIRATION,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed)};@attach %!/INC`EPRIVATE=INSPIRATION,Your inspiration leaves you [switch(%q<qrkinspir>,1,refreshed!,2,energized! Bonus to Power,3,sharp!,4,motivated! Bonus to Precision!,revitalized!)],%0

&STATUS`QRK_INSPIRATION_POWER [u(cobj,age)]=Inspiration-Power
&STATUS`QRK_INSPIRATION_POWER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_INSPIRATION_POWER`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Power
&STATUS`QRK_INSPIRATION_POWER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Moderate

&STATUS`QRK_INSPIRATION_PRECISION [u(cobj,age)]=Inspiration-Precision
&STATUS`QRK_INSPIRATION_PRECISION`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_INSPIRATION_PRECISION`DESCRIPTION [u(cobj,age)]=Moderate Bonus to Precision
&STATUS`QRK_INSPIRATION_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Moderate

&STATUS`QRK_LASTSTAND [u(Cobj,age)]=Last Stand
&STATUS`QRK_LASTSTAND`BELOW_25_HEALTH [u(cobj,age)]=@attach %!/INC`DRIVE=%0,mul(15,get(%0/D`COMBAT`OPPONENTS)),LAST STAND

&STATUS`QRK_OVERCHARGED [u(cobj,age)]=Overcharged
&STATUS`QRK_OVERCHARGED`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_OVERCHARGED`STATIC`MAXIMUM`HP [u(Cobj,age)]=-50

&STATUS`QRK_PREPTIME [u(cobj,age)]=Prep Time
&STATUS`QRK_PREPTIME`STATIC`START`HYPE [u(cobj,age)]=3
&STATUS`QRK_PREPTIME`DEFENSE_ON_CALCULATE [u(cobj,age)]=@select/inline cand(gte(%q<atklevel>,3),not(gte(get(%0/D`COMBAT`HISTORY`QRK_PREPTIME),default(%0/D`COMBAT`OPPONENTS,1))))=1,{@attach %!/INC`SETSTATUS=%0,%0,QRK_PREPTIME_ACTIVE,,0,1;@attach %!/INC`EANNOUNCE=PREP TIME,[ansi(hw,%n)] was ready for these hijinx! Solid Bonus to Endurance and Mitigation!;th u(addto,%0,D`COMBAT`HISTORY`QRK_PREPTIME,1)}

&STATUS`QRK_PREPTIME_ACTIVE [u(cobj,age)]=Prep Time-Bonus
&STATUS`QRK_PREPTIME_ACTIVE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_PREPTIME_ACTIVE`DESCRIPTION [u(cobj,age)]=Solid Bonus to Endurance and Mitigation
&STATUS`QRK_PREPTIME_ACTIVE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Solid
&STATUS`QRK_PREPTIME_ACTIVE`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Solid

&STATUS`QRK_REPERTOIRE [u(Cobj,age)]=Repertoire
&STATUS`QRK_REPERTOIRE`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_REPERTOIRE_DEFENSE,,0,1;@attach %!/INC`EANNOUNCE=REPERTOIRE,[ansi(h,%n)] knuckles down with a strategy! Minor Bonus to Endurance and Mitigation!
&STATUS`QRK_REPERTOIRE`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`QRK_REPERTOIRE`DEF`1`ACTIVATE
&STATUS`QRK_REPERTOIRE`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,QRK_REPERTOIRE_OFFENSE,,1,0;@attach %!/INC`EANNOUNCE=REPERTOIRE,[ansi(h,%n)] knuckles down with a strategy! Minor Bonus to Power and Precision!
&STATUS`QRK_REPERTOIRE`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/STATUS`QRK_REPERTOIRE`DEF`3`ACTIVATE

&STATUS`QRK_REPERTOIRE_DEFENSE [u(cobj,age)]=Repertoire-Defense
&STATUS`QRK_REPERTOIRE_DEFENSE`TYPE [u(cobj,age)]=ADD
&STATUS`QRK_REPERTOIRE_DEFENSE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_REPERTOIRE_DEFENSE`DESCRIPTION [u(cobj,age)]=Minor Bonus to Endurance and Mitigation
&STATUS`QRK_REPERTOIRE_DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_REPERTOIRE_DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor

&STATUS`QRK_REPERTOIRE_OFFENSE [u(cobj,age)]=Repertoire-Offense
&STATUS`QRK_REPERTOIRE_OFFENSE`TYPE [u(cobj,age)]=ADD
&STATUS`QRK_REPERTOIRE_OFFENSE`TAGS [u(cobj,age)]=DISPLAY
&STATUS`QRK_REPERTOIRE_OFFENSE`DESCRIPTION [u(cobj,age)]=Minor Bonus to Power and Precision
&STATUS`QRK_REPERTOIRE_OFFENSE`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`QRK_REPERTOIRE_OFFENSE`BONUS`STAT`2 [u(cobj,age)]=Minor

&STATUS`QRK_REVENGE [u(cobj,age)]=Revenge
&STATUS`QRK_REVENGE`DEFENSE_ON_STRIKE [u(cobj,age)]=@select/inline gte(%q<hitmul>,0.7)=1,{@attach %!/INC`DRIVE=%#,get(%#/%q<atk>`ATK),REVENGE}
&STATUS`QRK_REVENGE`STATIC`GAIN`DRIVE [u(Cobj,age)]=1

&STATUS`QRK_SELFLESS [u(Cobj,age)]=Selfless
&STATUS`QRK_SELFLESS`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=Minor
&STATUS`QRK_SELFLESS`DEFENSE_END_TURN [u(cobj,age)]=@select/inline cand(isdbref(u(setr,sup,get(%0/D`COMBAT`SUPPORTING))),not(strmatch(num(%q<sup>),num(%0))),gt(u(setr,odrive,get(%q<sup>/D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS)),0))=1,{@attach %!/INC`DRIVE=%0,round(mul(%q<odrive>,0.2),0),SELFLESS;&D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS %q<sup>=0}

&STATUS`QRK_SOLIDITY [u(cobj,age)]=Solidity
&STATUS`QRK_SOLIDITY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`QRK_SOLIDITY`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor

&STATUS`QRK_TEAMSUPPORT [u(Cobj,age)]=Team Support
&STATUS`QRK_TEAMSUPPORT`ON_SUPPORT [u(cobj,age)]=@attach %!/INC`SETSTATUS=%2,%0,QRK_TEAMSUPPORT_SUPPORT,,X,X

&STATUS`QRK_TEAMSUPPORT_SUPPORT [u(cobj,age)]=Team Support
&STATUS`QRK_TEAMSUPPORT_SUPPORT`TAGS [u(cobj,age)]=DISPLAY FIFO_DAMAGE
&STATUS`QRK_TEAMSUPPORT_SUPPORT`ATTACK_END_TURN [u(cobj,age)]=@select/inline cand(u(setr,qrkreg,u(pop,%0,D`COMBAT`STATUS`%1`FIFO_DAMAGE)),gt(u(percent,%0),0))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(%q<qrkreg>,u(scatter,5)),0)),,TEAM SUPPORT,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th unsetq(healed qrkreg)}

&STATUS`QRK_UNBREAKABLE [u(cobj,age)]=Unbreakable
&STATUS`QRK_UNBREAKABLE`STATIC`GAIN`DRIVE [u(cobj,age)]=2
&STATUS`QRK_UNBREAKABLE`DEFENSE`PROTECT`DRIVE_LOSS [u(cobj,age)]=3

@@ STATUS - Pushes

&STATUS`PUSH_ATTACK [u(cobj,age)]=Attack
&STATUS`PUSH_ATTACK`ATTACK_TURNS [u(cobj,age)]=1
&STATUS`PUSH_ATTACK`DEFENSE_TURNS [u(cobj,age)]=0
&STATUS`PUSH_ATTACK`ATTACK_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,linsert(%q<xcon>,-1,switch(get(%0/%q<atk>`STATUS`%1`COST),2,0.37,4,0.74,6,1.11)))
&STATUS`PUSH_ATTACK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY BUFF
&STATUS`PUSH_ATTACK`DESCRIPTION [u(cobj,age)]=Variable Attack increase
&STATUS`PUSH_ATTACK`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Standard,4,Substantial,6,Overwhelming)

&STATUS`PUSH_DEFENSE [u(cobj,age)]=Defense
&STATUS`PUSH_DEFENSE`DEFENSE_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,linsert(%q<xcon>,-1,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,-0.33,4,-0.66,6,-0.99)))
&STATUS`PUSH_DEFENSE`TAGS [u(cobj,age)]=PUSH PUSH_DEFENSE DISPLAY BUFF
&STATUS`PUSH_DEFENSE`DESCRIPTION [u(cobj,age)]=Variable Defense increase
&STATUS`PUSH_DEFENSE`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Standard,4,Substantial,6,Overwhelming)

&STATUS`PUSH_BALANCE [u(cobj,age)]=Balance
&STATUS`PUSH_BALANCE`ATTACK_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,linsert(%q<xcon>,-1,switch(get(%0/%q<atk>`STATUS`%1`COST),2,0.185,4,0.37,6,0.555)))
&STATUS`PUSH_BALANCE`DEFENSE_ON_CALCULATE [u(cobj,age)]=th u(setq,xcon,linsert(%q<xcon>,-1,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,-0.165,4,-0.33,6,-0.495)))
&STATUS`PUSH_BALANCE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK PUSH_DEFENSE DISPLAY
&STATUS`PUSH_BALANCE`DESCRIPTION [u(cobj,age)]=Variable increase to Attack and Defense
&STATUS`PUSH_BALANCE`BREAK`INTENSITY [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),2,Small,4,Standard,6,Considerable)

&STATUS`PUSH_BUFF_POWER [u(cobj,age)]=Buff-Power
&STATUS`PUSH_BUFF_POWER`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_POWER`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0,%0,%1) Bonus to Power
&STATUS`PUSH_BUFF_POWER`ATTACK_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_POWER`BREAK`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_BUFF_POWER`ATTACK`BONUS`STAT`0,%0,%1)

&STATUS`PUSH_BUFF_ENDURANCE [u(cobj,age)]=Buff-Endurance
&STATUS`PUSH_BUFF_ENDURANCE`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1,%0,%1) Bonus to Endurance
&STATUS`PUSH_BUFF_ENDURANCE`DEFENSE_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_ENDURANCE`BREAK`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_BUFF_ENDURANCE`DEFENSE`BONUS`STAT`1,%0,%1)

&STATUS`PUSH_BUFF_PRECISION [u(cobj,age)]=Buff-Precision
&STATUS`PUSH_BUFF_PRECISION`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_PRECISION`ATTACK`BONUS`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_PRECISION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_PRECISION`DEFENSE`BONUS`STAT`2,%0,%1) Bonus to Precision
&STATUS`PUSH_BUFF_PRECISION`ATTACK_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_PRECISION`BREAK`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_BUFF_PRECISION`ATTACK`BONUS`STAT`2,%0,%1)

&STATUS`PUSH_BUFF_MITIGATION [u(cobj,age)]=Buff-Mitigation
&STATUS`PUSH_BUFF_MITIGATION`TAGS [u(cobj,age)]=BUFF PUSH DISPLAY
&STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_BUFF_MITIGATION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3,%0,%1) Bonus to Mitigation
&STATUS`PUSH_BUFF_MITIGATION`DEFENSE_TURNS [u(cobj,age)]=2
&STATUS`PUSH_BUFF_MITIGATION`BREAK`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_BUFF_MITIGATION`DEFENSE`BONUS`STAT`3,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_POWER [u(cobj,age)]=Inflict-Debuff-Power
&STATUS`PUSH_INFLICT_DEBUFF_POWER`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_POWER,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],2,0;@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] now suffers from a [ansi(hw,Power Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_POWER`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY IDEBUFF
&STATUS`PUSH_INFLICT_DEBUFF_POWER`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Power

&STATUS`PUSH_DEBUFF_POWER [u(cobj,age)]=Debuff-Power
&STATUS`PUSH_DEBUFF_POWER`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_POWER`DESCRIPTION [u(cobj,age)]=u(switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior),%0,%1) Penalty to Power
&STATUS`PUSH_DEBUFF_POWER`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_POWER`ATTACK`PENALTY`STAT`0,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE [u(cobj,age)]=Inflict-Debuff-Endurance
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_ENDURANCE,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],0,2;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from an [ansi(hw,Endurance Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY IDEBUFF
&STATUS`PUSH_INFLICT_DEBUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Endurance


&STATUS`PUSH_DEBUFF_ENDURANCE [u(cobj,age)]=Debuff-Endurance
&STATUS`PUSH_DEBUFF_ENDURANCE`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_ENDURANCE`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1,%0,%1) Penalty to Endurance
&STATUS`PUSH_DEBUFF_ENDURANCE`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_ENDURANCE`DEFENSE`PENALTY`STAT`1,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_PRECISION [u(cobj,age)]=Inflict-Debuff-Precision
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_PRECISION,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],2,0;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from a [ansi(hw,Precision Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY IDEBUFF
&STATUS`PUSH_INFLICT_DEBUFF_PRECISION`DESCRIPTION [u(cobj,age)]=Inflicts a Penalty to Precision


&STATUS`PUSH_DEBUFF_PRECISION [u(cobj,age)]=Debuff-Precision
&STATUS`PUSH_DEBUFF_PRECISION`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_PRECISION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2,%0,%1) Penalty to Precision
&STATUS`PUSH_DEBUFF_PRECISION`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_PRECISION`ATTACK`PENALTY`STAT`2,%0,%1)

&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION [u(cobj,age)]=Inflict-Debuff-Mitigation
&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION`ATTACK_ON_STRIKE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%q<atker>,PUSH_DEBUFF_MITIGATION,COST=[get(%#/%q<atk>`STATUS`%1`COST)]|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)],0,2;@attach %!/INC`EANNOUNCE=DEBUFF,[ansi(hw,%n)] now suffers from a [ansi(hw,Mitigation Debuff)]!
&STATUS`PUSH_INFLICT_DEBUFF_MITIGATION`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY IDEBUFF

&STATUS`PUSH_DEBUFF_MITIGATION [u(cobj,age)]=Debuff-Mitigation
&STATUS`PUSH_DEBUFF_MITIGATION`TAGS [u(cobj,age)]=DEBUFF PUSH DISPLAY
&STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3 [u(cobj,age)]=switch(get(%0/D`COMBAT`STATUS`%1`COST),1,Minor,3,Solid,5,Major,7,Superior)
&STATUS`PUSH_DEBUFF_MITIGATION`DESCRIPTION [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3,%0,%1) Penalty to Mitigation
&STATUS`PUSH_DEBUFF_MITIGATION`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DEBUFF_MITIGATION`DEFENSE`PENALTY`STAT`3,%0,%1)


&STATUS`PUSH_INFLICT_DOT [u(cobj,age)]=Inflict-Damage Over Time
&STATUS`PUSH_INFLICT_DOT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%q<atker>,PUSH_DOT,COST=[get(%0/%q<atk>`STATUS`%1`COST)]|HITMUL=%q<hitmul>|DAMAGEMOD=%q<damagemod>|DISPLAY=[get(%#/%q<atk>`STATUS`%1`DISPLAY)]|INCREMENT=0,0,mul(4,get(%0/D`COMBAT`OPPONENTS));@attach %!/INC`EANNOUNCE=DAMAGE OVER TIME,[ansi(h,%n)] will suffer Damage over Time if not quickly cured!! Uh-oh!
&STATUS`PUSH_INFLICT_DOT`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_INFLICT_DOT`DESCRIPTIION [u(cobj,age)]=Inflicts DoT on Victim

&STATUS`PUSH_DOT [u(cobj,age)]=Damage Over Time
&STATUS`PUSH_DOT`TAGS [u(cobj,age)]=DOT PUSH DISPLAY
&STATUS`PUSH_DOT`DEFENSE`DOT [u(cobj,age)]=if(eq(mod(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0),bound(floor(mul(u(cust,CORE,BASEDAMAGE),get(%0/D`COMBAT`STATUS`%1`HITMUL),get(%0/D`COMBAT`STATUS`%1`DAMAGEMOD),u(STATUS`PUSH_DOT`DEFENSE`DOT`[get(%0/D`COMBAT`STATUS`%1`COST)],%0,%1))),0),0)
&STATUS`PUSH_DOT`DEFENSE`DOT`1 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,0.14,0.03)
&STATUS`PUSH_DOT`DEFENSE`DOT`3 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,0.42,0.08)
&STATUS`PUSH_DOT`DEFENSE`DOT`5 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,0.70,0.2)
&STATUS`PUSH_DOT`DEFENSE`DOT`7 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,0,1,0.90,0.25)
&STATUS`PUSH_DOT`DESCRIPTION [u(Cobj,age)]=Suffers DoT on Defense
&STATUS`PUSH_DOT`CURE`INTENSITY [u(cobj,age)]=u(STATUS`PUSH_DOT`CURE`INTENSITY`[get(%0/D`COMBAT`STATUS`%1`COST)],%0,%1)
&STATUS`PUSH_DOT`CURE`INTENSITY`1 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,Small,1,Small,Tiny)
&STATUS`PUSH_DOT`CURE`INTENSITY`3 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,Standard,1,Standard,Small)
&STATUS`PUSH_DOT`CURE`INTENSITY`5 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,Considerable,1,Considerable,Small)
&STATUS`PUSH_DOT`CURE`INTENSITY`7 [u(cobj,age)]=switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),get(%0/D`COMBAT`OPPONENTS)),0,Substantial,1,Substantial,Standard)


&STATUS`PUSH_CURE [u(Cobj,age)]=Cure
&STATUS`PUSH_CURE`ON_ACTIVATE [u(cobj,age)]=@dolist/inline u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,CURE,switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Moderate,5,Significant,7,Superior),switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Small,5,Standard,7,Substantial),%0)={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=CURE,[ansi(hw,%n)] shrugs off negative Status Effects!

&FIL`COSTCOMPARE [u(Cobj,age)]=cor(cand(hasattr(u(cobj,age)/STATUS`%0`%1`ADJECTIVE),lte(u(adj,u(u(cobj,age)/STATUS`[before(%0,$)]`%1`ADJECTIVE,%0,%4)),u(adj,%2))),cand(hasattr(u(cobj,age)/STATUS`[before(%0,$)]`%1`INTENSITY),lte(u(cust,INTENSITY,u(u(cobj,age)/STATUS`[before(%0,$)]`%1`INTENSITY,%0,%4)),u(cust,INTENSITY,%3))))

&STATUS`PUSH_BREAK [u(cobj,age)]=Inflict-Break
&STATUS`PUSH_BREAK`ATTACK_ON_STRIKE [u(cobj,age)]=@dolist/inline u(filter,COSTCOMPARE,get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`BUFF),%b,%b,BREAK,switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Moderate,5,Significant,7,Superior),switch(get(%0/D`COMBAT`STATUS`%1`COST),3,Small,5,Standard,7,Substantial),%0)={th u(setq,statusname,get(%0/D`COMBAT`STATUS`%i0));@attach %!/KILLSTATUS=%0,%i0,1;@select/inline t(%q<blockkill>)=0,{@attach %!/INC`EANNOUNCE=BREAK,[ansi(h,%n)]'s "%q<statusname>" has been removed!}};@attach %!/INC`EANNOUNCE=BREAK,[ansi(hw,%n)] has suffered a Break! Positive Status Effects removed!
&STATUS`PUSH_BREAK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_BREAK`DESCRIPTION [u(Cobj,age)]=Purges Positive Status Effects from target.

&STATUS`PUSH_BOOST [u(cobj,age)]=Boost
&STATUS`PUSH_BOOST`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,4,4,8,6,12),BOOST,,switch(get(%0/D`COMBAT`STATUS`%1`COST),2,4,4,8,6,12)

&STATUS`PUSH_COUPDEGRACE [u(cobj,age)]=Coup de Grace
&STATUS`PUSH_COUPDEGRACE`ATTACK_ON_STRIKE [u(cobj,age)]=th u(setq,adamage,0);@dolist/inline u(setr,towipe,u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,BREAK,Solid,Standard,%0))={th u(setq,adamage,add(%q<adamage>,mul(u(u(cobj,age)/STATUS`[before(%i0,$)]`DEFENSE`DOT,%0,%i0),get(%#/D`COMBAT`STATUS`%i0`ATTACK_TURNS)),mul(u(ladd,iter(u(lattr,u(cobj,age)/STATUS`%i0`*`PENALTY`STAT`*),mul(1.35,u(adj,get(u(cobj,age)/%i0))))),get(%#/D`COMBAT`STATUS`%i0`DEFENSE_TURNS))))};@dolist/inline %q<towipe>={@attach %!/KILLSTATUS=%#,%i0,1};@attach %!/INC`EANNOUNCE=COUP DE GRACE,[ansi(h,%n)]'s negative effects are deftly converted into extra injury!
&STATUS`PUSH_COUPDEGRACE`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_COUPDEGRACE`DESCRIPTION [u(Cobj,age)]=Converts Penalties and DOT into extra damage

&STATUS`PUSH_FINISHINGBLOW [u(cobj,age)]=Finishing Blow
&STATUS`PUSH_FINISHINGBLOW`ATTACK_INCREASE_HITMUL [u(cobj,age)]=@select/inline t(%q<hitmul>)=1,{@select/inline gte(%q<hitmul>,1.0)=0,{th u(setq,hitmul,1.0)};@attach %!/INC`EANNOUNCE=FINISHING BLOW,[ansi(hw,name(%q<atker>))]'s attack shakes the heavens!}
&STATUS`PUSH_FINISHINGBLOW`ATTACK_DECREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,atkdecdamagemul,linsert(%q<atkdecdamagemul>,-1,0.15));@attach %!/INC`DEBUG=FINISHINGBLOW,Attack Decrease Damage Multiplier: 0.2
&STATUS`PUSH_FINISHINGBLOW`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_FINISHINGBLOW`DESCRIPTION [u(Cobj,age)]=Any hit becomes a guaranteed Critical Hit

&KILLSTATUS [u(Cobj,age)]=th u(setq,blockkill,0);@dolist/inline setdiff(iter(get(%0/D`COMBAT`STATUS`%1`SOURCE),num(%i0)),num(%0))={@dolist/inline get(%i0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`BLOCK_OPPONENT_KILL_STATUS=%i1,%i0,%0,%1,%2}};@select/inline t(%q<blockkill>)=0,{@dolist/inline setdiff(iter(get(%0/D`COMBAT`STATUS`%1`SOURCE),num(%i0)),num(%0))={@dolist/inline get(%i0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_OPPONENT_KILL_STATUS=%i1,%i0,%0,%1,%2}}};@select/inline t(%q<blockkill>)=0,{@dolist/inline setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1)={@attach %!/STATUS`[before(%i0,$)]`ON_KILL_OTHER_STATUS=%0,%1,%2};@attach %!/STATUS`[before(%1,$)]`ON_KILL_STATUS=%0,%1,%2;@attach %!/WIPE=%0,D`COMBAT`STATUS`%1;th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%1));th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%1));th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`[before(%1,$)],setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`[before(%1,$)]),%1));@dolist/inline get(u(cobj,age)/STATUS`[before(%1,$)]`TAGS)={th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`TAGS`%i0,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`%i0),%1))};th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS),%1));@select/inline words(u(setr,getstack,get(%0/D`COMBAT`QUEUE`[before(%1,$)])),^)=>0,{th u(setq,stackdat,first(%q<getstack>,^));th u(attrib_set,%0,D`COMBAT`QUEUE`[before(%1,$)],ldelete(%q<getstack>,1,^));@attach %!/INC`SETSTATUS=%0,elements(%q<stackdat>,1,~),before(%1,$),elements(%q<stackdat>,2,~),elements(%q<stackdat>,3,~),elements(%q<stackdat>,4,~)}},1,{}



&STATUS`PUSH_SECONDWIND [u(Cobj,age)]=Second Wind
&STATUS`PUSH_SECONDWIND`TYPE [u(cobj,age)]=ADD
&STATUS`PUSH_SECONDWIND`ON_ACTIVATE [u(cobj,age)]=@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),0.15),0)),,SECOND WIND,[ansi(hw,name(%0))] regenerates [ansi(hg,%q<healed>)] HP!;th u(addto,%0,D`COMBAT`HISTORY`SECONDWIND,1);@select/inline gte(get(%0/D`COMBAT`HISTORY`SECONDWIND),get(%0/D`COMBAT`OPPONENTS))=1,{
@dolist/inline u(filter,COSTCOMPARE,setunion(get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DEBUFF),get(%0/D`COMBAT`ACTIVE`STATUS`TAGS`DOT)),%b,%b,CURE,Extreme,Override)={@attach %!/KILLSTATUS=%0,%i0,1};@attach %!/INC`EANNOUNCE=SECOND WIND,[ansi(h,%n)] rises to the challenge! Negative effects Purged.};
&STATUS`PUSH_SECONDWIND`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Major
&STATUS`PUSH_SECONDWIND`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Major

&STATUS`PUSH_ULTIMATEATTACK [u(cobj,age)]=Ultimate Attack
&STATUS`PUSH_ULTIMATEATTACK`ATTACK_ON_HITCHECK [u(cobj,age)]
&STATUS`PUSH_ULTIMATEATTACK`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,0.5));@attach %!/INC`EANNOUNCE=ULTIMATE ATTACK,[ansi(hw,name(%q<atker>))]'s power surges wildly! Attack Power Up!;@attach %!/INC`DEBUG=ULTIMATE ATTACK,Attack Increase Damage Multiplier: 0.5
&STATUS`PUSH_ULTIMATEATTACK`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_ULTIMATEATTACK`DESCRIPTION [u(cobj,age)]=+50% damage but penalty to accuracy.

&STATUS`PUSH_EXHAUST [u(cobj,age)]=Exhaust
&STATUS`PUSH_EXHAUST`ATTACK_POST_DAMAGE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,-[bound(sub(switch(get(%0/%q<atk>`STATUS`%1`COST),2,5,4,10,6,15),u(ladd,iter(edit(lattr(%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,),u(getstatus,%0,%i0,DEFENSE,PROTECT`DRIVE_LOSS)))),0)],EXHAUST
&STATUS`PUSH_EXHAUST`TAGS [u(cobj,age)]=PUSH PUSH_ATTACK DISPLAY
&STATUS`PUSH_EXHAUST`DESCRIPTION [u(cobj,age)]=

&STATUS`PUSH_INDOMITABILITY_PREPARE [u(cobj,age)]=Indomitability
&STATUS`PUSH_INDOMITABILITY_PREPARE`ATTACK_BEFORE_LAUNCH [u(cobj,age)]=@attach %!/INC`SETSTATUS=%#,%#,PUSH_INDOMITABILITY,,0,1;@attach %!/INC`EPRIVATE=INDOMITABILITY,You ready yourself to power through the next attack!,%#

&STATUS`PUSH_INDOMITABILITY [u(Cobj,age)]=Indomitability
&STATUS`PUSH_INDOMITABILITY`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,0.45));@attach %!/INC`EANNOUNCE=INDOMITABILITY, [ansi(hw,%n)] must be made of metal! Damage was greatly reduced.;@attach %!/INC`DEBUG=INDOMITABILITY,Defense Decrease Damage Multiplier: 0.3
&STATUS`PUSH_INDOMITABILITY`TAGS [u(cobj,age)]=PUSH DISPLAY
&STATUS`PUSH_INDOMITABILITY`DESCRIPTION [u(cobj,age)]=Greatly reduce damage for one defense.


@@ STATUS: Signatures

&STATUS`SIG_IMPERVIOUS [u(cobj,age)]=Impervious
&STATUS`SIG_IMPERVIOUS`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_IMPERVIOUS`SIGNATURE [u(cobj,age)]=@select/inline get(%0/D`COMBAT`HYPE)=>1,{@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`SIG_IMPERVIOUS_ACTIVE))=0,{@attach %!/INC`HYPE=%0,-2,IMPERVIOUS;@attach %!/INC`SETSTATUS=%0,%0,SIG_IMPERVIOUS_ACTIVE,,0,1;@attach %!/INC`EANNOUNCE=IMPERVIOUS,[ansi(hw,%n)] engages [poss(%#)] Impervious Barrier!},{@attach %!/INC`EPRIVATE=IMPERVIOUS,Your barrier is already primed!}},{@attach %!/INC`EPRIVATE=IMPERVIOUS,You need 2 Hype to power the Barrier!,%0}

&STATUS`SIG_IMPERVIOUS_ACTIVE [u(cobj,age)]=Impervious
&STATUS`SIG_IMPERVIOUS_ACTIVE`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SIG_IMPERVIOUS_ACTIVE`DESCRIPTION [u(cobj,age)]=Negate damage exceeding 20% or 250 HP.
&STATUS`SIG_IMPERVIOUS_ACTIVE`DEFENSE_NEGATE_DAMAGE [u(cobj,age)]=@select/inline lte(firstof(%q<defbosspredam>,%q<damage>),u(hitpercent,%0,0.15,1))=1,{th u(setq,damage,0);@attach %!/INC`EANNOUNCE=IMPERVIOUS,Nothing can pierce [ansi(hw,%n)]'s absolute defense!}

&STATUS`SIG_KILLERMOVE [u(cobj,age)]=Killer Move
&STATUS`SIG_KILLERMOVE`TAGS [u(cobj,age)]=SIGNATURE DISPLAY
&STATUS`SIG_KILLERMOVE`DESCRIPTION [u(cobj,age)]=Unleash Hi-ougi at 100% charge! (Current: [ansi(hg,default(%0/D`COMBAT`STATUS`%1`CHARGE,0)\%)])
&STATUS`SIG_KILLERMOVE`STATIC`GAIN`DRIVE [u(cobj,age)]=1
&STATUS`SIG_KILLERMOVE`DEFENSE_END_TURN [u(cobj,age)]=th u(addto,%0,D`COMBAT`STATUS`%1`COUNTER,1);@select/inline isint(fdiv(get(%0/D`COMBAT`STATUS`%1`COUNTER),get(%0/D`COMBAT`OPPONENTS)))=1,{th u(addto,%0,D`COMBAT`STATUS`%1`CHARGE,u(setr,gaincharge,20));@attach %!/INC`EANNOUNCE=KILLER MOVE,%n gains [ansi(hg,%q<gaincharge>\%)] Special Meter! (Current: [ansi(hg,get(%0/D`COMBAT`STATUS`%1`CHARGE)\%)]);th unsetq(gaincharge)}
&STATUS`SIG_KILLERMOVE`ATTACK_BEFORE_LAUNCH [u(cobj,age)]=@select/inline cand(gte(%q<atklevel>,4),gte(get(%0/D`COMBAT`STATUS`%1`CHARGE),100))=1,{th u(addto,%0,D`COMBAT`STATUS`%1`CHARGE,-100);@attach %!/INC`EANNOUNCE=KILLER MOVE,Ichigeki hissatsu! [ansi(h,%n)] unleashes %p hi-ougi! ([ansi(hr,-100\% Special Meter!)] Remaining: [ansi(hg,default(%0/D`COMBAT`%1`CHARGE,0)\%)]),%0;@attach %!/INC`SETSTATUS=%0,%0,SIG_KILLERMOVE_BONUS,,1,0}
&STATUS`SIG_KILLERMOVE`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),get(%0/D`COMBAT`OPPONENTS))=1,{@select/inline gte(get(%0/D`COMBAT`HYPE),u(setr,needsighype,mul(5,get(%0/D`COMBAT`OPPONENTS))))=1,{@attach %!/INC`HYPE=%0,-%q<needsighype>,KILLER MOVE;th u(addto,%0,D`COMBAT`STATUS`%1`CHARGE,u(setr,gaincharge,20));@attach %!/INC`DRIVE=%0,mul(8,get(%0/D`COMBAT`OPPONENTS)),KILLER MOVE,[ansi(hw,%n)] focuses [poss(%0)] energy! Gains [ansi(hg,mul(8,get(%0/D`COMBAT`OPPONENTS)))] Drive and [ansi(hg,%q<gaincharge>\%)] Special Meter! (Current: [ansi(hg,get(%0/D`COMBAT`STATUS`%1`CHARGE)\%)]);th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=KILLER MOVE,You require %q<needsighype> Hype to activate Killer Move!}},0,{@attach %!/INC`EPRIVATE=KILLER MOVE,Your special meter could shatter if you push it any further!}

&STATUS`SIG_KILLERMOVE_BONUS [u(cobj,age)]=Killer Move
&STATUS`SIG_KILLERMOVE_BONUS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Extreme
&STATUS`SIG_KILLERMOVE_BONUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Extreme

&STATUS`SIG_EXECUTION [u(Cobj,age)]=Execution
&STATUS`SIG_EXECUTION`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_EXECUTION`SIGNATURE [u(cobj,age)]=@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`SIG_EXECUTION_INFLICT))=0,{@attach %!/INC`SETSTATUS=%0,%0,SIG_EXECUTION_INFLICT,,1,0;@attach %!/INC`EANNOUNCE=EXECUTION,ansi(h,%n) radiates a fierce killing intent!;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},{@attach %!/INC`EPRIVATE=EXECUTION,You are already prepared to strike a mortal blow!}

&STATUS`SIG_EXECUTION_INFLICT [u(cobj,age)]=Execution
&STATUS`SIG_EXECUTION_INFLICT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline t(match(get(%0/D`COMBAT`HISTORY`SIG_EXECUTION),%q<atker>))=0,{@attach %!/INC`SETSTATUS=%0,%q<atker>,SIG_EXECUTION_DOT,DAMAGE=%q<damage>|INCREMENT=[get(%0/D`COMBAT`OPPONENTS)],0,mul(3,get(%0/D`COMBAT`OPPONENTS));@attach %!/INC`EANNOUNCE=EXECUTION,ansi(h,%n) suffers a deadly injury! Cure cannot help %o! Beware bleeding out...;th u(attrib_set,%0,D`COMBAT`HISTORY`SIG_EXECUTION,setunion(get(%0/D`COMBAT`HISTORY`SIG_EXECUTION),%q<atker>))},1,{@attach %!/INC`EANNOUNCE=EXECUTION,ansi(h,%n) will not take another horrific wound so easily just yet!}
&STATUS`SIG_EXECUTION_INFLICT`ATTACK_NEGATE_DAMAGE [u(Cobj,age)]=th u(setq,damage,0)

&STATUS`SIG_EXECUTION_DOT [u(cobj,age)]=Execution
&STATUS`SIG_EXECUTION_DOT`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SIG_EXECUTION_DOT`TYPE [u(cobj,age)]
&STATUS`SIG_EXECUTION_DOT`DESCRIPTION [u(cobj,age)]=Suffer an Overwhelming amount of damage every defense round... (Incurable!)
&STATUS`SIG_EXECUTION_DOT`DEFENSE`DOT [u(cobj,age)]=if(eq(mod(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),default(%0/D`COMBAT`OPPONENTS`REMAINING,1)),0),bound(round(mul(get(%0/D`COMBAT`STATUS`%1`DAMAGE),switch(div(default(%0/D`COMBAT`STATUS`%1`INCREMENT,0),default(%0/D`COMBAT`OPPONENTS`REMAINING,1)),1,0.725,2,0.3625,3,0.3625,0.3625),add(1,u(scatter,10))),0),0),0)
&STATUS`SIG_EXECUTION_DOT`ON_KILL_STATUS [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`HISTORY`SIG_EXECUTION,setdiff(get(%0/D`COMBAT`HISTORY`SIG_EXECUTION),get(%0/D`COMBAT`STATUS`%1`SOURCE)))




&STATUS`SIG_ENERVATION [u(cobj,age)]=Enervation
&STATUS`SIG_ENERVATION`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_ENERVATION`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),2))=1,{@attach %!/INC`SETSTATUS=%0,%0,SIG_ENERVATION_INFLICT,FROM=%1,1,0;@attach %!/INC`EANNOUNCE=ENERVATION,ansi(h,%n)'s ready to take %p foes down a notch!;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=ENERVATION,You cannot use this again!}

&STATUS`SIG_ENERVATION_INFLICT [u(cobj,age)]=Enervation
&STATUS`SIG_ENERVATION_INFLICT`TYPE [u(cobj,age)]=ADD
&STATUS`SIG_ENERVATION_INFLICT`ATTACK_INFLICT_STATUS [u(cobj,age)]=@select/inline lt(get(%q<atker>/D`COMBAT`STATUS`[u(setr,from,get(%0/%q<atk>`STATUS`%1`FROM))]`ACTIVATED`[u(setr,debtype,if(match(2 4,%q<off>),POWPRES,ENDMIT))]),get(%0/%q<atk>`OPPONENTS))=1,{@attach %!/INC`SETSTATUS=%0,%q<atker>,SIG_ENERVATION_DEBUFF_%q<debtype>,FROM=[get(%0/%q<atk>`STATUS`%1`FROM)],if(strmatch(%q<debtype>,POWPRES),1,0),if(strmatch(%q<debtype>,ENDMIT),2,0);@attach %!/INC`EANNOUNCE=ENERVATION,ansi(h,%n) shall suffer a severe penalty to [if(match(2 4,%q<off>),Power and Precision,Endurance and Mitigation)];th u(addto,%q<atker>,D`COMBAT`STATUS`%q<from>`ACTIVATED`%q<debtype>,1)},0,{@attach %!/INC`EPRIVATE=ENERVATION,This Enervation debuff has been all used up! Refunding Enervation activation...,%q<atker>;th u(addto,%q<atker>,D`COMBAT`STATUS`%q<from>`ACTIVATED,-1)}

&STATUS`SIG_ENERVATION_DEBUFF_POWPRES [u(cobj,age)]=Enervation
&STATUS`SIG_ENERVATION_DEBUFF_POWPRES`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_ENERVATION_DEBUFF_POWPRES`DESCRIPTION [u(cobj,age)]=Incurable Severe penalty to Power and Precision
&STATUS`SIG_ENERVATION_DEBUFF_POWPRES`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Superior
&STATUS`SIG_ENERVATION_DEBUFF_POWPRES`ATTACK`PENALTY`STAT`2 [u(Cobj,age)]=Superior

&STATUS`SIG_ENERVATION_DEBUFF_ENDMIT [u(cobj,age)]=Enervation
&STATUS`SIG_ENERVATION_DEBUFF_ENDMIT`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_ENERVATION_DEBUFF_ENDMIT`DESCRIPTION [u(cobj,age)]=Incurable Severe penalty to Endurance and Mitigation
&STATUS`SIG_ENERVATION_DEBUFF_ENDMIT`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Superior
&STATUS`SIG_ENERVATION_DEBUFF_ENDMIT`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Superior

&STATUS`SIG_RESURRECTION [u(cobj,age)]=Resurrection
&STATUS`SIG_RESURRECTION`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_RESURRECTION`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),get(%0/D`COMBAT`OPPONENTS))=1,{@attach %!/INC`HEAL=%0,u(setr,healed,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),0.2),0)),,RESURRECTION,ansi(h,%n) draws in a deep breath and rises to the occasion\, recovering [ansi(hg,%q<healed>)] HP! But... will suffer a penalty to Endurance and Mitigation!;@attach %!/INC`SETSTATUS=%0,%0,SIG_RESURRECTION_DEBUFF,,0,1;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=RESURRECTION,Your well of reserve strength is dry!}

&STATUS`SIG_RESURRECTION_DEBUFF [u(cobj,age)]=Resurrection
&STATUS`SIG_RESURRECTION_DEBUFF`TAGS [u(Cobj,age)]=DISPLAY
&STATUS`SIG_RESURRECTION_DEBUFF`DESCRIPTION [u(cobj,age)]=Suffer Significant penalty to Endurance and Mitigation
&STATUS`SIG_RESURRECTION_DEBUFF`TYPE [u(cobj,age)]=ADD
&STATUS`SIG_RESURRECTION_DEBUFF`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Significant
&STATUS`SIG_RESURRECTION_DEBUFF`DEFENSE`PENALTY`STAT`3 [u(Cobj,age)]=Significant

&STATUS`SIG_TURBOOVERDRIVE [u(cobj,age)]=Turbo Overdrive
&STATUS`SIG_TURBOOVERDRIVE`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_TURBOOVERDRIVE`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),get(%0/D`COMBAT`OPPONENTS))=1,{@select/inline gt(get(%0/D`COMBAT`DRIVE),get(%0/D`COMBAT`DRIVE`MAXIMUM))=0,{@attach %!/INC`DRIVE=%0,30,TURBO OVERDRIVE,ansi(h,%n) shifts into turbo and gains [ansi(hg,30)] limit-breaking Drive!,,,1;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},1,{@attach %!/INC`EPRIVATE=TURBO OVERDRIVE,You are already past the limits! Use up some Drive first.}},0,{@attach %!/INC`EPRIVATE=TURBO OVERDRIVE,Your well of reserve strength is dry!}


&STATUS`SIG_MAXIMUMHYPE [u(cobj,age)]=Maximum Hype
&STATUS`SIG_MAXIMUMHYPE`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_MAXIMUMHYPE`SIGNATURE [u(cobj,age)]=@select/inline cand(get(%0/D`COMBAT`NUMBERS`TIMES_ATTACKED),get(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED))=1,{@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),get(%0/D`COMBAT`OPPONENTS))=1,{@select/inline lte(u(hpercent,%0),1)=1,{@attach %!/INC`HYPE=%0,6,MAXIMUM HYPE,ansi(h,%n) summons up [ansi(hg,6)] limit-breaking Hype from nowhere! Lets get ready to rumble!,,,1;@attach %!/INC`SETSTATUS=%0,%0,SIG_MAXIMUMHYPE_FINISH,,0,1;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=MAXIMUM HYPE,You are already pretty hype! Activating this now would be a waste.}},0,{@attach %!/INC`EPRIVATE=MAXIMUM HYPE,Your well of reserve strength is dry!}},0,{@attach %!/INC`EPRIVATE=MAXIMUM HYPE,This cannot be used unless you have attacked AND defended at least once each.}

&STATUS`SIG_MAXIMUMHYPE_FINISH [u(Cobj,age)]=Maximum Hype
&STATUS`SIG_MAXIMUMHYPE_FINISH`DEFENSE_END_TURN [u(Cobj,age)]=@select/inline lte(u(hpercent,%0),1)=1,{@attach %!/INC`HYPE=%0,6,MAXIMUM HYPE,ansi(h,%n) summons up another [ansi(hg,6)] limit-breaking Hype from nowhere! All systems go!,,,1},0,{@attach %!/INC`EPRIVATE=MAXIMUM HYPE,You are already hyped up! Your extra motivation sputters and is wasted.}

&STATUS`SIG_ULTIMATEDEFENSE [u(cobj,age)]=Ultimate Defense
&STATUS`SIG_ULTIMATEDEFENSE`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_ULTIMATEDEFENSE`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),6))=1,{@attach %!/INC`DRIVE=%0,-5,ULTIMATE DEFENSE,ansi(h,%n) readies for a beating!;@attach %!/INC`SETSTATUS=%0,%0,SIG_ULTIMATEDEFENSE_REDUCE,FROM=%1,0,1;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=ULTIMATE DEFENSE,Your well of reserve strength is dry!}

&STATUS`SIG_ULTIMATEDEFENSE_REDUCE [u(cobj,age)]=Ultimate Defense
&STATUS`SIG_ULTIMATEDEFENSE_REDUCE`DEFENSE_ON_MISS [u(cobj,age)]=th u(addto,%0,D`COMBAT`STATUS`[get(%0/D`COMBAT`STATUS`%1`FROM)]`ACTIVATED,-1);@attach %!/INC`DRIVE=%0,5,ULTIMATE DEFENSE,Refunded 1 use of Ultimate Defense and [ansi(hg,5 Drive)]!
&STATUS`SIG_ULTIMATEDEFENSE_REDUCE`DEFENSE_NEGATE_DAMAGE [u(cobj,age)]=@select/inline lte(%q<damage>,0)=0,{@attach %!/INC`EANNOUNCE=ULTIMATE DEFENSE,[ansi(h,%n)] reduces incoming damage from [ansi(hr,%q<damage>)] to [ansi(hr,u(setr,damage,bound(sub(%q<damage>,50),0)))]!},1,{@attach %!/STATUS`SIG_ULTIMATEDEFENSE_REDUCE`DEFENSE_ON_MISS=%0,%1}

&STATUS`SIG_UNTOUCHABLE [u(Cobj,age)]=Untouchable
&STATUS`SIG_UNTOUCHABLE`TAGS [u(cobj,age)]=SIGNATURE DISPLAY
&STATUS`SIG_UNTOUCHABLE`DESCRIPTION [u(cobj,age)]=Spend <atklevel> points to reduce attack grade! (Remaining: [sub(mul(get(%0/D`COMBAT`OPPONENTS),5),get(%0/D`COMBAT`STATUS`%1`ACTIVATED))])
&STATUS`SIG_UNTOUCHABLE`SIGNATURE [u(Cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),5))=1,{@attach %!/INC`SETSTATUS=%0,%0,SIG_UNTOUCHABLE_ACTIVATED,FROM=%1,0,1;@attach %!/INC`EANNOUNCE=UNTOUCHABLE,ansi(h,%n) is ready to dance through any danger!},0,{@attach %!/INC`EPRIVATE=UNTOUCHABLE,Your well of reserve strength is dry!}

&STATUS`SIG_UNTOUCHABLE_ACTIVATED [u(Cobj,age)]=Untouchable
&STATUS`SIG_UNTOUCHABLE_ACTIVATED`DEFENSE_FINAL_HITMUL [u(cobj,age)]=@select/inline gte(u(setr,cost,sub(sub(mul(get(%0/D`COMBAT`OPPONENTS),5),get(%0/D`COMBAT`STATUS`[u(setr,from,get(%0/D`COMBAT`STATUS`%1`FROM))]`ACTIVATED)),%q<atklevel>)),0)=1,{@select/inline gt(%q<hitmul>,0)=1,{th u(setq,hitmul,switch(%q<hitmul>,1.0,0.7,0.7,0.4,0.4,0.0,0.0,0));@attach %!/INC`EANNOUNCE=UNTOUCHABLE,ansi(h,%n) dances through the danger like a champ! Hit degraded to a [ansi(hg,switch(%q<hitmul>,0.7,Solid,0.4,Close Call,0.0,Miss))]!;@@ ... But %q<atklevel>x Minor Penalties to Endurance.;@@ @dolist/inline lnum(1,%q<atklevel>)={@attach %!/INC`SETSTATUS=%0,%0,SIG_UNTOUCHABLE_PENALTY,,0,1}},0,{@attach %!/INC`SETSTATUS=%0,%0,SIG_UNTOUCHABLE_BONUS,,0,2;@attach %!/INC`EANNOUNCE=UNTOUCHABLE,ansi(h,%n) dances through the danger like a champ! Extreme bonus to Mitigation!};th u(addto,%0,D`COMBAT`STATUS`%q<from>`ACTIVATED,%q<atklevel>)},0,{@attach %!/INC`EANNOUNCE=UNTOUCHABLE,ansi(h,%n) fails to evade!}

&STATUS`SIG_UNTOUCHABLE_PENALTY [u(cobj,age)]=Untouchable
&STATUS`SIG_UNTOUCHABLE_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_UNTOUCHABLE_PENALTY`DESCRIPTION [u(cobj,age)]=Minor penalty to Endurance
&STATUS`SIG_UNTOUCHABLE_PENALTY`DEFENSE`PENALTY`STAT`1 [u(Cobj,age)]=Minor

&STATUS`SIG_UNTOUCHABLE_BONUS [u(Cobj,age)]=Untouchable
&STATUS`SIG_UNTOUCHABLE_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_UNTOUCHABLE_BONUS`DESCRIPTION [u(cobj,age)]=Extreme Bonus to Mitigation!
&STATUS`SIG_UNTOUCHABLE_BONUS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Extreme

&STATUS`SIG_PERFECTSTRIKE [u(cobj,age)]=Perfect Strike
&STATUS`SIG_PERFECTSTRIKE`TAGS [u(cobj,age)]=SIGNATURE DISPLAY
&STATUS`SIG_PERFECTSTRIKE`DESCRIPTION [u(cobj,age)]=Spend <atklevel> points to increase attack grade! (Remaining: [sub(mul(get(%0/D`COMBAT`OPPONENTS),5),get(%0/D`COMBAT`STATUS`%1`ACTIVATED))])
&STATUS`SIG_PERFECTSTRIKE`SIGNATURE [u(Cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),5))=1,{@attach %!/INC`SETSTATUS=%0,%0,SIG_PERFECTSTRIKE_ACTIVATED,FROM=%1,1,0;@attach %!/INC`EANNOUNCE=PERFECT STRIKE,ansi(h,%n) hones %p focus to find the perfect moment!},0,{@attach %!/INC`EPRIVATE=PERFECT STRIKE,Your well of reserve strength is dry!}

&STATUS`SIG_PERFECTSTRIKE_ACTIVATED [u(Cobj,age)]=Perfect Strike
&STATUS`SIG_PERFECTSTRIKE_ACTIVATED`ATTACK_FINAL_HITMUL [u(cobj,age)]=@select/inline gte(u(setr,cost,sub(sub(mul(get(%0/%q<atk>`OPPONENTS),5),get(%q<atker>/D`COMBAT`STATUS`[u(setr,from,get(%0/%q<atk>`STATUS`%1`FROM))]`ACTIVATED)),%q<atklevel>)),0)=1,{@select/inline lt(%q<hitmul>,1)=1,{th u(setq,hitmul,switch(%q<hitmul>,0.0,0.4,0.4,0.7,0.7,1.0));@attach %!/INC`EANNOUNCE=PERFECT STRIKE,ansi(h,name(%q<atker>)) draws on honed combat instincts and delivers the ultimate blow! Hit upgraded to a [ansi(hg,switch(%q<hitmul>,1.0,Critical,0.7,Solid,0.4,Close Call,0.0,Miss))]!;@@ ... But %q<atklevel>x Minor Penalties to Power.;@@ @dolist/inline lnum(1,%q<atklevel>)={@attach %!/INC`SETSTATUS=%q<atker>,%q<atker>,SIG_PERFECTSTRIKE_PENALTY,,1,0}},0,{@attach %!/INC`SETSTATUS=%q<atker>,%q<atker>,SIG_PERFECTSTRIKE_BONUS,,1,0;@attach %!/INC`EANNOUNCE=PERFECT STRIKE,ansi(h,name(%q<atker>)) draws on honed combat instincts and delivers the ultimate blow! Extreme Precision bonus to [poss(%q<atker>)] next attack!};th u(addto,%q<atker>,D`COMBAT`STATUS`%q<from>`ACTIVATED,%q<atklevel>)},0,{@attach %!/INC`EANNOUNCE=PERFECT STRIKE,ansi(h,name(%q<atker>)) fails to land the ultimate blow!}

&STATUS`SIG_PERFECTSTRIKE_PENALTY [u(cobj,age)]=Perfect Strike
&STATUS`SIG_PERFECTSTRIKE_PENALTY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_PERFECTSTRIKE_PENALTY`DESCRIPTION [u(cobj,age)]=Minor penalty to Power
&STATUS`SIG_PERFECTSTRIKE_PENALTY`ATTACK`PENALTY`STAT`0 [u(Cobj,age)]=Minor

&STATUS`SIG_PERFECTSTRIKE_BONUS [u(Cobj,age)]=Perfect Strike
&STATUS`SIG_PERFECTSTRIKE_BONUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_PERFECTSTRIKE_BONUS`DESCRIPTION [u(cobj,age)]=Extreme Bonus to Precision!
&STATUS`SIG_PERFECTSTRIKE_BONUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Extreme

&STATUS`SIG_JUSTTHATGOOD [u(cobj,age)]=Just That Good
&STATUS`SIG_JUSTTHATGOOD`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_JUSTTHATGOOD`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Minor
&STATUS`SIG_JUSTTHATGOOD`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Minor
&STATUS`SIG_JUSTTHATGOOD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Minor
&STATUS`SIG_JUSTTHATGOOD`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Minor
&STATUS`SIG_JUSTTHATGOOD`STATIC`START`HYPE [u(cobj,age)]=3
&STATUS`SIG_JUSTTHATGOOD`SIGNATURE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=JUST THAT GOOD,ansi(h,%n) does a little dance to show off how good %s is! ... But nothing happened.

&STATUS`SIG_MULTISTAGEDEFENSE [u(cobj,age)]=Multi-Stage Defense
&STATUS`SIG_MULTISTAGEDEFENSE`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_MULTISTAGEDEFENSE`SIGNATURE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=MULTI-STAGE DEFENSE,ansi(h,%n) flaunts %p ever-increasing layers of armor. Is %s secretly a katamari?
&STATUS`SIG_MULTISTAGEDEFENSE`DEFENSE_DECREASE_DAMAGE_2 [u(cobj,age)]=@select/inline u(setr,layers,sub(5,floor(u(setr,layraw,fdiv(get(%0/D`COMBAT`STATUS`%1`COUNTER),get(%0/D`COMBAT`OPPONENTS))))))=>0,{th u(addto,%0,D`COMBAT`STATUS`%1`COUNTER,1);th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(setr,msarmor,iter(lnum(1,%q<layers>),u(scatter,7)))));u(setr,layraw2,fdiv(get(%0/D`COMBAT`STATUS`%1`COUNTER),get(%0/D`COMBAT`OPPONENTS));@attach %!/INC`EANNOUNCE=MULTI-STAGE DEFENSE,[ansi(h,%n)] sports a fancy multi-layered armoring! [if(neq(floor(%q<layraw>),floor(%q<layraw2>)),One layer breaks off! [sub(%q<layers>,1)] layers remain!,ceil(%q<layraw2>) layers remain!)];@attach %!/INC`DEBUG=MULTI-STAGE DEFENSE,Defense Decrease Damage Multiplier: %q<msarmor>;th unsetq(msarmor)},{@select/inline default(%0/D`COMBAT`STATUS`%1`FINISHED,0)=0,{@attach %!/INC`EANNOUNCE=MULTI-STAGE DEFENSE,All the extra armoring has collapsed. [ansi(h,%n)] is vulnerable!;th u(addto,%0,D`COMBAT`STATUS`%1`FINISHED,1)}}

&STATUS`SIG_COMBOMULTIPLIER [u(cobj,age)]=Combo Multiplier
&STATUS`SIG_COMBOMULTIPLIER`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_COMBOMULTIPLIER`SIGNATURE [u(cobj,age)]=@attach %!/INC`EANNOUNCE=COMBO MULTIPLIER,ansi(h,%n) flaunts %p ever-increasing battle prowess. %S isn't just mashing buttons\, right?
&STATUS`SIG_COMBOMULTIPLIER`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=@select/inline u(setr,combo,floor(fdiv(get(%0/%q<atk>`STATUS`%1`COUNTER),get(%0/%q<atk>`OPPONENTS))))=>0,{th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,u(setr,comboatkmul,iter(lnum(1,%q<combo>),u(scatter,9)))));@attach %!/INC`DEBUG=COMBO MULTIPLIER,Attack Increase Damage Multiplier: %q<comboatkmul>;th unsetq(comboatkmul);@attach %!/INC`EANNOUNCE=COMBO MULTIPLIER,[ansi(h,name(%q<atker>))] is on a roll! Combo Bonus of %q<combo>!}
&STATUS`SIG_COMBOMULTIPLIER`ATTACK_ON_DEFENSE_ENDTURN [u(cobj,age)]=th u(addto,%q<atker>,D`COMBAT`STATUS`%1`COUNTER,1);@select/inline isint(floordiv(get(%q<atker>/D`COMBAT`STATUS`%1`COUNTER),get(%0/D`COMBAT`OPPONENTS)))=1,{@attach %!/INC`EANNOUNCE=COMBO MULTIPLIER,ansi(h,name(%q<atker>)) builds up more and more battle prowess!}


&STATUS`SIG_ARMORSLAYER [u(Cobj,age)]=Armor Slayer
&STATUS`SIG_ARMORSLAYER`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_ARMORSLAYER`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),8))=1,{@attach %!/INC`SETSTATUS=%0,%0,SIG_ARMORSLAYER_ACTIVATED,FROM=%1,1,0;@attach %!/INC`EANNOUNCE=ARMOR SLAYER,ansi(h,%n) is a menace to any defense! Beware!;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)},0,{@attach %!/INC`EPRIVATE=ARMOR SLAYER,Your well of reserve strength is dry!}

&STATUS`SIG_ARMORSLAYER_ACTIVATED [u(Cobj,age)]=Armor Slayer
&STATUS`SIG_ARMORSLAYER_ACTIVATED`ATTACK_SPECIAL_DAMAGE [u(cobj,age)]=th u(setq,armorslayer,add(1,%q<armorslayer>));@select/inline lte(%q<armorslayer>,%q<atklevel>)=1,{th u(setq,damage,add(%q<damage>,20));@attach %!/INC`EANNOUNCE=ARMOR SLAYER,The blow cleaved through the [u(numth,%q<armorslayer>)] armor layer!},0,{@attach %!/INC`EANNOUNCE=ARMOR SLAYER,The blow lacked the power to pierce that much armor. (Excess uses Refunded.);th u(addto,%q<atker>,D`COMBAT`STATUS`[get(%0/D`COMBAT`STATUS`%1`FROM)]`ACTIVATED,-1)}


&STATUS`SIG_MIRACLE [u(Cobj,age)]=Miracle
&STATUS`SIG_MIRACLE`TAGS [u(Cobj,age)]=SIGNATURE
&STATUS`SIG_MIRACLE`SIGNATURE [u(cobj,age)]=@attach %!/INC`DRIVE=%0,-1,MIRACLE,ansi(h,%n) prays for a miracle... and is answered! %p dice rolls will use the better of two outcomes for the next attack or defense. ([ansi(hr,-1 Drive)]).;@attach %!/INC`SETSTATUS=%0,%0,SIG_MIRACLE_ACTIVE,1,1;

&STATUS`SIG_MIRACLE_ACTIVE [u(Cobj,age)]=Miracle
&STATUS`SIG_MIRACLE_ACTIVE`TAGS [u(Cobj,age)]=FRAGILE
&STATUS`SIG_MIRACLE_ACTIVE`ATTACK_ON_CALCULATE [u(cobj,age)]=th u(setq,rerollbestatk,2)
&STATUS`SIG_MIRACLE_ACTIVE`DEFENSE_ON_CALCULATE [u(Cobj,age)]=th u(setq,rerollbestdef,2)

&STATUS`SIG_EXACTION [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION`TAGS [u(cobj,age)]=SIGNATURE
&STATUS`SIG_EXACTION`SIGNATURE [u(cobj,age)]=@select/inline lt(get(%0/D`COMBAT`STATUS`%1`ACTIVATED),mul(get(%0/D`COMBAT`OPPONENTS),3))=1,{@select/inline words(get(%0/D`COMBAT`ACTIVE`STATUS`SIG_EXACTION_ACTIVATED))=>0,{@attach %!/INC`EPRIVATE=EX ACTION,EX Action is already active! Give it your all!},0,{@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_ACTIVATED,FROM=%1,2,2;@attach %!/INC`EANNOUNCE=EX Action,ansi(h,%n) prepares to go even further beyond! Beware!;th u(addto,%0,D`COMBAT`STATUS`%1`ACTIVATED,1)}},0,{@attach %!/INC`EPRIVATE=EX ACTION,Your well of reserve strength is dry!}

&STATUS`SIG_EXACTION_ACTIVATED [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_ACTIVATED`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_ACTIVATED`DESCRIPTION [u(cobj,age)]=Next Attack or Defense is EX Enhanced!
&STATUS`SIG_EXACTION_ACTIVATED`OFF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_CONSISTENT_FOCUS,,1,0;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Superior Bonus to Precision!
&STATUS`SIG_EXACTION_ACTIVATED`OFF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_FORCEFUL_BOLSTER,,1,0;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Superior Bonus to Power!
&STATUS`SIG_EXACTION_ACTIVATED`OFF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_EFFICIENT,,1,0;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Attack Drive costs reduced!
&STATUS`SIG_EXACTION_ACTIVATED`OFF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`HYPE=%#,4,EX Action
&STATUS`SIG_EXACTION_ACTIVATED`DEF`1`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_CONSISTENT_FOCUS,,1,0;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Superior Bonus to Precision!
&STATUS`SIG_EXACTION_ACTIVATED`DEF`2`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_FORCEFUL_BOLSTER,,1,0;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Superior Bonus to Power!
&STATUS`SIG_EXACTION_ACTIVATED`DEF`3`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_GUARD,,0,1;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Extreme Bonus to Endurance!
&STATUS`SIG_EXACTION_ACTIVATED`DEF`4`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_MANEUVER,,0,1;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Extreme Bonus to Mitigation!
&STATUS`SIG_EXACTION_ACTIVATED`DEF`5`ACTIVATE [u(cobj,age)]=@attach %!/INC`SETSTATUS=%0,%0,SIG_EXACTION_RALLY,,0,1;@attach %!/INC`EANNOUNCE=EX ACTION,ansi(h,%n) pushes to the very limits! Drive and Defense stats boosted!
&STATUS`SIG_EXACTION_ACTIVATED`ATTACK_END_TURN [u(Cobj,age)]=@attach %!/KILLSTATUS=%0,%1;
&STATUS`SIG_EXACTION_ACTIVATED`DEFENSE_END_TURN [u(cobj,age)]=@attach %!/KILLSTATUS=%0,%1;

&STATUS`SIG_EXACTION_CONSISTENT_FOCUS [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_CONSISTENT_FOCUS`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_CONSISTENT_FOCUS`DESCRIPTION [u(cobj,age)]=Massive Bonus to Precision
&STATUS`SIG_EXACTION_CONSISTENT_FOCUS`TYPE [u(cobj,age)]=ADD
&STATUS`SIG_EXACTION_CONSISTENT_FOCUS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Massive

&STATUS`SIG_EXACTION_FORCEFUL_BOLSTER [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_FORCEFUL_BOLSTER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_FORCEFUL_BOLSTER`DESCRIPTION [u(cobj,age)]=Massive Bonus to Power
&STATUS`SIG_EXACTION_FORCEFUL_BOLSTER`TYPE [u(cobj,age)]=ADD
&STATUS`SIG_EXACTION_FORCEFUL_BOLSTER`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Massive

&STATUS`SIG_EXACTION_MANEUVER [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_MANEUVER`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_MANEUVER`DESCRIPTION [u(cobj,age)]=Massive Bonus to Mitigation
&STATUS`SIG_EXACTION_MANEUVER`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Massive

&STATUS`SIG_EXACTION_GUARD [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_GUARD`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_GUARD`DESCRIPTION [u(cobj,age)]=Massive Bonus to Endurance
&STATUS`SIG_EXACTION_GUARD`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Massive

&STATUS`SIG_EXACTION_EFFICIENT [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_EFFICIENT`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_EFFICIENT`DESCRIPTION [u(cobj,age)]=Solid Bonus to Power and Precision
&STATUS`SIG_EXACTION_EFFICIENT`ATTACK`BONUS`STAT`0 [u(cobj,age)]=Solid
&STATUS`SIG_EXACTION_EFFICIENT`ATTACK`BONUS`STAT`2 [u(cobj,age)]=Solid

&STATUS`SIG_EXACTION_RALLY [u(cobj,age)]=EX Action
&STATUS`SIG_EXACTION_RALLY`TAGS [u(cobj,age)]=DISPLAY
&STATUS`SIG_EXACTION_RALLY`DESCRIPTION [u(cobj,age)]=+5 passive Drive. Moderate Bonus to Endurance and Mitigation
&STATUS`SIG_EXACTION_RALLY`DEFENSE`BONUS`DRIVE_GAIN [u(cobj,age)]=5
&STATUS`SIG_EXACTION_RALLY`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=Moderate
&STATUS`SIG_EXACTION_RALLY`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=Moderate

@@ Enhancements
&STATUS`ENH_POWER [u(cobj,age)]=Enhanced Power
&STATUS`ENH_POWER`TAGS [u(Cobj,age)]=ENHANCEMENT
&STATUS`ENH_POWER`ATTACK_INCREASE_DAMAGE_2 [u(cobj,age)]=@select/inline lte(u(setr,enpowrand,rand(1,100)),25)=1,{th u(setq,atkincdamagemul,linsert(%q<atkincdamagemul>,-1,u(scatter,20)));@attach %!/INC`EANNOUNCE=ENHANCED POWER,ansi(h,name(%q<atker>)) is stronger than [subj(%q<atker>)] looks! Damage bonus!};@attach %!/INC`DEBUG=ENHANCED POWER,Damage Bonus rand: %q<enpowrand>/25;th unsetq(enpowrand)

&STATUS`ENH_PRECISION [u(cobj,age)]=Enhanced Precision
&STATUS`ENH_PRECISION`TAGS [u(Cobj,age)]=ENHANCEMENT
&STATUS`ENH_PRECISION`ATTACK_INCREASE_HITMUL [u(cobj,age)]=@select/inline %q<hitmul>=0.7,{@select/inline lte(u(setr,enprerand,rand(1,100)),20)=1,{th u(setq,hitmul,1.0);@attach %!/INC`EANNOUNCE=ENHANCED PRECISION,ansi(h,name(%q<atker>)) is startlingly accurate! Strike upgraded from a Solid to Critical Hit!};@attach %!/INC`DEBUG=ENHANCED PRECISION,Strike Upgrade rand: %q<enprerand>/20}

&STATUS`ENH_ENDURANCE [u(Cobj,age)]=Enhanced Endurance
&STATUS`ENH_ENDURANCE`TAGS [u(cobj,age)]=ENHANCEMENT
&STATUS`ENH_ENDURANCE`DEFENSE_DECREASE_DAMAGE_2 [u(Cobj,age)]=@select/inline lte(u(setr,enendrand,rand(1,100)),25)=1,{th u(setq,defdecdamagemul,linsert(%q<defdecdamagemul>,-1,u(scatter,17)));@attach %!/INC`EANNOUNCE=ENHANCED ENDURANCE,ansi(h,%n) is much tougher than %s looks! Damage decreased!};@attach %!/INC`DEBUG=ENHANCED ENDURANCE,Defense Decrease Damage Multiplier Rand: %q<enendrand>/25

&STATUS`ENH_MITIGATION [u(Cobj,age)]=Enhanced Mitigation
&STATUS`ENH_MITIGATION`TAGS [u(Cobj,age)]=ENHANCEMENT
&STATUS`ENH_MITIGATION`DEFENSE_DECREASE_HITMUL [u(cobj,age)]=@select/inline %q<hitmul>=0.4,{@select/inline lte(u(setr,enmitrand,rand(1,100)),15)=1,{th u(setq,hitmul,0.0);@attach %!/INC`EANNOUNCE=ENHANCED MITIGATION,ansi(h,%n) is much quicker than %s looks! Strike downgraded from a Close Call to a complete Miss! Whoosh!};@attach %!/INC`DEBUG=ENHANCED MITIGATION,Strike Downgrade rand: %q<enmitrand>/15;th unsetq(enmitrand)}

&STATUS`ENH_DRIVE [u(cobj,age)]=Enhanced Drive
&STATUS`ENH_DRIVE`TAGS [u(cobj,age)]=ENHANCEMENT
&STATUS`ENH_DRIVE`STATIC`GAIN`DRIVE [u(cobj,age)]=2
&STATUS`ENH_DRIVE`DEFENSE`BONUS`DRIVE_GAIN`EXEMPT [u(cobj,age)]=2

@@ COMBAT CODE

&CMD`COMBAT [u(cobj,age)]=$^(?s)\+(attack|defend|stats|sheet|reset|push|queue|cancel|health|boss|scan|support|keeps|forgive|quirk|sig|signature|meister|pull|scale|restrain|sell|hardsell|takehit)(?\:/(\S+))?(?\: +(.+?))?(?\:/(.+?)?)?(?\:=(.*))?$:th u(setq,command,switch(%1,sig,SIGNATURE,%1));th u(setq,sysname,COMBAT);@attach %!/INC`GETSWITCH=%2;@attach %!/INC`CHECKPC=%#,1;@attach %!/INC`%q<sysname>`%q<command>`[u(strfirstof,%q<switch>,MAIN)]=%3,%4,%5
@set [u(cobj,age)]/CMD`COMBAT=regexp

&COMBAT`PUSH`PLAYER [u(cobj,age)]=LIST
&COMBAT`PUSH`ADMIN [u(cobj,age)]=

@@ Takehit
&INC`COMBAT`TAKEHIT`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat-ready!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Consequences severity field empty.;@attach %!/INC`PARTIAL=%0,MILD|MODERATE|SEVERE|NONE,|,severity;@check gt(u(setr,newcon,switch(%q<severity>,NONE,0,MILD,1,MODERATE,2,SEVERE,3)),get(%#/D`CONSEQUENCES))=@attach %!/INC`MSG=ERROR: You can only Takehit for more intense Consequences than you already have.;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will guarantee at least %q<severity> Consequences after this fight. Did you enter the right grade? Enter this command again within ten seconds to verify.,TAKEHIT %q<severity>;@attach %!/INC`EANNOUNCE=TAKEHIT,[ansi(hw,%n)] will voluntarily take [capstr(lcstr(switch(%q<severity>,NONE,No,%q<severity>)))] Consequences this day!;@attach %!/INC`CONSEQUENCES`SET=%#,get(%#/D`COMBAT`MANTLE`LINK),%q<newcon>

@@ SCALE

&COMBAT`SCALE`PLAYER [u(Cobj,age)]=CHANGE
@@ @check get(%#/D`CSYS`MANTLE`LOCKED)=@attach %!/INC`MSG=ERROR: Can only use +boss with loaner Mantles.;

&INC`COMBAT`SCALE`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`SCALE`CHANGE

@@ @check isint(get(%#/D`CSYS`MANTLE))=@attach %!/INC`MSG=ERROR: Your Mantle is not set.;@stop get(%#/D`CSYS`MANTLE`LOCKED)=@attach %!/INC`MSG=ERROR: Can only use +scale with your own Mantles.;@attach %!/INC`VALID`POSINT=%0;@stop lt(%q<value>,2)=@attach %!/INC`MSG=ERROR: Scale requires a value 2 or greater!;@attach %!/INC`MSG=You will Scale %q<value> opponents when you next +reset!;&D`CSYS`OPPONENTS %#=%q<value>;&D`CSYS`MODE %#=SCALE;

&INC`COMBAT`SCALE`CHANGE [u(cobj,age)]=@check isint(get(%#/D`CSYS`MANTLE))=@attach %!/INC`MSG=ERROR: Your Mantle is not set.;@stop get(%#/D`CSYS`MANTLE`LOCKED)=@attach %!/INC`MSG=ERROR: Can only use +scale with your own Mantles.;@stop match(BOSS,get(%#/D`COMBAT`MODE))=@attach %!/INC`MSG=ERROR: Cannot change to Scale mode from Boss mode.;@attach %!/INC`VALID`POSINT=%0;@attach %!/INC`COMBAT`SCALE`CHANGE`DO=%#,%q<value>;@attach %!/INC`EANNOUNCE=SCALE,%n is now tanking for %q<value> opponents!

&INC`COMBAT`SCALE`CHANGE`DO [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`OPPONENTS,%1);th u(attrib_set,%0,D`COMBAT`MODE,SCALE);th u(setq,damper,u(percent,%0));th u(setq,drper,u(dpercent,%0));th u(setq,hper,u(hpercent,%0));th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),get(%0/D`COMBAT`OPPONENTS)),0));th u(attrib_set,%0,D`COMBAT`DAMAGE,round(mul(get(%0/D`COMBAT`HEALTH),sub(1,%q<damper>)),0));th u(attrib_set,%0,D`COMBAT`DRIVE`MAXIMUM,round(mul(get(%0/D`COMBAT`DRIVE`MAXIMUM`ORIGINAL),get(%0/D`COMBAT`OPPONENTS)),0));th u(attrib_set,%0,D`COMBAT`DRIVE,round(mul(get(%0/D`COMBAT`DRIVE`MAXIMUM),%q<drper>),0));th u(attrib_set,%0,D`COMBAT`HYPE`MAXIMUM,round(mul(get(%0/D`COMBAT`HYPE`MAXIMUM`ORIGINAL),get(%0/D`COMBAT`OPPONENTS)),0));th u(attrib_set,%0,D`COMBAT`HYPE,round(mul(get(%0/D`COMBAT`HYPE`MAXIMUM),%q<hper>),0))

@@ Boss
&COMBAT`BOSS`PLAYER [u(cobj,age)]=CASUAL|NORMAL|SERIOUS

&INC`COMBAT`BOSS`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`BOSS`NORMAL

&INC`COMBAT`BOSS`CASUAL [u(cobj,age)]=@attach %!/INC`COMBAT`BOSS`CHANGE=%0,CASUAL
&INC`COMBAT`BOSS`NORMAL [u(cobj,age)]=@attach %!/INC`COMBAT`BOSS`CHANGE=%0,NORMAL
&INC`COMBAT`BOSS`SERIOUS [u(cobj,age)]=@attach %!/INC`COMBAT`BOSS`CHANGE=%0,SERIOUS

&INC`COMBAT`BOSS`CHANGE [u(cobj,age)]=@check isint(get(%#/D`ARMORY`MAIN`MANTLE`LINK))=@attach %!/INC`MSG=ERROR: Your Mantle is not set.;@attach %!/INC`VALID`POSINT=%0;@attach %!/INC`COMBAT`BOSS`CHANGE`DO=%#,%q<value>,%1;@attach %!/INC`EANNOUNCE=BOSS,%n is [switch(%q<value>,1,no longer in Boss mode!,now [ansi(switch(%1,casual,hg,normal,hy,serious,hr,hw),capstr(lcstr(%1)))] Boss'ing for %q<value> opponents!)]

&INC`COMBAT`BOSS`CHANGE`DO [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`OPPONENTS,%1);th u(attrib_set,%0,D`COMBAT`OPPONENTS`REMAINING,%1);th u(setq,damper,u(percent,%0));th u(setq,drper,u(dpercent,%0));th u(setq,hper,u(hpercent,%0));@select/inline %1=>1,{th u(attrib_set,%0,D`COMBAT`MODE,BOSS);th u(attrib_set,%0,D`COMBAT`BOSSMODE,%2)},1,{@attach %!/WIPE=%0,D`COMBAT`*MODE};th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),add(1,mul(u(conf,BOSS_EXTRA_HP),sub(%1,1)))),0));th u(attrib_set,%0,D`COMBAT`HYPE`MAXIMUM,switch(%1,1,get(%0/D`COMBAT`HYPE`MAXIMUM`ORIGINAL),mul(get(%0/D`COMBAT`HYPE`MAXIMUM`ORIGINAL),%1)));th u(attrib_set,%0,D`COMBAT`DRIVE`MAXIMUM,switch(%1,1,get(%0/D`COMBAT`DRIVE`MAXIMUM`ORIGINAL),mul(get(%0/D`COMBAT`DRIVE`MAXIMUM`ORIGINAL),%1)));th u(attrib_set,%0,D`COMBAT`DAMAGE,round(mul(get(%0/D`COMBAT`HEALTH),sub(1,%q<damper>)),0));th u(attrib_set,%0,D`COMBAT`HYPE,round(mul(get(%0/D`COMBAT`HYPE`MAXIMUM),%q<hper>),0));th u(attrib_set,%0,D`COMBAT`DRIVE,round(mul(get(%0/D`COMBAT`DRIVE`MAXIMUM),%q<drper>),0))


@@ Quirk
&COMBAT`QUIRK`PLAYER [u(cobj,age)]=ADD|REMOVE|WIPE

&INC`COMBAT`QUIRK`MANTLE [u(Cobj,age)]=@check u(setr,centity_id,get(%#/D`ARMORY`MAIN`MANTLE`ID))=@attach %!/INC`MSG=ERROR: No Mantle selected!;@stop get(%#/D`ARMORY`MAIN`MANTLE`LOCKED)=@attach %!/INC`MSG=ERROR: This Mantle is read-only.

&INC`COMBAT`QUIRK`TARGET [u(Cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Quirk name entered!;@check u(setr,quirk_id,u(FIND_TRAIT,QRK,%0))=@attach %!/INC`MSG=ERROR: Could not find Quirk named '%0'.

&INC`COMBAT`QUIRK`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`MSG=You are currently using Quirks: [iter(u(mysql,SELECT`MANTLE_LINK`QUIRK,%q<centity_id>),default(u(cobj,agedb)/QRK`%i0,<unset>),%b,\,%b)]

&INC`COMBAT`QUIRK`ADD [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;th u(setq,maxquirks,add(3,get(u(cobj,age)/STATUS`[get(u(cobj,agedb)/ARC`[get(%#/D`ARMORY`MAIN`MANTLE`ARCHETYPE)]`STATUS)]`STATIC`MAXIMUM`QUIRKS)));@stop gte(u(mysql,COUNT`MANTLE_LINK`QUIRK,%q<centity_id>),%q<maxquirks>)=@attach %!/INC`MSG=ERROR: You are already at your maximum of %q<maxquirks> Quirks.;@attach %!/INC`COMBAT`QUIRK`TARGET;@stop u(mysql,EXIST`MANTLE_LINK`QUIRK,%q<centity_id>,%q<quirk_id>)=@attach %!/INC`MSG=ERROR: You already are using that Quirk.;@attach %!/INC`DOSQL=ADD`MANTLE_LINK`QUIRK,%q<centity_id>,%q<quirk_id>;@attach %!/INC`MSG=You have selected the '[default(u(cobj,agedb)/QRK`%q<quirk_id>,<unset>)]' Quirk! You must +reset for this to reflect in your +stats.

&INC`COMBAT`QUIRK`REMOVE [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`COMBAT`QUIRK`TARGET;@check u(mysql,EXIST`MANTLE_LINK`QUIRK,%q<centity_id>,%q<quirk_id>)=@attach %!/INC`MSG=ERROR: You are not using that Quirk.;@attach %!/INC`DOSQL=REMOVE`MANTLE_LINK`QUIRK,%q<centity_id>,%q<quirk_id>;@attach %!/INC`MSG=You have removed the '[default(u(cobj,agedb)/QRK`%q<quirk_id>,<unset>)]' Quirk! You must +reset for this to reflect in your +stats.

&INC`COMBAT`QUIRK`WIPE [u(Cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will remove all Quirks from your Mantle. Are you sure? Enter the command again to verify.,WIPE %q<centity_id> QUIRKS;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`QUIRK,%q<centity_id>;@attach %!/INC`MSG=All Quirks wiped! You must +reset for this to reflect in your +stats.

&Q`EXIST`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT trait_value FROM vol_ctrait where trait_type=2 AND centity_id=? AND trait_id=?
&Q`ADD`MANTLE_LINK`QUIRK [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,2,1)
&Q`REMOVE`MANTLE_LINK`QUIRK [u(cobj,age)]=DELETE FROM vol_ctrait WHERE centity_id=? AND trait_type=2 AND trait_id=?
&Q`WIPE`MANTLE_LINK`QUIRK [u(cobj,age)]=DELETE FROM vol_ctrait WHERE centity_id=? AND trait_type=2
&Q`SELECT`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_type=2
&Q`COUNT`MANTLE_LINK`QUIRK [u(cobj,age)]=SELECT COUNT(*) FROM vol_ctrait WHERE centity_id=? AND trait_type=2

@@ Signature

&COMBAT`SIGNATURE`PLAYER [u(cobj,age)]=SET|WIPE

&INC`COMBAT`SIGNATURE`TARGET [u(Cobj,age)]=@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Signature name entered!;@check u(setr,sig_id,u(FIND_TRAIT,SIG,%0))=@attach %!/INC`MSG=ERROR: Could not find Signature named '%0'.

&INC`COMBAT`SIGNATURE`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready!;@check words(u(setr,sigs,get(%#/D`COMBAT`ACTIVE`STATUS`TAGS`SIGMOVE)))=@attach %!/INC`MSG=ERROR: You have no Signature Ability to activate! Sucks.;@dolist/inline %q<sigs>={@attach %!/STATUS`[before(%i0,$)]`SIGNATURE=%#,%i0}

&INC`COMBAT`SIGNATURE`SET [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`COMBAT`SIGNATURE`TARGET;@stop u(mysql,EXIST`SIGLINK,%q<centity_id>,%q<sig_id>)=@attach %!/INC`MSG=[ansi(hr,ERROR:)] You have already equipped that Signature technique!;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`SIG,%q<centity_id>;@attach %!/INC`DOSQL=ADD`MANTLE_LINK`SIG,%q<centity_id>,%q<sig_id>;@attach %!/INC`MSG=You have selected the '[default(u(cobj,agedb)/SIG`%q<sig_id>,<unset>)]' Signature Ability! You must +reset for this to reflect in your +stats.

&INC`COMBAT`SIGNATURE`WIPE [u(Cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will remove all Signatures from your Mantle excluding Meister Signature. Are you sure? Enter the command again to verify.,WIPE %q<centity_id> SIGNATURE;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`SIG,%q<centity_id>;@attach %!/INC`MSG=Signature wiped! You must +reset for this to reflect in your +stats.

&Q`ADD`MANTLE_LINK`SIG [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,4,1)
&Q`WIPE`MANTLE_LINK`SIG [u(cobj,age)]=DELETE FROM vol_ctrait WHERE centity_id=? AND trait_type=4
&Q`EXIST`SIGLINK [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_id=? AND trait_type IN (4,5)

@@ Meister
&COMBAT`MEISTER`PLAYER [u(cobj,age)]=SET|CLEAR|WIPE

&INC`COMBAT`MEISTER`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready!;@check eq(124,get(%#/D`ARMORY`MAIN`MANTLE`ARCHETYPE))=@attach %!/INC`MSG=ERROR: You are not a Meister!;@check words(u(setr,sigs,get(%#/D`COMBAT`ACTIVE`STATUS`TAGS`MEISTER)))=@attach %!/INC`MSG=ERROR: You have no Meister Signature Ability to activate! Sucks.;@dolist/inline %q<sigs>={@attach %!/STATUS`[before(%i0,$)]`SIGNATURE=%#,%i0}

&INC`COMBAT`MEISTER`SET [u(cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@check eq(124,get(%#/D`ARMORY`MAIN`MANTLE`ARCHETYPE))=@attach %!/INC`MSG=ERROR: You are not a Meister!;@attach %!/INC`COMBAT`SIGNATURE`TARGET;@stop u(mysql,EXIST`SIGLINK,%q<centity_id>,%q<sig_id>)=@attach %!/INC`MSG=[ansi(hr,ERROR:)] You have already equipped that Signature technique!;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`MEISTER,%q<centity_id>;@attach %!/INC`DOSQL=ADD`MANTLE_LINK`MEISTER,%q<centity_id>,%q<sig_id>;@attach %!/INC`MSG=You have selected the '[default(u(cobj,agedb)/SIG`%q<sig_id>,<unset>)]' Signature Ability! You must +reset for this to reflect in your +stats.

&Q`ADD`MANTLE_LINK`MEISTER [u(cobj,age)]=INSERT INTO vol_ctrait (centity_id,trait_id,trait_type,trait_value) VALUES (?,?,5,1)
&Q`WIPE`MANTLE_LINK`MEISTER [u(cobj,age)]=DELETE FROM vol_ctrait WHERE centity_id=? AND trait_type=5

&INC`COMBAT`MEISTER`WIPE [u(Cobj,age)]=@attach %!/INC`COMBAT`QUIRK`MANTLE;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will remove all Meister Signatures from your Mantle. Are you sure? Enter the command again to verify.,WIPE %q<centity_id> MEISTER;@attach %!/INC`DOSQL=WIPE`MANTLE_LINK`MEISTER,%q<centity_id>;@attach %!/INC`MSG=Signature wiped! You must +reset for this to reflect in your +stats.

@@ Forgive
&COMBAT`FORGIVE`ADMIN [u(cobj,age)]=ALL

&INC`COMBAT`FORGIVE`ALL [u(cobj,age)]=@attach %!/INC`CHECKPC=%0,1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not combat-ready!;@@ @check nattr(%q<t1>/D`CONSEQUENCES`**)=@attach %!/INC`MSG=ERROR: %q<t1name> suffers from no consequences.;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will clear all Consequences from %q<t1name> and force them to reset. Do not use in the middle of a fight. Are you sure? Enter the same command again to continue.,FORGIVE ALL %q<t1>;@attach %!/INC`DOSQL=FORGIVE`CONSEQUENCES,%q<t1id>;@attach %!/INC`MSG=Consequences forgiven!;@attach %!/INC`MSG`CHAN=Forgave All Consequences for %q<t1name>;@attach %!/INC`MSG=Your combat Consequences have been fully forgiven and combat status reset!,%q<t1>;@attach %!/INC`COMBAT`READYCHARACTER=%q<t1objid>,get(%q<t1>/D`ARMORY`MAIN`MANTLE`LINK)

&INC`COMBAT`FORGIVE`MAIN [u(cobj,age)]=

&Q`FORGIVE`CONSEQUENCES [u(cobj,age)]=UPDATE vol_clink SET consequences_date_timeout=SET_NULL,consequences_date_gained=SET_NULL WHERE character_id=?

@@ Support
&INC`COMBAT`SUPPORT`MAIN [u(cobj,age)]=@check hasattr(%#/D`COMBAT`SUPPORTING)=@attach %!/INC`MSG=ERROR: You are not a Synergist Archetype!;@check gt(u(percent,%#),0)=@attach %!/INC`MSG=ERROR: You are KO'd!;@check strmatch(objid(get(%#/D`COMBAT`SUPPORTING)),%:)=@attach %!/INC`MSG=ERROR: Support Effect has already been assigned!;@attach %!/INC`CHECKPC=%0,2;@check nattr(%q<t2>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t2name> is not combat ready!;@check gt(u(percent,%q<t2>),0)=@attach %!/INC`MSG=ERROR: %q<t2name> is KO'd!;@check strmatch(loc(%q<t2>),%l)=@attach %!/INC`MSG=ERROR: %q<t2name> is not present!;@check hasflag(%q<t2>,CONNECTED)=@attach %!/INC`MSG=ERROR: %q<t2name> is not connected!;@check strlen(u(setr,supactive,get(%#/D`COMBAT`ACTIVE`STATUS`[u(setr,supname,get(%#/D`COMBAT`SUPPORT))])))=@attach %!/INC`MSG=ERROR: Code Error. Synergist is not properly configured. Contact Volund.;@attach %!/KILLSTATUS=%#,%q<supactive>;@attach %!/INC`SETSTATUS=%q<t2>,%#,%q<supname>,,X,X;&D`COMBAT`SUPPORTING %#=%q<t2objid>;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`ON_SUPPORT=%#,%i0,%q<t2objid>};@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] lends Synergist Support to [ansi(hw,%q<t2name>)]!;@attach %!/WIPE=%#,D`COMBACK

@@ Cancel

&INC`COMBAT`CANCEL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBACK`**)=@attach %!/INC`MSG=ERROR: You cannot restore a previous state now.;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will restore combat state before launching any attacks or using Pushes. Are you sure? Enter the same command again to verify.,COMBAT RESTORE;@dolist/inline get(%#/D`COMCHECK`ATTACKED)={@attach %!/WIPE=%i0,D`COMBAT`Q`%#;@pemit %i0=[ansi(90,COMBAT:)]%B[ansi(hw,%n)] withdrew their attack against you!};@attach %!/WIPE=%#,D`COMCHECK`ATTACKED;@attach %!/WIPE=%#,D`COMBAT;@attach %!/INC`MVTREE=%#,D`COMBACK,%#,D`COMBAT;@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] undid canceled all combat actions!

@@ Scan
&INC`COMBAT`SCAN`MAIN [u(cobj,age)]=@pemit %#=u(header,Combatants);@pemit %#=ansi(u(color,%#,COLUMN_NAMES),align(15 15 10 10 10 12,Name,Archetype,Weight,Drive,HP,Consequences));@pemit %#=u(separator);@dolist/inline u(filter,COMBATREADY,lplayers(%l))={@pemit %#=align(15 15 10 10 10 12,u(getmoniker,%i0),u(GET`ARCHETYPE,%i0)[if(get(%i0/D`COMBAT`MANTLE`LOCKED),\(P\))],ansi(u(scalecolor,get(%i0/D`COMBAT`STATS`4)),u(fancyweight,%i0))[if(get(%i0/D`COMBAT`ACCOLADES),[ansi(hw,+)][ansi(%q<qcolor>,get(%i0/D`COMBAT`ACCOLADES))])],get(%i0/D`COMBAT`DRIVE`STATUS),ansi(u(ryg,sub(100,bound(u(setr,hp,round(mul(u(percent,%i0),100),0)),0))),%q<hp>\%),u(fancycon,%i0))};@pemit %#=u(footer)

&FANCYCON [u(cobj,age)]=switch(%0,1,ansi(228,Mild),2,ansi(215,Moderate),3,ansi(202,Severe),ansi(hx,None))
&FANCYCON2 [u(cobj,age)]=switch(%0,1,ansi(228,Mild),2,ansi(215,Moderate),3,ansi(202,Severe),ansi(hx,No Consequences))

&FIL`COMBATREADY [u(cobj,age)]=cand(hasflag(%0,CONNECTED),nattr(%0/D`COMBAT`**))

@@ MANTLE SELECT


@@ CSETUP

&INC`MATRIX`CSETUP [u(cobj,age)]=@check u(tester,%#)=@attach %!/INC`MSG=ERROR: Permission denied.;@attach %!/INC`CHECKPC=%0,1;@force/inline %q<t1>={+mantle %q<t1name>;+reset;+reset};@@ @attach %!/INC`COMBAT`READYCHARACTER=%q<t1objid>,get(%q<t1>/D`ARMORY`MAIn`MANTLE`LINK);@attach %!/INC`MSG=You have setup %q<t1name> for battle!




@@ RADAR
&INC`COMBAT`RADAR`MAIN [u(cobj,age)]=@select/inline strlen(%0)=>0,{@attach %!/INC`CHECKPC=%0,1;th u(setq,radar,%q<t1>)},{th u(setq,radar,u(filter,RADAR,u(lvplayers,%l)))};@check words(%q<radar>)=@attach %!/INC`MSG=Nobody to show up on your radar. Bummer!;@pemit %#=u(header,Radar Display);@pemit %#=ansi(u(color,%#,COMBAT,COLUMN_NAMES),align(20 25 12 8 10,Pilot,Mecha,Size,Health,Heat));@pemit %#=u(separator);@dolist/inline %q<radar>={@pemit %#=align(20 25 12 8 10,u(getproperty,%i0,BANNER)[if(strmatch(u(setr,pilname,get(%i0/D`COMBAT`STATS`PILOT)),name(%i0)),,%b\(as %q<pilname>\))],get(%i0/D`COMBAT`STATS`MECHA),u(mechsize,%i0),u(RADARHP,%i0),u(heatstatus,%i0))};@pemit %#=u(footer)

&FIL`RADAR [u(cobj,age)]=t(cand(nattr(%0/D`COMBAT`**),not(get(%0/D`OBSERVER))))

&RADARHP [u(cobj,age)]=switch(before(mul(u(percent,%0),100),.),100,Perfect,>79,Excellent,>59,Good,>39,Fine,>19,Damaged,>0,Critical,Scrap)

@@ READY CHARACTER

&Q`LOAD`CLINK [u(cobj,age)]=SELECT clink_id,character_id,character_name,character_objid,clink_approved,clink_loan_from,loan_from_name,loan_from_objid,clink_type,clink_locked,consequences_date_gained_secs,consequences_date_timeout_secs,consequences_scenes,centity_id,centity_name,centity_type,centity_version,centity_owner,centity_owner_name,centity_owner_type,centity_owner_objid,centity_date_created_secs,centity_claim_lock,centity_approved FROM volv_clink WHERE clink_id=?
&FIELD`CLINK [u(Cobj,age)]=id linkowner linkownername linkownerobjid linkapproved loanfrom loanfromname loanfromobjid linktype linklocked congained contimeout conscenes centity centityname centitytype centityver centityowner centityownername centityownertype centityownerobjid centitycreated centityclaimlock centityapproved

&INC`COMBAT`READYCHARACTER [u(cobj,age)]=@attach %!/WIPE=%0,D`COMBAT;@attach %!/WIPE=%0,D`COMBACK;@dolist/inline MODE OPPONENTS={th u(attrib_set,%0,D`COMBAT`%i0,get(%0/D`CSYS`%i0));@attach %!/WIPE=%0,D`CSYS`%i0};th u(attrib_set,%0,D`COMBAT`OPPONENTS,1);@attach %!/INC`LOADSQL=CLINK,%1,,cl;th u(attrib_set,%0,D`COMBAT`MANTLE`LINK,%1);th u(attrib_set,%0,D`COMBAT`MANTLE`LOCKED,%q<cl.linklocked>);@attach %!/INC`COMBAT`READYCHARACTER`MANTLE;@attach %!/INC`COMBAT`READYCHARACTER`FINISH

&INC`COMBAT`READYCHARACTER`MANTLE [u(cobj,age)]=th u(setq,mdata,u(mysql3,READY`MANTLE,%q<cl.centity>));&D`COMBAT`MANTLE`LOCKED %0=%q<cl.linklocked>;th u(setq,mstats,elements(%q<mdata>,1,chr(177)));&D`COMBAT`WEIGHT %0=u(setr,wt,elements(get(u(cobj,agedb)/WEIGHTS),elements(%q<mstats>,5),|));&D`COMBAT`WEIGHT`ORIGINAL %0=%q<wt>;@dolist/inline %q<mstats>={&D`COMBAT`STATS`[sub(inum(0),1)] %0=default(u(cobj,agedb)/ENTITY`0`STAT`[sub(inum(0),1)]`MAPPING`%i0,%i0);&D`COMBAT`STATS`[sub(inum(0),1)]`DISPLAY %0=%i0};&D`COMBAT`ARCHETYPE %0=u(setr,arcid,elements(%q<mdata>,2,chr(177)));@select/inline strlen(u(setr,arcname,get(u(cobj,agedb)/ARC`%q<arcid>`STATUS)))=>0,{@attach %!/INC`SETSTATUS=%0,%0,get(u(cobj,agedb)/ARC`%q<arcid>`STATUS),,X,X;@select/inline strlen(u(setr,supname,get(u(cobj,age)/STATUS`%q<arcname>`SUPPORT)))=>0,{@attach %!/INC`SETSTATUS=%0,%0,%q<supname>,,X,X;&D`COMBAT`SUPPORTING %0=%0;&D`COMBAT`SUPPORT %0=%q<supname>}};&D`COMBAT`QUIRKS %0=sortkey(#lambda/get(u(cobj,agedb)/QRK`\%0),u(mysql,READY`QUIRKS,%q<cl.centity>),i);@dolist/inline u(setr,sigids,u(mysql,READY`SIG,%q<cl.centity>))={@attach %!/INC`SETSTATUS=%0,%0,u(cust,SIG,%i0`STATUS),,X,X,SIGMOVE};@select/inline %q<arcid>=124,{@dolist/inline u(setr,meiids,u(mysql,READY`MEI,%q<cl.centity>))={@attach %!/INC`SETSTATUS=%0,%0,u(cust,SIG,%i0`STATUS),,X,X,MEISTER}};&D`COMBAT`SIG %0=squish(%q<sigids> %q<meiids>);@select/inline t(get(%l/D`NOENHANCE))=0,{@dolist/inline/delimit [chr(176)] [u(mysql3,READY`ENHANCEMENTS,%q<cl.centity>)]={&D`COMBAT`STATS`[u(setr,accid,elements(%i0,1,chr(177)))]`ACC %0=u(setr,accval,elements(%i0,2,chr(177)));@attach %!/INC`SETSTATUS=%0,%0,ENH_[switch(%q<accid>,0,POWER,1,ENDURANCE,2,PRECISION,3,MITIGATION,4,DRIVE)],,X,X;th u(addto,%0,D`COMBAT`ACCOLADES,1)}}

&Q`READY`MANTLE [u(cobj,age)]=SELECT mantle_stats,mantle_archetype FROM volv_mantle WHERE mantle_id=? LIMIT 1
&Q`READY`ENHANCEMENTS [u(cobj,age)]=SELECT trait_id,trait_flags_1 FROM vol_ctrait WHERE centity_id=? AND trait_type=0 AND trait_flags_1>0
&Q`READY`QUIRKS [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_type=2 AND trait_value>0
&Q`READY`SIG [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_type=4 AND trait_value>0
&Q`READY`MEI [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_type=5 AND trait_value>0
&Q`PUBLIC`QUIRKS [u(cobj,age)]=SELECT trait_id FROM vol_ctrait WHERE centity_id=? AND trait_type=2 AND trait_value>0

&INC`COMBAT`READYCHARACTER`FINISH [u(cobj,age)]=@attach %!/INC`COMBAT`READYCHARACTER`FINISH`STARTING;@attach %!/INC`COMBAT`READYCHARACTER`FINISH`WEIGHT;@dolist/inline get(%0/D`COMBAT`QUIRKS)={@attach %!/INC`SETSTATUS=%0,%0,get(u(cobj,agedb)/QRK`%i0`STATUS),,X,X};@attach/localize %!/INC`COMBAT`READYCHARACTER`FINISH`STATIC;th u(attrib_set,%0,D`COMBAT`HEALTH`ORIGINAL,get(%0/D`COMBAT`HEALTH));@select/inline cand(not(%q<cl.linklocked>),u(setr,con,u(consequences,%q<cl.contimeout>)))=1,{th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH),switch(%q<con>,1,0.9,2,0.75,3,0.6)),0))};@@ @select/inline strlen(get(%0/D`COMBAT`MODE))=>0,{@attach %!/INC`COMBAT`READYCHARACTER`FINISH`[get(%0/D`COMBAT`MODE)]};&D`COMBAT`DRIVE`STATUS %0=u(drivestatus,%0)

&INC`COMBAT`READYCHARACTER`FINISH`SCALE [u(cobj,age)]=th u(attrib_set,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),default(%0/D`COMBAT`OPPONENTS,1)),0));th u(attrib_set,%0,D`COMBAT`DRIVE`MAXIMUM,mul(get(%0/D`COMBAT`DRIVE`MAXIMUM),get(%0/D`COMBAT`OPPONENTS)));th u(attrib_set,%0,D`COMBAT`DRIVE,mul(get(%0/D`COMBAT`DRIVE),get(%0/D`COMBAT`OPPONENTS)));th u(attrib_set,%0,D`COMBAT`HYPE`MAXIMUM,mul(get(%0/D`COMBAT`HYPE`MAXIMUM),get(%0/D`COMBAT`OPPONENTS)))

&INC`COMBAT`READYCHARACTER`FINISH`BOSS [u(cobj,age)]=th u(addto,%0,D`COMBAT`HEALTH,round(mul(get(%0/D`COMBAT`HEALTH`ORIGINAL),sub(get(%0/D`COMBAT`OPPONENTS),1),switch(%q<wt>,LIGHT,0.8,MEDIUM,0.7,HEAVY,0.6,SUPERHEAVY,0.6,BOSS,0.5)),0));th u(attrib_set,%0,D`COMBAT`HYPE`MAXIMUM,mul(get(%0/D`COMBAT`HYPE`MAXIMUM),get(%0/D`COMBAT`OPPONENTS)));th u(addto,%0,D`COMBAT`DRIVE`MAXIMUM,round(mul(100,get(%#/D`COMBAT`OPPONENTS),switch(%q<wt>,LIGHT,0.8,MEDIUM,0.7,HEAVY,0.6,SUPERHEAVY,0.6,BOSS,0.5)),0))

&INC`COMBAT`READYCHARACTER`FINISH`STARTING [u(cobj,age)]=&D`COMBAT`HEALTH %0=1000;&D`COMBAT`DRIVE %0=70;&D`COMBAT`DRIVE`GAIN %0=5;&D`COMBAT`DRIVE`MAXIMUM %0=100;&D`COMBAT`DRIVE`COST %0=0;&D`COMBAT`DRIVE`EXHAUSTION_MULTIPLIER %0=1;&D`COMBAT`DRIVE`PENALTY_MULTIPLIER %0=1;&D`COMBAT`DRIVE`BONUS_MULTIPLIER %0=1;&D`COMBAT`DAMAGE %0=0;&D`COMBAT`HYPE %0=0;&D`COMBAT`HYPE`MAXIMUM %0=10;&D`COMBAT`HYPE`GAIN %0=2

&INC`COMBAT`READYCHARACTER`FINISH`WEIGHT [u(cobj,age)]=

&INC`COMBAT`READYCHARACTER`FINISH`STATIC [u(cobj,age)]=@dolist/inline edit(u(lattr,%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={th u(addto,%0,D`COMBAT`HEALTH,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`HP));th u(addto,%0,D`COMBAT`DRIVE`GAIN,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`GAIN`DRIVE));th u(addto,%0,D`COMBAT`DRIVE,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`START`DRIVE));th u(addto,%0,D`COMBAT`DRIVE`MAXIMUM,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`DRIVE));th u(attrib_set,%0,D`COMBAT`DRIVE`MAXIMUM`ORIGINAL,get(%0/D`COMBAT`DRIVE`MAXIMUM));th u(addto,%0,D`COMBAT`HYPE`GAIN,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`GAIN`HYPE));th u(addto,%0,D`COMBAT`HYPE,mul(get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`START`HYPE),default(%0/D`COMBAT`OPPONENTS,1)));th u(addto,%0,D`COMBAT`HYPE`MAXIMUM,get(u(cobj,age)/STATUS`[before(%i0,$)]`STATIC`MAXIMUM`HYPE));th u(attrib_set,%0,D`COMBAT`HYPE`MAXIMUM`ORIGINAL,get(%0/D`COMBAT`HYPE`MAXIMUM));th u(attrib_set,%0,D`COMBAT`BANNED`OFF,setunion(get(%0/D`COMBAT`BANNED`OFF),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`OFF)));th u(attrib_set,%0,D`COMBAT`BANNED`DEF,setunion(get(%0/D`COMBAT`BANNED`DEF),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`DEF)));th u(attrib_set,%0,D`COMBAT`BANNED`PUSH,setunion(get(%0/D`COMBAT`BANNED`PUSH),get(u(cobj,age)/STATUS`[before(%i0,$)]`BANNED`PUSH)));@dolist/inline EXHAUSTION PENALTY BONUS={th u(addto,%0,D`COMBAT`DRIVE`%i0_MULTIPLIER,get(u(cobj,age)/STATUS`[before(%i1,$)]`DRIVE`%i0_MULTIPLIER))}};

&ADDTO [u(cobj,age)]=u(attrib_set,%0,%1,add(%2,default(%0/%1,0)))


@@ - RESET
&INC`COMBAT`RESET`MAIN [u(cobj,age)]=@check isint(u(setr,m1id,get(%#/D`ARMORY`MAIN`MANTLE`LINK)))=@attach %!/INC`MSG=ERROR: Your Mantle is not set.;@check u(setr,linkid,u(mysql,RESET_EXIST,%q<m1id>,get(%#/D`ID)))=@attach %!/INC`MSG=ERROR: Your Mantle is invalid. Re-select one.;@select/inline t(nattr(%#/D`COMBAT`**))=1,{@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] This will reset you to base combat readiness\, and clear any attacks. ARE YOU SURE? Enter the same command again within ten seconds to continue.,RESET CSYS};@select/inline cand(hasattr(%#/D`COMBAT`SUPPORTING),not(strmatch(get(%#/D`COMBAT`SUPPORTING),%:)))=1,{@attach %!/KILLSTATUS=get(%#/D`COMBAT`SUPPORTING),first(get(get(%#/D`COMBAT`SUPPORTING)/D`COMBAT`ACTIVE`STATUS`[get(%#/D`COMBAT`SUPPORT)]))};@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] has reset!;@attach %!/INC`COMBAT`READYCHARACTER=%:,get(%#/D`ARMORY`MAIN`MANTLE`LINK)

&Q`RESET_EXIST [u(Cobj,age)]=SELECT clink_id FROM vol_clink WHERE clink_id=? AND character_id=? LIMIT 1

&INC`CONSEQUENCES [u(cobj,age)]=@select/inline cand(not(cor(strmatch(u(conf,EXEMPT_DISTRICT),objid(parent(loc(%0)))),get(%l/D`NOKEEPS))),not(get(%0/D`COMBAT`MANTLE`LOCKED)))=1,{@attach %!/INC`DOSQL=SCENE`CONSEQUENCES,setunion(u(mysql,GET`CONSEQUENCES_SCENE,get(%0/D`COMBAT`MANTLE`LINK)),get(%0/D`SCENE)),get(%0/D`COMBAT`MANTLE`LINK);@select/inline default(%0/D`COMBAT`KEEPS,0)=0,{th u(setq,newcon,if(lte(u(percent,%0),0.35),1,0))},1,{th u(setq,newcon,if(lt(u(percent,%0),0.25),3,if(lt(u(percent,%0),0.5),2,1)))};th u(setq,newcon,max(%q<newcon>,default(%0/D`COMBAT`TAKEHIT,0)));@select/inline gt(%q<newcon>,u(consequences,u(mysql,GET`CONSEQUENCES_TIMEOUT,get(%0/D`COMBAT`MANTLE`LINK))))=1,{@attach %!/INC`CONSEQUENCES`SET=%0,get(%0/D`COMBAT`MANTLE`LINK),%q<newcon>}}

&Q`GET`CONSEQUENCES_SCENE [u(cobj,age)]=SELECT consequences_scenes FROM vol_clink WHERE clink_id=?
&Q`GET`CONSEQUENCES_TIMEOUT [u(Cobj,age)]=SELECT consequences_date_timeout_secs FROM volv_clink WHERE clink_id=?

&INC`CONSEQUENCES`SET [u(cobj,age)]=@attach %!/INC`EPRIVATE=CONSEQUENCES,You now suffer [switch(%2,1,Mild,2,Moderate,3,Severe)] Consequences! Maximum HP will be reduced next +reset!,%0;@attach %!/INC`DOSQL=SET`CONSEQUENCES,secs(),u(setr,timeout,add(secs(),mul(60,60,24,7,switch(%2,1,1,2,4,3,10)))),%1

&Q`SET`CONSEQUENCES [u(cobj,age)]=UPDATE vol_clink SET consequences_date_gained=FROM_UNIXTIME(?),consequences_date_timeout=FROM_UNIXTIME(?) WHERE clink_id=?

&Q`SCENE`CONSEQUENCES [u(cobj,age)]=UPDATE vol_clink SET consequences_scenes='!' WHERE clink_id=?

&CONSEQUENCES [u(cobj,age)]=switch(sub(%0,secs()),<[mul(60,60,12)],0,<=[mul(60,60,24,7,1)],1,<=[mul(60,60,24,7,4)],2,<=[mul(60,60,24,7,10)],3)
&CONSEQUENCES`REMAINING [u(cobj,age)]=bound(sub(%0,secs(),switch(u(consequences,%0),0,0,1,mul(60,60,12),2,mul(60,60,24,7,1),3,mul(60,60,24,7,4))),0)



&Q`GET`CONSEQUENCES_SCENE_NAME [u(cobj,age)]=SELECT clink_id,centity_name,consequences_scenes,centity_id FROM volv_clink WHERE character_id=? AND clink_locked=0 AND consequences_date_timeout>=UTC_TIMESTAMP()

&INC`CONSEQUENCES`REDUCE [u(cobj,age)]=@dolist/inline/nobreak/delimit [chr(176)] [u(mysql3,GET`CONSEQUENCES_SCENE_NAME,get(%0/D`ID))]={@stop match(elements(%i0,3,chr(177)),%1);@attach %!/INC`DOSQL=REDUCE`CONSEQUENCES,elements(%i0,1,chr(177));@attach %!/INC`EPRIVATE=CONSEQUENCES,Consequences for '[elements(%i0,4,chr(177))]: [elements(%i0,2,chr(177))]' was reduced by one week from Scene %1 being marked Finished!,%0}

&Q`REDUCE`CONSEQUENCES [u(cobj,age)]=UPDATE vol_clink SET consequences_date_timeout=consequences_date_timeout - INTERVAL 7 DAY WHERE clink_id=?

&SCENE`CHANGE_STATUS [u(cobj,age)]=@select/inline cand(eq(%2,3),t(%4))=1,{@dolist/inline [u(filter,ISOBJID,u(mysql,SCENE`ACTORS,%0))]={@attach %!/INC`CONSEQUENCES`REDUCE=%i0,%0,%5}}

&Q`SCENE`ACTORS [u(cobj,age)]=SELECT character_objid FROM volv_actor_agg WHERE scene_id=? AND action_count>0

&LOOP`CONSEQUENCES [u(cobj,age)]=@attach %!/INC`DOSQL=CLEAR`CONSEQUENCES;@wait 60={@trigger me/LOOP`CONSEQUENCES}

@STARTUP [u(Cobj,age)]=@trigger me/LOOP`CONSEQUENCES

&Q`CLEAR`CONSEQUENCES [u(cobj,age)]=UPDATE vol_consequences SET consequences_scenes=SET_NULL,consequences_date_timeout=SET_NULL,consequences_date_gained=SET_NULL WHERE consequences_date_timeout IS NOT NULL AND consequences_date_timeout<UTC_TIMESTAMP + INTERVAL 12 HOUR

@@ - KEEPS
&INC`COMBAT`KEEPS`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@check get(%#/D`COMBAT`ARCHETYPE)=@attach %!/INC`MSG=ERROR: Unshaped Mantles may not use +keeps.;@stop or(get(%l/D`NOKEEPS),strmatch(u(conf,EXEMPT_DISTRICT),objid(parent(%l))))=@attach %!/INC`MSG=ERROR: Keeps cannot be used in a Consequences-Free area.;@stop get(%#/D`COMBAT`KEEPS)=@attach %!/INC`MSG=ERROR: Keeps is already active! Go the distance!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Reason empty!;@attach %!/INC`VERIFY=[ansi(hr,WARNING:)] Consequences await. Are you SURE you want to use Keeps this fight? Type +keeps again to verify!,KEEPS;th u(attrib_set,%#,D`COMBAT`PULL,0);th u(attrib_set,%#,D`COMBAT`WEIGHT,u(setr,newwt,u(WEIGHT`UPGRADE,get(%#/D`COMBAT`WEIGHT`ORIGINAL))));th u(attrib_set,%#,D`COMBAT`KEEPS,1);@attach %!/INC`SETSTATUS=%#,%#,SPC_KEEPS,,1,1;@attach %!/INC`EANNOUNCE=KEEPS,Look out! [ansi(hw,%n)] is fighting for Keeps! Weight upgraded to [ansi(hw,capstr(%q<newwt>))];@attach %!/INC`MSG`CHAN=%n is fighting for Keeps! (%0);@attach %!/INC`DOSQL=LOG`KEEPS,get(%#/D`ID),%0;@attach %!/INC`CONSEQUENCES=%#

&Q`LOG`KEEPS [u(Cobj,age)]=INSERT INTO vol_clog (character_id,clog_date_created,clog_type,clog_text) VALUES (?,UTC_TIMESTAMP(),0,?)

&KEEPBONUS [u(Cobj,age)]=3

&STATUS`SPC_KEEPS [u(Cobj,age)]=Keeps
&STATUS`SPC_KEEPS`ATTACK`BONUS`STAT`0 [u(cobj,age)]=fdiv(mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_ATTACKED,0)),get(%0/D`COMBAT`OPPONENTS))
&STATUS`SPC_KEEPS`DEFENSE`BONUS`STAT`1 [u(cobj,age)]=fdiv(mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED,0)) ,get(%0/D`COMBAT`OPPONENTS))
&STATUS`SPC_KEEPS`ATTACK`BONUS`STAT`2 [u(cobj,age)]=fdiv(mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_ATTACKED,0)),get(%0/D`COMBAT`OPPONENTS))
&STATUS`SPC_KEEPS`DEFENSE`BONUS`STAT`3 [u(cobj,age)]=fdiv(mul(v(KEEPBONUS),default(%0/D`COMBAT`NUMBERS`TIMES_DEFENDED,0)) ,get(%0/D`COMBAT`OPPONENTS))

&INC`COMBAT`KEEPS`CHECK [u(cobj,age)]=

@@ - STATS

@@ SELL
&INC`COMBAT`SELL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`SELL,0)=0,{@attach %!/INC`EPRIVATE=SELL,The other guy is seemingly awfully scary now.,%#},1,{@attach %!/INC`EPRIVATE=SELL,Who are you kidding? They're not scary at all!,%#};&D`COMBAT`HARDSELL %#=0;&D`COMBAT`SELL %#=not(get(%#/D`COMBAT`SELL))

@@ HARDSELL
&INC`COMBAT`HARDSELL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`HARDSELL,0)=0,{@attach %!/INC`EPRIVATE=HARDSELL,The other guy is seemingly INCREDIBLY scary now.,%#},1,{@attach %!/INC`EPRIVATE=HARDSELL,Who are you kidding? They're not scary at all! Not even a bit!,%#};&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=not(get(%#/D`COMBAT`HARDSELL))

@@ - PULL
&INC`COMBAT`PULL`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@stop get(%#/D`COMBAT`KEEPS)=@attach %!/INC`MSG=ERROR: Keeps is active! There's no backing down now. Go the distance!;@stop strmatch(LIGHT,get(%#/D`COMBAT`WEIGHT`ORIGINAL))=@attach %!/INC`MSG=ERROR: Maybe if you were a little beefier...;@select/inline default(%#/D`COMBAT`PULL,0)=0,{th u(attrib_set,%#,D`COMBAT`WEIGHT,u(setr,newwt,u(WEIGHT`DOWNGRADE,get(%#/D`COMBAT`WEIGHT`ORIGINAL))));th u(attrib_set,%#,D`COMBAT`PULL,1);@attach %!/INC`EANNOUNCE=PULL,[ansi(hw,%n)] decides to take it easy for now. Weight downgraded to [ansi(hw,capstr(%q<newwt>))]!},1,{th u(attrib_set,%#,D`COMBAT`WEIGHT,get(%#/D`COMBAT`WEIGHT`ORIGINAL));@attach %!/INC`EANNOUNCE=PULL,[ansi(hw,%n)] stops holding back! Original Weight class restored.;&D`COMBAT`PULL %#=0}

@@ - RESTRAIN
&INC`COMBAT`RESTRAIN`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not readied for battle.;@select/inline default(%#/D`COMBAT`RESTRAIN,0)=0,{@attach %!/INC`EANNOUNCE=RESTRAIN,[ansi(hw,%n)] pulls [poss(%#)] punches a little!},1,{@attach %!/INC`EANNOUNCE=RESTRAIN,No holding back anymore! [ansi(hw,%n)] is going at it full steam!};th u(attrib_set,%#,D`COMBAT`RESTRAIN,not(get(%#/D`COMBAT`RESTRAIN)))

&TESTER [u(cobj,age)]=testlock(V`GROUP`6301:<=9001|V`ADMIN:>0|FLAG^ROYALTY|FLAG^WIZARD,%0)

&SCALECOLOR [u(Cobj,age)]=switch(%0,1,45,2,113,3,220,4,198,5,196)
&SCALECOLOR`WEIGHT [u(Cobj,age)]=switch(%0,LIGHT,45,MEDIUM,113,HEAVY,220,SUPERHEAVY,198,BOSS,196)

&FANCYWEIGHT [u(cobj,age)]=ansi(u(setr,qcolor,u(scalecolor`weight,get(%0/D`COMBAT`WEIGHT))),[if(get(%0/D`COMBAT`KEEPS),+,if(get(%0/D`COMBAT`PULL),-))][capstr(lcstr(if(%1,left(get(%0/D`COMBAT`WEIGHT),1),get(%0/D`COMBAT`WEIGHT))))])

&INC`COMBAT`SHEET`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`STATS`MAIN
&INC`COMBAT`STATS`MAIN [u(cobj,age)]=@attach %!/INC`CHECKPC=u(strfirstof,if(u(tester,%#),%0),%#),1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not readied for battle.;@pemit %#=u(header,%q<t1name> - Stats);@attach %!/INC`COMBAT`STATS`DISPLAY;@pemit %#=u(footer)


&INC`COMBAT`STATS`DISPLAY [u(cobj,age)]=th u(setr,bor,ansi(u(color,%#,BORDER),|));@pemit %#=align(1. 50 1. 23 1.,%q<bor>,u(setr,startsec,u(fancyweight,%q<t1>)[repeat(*,get(%q<t1>/D`COMBAT`STATS`5`ORIG))]%b[ansi(hw,default(u(cobj,agedb)/ARC`[default(%q<t1>/D`COMBAT`ARCHETYPE,0)],Unpublished))]%B[if(get(%q<t1>/D`COMBAT`ACCOLADES),[ansi(hw,+)][ansi(%q<qcolor>,get(%q<t1>/D`COMBAT`ACCOLADES))])])[rjust(u(fancycon2,u(setr,conseq,u(consequences,u(setr,conseqtime,u(mysql,GET`CONSEQUENCES_TIMEOUT,get(%q<t1>/D`COMBAT`MANTLE`LINK))))))[if(%q<conseq>,%B\([squish(etime(u(consequences`remaining,%q<conseqtime>),6))]\))],sub(60,strlen(%q<startsec>),10))]%R[rjust(ansi(h,HP:),6)] [ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(u(setr,perc,mul(%i0,5)),100),u(percent,%q<t1>)),ansi(u(ryg,sub(100,%q<perc>)),|),%B),%b,)][ansi(h,>>)]%B[ansi(h,[sub(get(%q<t1>/D`COMBAT`HEALTH),get(%q<t1>/D`COMBAT`DAMAGE))]/[get(%q<t1>/D`COMBAT`HEALTH)]%B\([before(round(mul(u(percent,%q<t1>),100),0),.)]\%\))]%R[rjust(ansi(h,Drive:),6)][if(get(%q<t1>/D`COMBAT`STATS`5`ACC),ansi(117,+),%B)][ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(mul(%i0,5),100),fdiv(get(%q<t1>/D`COMBAT`DRIVE),get(%q<t1>/D`COMBAT`DRIVE`MAXIMUM))),ansi(u(drivebar,%i0),|),%b),%b,)][ansi(h,>>)]%B[ansi(h,[get(%q<t1>/D`COMBAT`DRIVE)]/[get(%q<t1>/D`COMBAT`DRIVE`MAXIMUM)]%B\([switch(get(%q<t1>/D`COMBAT`DRIVE`STATUS),Overextended,Overex.,get(%q<t1>/D`COMBAT`DRIVE`STATUS))]\))]%R[rjust(ansi(h,Hype:),6)] [ansi(h,<<)][iter(lnum(1,20),if(lte(fdiv(mul(%i0,5),100),fdiv(get(%q<t1>/D`COMBAT`HYPE),get(%q<t1>/D`COMBAT`HYPE`MAXIMUM))),ansi(u(hypebar,%i0),|),%b),%b,)][ansi(h,>>)]%B[ansi(h,[get(%q<t1>/D`COMBAT`HYPE)]/[get(%q<t1>/D`COMBAT`HYPE`MAXIMUM)])],%q<bor>,center(ansi(%q<qcolor>,Quirks),23)%R[iter(get(%q<t1>/D`COMBAT`QUIRKS),ansi(hw,default(u(cobj,agedb)/QRK`%i0,<unknown>)),%B,%R)],%q<bor>);@pemit %#=u(separator);@pemit %#=align(1. 50 1. 23 1.,%q<bor>,u(SHEET`STAT,%q<t1>,POW,0)[u(SHEET`STAT,%q<t1>,PRE,2)]%R[u(SHEET`STAT,%q<t1>,END,1)][u(SHEET`STAT,%q<t1>,MIT,3)],%q<bor>,center(ansi(%q<qcolor>,Signature),23)%R[iter(get(%q<t1>/D`COMBAT`SIG),ansi(hw,default(u(cobj,agedb)/SIG`%i0,<unknown>)),%B,%R)],%q<bor>);

&DRIVEBAR [u(cobj,age)]=switch(1,t(match(1 2 3 4,%0)),27,t(match(5 6 7 8 9 10 11,%0)),75,t(match(12 13 14 15 16,%0)),117,t(match(17 18 19 20,%0)),159)

&HYPEBAR [u(cobj,age)]=switch(1,t(match(1 2,%0)),56,t(match(3 4,%0)),93,t(match(5 6,%0)),129,t(match(7 8,%0)),165,t(match(9 10,%0)),201,t(match(11 12,%0)),207,t(match(13 14,%0)),213,t(match(15 16,%0)),219,t(match(17 18,%0)),225,t(match(19 20,%0)),231)

&SHEET`STAT [u(cobj,age)]=localize(ansi(hw,%1:)%B[ljust(if(get(%0/D`COMBAT`MANTLE`LOCKED),Public,ansi(u(statcolor,u(setr,val,get(%0/D`COMBAT`STATS`%2`DISPLAY))),u(VIEW`STAT,%q<val>)%B[if(get(%0/D`COMBAT`STATS`%2`ACC),+)])),20)])

&STATCOLOR [u(cobj,age)]=switch(%0,1,208,2,191,3,76,4,39,5,141)

@@ - ATTACK
&INC`COMBAT`ATTACK`MAIN [u(cobj,age)]=@attach %!/INC`COMBAT`ATTACK`MAIN`TARGET;@attach %!/INC`COMBAT`ATTACK`MAIN`ATTACK;@@ @attach %!/INC`COMBAT`ATTACK`MAIN`SELF_EFFECTS;@@ @attach %!/INC`COMBAT`ATTACK`MAIN`BONUSES;@attach %!/INC`COMBAT`ATTACK`MAIN`LAUNCH;@attach %!/INC`COMBAT`ATTACK`MAIN`ENDTURN

&INC`COMBAT`ATTACK`MAIN`TARGET [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Mantle's set and use +reset.;@stop gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Nobody entered to attack.;@stop strmatch(%0,*\,*)=@attach %!/INC`MSG=ERROR: Multi-targeting is currently disabled.;@check strlen(%2)=@attach %!/INC`MSG=ERROR: No attack name entered.;th u(setq,allplayers,u(setr,players,lvplayers(%l)));@dolist/inline/delimit \, %0={@check isdbref(u(setr,ply,namegrab(%q<players>,%i0)))=@attach %!/INC`MSG=ERROR: '%i0' does not match a present player.;th u(setq,players,setdiff(%q<players>,%q<ply>))};th u(setq,targets,setdiff(%q<allplayers>,%q<players>));@dolist/inline %q<targets>={@check nattr(%i0/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: [name(%i0)] is not ready for battle.;@stop hasattr(%i0/D`COMBAT`Q`%#)=@attach %!/INC`MSG=ERROR: You have already attacked [name(%i0)]!;@stop gte(get(%i0/D`COMBAT`DAMAGE),get(%i0/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: [name(%i0)] is already down!}

&INC`COMBAT`ATTACK`MAIN`ATTACK [u(cobj,age)]=@attach %!/INC`VALID`POSINT=before(%2,/);@check match(get(u(cobj,agedb)/ATTACKS),u(setr,atklevel,%q<value>),|)=@attach %!/INC`MSG=ERROR: No Attack Number for %q<value>!;@check strlen(before(after(%2,/),:))=@attach %!/INC`MSG=ERROR: Must enter an Attack Style!;@check u(setr,off,u(FIND_TRAIT,OFF,before(after(%2,/),:)))=@attach %!/INC`MSG=ERROR: Not an Attack Style!;@stop t(match(get(%#/D`COMBAT`BANNED`OFF),%q<off>))=@attach %!/INC`MSG=ERROR: You may not use that Offense!;th u(setq,atkname,after(after(%2,/),:));@attach %!/INC`SETSTATUS=%#,%#,get(u(cobj,agedb)/OFF`%q<off>`STATUS),LEVEL=%q<atklevel>,get(u(cobj,agedb)/OFF`%q<off>`ATTACK_TURNS),get(u(cobj,agedb)/OFF`%q<off>`DEFENSE_TURNS);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`OFF`%q<off>`ACTIVATE=%#,%i0};@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_BEFORE_LAUNCH=%#,%i0}

&GET`ARCHETYPE [u(Cobj,age)]=localize(if(u(setr,arc,get(%0/D`COMBAT`ARCHETYPE)),u(u(cobj,agedb)/ARC`%q<arc>[if(%1,`%1)]),Unshaped))

@@ &INC`COMBAT`ATTACK`MAIN`SELF_EFFECTS [u(cobj,age)]=@dolist/inline/nobreak [get(%#/%q<atk>`EFFECTS`PRIORITY)]={@attach %!/EFFECT`%i0`PRIORITY=%#};@dolist/inline/nobreak setunion(setunion(get(%#/%q<atk>`EFFECTS`SELF`LINGER),get(%#/%q<atk>`EFFECTS`SELF`INSTANT)),filterbool(#lambda/match(v(EFFECT`\%0`CATEGORIES),self),%q<extraeff>))={@attach %!/INC`SETSTATUS=%#,%i0};th u(setq,extargeffs,filterbool(#lambda/match(v(EFFECT`\%0`CATEGORIES),target),%q<extraeff>));

@@ &INC`COMBAT`ATTACK`MAIN`BONUSES [u(cobj,age)]=th u(setq,bonuses,add(get(%#/%q<atk>`PRECALC`ATTACK),u(heatbonus,%#),u(dynamic,%#,ATTACK,ATTACK)));th u(setq,multiplier,add(get(%#/%q<atk>`PRECALC`ATTACK`MULTIPLIER),u(dynamic,%#,ATTACK,ATTACK`MULTIPLIER)));

&FIL`TAGFILTER [u(cobj,age)]=t(match(v(%1`[before(%0,~)]`%2),%3))

&INC`DRIVE [u(Cobj,age)]=th u(setq,overcap,gte(u(setr,curdrive,get(%0/D`COMBAT`DRIVE)),u(setr,maxdrive,get(%0/D`COMBAT`DRIVE`MAXIMUM))));th u(setq,newdrive,add(%1,%q<curdrive>));@select/inline lt(%q<newdrive>,%q<curdrive>)=1,{th u(attrib_set,%0,D`COMBAT`DRIVE,%q<newdrive>)},0,{th u(attrib_set,%0,D`COMBAT`DRIVE,switch(t(%6)%q<overcap>,1*,%q<newdrive>,01,%q<curdrive>,00,bound(%q<newdrive>,0,%q<maxdrive>)))};@select/inline not(%7)=1,{@select/inline not(%3)=1,{@attach %!/INC`EANNOUNCE=%2,[ansi(hw,name(%0))] [if(lte(%1,0),loses,gains)] [ansi(118,abs(%1))] [ansi(118,Drive)]![if(%6,%B\(Break the limit!\))]},0,{@attach %!/INC`EANNOUNCE=%2,%3}};&D`COMBAT`DRIVE`STATUS %0=u(drivestatus,%0);@select/inline cand(strlen(%4),gte(%1,0))=1,{th u(addto,%0,D`COMBAT`DRIVE`TALLY,bound(sub(%1,%4),0))};@select/inline t(%5)=1,{&D`COMBAT`DRIVE`STATUS`ATTACK %0=get(%0/D`COMBAT`DRIVE`STATUS)};th unsetq(overcap maxdrive newdrive)
}
@@ %0 - Target. %1 - Drive to add/subtract. %2 - EFFECT NAME, %3 - Message. %4 - Exempt up to this amount from the Drive Tally. %5 - Toggle for calculating Drive after an attack. %6 - This add bypasses Maximums. %7 - No message at all!

&INC`HYPE [u(Cobj,age)]=th u(setq,overcap,gte(u(setr,curhype,get(%0/D`COMBAT`HYPE)),u(setr,maxhype,get(%0/D`COMBAT`HYPE`MAXIMUM))));th u(setq,newhype,add(%1,%q<curhype>));@select/inline lt(%q<newhype>,%q<curhype>)=1,{th u(attrib_set,%0,D`COMBAT`HYPE,%q<newhype>)},0,{th u(attrib_set,%0,D`COMBAT`HYPE,switch(t(%6)%q<overcap>,1*,%q<newhype>,01,%q<curhype>,00,bound(%q<newhype>,0,%q<maxhype>)))};@select/inline not(%7)=1,{@select/inline not(%3)=1,{@attach %!/INC`EANNOUNCE=%2,[ansi(hw,name(%0))] [if(lte(%1,0),loses,gains)] [ansi(118,abs(%1))] [ansi(118,Hype)]![if(%6,%B\(Break the limit!\))]},0,{@attach %!/INC`EANNOUNCE=%2,%3}};@select/inline cand(strlen(%4),gte(%1,0))=1,{th u(addto,%0,D`COMBAT`HYPE`TALLY,sub(%1,%4))}
@@ %0 - Target. %1 - Drive to add/subtract. %2 - EFFECT NAME, %3 - Message. %4 - Exempt this amount from the Hype Tally. %5 - Toggle for calculating Hype after an attack. (unused) %6 - This add bypasses Maximums. %7 - No message at all!

@@ th u(addto,%0,D`COMBAT`HYPE,%1);@select/inline gte(get(%0/D`COMBAT`HYPE),get(%0/D`COMBAT`HYPE`MAXIMUM))=1,{&D`COMBAT`HYPE %0=get(%0/D`COMBAT`HYPE`MAXIMUM)};@select/inline not(%3)=1,{@attach %!/INC`ANNOUNCE=[ansi(hw,name(%0))] [if(gte(%1,0),gains,loses)] [ansi(118,abs(%1))] [ansi(118,Hype)] from [ansi(hw,%2)]!}

&INC`COMBAT`ATTACK`MAIN`LAUNCH [u(cobj,age)]=th [u(setq,fullname,[if(strlen(%q<atkname>),'%q<atkname>' \([get(u(cobj,agedb)/OFF`%q<off>)] Level %q<atklevel>\),[get(u(cobj,agedb)/OFF`%q<off>)] Level %q<atklevel>)])];th u(setq,boss,strmatch(get(%#/D`COMBAT`BOSS),BOSS));@select/inline u(setr,dafter,add(get(%#/D`COMBAT`DRIVE),mul(u(setr,dcost,add(u(CUST,ATTACKS,%q<atklevel>`COST),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%#,%i0,ATTACK,DRIVE_COST))))),-1)))=<-25,{@attach %!/INC`DRIVE=%#,mul(%q<dcost>,-1),ATTACK,,if(eq(%q<atklevel>,1),abs(u(cust,ATTACKS,1`COST))),1,,1;@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] tries to launch a [ansi(u(scalecolor,%q<atklevel>),u(u(cobj,agedb)/ATTACKS`%q<atklevel>`DESCRIPTION) [u(u(cobj,agedb)/OFF`%q<off>)])]%B[if(strlen(%q<atkname>),%q<atkname>,attack)] at [u(itemize,iter(u(sortname,%q<targets>),ansi(hw,name(%i0)),%B,\,|),|,and,\,)]! ... but can't summon the strength!;@select/inline gt(u(setr,overe,u(overexert,%#)),0)=1,{@attach %!/INC`DAMAGE=%#,floor(mul(get(%#/D`COMBAT`HEALTH),%q<overe>)),Exhaustion!}},{@dolist/inline/nobreak %q<targets>={@attach %!/INC`COMBAT`ATTACK`LAUNCH=%#,%i0,%q<extargeffs>,%q<fullname>};&D`COMCHECK`ATTACKED %#=%q<targets>;@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] launched a [ansi(u(scalecolor,%q<atklevel>),u(u(cobj,agedb)/ATTACKS`%q<atklevel>`DESCRIPTION) [u(u(cobj,agedb)/OFF`%q<off>)])]%B[if(strlen(%q<atkname>),%q<atkname>,attack)] at [u(itemize,iter(u(sortname,%q<targets>),ansi(hw,name(%i0)),%B,\,|),|,and,\,)]! [ansi(hg,abs(%q<dcost>))] Drive [if(strmatch(%q<dcost>,-*),gained,spent)].;@attach %!/INC`PRIVATE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>)%B)][ansi(hw,%n)] attacked you! Respond with [ansi(hw,+defend %n=<choice>)],%q<targets>;@attach %!/INC`DRIVE=%#,mul(%q<dcost>,-1),ATTACK,,add(if(eq(%q<atklevel>,1),abs(u(cust,ATTACKS,1`COST))),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%#,%i0,ATTACK,DRIVE_COST`EXEMPT)))),1,,1;@select/inline gt(u(setr,overe,u(overexert,%#)),0)=1,{@attach %!/INC`DAMAGE=%#,floor(mul(get(%#/D`COMBAT`HEALTH),%q<overe>)),Exhaustion!};@select/inline u(setr,dot,round(u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%#,%i0,ATTACK,DOT))),0))=>0,{@attach %!/INC`DAMAGE=%#,%q<dot>,Damage Over Time}};

&INC`COMBAT`ATTACK`LAUNCH [u(cobj,age)]=th u(attrib_set,%1,u(setr,atkattr,D`COMBAT`Q`%0),%3);@dolist/inline edit(u(lattr,%#/D`COMBAT`STATS`*),D`COMBAT`STATS`,)={th u(attrib_set,%1,%q<atkattr>`STATS`%i0,get(%#/D`COMBAT`STATS`%i0));th u(attrib_set,%1,%q<atkattr>`STATS`%i0`MOD,u(calcstatmod,%#,%i0,ATTACK,%q<off>))};&%q<atkattr>`ATK %1=%q<atklevel>;&%q<atkattr>`OFF %1=%q<off>;&%q<atkattr>`ARCHETYPE %1=get(%0/D`COMBAT`ARCHETYPE);&%q<atkattr>`WEIGHT %1=get(%0/D`COMBAT`WEIGHT);&%q<atkattr>`TIMESTAMP %1=secs();@attach %!/INC`CPTREE=%#,D`COMBAT`STATUS,%1,%q<atkattr>`STATUS;@attach %!/INC`CPTREE=%#,D`COMBAT`ACTIVE,%1,%q<atkattr>`ACTIVE;@dolist/inline SELL HARDSELL PULL KEEPS RESTRAIN WEIGHT MODE OPPONENTS BOSSMODE={@cpattr %#/D`COMBAT`##=%1/%q<atkattr>`##};th u(attrib_set,%1,%q<atkattr>`DRIVESTATUS,u(drivestatus,%#));@attach %!/INC`CPTREE=%0,D`COMBAT`DRIVE,%1,%q<atkattr>`DRIVE;th u(attrib_set,%0,D`COMBAT`DRIVE`QUEUE_TALLY,rest(get(%0/D`COMBAT`DRIVE`QUEUE_TALLY)))

&INC`COMBAT`ATTACK`MAIN`ENDTURN [u(cobj,age)]=th u(addto,%#,D`COMBAT`NUMBERS`TIMES_ATTACKED,1);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_END_TURN=%#,%i0};@attach/nobreak %!/INC`COMBAT`ATTACK`MAIN`ENDTURN`STATUS=%#;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`OFF`%q<off>`END_TURN=%#,%i0};&D`COMBAT`HYPE`USED %#=0;&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=0;&D`COMBAT`HISTORY`DRIVE_SPENT_SELFLESS %#=%q<dcost>;&D`COMBAT`DRIVE`TALLY %#=0

&INC`COMBAT`ATTACK`MAIN`ENDTURN`STATUS [u(cobj,age)]=@dolist/inline/nobreak get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK)={@select/inline u(setr,srem,get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS))=X,{},>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%i0`ATTACK_TURNS,sub(%q<srem>,1));@stop get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS);th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`ATTACK,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),%i0));@stop cor(strmatch(get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS),X),gt(u(lmax,iter(ATTACK DEFENSE,get(%0/D`COMBAT`STATUS`%i1`%i0_TURNS))),0));@attach %!/KILLSTATUS=%0,%i0}};

&INC`DAMAGE [u(cobj,age)]=@select/inline not(%4)=1,{@attach %!/INC`ANNOUNCE=[if(%3,%3,[u(getmoniker,%0)] took [ansi(h,%1)] damage from %2!)]};th u(setq,predam,get(%0/D`COMBAT`DAMAGE));th u(setq,prebon,u(healthbonus,%0));th u(addto,%0,D`COMBAT`DAMAGE,%1);th u(setq,postbon,u(healthbonus,%0));th u(setq,afterper,u(percent,%0));@dolist/inline/nobreak iter(revwords(lnum(0,19)),mul(%i0,5))={@attach %!/INC`DAMAGETIER=%0,%i0};@select/inline cand(lte(%q<afterper>,0),not(%4))=1,{@attach %!/INC`ANNOUNCE=[ansi(hr,name(%0) has been Defeated! *BOOM*)]};&D`COMBAT`DAMAGE`TIMESTAMP %0=secs();@select/inline t(get(%0/D`COMBAT`MANTLE`LOCKED))=0,{@attach %!/INC`CONSEQUENCES=%0}

&INC`DAMAGETIER [u(cobj,age)]=@select/inline cand(lte(%q<afterper>,fdiv(%1,100)),not(hasattr(%0/D`COMBAT`PERCENT`%1)))=1,{&D`COMBAT`PERCENT`%1 %0=1;@dolist/inline/nobreak get(%0/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`BELOW_%1_HEALTH=%0,%i0}};


@@ - DEFEND
&INC`COMBAT`DEFEND`MAIN [u(cobj,age)]=th u(setq,defstartdrive,get(%#/D`COMBAT`DRIVE));@attach %!/INC`COMBAT`DEFEND`MAIN`TARGET;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE;@attach %!/INC`COMBAT`DEFEND`MAIN`STRIKE;@attach %!/INC`COMBAT`DEFEND`MAIN`ENDTURN;@attach %!/INC`COMBAT`DEFEND`MAIN`DEBUG

&INC`COMBAT`DEFEND`MAIN`TARGET [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Mantle's set and use +reset.;@@ @stop cand(gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH)),not(gt(get(%#/D`COMBAT`OPPONENTS),1)))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check nattr(%#/D`COMBAT`Q`*)=@attach %!/INC`MSG=ERROR: You have no attacks to deal with!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: Nobody entered to defend against.;@check isdbref(u(setr,atker,namegrab(iter(lattr(%#/D`COMBAT`Q`*),last(%i0,`)),%0)))=@attach %!/INC`MSG=ERROR: No Attacker called '%0'!;th u(setq,atk,D`COMBAT`Q`%q<atker>);@check strlen(%2)=@attach %!/INC`MSG=ERROR: No defense method entered.;@check u(setr,def,u(FIND_TRAIT,DEF,%2))=@attach %!/INC`MSG=ERROR: No Defense named '%2'!;@stop t(match(get(%#/D`COMBAT`BANNED`DEF),%q<def>))=@attach %!/INC`MSG=ERROR: You may not use that Defense!;th u(setq,off,get(%#/%q<atk>`OFF));@attach %!/INC`SETSTATUS=%#,%#,get(u(cobj,agedb)/DEF`%q<def>`STATUS),,get(u(cobj,agedb)/DEF`%q<def>`ATTACK_TURNS),get(u(cobj,agedb)/DEF`%q<def>`DEFENSE_TURNS);@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS)={@attach %!/STATUS`[before(%i0,$)]`DEF`%q<def>`ACTIVATE=%#,%i0}

&DYNAMIC [u(cobj,age)]=add(u(ladd,iter(get(%0/D`COMBAT`ACTIVE_EFFECTS`%1),udefault(%!/EFFECT`[before(%i0,~)]`%2,0,%0),|,%b)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE_BOOSTS`%1),udefault(%!/BOOST`[before(%i0,~)]`%2,0,%0),|,%b)),u(ladd,iter(get(%0/D`COMBAT`ABILITIES`%1),udefault(%!/ABIL`[before(%i0,~)]`%2,0,%0,after(%i0,~)),|,%b)))

&GET`WEIGHT [u(cobj,age)]=localize(if(cand(strlen(u(setr,wt,get(%0/D`COMBAT`WEIGHT))),hasattr(u(cobj,agedb)/WEIGHTS`%q<wt>)),u(u(cobj,agedb)/WEIGHTS`%q<wt>[if(%1,`%1)])))

&GET`DRIVE [u(cobj,age)]=localize(if(cand(strlen(u(setr,dr,if(%2,u(strfirstof,get(%0/D`COMBAT`DRIVE`STATUS`ATTACK),get(%0/D`COMBAT`DRIVE`STATUS)),get(%0/D`COMBAT`DRIVE`STATUS)))),hasattr(u(cobj,agedb)/DRIVES`%q<dr>)),u(u(cobj,agedb)/DRIVES`%q<dr>[if(%1,`%1)])))

&CALCSTATMOD [u(cobj,age)]=add(u(adj,u(GET`DRIVE,%0,%2`BONUS`STAT`%1,%4)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(getstatus,%0,%i0,%2,BONUS`STAT`%1))),mul(-1,add(u(adj,u(GET`DRIVE,%0,%2`PENALTY`STAT`%1,%4)),u(ladd,iter(get(%0/D`COMBAT`ACTIVE`STATUS`%2),u(getstatus,%0,%i0,%2,PENALTY`STAT`%1))))))

&CALCOFF [u(cobj,age)]=power(u(cust,ENTITY`0`STAT`%1,SCALE),fdiv(sub(%0,u(cust,ENTITY`0`STAT`%1,DIAL)),5))

&CALCDEF [u(cobj,age)]=power(u(cust,ENTITY`0`STAT`%1,SCALE),fdiv(sub(u(cust,ENTITY`0`STAT`%1,DIAL),%0),5))

@@ &CALCOFF [u(cobj,age)]=add(1,fdiv(sub(fdiv(%0,u(u(cobj,agedb)/ENTITY`0`STAT`%1`DIAL)),1),1.5))

@@ &CALCDEF [u(cobj,age)]=add(1,fdiv(sub(fdiv(u(u(cobj,agedb)/ENTITY`0`STAT`%1`DIAL),%0),1),1.5))

&INC`RUNSTATUS [u(Cobj,age)]=@dolist/inline edit(u(lattr,%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`%i0`%1=%0,%2,%3,%4,%5,%6,%7,%8,%9}

&MEDEFSTAT [u(Cobj,age)]=get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)

&INC`COMBAT`DEFEND`MAIN`CALCULATE [u(cobj,age)]=th u(setq,atklevel,get(%#/%q<atk>`ATK));@dolist/inline u(setr,atkeratkstat,get(%#/%q<atk>`ACTIVE`STATUS`ATTACK))={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_CALCULATE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_CALCULATE=%#,%i0};@dolist/inline BALANCE DAMAGEMOD ACCURACYMOD={@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`%i0};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_HITCHECK=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_HITCHECK=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL;@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`%q<tmode>;@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_PRE_REROLL=%#,%i0};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_PRE_REROLL=%#,%i0};@select/inline not(%q<disablereroll>)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_REROLL=%#,%i0}};th u(setq,orighitmul,%q<hitmul>);@dolist/inline INCREASE DECREASE MODIFY FINAL={@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_%i1_HITMUL=%#,%i0}};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_REROLL=%#,%i0};@dolist/inline INCREASE DECREASE MODIFY FINAL={@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_%i1_HITMUL=%#,%i0}};@select/inline gt(%q<hitmul>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_STRIKE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_STRIKE=%#,%i0}};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGE;th u(setq,htype,if(gt(%q<hitmul>,0.0),if(gte(%q<hitmul>,1.0),CRITICAL,if(gte(%q<hitmul>,0.7),SOLID,CLOSE)),MISS));@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_%q<htype>=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_ON_%q<htype>=%#,%i0};@select/inline t(%q<hitmul>)=1,{@dolist/inline INCREASE_DAMAGE DECREASE_DAMAGE INCREASE_DAMAGE_2 DECREASE_DAMAGE_2={@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_%i1=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_%i0};@dolist/inline INCREASE_DAMAGE DECREASE_DAMAGE INCREASE_DAMAGE_2 DECREASE_DAMAGE_2={@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_%i1=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_%i0}};@dolist/inline DNORMALIZE NORMALIZE={@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`%i0};@select/inline gt(%q<damage>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_POST_DAMAGE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_POST_DAMAGE=%#,%i0}};@select/inline cor(gt(%q<hitmul>,0),%q<atkinflictoverride>)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_INFLICT_STATUS=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_INFLICT_STATUS=%#,%i0}};th u(setq,dot,round(u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,DOT))),0));@select/inline strlen(u(setr,atkmode,get(%#/%q<atk>`MODE)))=>0,{@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_MODE`%q<atkmode>};@select/inline strlen(u(setr,defmode,get(%#/D`COMBAT`MODE)))=>0,{@attach %!/INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_MODE`%q<defmode>};@select/inline gt(%q<damage>,0)=1,{@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_NEGATE_DAMAGE=%#,%i0}};@select/inline gt(%q<damage>,0)=1,{@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_NEGATE_DAMAGE=%#,%i0}};@dolist/inline %q<atkeratkstat>={@attach %!/STATUS`[before(%i0,$)]`ATTACK_SPECIAL_DAMAGE=%#,%i0};@dolist/inline u(MEDEFSTAT)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_SPECIAL_DAMAGE=%#,%i0}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_INCREASE_DAMAGE [u(Cobj,age)]=
&INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_INCREASE_DAMAGE_2 [u(Cobj,age)]=th u(setq,damage,mul(%q<damage>,add(1,u(ladd,%q<atkincdamagemul>))))
&INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_DECREASE_DAMAGE [u(Cobj,age)]=
&INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_DECREASE_DAMAGE_2 [u(Cobj,age)]=@attach %!/INC`DEBUG=ATTACK_DECREASE_DAMAGE_2,Damage before step: %q<damage>;@select/inline words(%q<atkdecdamagemul>)=>0,{th u(setq,damage,mul(%q<damage>,lmath(mul,iter(%q<atkdecdamagemul>,u(setr,convatk,sub(1.0,%i0))))))};@attach %!/INC`DEBUG=ATTACK_DECREASE_DAMAGE_2,Damage after step: %q<damage>. Formatted Attack Decrease Damage Multipliers: %q<convatk>

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_INCREASE_DAMAGE [u(Cobj,age)]=
&INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_INCREASE_DAMAGE_2 [u(Cobj,age)]=th u(setq,damage,mul(%q<damage>,add(1,u(ladd,%q<defincdamagemul>))))
&INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_DECREASE_DAMAGE [u(Cobj,age)]=
&INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_DECREASE_DAMAGE_2 [u(Cobj,age)]=@attach %!/INC`DEBUG=DEFENSE_DECREASE_DAMAGE_2,Damage Before step: %q<damage>. Defense Decrease Damage Multiplier: %q<defdecdamagemul>;@select/inline words(%q<defdecdamagemul>)=>0,{th u(setq,damage,mul(%q<damage>,lmath(mul,u(setr,convdef,iter(%q<defdecdamagemul>,sub(1.0,%i0))))))};@attach %!/INC`DEBUG=DEFENSE_DECREASE_DAMAGE_2,Damage after step: %q<damage>. Formatted Defense Decrease Damage Multiplier: %q<convdef>

&CALCSTAT`ATK [u(cobj,age)]=add(get(%0/%1`STATS`%2),default(u(cobj,agedb)/WEIGHTS`[get(%0/%1`WEIGHT)]`BONUS,0),mul(-3,default(%0/%1`RESTRAIN,0)))
&CALCSTAT [u(cobj,age)]=add(get(%0/D`COMBAT`STATS`%1),default(u(cobj,agedb)/WEIGHTS`[get(%0/D`COMBAT`WEIGHT)]`BONUS,0),mul(-3,default(%0/D`COMBAT`RESTRAIN,0)))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`BALANCE [u(cobj,age)]=@dolist/inline 0-1 1-0 2-3 3-2={@select/inline u(setr,diff,sub(u(setr,astat,u(CALCSTAT`ATK,%#,%q<atk>,before(%i0,-))),u(setr,dstat,u(CALCSTAT,%#,after(%i0,-),1))))=0,{th u(setq,bdstat[after(%i0,-)],%q<dstat>);th u(setq,bastat[before(%i0,-)],%q<astat>)},>0,{th u(setq,bdiff,abs(%q<diff>));th u(setq,bdstat[after(%i0,-)],%q<dstat>);th u(setq,bastat[before(%i0,-)],add(%q<dstat>,fdiv(%q<bdiff>,u(cust,CORE,BALANCE))))},<0,{th u(setq,bdiff,abs(%q<diff>));th u(setq,bdstat[after(%i0,-)],add(%q<astat>,fdiv(%q<bdiff>,u(cust,CORE,BALANCE))));th u(setq,bastat[before(%i0,-)],%q<astat>)}};th unsetq(astat dstat)

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ATTACK_MODE`BOSS [u(cobj,age)]=@select/inline t(%q<damage>)=1,{th u(setq,damage,u(setr,atkbosspostdam,round(mul(u(setr,atkbosspredam,%q<damage>),mul(u(setr,atkbossdmgmul,u(cust,BOSS,[u(setr,atkopp,bound(get(%#/%q<atk>`OPPONENTS),2,10))]`DMG_MUL)),u(setr,atkbosssqrt,sqrt(u(cust,BOSS,%q<atkopp>`[get(%#/%q<atk>`BOSSMODE)]))))),0)))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DEFENSE_MODE`BOSS [u(cobj,age)]=@select/inline t(%q<damage>)=1,{th u(setq,damage,u(setr,defbosspostdam,round(mul(u(setr,defbosspredam,%q<damage>),fdiv(u(setr,defbossdefmul,u(cust,BOSS,[u(setr,defopp,bound(get(%#/D`COMBAT`OPPONENTS),2,10))]`DEF_MUL)),u(setr,defbosssqrt,sqrt(u(cust,BOSS,%q<defopp>`[get(%#/D`COMBAT`BOSSMODE)]))))),0)))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGEMOD [u(cobj,age)]=th u(setq,damagemod,mul(u(calcoff,add(%q<bastat0>,get(%#/%q<atk>`STATS`0`MOD)),0),u(calcdef,add(%q<bdstat1>,u(calcstatmod,%#,1,DEFENSE,%q<def>,1)),1),if(get(%#/%q<atk>`HARDSELL),0.9,if(get(%#/%q<atk>`SELL),0.95,1)),if(get(%#/D`COMBAT`HARDSELL),1.1,if(get(%#/D`COMBAT`SELL),1.05,1))));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ACCURACYMOD [u(Cobj,age)]=th u(setq,accuracymod,mul(u(calcoff,add(%q<bastat2>,get(%#/%q<atk>`STATS`2`MOD)),2),u(calcdef,add(%q<bdstat3>,u(calcstatmod,%#,3,DEFENSE,%q<def>,1)),3),if(get(%#/%q<atk>`HARDSELL),0.75,if(get(%#/%q<atk>`SELL),0.85,1)),if(get(%#/D`COMBAT`HARDSELL),1.25,if(get(%#/D`COMBAT`SELL),1.15,1))));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`ROLL [u(Cobj,age)]=@select/inline hasattr(%#/D`ROLLFORCE)=1,{th u(setq,roll,get(%#/D`ROLLFORCE));@attach %!/WIPE=%#,D`ROLLFORCE},0,{th u(setq,roll,die(1,100))};

&FULLDAMAGE [u(cobj,age)]=add(%q<damage>,%q<dot>)

&THRESHOLD [u(cobj,age)]=switch(1,eq(%0,1),0,cand(lt(%0,1.0),gte(%0,0.63)),1,lt(%0,0.63),2,cand(gte(%0,1.0),lte(%0,1.3666)),3,cand(gt(%0,1.3666),lte(%0,1.5388)),4,gte(%0,1.5388),5)

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD [u(cobj,age)]=th u(setq,tmode,u(THRESHOLD,%q<accuracymod>));

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`0 [u(cobj,age)]=th u(setq,hitmul,switch(%q<roll>,<=10,0.0,<=50,0.4,<=90,0.7,>=91,1.0))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`1 [u(cobj,age)]=th u(setq,athresh,mul(sub(1,%q<accuracymod>),24.54));th u(setq,hitmul,if(lte(%q<roll>,round(add(10,%q<athresh>),0)),0.0,if(lte(%q<roll>,round(mul(5,add(10,%q<athresh>)),0)),0.4,if(cand(gt(%q<roll>,round(mul(5,add(10,%q<athresh>)),0)),lte(%q<roll>,round(add(90,%q<athresh>),0))),0.7,if(gt(%q<roll>,round(add(90,%q<athresh>),0)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`2 [u(cobj,age)]=th u(setq,athresh,mul(sub(1,%q<accuracymod>),135.65));th u(setq,hitmul,if(lte(%q<roll>,round(add(19,%q<athresh>),0)),0.0,if(cand(gt(%q<roll>,round(add(19,%q<athresh>),0)),lt(%q<roll>,95)),0.4,if(cand(lt(%q<roll>,100),gte(%q<roll>,95)),0.7,if(eq(%q<roll>,100),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`3 [u(cobj,age)]=th u(setq,athresh,mul(sub(%q<accuracymod>,1),24.54));th u(setq,hitmul,if(lte(%q<roll>,round(sub(10,%q<athresh>),0)),0.0,if(lte(%q<roll>,round(mul(5,sub(10,%q<athresh>)),0)),0.4,if(cand(gt(%q<roll>,round(mul(5,sub(10,%q<athresh>)),0)),lte(%q<roll>,round(sub(90,%q<athresh>),0))),0.7,if(gt(%q<roll>,round(sub(90,%q<athresh>),0)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`4 [u(cobj,age)]=th u(setq,athresh,mul(sub(%q<accuracymod>,1.3666),180.18));th u(setq,hitmul,if(eq(%q<roll>,1),0.0,if(lte(%q<roll>,5),0.4,if(cand(gt(%q<roll>,5),lte(%q<roll>,round(sub(81,%q<athresh>),0))),0.7,if(gt(%q<roll>,sub(81,%q<athresh>)),1.0)))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`THRESHOLD`5 [u(cobj,age)]=th u(setq,hitmul,if(eq(%q<roll>,1),0.0,if(lte(%q<roll>,5),0.4,if(cand(gt(%q<roll>,5),lte(%q<roll>,50)),0.7,if(gt(%q<roll>,50),add(1.0,mul(1.076,sub(%q<accuracymod>,1.588))))))))

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DNORMALIZE [u(cobj,age)]=th u(setq,origdamage,%q<damage>);@select/inline gt(%q<damage>,0)=1,{th u(setq,damage,u(setr,dnormdamage,fdiv(%q<damage>,add(1,fdiv(mul(first(get(%#/%q<atk>`DRIVE`QUEUE_TALLY)),2.4),100)))))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`NORMALIZE [u(cobj,age)]=@select/inline gt(%q<damage>,0)=1,{th u(setq,damage,u(setr,normdamage,round(add(u(setr,yfac,mul(get(%#/D`COMBAT`HEALTH`ORIGINAL),u(cust,ATTACKS,%q<atklevel>`PERCENTAGE))),fdiv(sub(%q<damage>,%q<yfac>),u(cust,CORE,NORMALIZE))),0)))}

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGE [u(cobj,age)]=th u(setq,xconorig,u(cust,ATTACKS,%q<atklevel>));th u(setr,damage,u(setr,preflux,mul(u(cust,CORE,BASEDAMAGE),%q<damagemod>,add(%q<xconorig>,u(ladd,%q<xcon>)),%q<hitmul>)));th u(setq,fudge,add(1.0,u(setr,flux,mul([if(rand(0,1),-,)]1,0.[rjust(rand(0,u(cust,CORE,FUDGESCATTER)),2,0)]))));th u(setr,startdamage,u(setr,damage,floor(mul(add(%q<damage>,%q<adamage>),%q<fudge>))));th u(setq,incdamagemul,1.0)

&INC`COMBAT`DEFEND`MAIN`CALCULATE`DAMAGE`MULTIPLIERS [u(cobj,age)]=

&INC`COMBAT`DEFEND`MAIN`STRIKE [u(cobj,age)]=th u(setq,boss,strmatch(get(%#/D`COMBAT`MODE),BOSS));@attach %!/INC`ANNOUNCE=[ansi(hw,%n)] [ansi(118,get(u(cobj,agedb)/DEF`%q<def>`ACTION))] against [ansi(hw,name(%q<atker>))]! [ansi(118,if(%q<hitmul>,if(gte(%q<hitmul>,1.0),A Critical Hit![u(setq,htype,CRITICAL)],if(gte(%q<hitmul>,0.7),A Solid Hit![u(setq,htype,SOLID)],A Close Call![u(setq,htype,CLOSE)])),It Missed![u(setq,htype,MISS)]))];@attach %!/INC`ANNOUNCE=[u(u(cobj,agedb)/DEF`%q<def>`%q<htype>,%q<atklevel>,ansi(hw,%n),ansi(hw,name(%q<atker>)),ansi(,u(u(cobj,agedb)/OFF`[get(%#/%q<atk>`OFF)]`DESCRIPTION,%q<atklevel>)))]%B[ansi(226,%q<damage>)] [ansi(hw,damage)]![if(%q<dot>,%B[ansi(hr,%q<dot>)] more from Damage over Time!)];@attach %!/INC`DAMAGE=%#,u(setr,fulldamage,add(%q<damage>,%q<dot>)),Normal Combat,,1;@select/inline gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=1,{@attach %!/INC`ANNOUNCE=[ansi(hr,%n has been defeated!)]};th u(setq,trgbons,iter(0 1 2 3,u(calcstatmod,%#,%i0,DEFENSE,%q<def>,1)));

&INC`COMBAT`DEFEND`MAIN`ENDTURN [u(cobj,age)]=&D`COMBAT`HISTORY`LAST_DEF_CHOICE %#=%q<def>;th u(addto,%#,D`COMBAT`NUMBERS`TIMES_DEFENDED,1);th u(setq,driveexempt,add(5,u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,BONUS`DRIVE_GAIN`EXEMPT)))));@attach %!/INC`DRIVE=%#,u(setr,passivedrive,add(get(%#/D`COMBAT`DRIVE`GAIN),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,BONUS`DRIVE_GAIN))))),PASSIVE GAIN,,,,,1;@attach %!/INC`HYPE=%#,u(setr,passivehype,add(get(%#/D`COMBAT`HYPE`GAIN),u(ladd,iter(get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE),u(getstatus,%#,%i0,DEFENSE,BONUS`HYPE_GAIN))))),PASSIVE GAIN,,,,,1;@attach %!/INC`EANNOUNCE=PASSIVE GAIN,ansi(h,%n) [if(strmatch(%q<passivedrive>,-*),lost,gained)] [ansi(hg,%q<passivedrive>)] Drive and [if(strmatch(%q<passivehype>,-*),lost,gained)] [ansi(hg,%q<passivehype>)] Hype!;th u(attrib_set,%#,D`COMBAT`HISTORY`LAST_SUFFERED_HITMUL,%q<hitmul>);th u(attrib_set,%#,D`COMBAT`HISTORY`LAST_SUFFERED_DAMAGE,%q<damage>);@select/inline t(u(setr,fifo_damage,bound(if(gt(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH)),sub(%q<fulldamage>,sub(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))),%q<fulldamage>),0)))=1,{@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`TAGS`FIFO_DAMAGE)={@attach %!/STATUS`[before(##,$)]`ON_FIFO_DAMAGE=%#,##,%q<damage>;th u(attrib_set,%#,D`COMBAT`STATUS`##`FIFO_DAMAGE,linsert(get(%#/D`COMBAT`STATUS`##`FIFO_DAMAGE),-1,%q<fifo_damage>))}};@dolist/inline edit(lattr(%0/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_PRE_BONUS=%#,%i0};@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_END_TURN=%#,%i0};@dolist/inline get(%#/%q<atk>`ACTIVE`STATUS`ATTACK)={@attach %!/STATUS`[before(%i0,$)]`ATTACK_ON_DEFENSE_ENDTURN=%#,%i0};@attach %!/INC`COMBAT`DEFEND`MAIN`ENDTURN`STATUS=%#;@dolist/inline get(%#/D`COMBAT`ACTIVE`STATUS`DEFENSE)={@attach %!/STATUS`[before(%i0,$)]`DEFENSE_FINAL_ENDTURN=%#,%i0};@select/inline u(setr,ftb,cand(not(get(%#/D`COMBAT`NO_FIRST_BONUS)),eq(get(%#/D`COMBAT`NUMBERS`TIMES_DEFENDED),get(%#/D`COMBAT`OPPONENTS)),not(get(%#/D`COMBAT`NUMBERS`TIMES_ATTACKED))))=1,{@attach %!/INC`DRIVE=%#,mul(25,get(%#/D`COMBAT`OPPONENTS)),FIRST TURN BONUS,,,,1;th u(setq,driveexempt,add(%q<driveexempt>,mul(25,get(%#/D`COMBAT`OPPONENTS))))};&D`COMBAT`HYPE`USED %#=0;&D`COMBAT`SELL %#=0;&D`COMBAT`HARDSELL %#=0;@attach %!/WIPE=%#,D`COMBACK;th u(attrib_set,%#,D`COMBAT`DRIVE`QUEUE_TALLY,linsert(get(%#/D`COMBAT`DRIVE`QUEUE_TALLY),-1,bound(sub(get(%#/D`COMBAT`DRIVE),%q<defstartdrive>,%q<driveexempt>),0)))

&INC`COMBAT`DEFEND`MAIN`ENDTURN`STATUS [u(cobj,age)]=@dolist/inline/nobreak u(setr,sall,get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE))={th u(addto,%0,D`COMBAT`STATUS`%i0`INCREMENT,1);@select/inline u(setr,srem,get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS))=X,{},>0,{th u(attrib_set,%0,D`COMBAT`STATUS`%i0`DEFENSE_TURNS,sub(%q<srem>,1));@stop get(%0/D`COMBAT`STATUS`%i0`DEFENSE_TURNS);th u(attrib_set,%0,D`COMBAT`ACTIVE`STATUS`DEFENSE,setdiff(get(%0/D`COMBAT`ACTIVE`STATUS`DEFENSE),%i0));@stop cor(strmatch(get(%0/D`COMBAT`STATUS`%i0`ATTACK_TURNS),X),gt(u(lmax,iter(ATTACK DEFENSE,get(%0/D`COMBAT`STATUS`%i1`%i0_TURNS))),0));@attach %!/KILLSTATUS=%0,%i0}};

&INC`COMBAT`DEFEND`MAIN`DEBUG [u(cobj,age)]=th u(setq,testers,u(filter,TESTER,lplayers(%l)));@pemit/list %q<testers>=u(setr,deboutput,center(Debug: [ansi(hw,%n)] defending against [ansi(hw,name(%q<atker>))],78,ansi(hm,=))%R[align(22 1. 53,Stats: Pow End Pre Mit%RAtker: [iter(0 1 2 3,ljust(u(colorstat,%i0,round(u(calcstat`atk,%#,%q<atk>,%i0),0)),3))]%RBonus: [iter(0 1 2 3,ljust(u(colorstat,%i0,get(%#/%q<atk>`STATS`%i0`MOD)),3))]%RDfder: [iter(0 1 2 3,ljust(u(colorstat,%i0,u(calcstat,%#,%i0)),3))]%RBonus: [iter(%q<trgbons>,ljust(u(colorstat,sub(inum(0),1),%i0),3))],|%R,Roll: %q<roll> | AccMod: %q<accuracymod> | DmgMod: %q<damagemod>%RBtrack: %q<tmode> | Hitmul: %q<hitmul> | Flux: %q<flux>%RXCON: %q<xconorig> + \([iter(%q<xcon>,%i0,%b,%b+%b)]\)%RRawDmg: [round(%q<preflux>,2)] | DrvDmg: [sub(%q<origdamage>,%q<dnormdamage>)] | NrmDmg: [sub(%q<dnormdamage>,%q<normdamage>)] | FinDmg: %q<damage> | Balance: [u(cust,CORE,BALANCE)]%RFunction Calls: %?[if(gt(%q<atkopp>,1),%RAttacker [ansi(hr,Boss)] [ansi(hy,%q<atkopp>)]: %q<atkbosspredam> * (%q<atkbossdmgmul> * %q<atkbosssqrt>) = %q<atkbosspostdam>)][if(gt(%q<defopp>,1),%RDefender [ansi(hr,Boss)] [ansi(hy,%q<defopp>)]: %q<defbosspredam> * (%q<defbossdefmul> / %q<defbosssqrt>) = %q<defbosspostdam>)])]%R[center(Lvl %q<atklevel> [u(u(cobj,agedb)/OFF`[get(%#/%q<atk>`OFF)],%q<atklevel>)] Atk VS [u(u(cobj,agedb)/DEF`%q<def>,%q<atklevel>)] Def,78,ansi(hm,=))]);@nscemit/noisy ***Combat System***=[ansi(hw,%n)] defending against [ansi(hw,name(%q<atker>))]%R%q<deboutput>;@attach %!/WIPE=%#,%q<atk>;@select/inline nattr(%#/D`COMBAT`Q`*)=0,{@attach %!/INC`CPTREE=%#,D`COMBAT,%#,D`COMBACK};

@@ &INC`COMBAT`DEFEND`MAIN`DEBUG [u(cobj,age)]=th u(setq,testers,u(filter,TESTER,lplayers(%l)));@pemit/list %q<testers>=u(setr,deboutput,center(Debug - %?,78,ansi(hm,=))%R[align(3 11 11 11 11 7 7 1 7,Rll,SrcStats,SrcBons,TrgStats,TrgBons,Acc,Dmg,B,HitChk)]%R[align(3 11 11 11 11 7 7 1 7,%q<roll>,iter(0 1 2 3,u(colorstat,%i0,round(u(calcstat`atk,%#,%q<atk>,%i0),0)))%R[iter(0 1 2 3,u(colorstat,%i0,round(r(bastat%i0),0)))],iter(0 1 2 3,u(colorstat,%i0,get(%#/%q<atk>`STATS`%i0`MOD))),iter(0 1 2 3,u(colorstat,%i0,u(calcstat,%#,%i0)))%R[iter(0 1 2 3,u(colorstat,%i0,round(r(bdstat%i0),0)))],iter(%q<trgbons>,u(colorstat,sub(inum(0),1),%i0)),%q<accuracymod>,%q<damagemod>,%q<tmode>,%q<hitmul>)]%R[center(StaticDam: [round(%q<preflux>,2)] - Flux: %q<flux> - XCON: %q<xconorig> + \([iter(%q<xcon>,%i0,%b,%b+%b)]\),78,ansi(hm,-))]%R[center(OrigDamage: %q<origdamage> - DriveDam: [sub(%q<origdamage>,%q<dnormdamage>)] - Normalize: [sub(%q<dnormdamage>,%q<normdamage>)],78,ansi(hm,-))][if(gt(%q<atkopp>,1),%R[center(Attacker [ansi(hr,Boss)] [ansi(hy,%q<atkopp>)]: %q<atkbosspredam> * (%q<atkbossdmgmul> * %q<atkbosssqrt>) = %q<atkbosspostdam>,78,ansi(hm,-))])][if(gt(%q<defopp>,1),%R[center(Defender [ansi(hr,Boss)] [ansi(hy,%q<defopp>)]: %q<defbosspredam> * (%q<defbossdefmul> / %q<defbosssqrt>) = %q<defbosspostdam>,78,ansi(hm,-))])]);@nscemit/noisy ***Combat System***=[ansi(hw,%n)] defending against [ansi(hw,name(%q<atker>))]%R%q<deboutput>;@attach %!/WIPE=%#,%q<atk>;@select/inline nattr(%#/D`COMBAT`Q`*)=0,{@attach %!/INC`CPTREE=%#,D`COMBAT,%#,D`COMBACK}

&COLORSTAT [u(cobj,age)]=ansi(switch(%0,0,hr,1,hg,2,hy,3,hc,h),%1)

th u(setq,colorstats,ansi(hr,0) [ansi(hg,1)] [ansi(hy,2)] [ansi(hc,3)]);

&FIL`TESTER [u(cobj,age)]=cand(u(tester,%0),get(%0/D`MATRIX),hasflag(%0,CONNECTED))

&OVEREXERT [u(cobj,age)]=localize(u(setq,origdamage,mul(get(%0/D`COMBAT`DRIVE`EXHAUSTION_MULTIPLIER),u(cust,DRIVES,[get(%0/D`COMBAT`DRIVE`STATUS)]`DAMAGE)))[if(u(setr,maxcap,lmath(min,filterbool(#lambda/gt(\%0,0),iter(get(%0/D`COMBAT`ACTIVE`STATUS`ATTACK),u(getstatus,%0,%i0,ATTACK,OVEREXERT_MAX_PERCENTAGE))))),min(%q<maxcap>,%q<origdamage>),%q<origdamage>)])

@@ PUSH CODE
&INC`COMBAT`PUSH`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready.;@stop gte(get(%#/D`COMBAT`DAMAGE),get(%#/D`COMBAT`HEALTH))=@attach %!/INC`MSG=ERROR: The defeated can do no such thing!;@check strlen(%0)=@attach %!/INC`MSG=ERROR: No Push entered to activate.;@check strlen(u(setr,push,u(FIND_MULTI,PUSH,%0)))=@attach %!/INC`MSG=ERROR: Push not found!;@stop gt(words(%q<push>),1)=@attach %!/INC`MSG=ERROR: That matches Pushes: [iter(%q<push>,get(u(cobj,agedb)/PUSH`%i0),%b,\,%b)]. Please be more specific.;@select/inline words(u(setr,hypecost,get(u(cobj,agedb)/PUSH`%q<push>`CHOICES)),|)=>1,{@check strlen(%1)=@attach %!/INC`MSG=ERROR: No cost chosen!;@attach %!/INC`PARTIAL=%1,%q<hypecost>,|,hypecost};@check gte(u(setr,starthype,get(%#/D`COMBAT`HYPE)),%q<hypecost>)=@attach %!/INC`MSG=ERROR: Not enough Hype!;@attach [u(cobj,agedb)]/PUSH`%q<push>`ACTIVATE=%#,%2,%q<hypecost>;th u(addto,%#,D`COMBAT`HYPE,mul(-1,%q<hypecost>));th u(setq,afterhype,get(%#/D`COMBAT`HYPE));@attach %!/INC`ANNOUNCE=[if(gt(%q<boss>,1),ansi(hr,<BOSS-%q<boss>>%B))][ansi(hw,%n)] uses a [ansi(118,Push)]!;@attach %!/INC`EPRIVATE=PUSH,You used [ansi(118,Push)]: [get(u(cobj,agedb)/PUSH`%q<push>)];th u(setq,testers,u(filter,TESTER,lplayers(%l)));@attach %!/INC`DEBUG=PUSH,%n used: [get(u(cobj,agedb)/PUSH`%q<push>)][if(%q<pushchoice>,%B\(%q<pushchoice>\))];@dolist/inline edit(lattr(%#/D`COMBAT`STATUS`*),D`COMBAT`STATUS`,)={@attach %!/STATUS`[before(%i0,$)]`PUSH_ON_ACTIVATE=%#,%i0,%q<push>,%q<statid>};th u(addto,%#,D`COMBAT`HYPE`USED,%q<hypecost>)


&INC`COMBAT`PUSH`LIST [u(cobj,age)]=@pemit %#=u(header,Available Pushes);@dolist/inline u(sortattr,u(lattr,u(cobj,agedb)/PUSH`*))={@pemit %#=u(separator,get(u(cobj,agedb)/%i0));@dolist/inline/delimit | [get(u(Cobj,agedb)/%i0`CHOICES)]={@pemit %#=[ansi(h,%i0 Hype:)]%B[get(u(cobj,agedb)/%i1`%i0)]}};@pemit %#=u(footer)

&INC`HEAL [u(cobj,age)]=&D`COMBAT`DAMAGE %0=bound(sub(get(%0/D`COMBAT`DAMAGE),u(setr,regain,%1)),0,get(%0/D`COMBAT`HEALTH));@select/inline not(%3)=1,{@attach %!/INC`ANNOUNCE=[name(%0)] gained %1 Health from: %2},0,{@attach %!/INC`EANNOUNCE=%3,%4}

@@ QUEUE CODE
&INC`COMBAT`QUEUE`MAIN [u(cobj,age)]=@check nattr(%#/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: You are not combat ready. Make sure your Pilot/Mecha are set and use +reset.;@check nattr(%#/D`COMBAT`Q`**)=@attach %!/INC`MSG=ERROR: You have no incoming attacks to deal with!;@pemit %#=u(header,Combat Queue);@pemit %#=ansi(u(color,%#,COLOR,COLUMN_NAMES),align(17 18 1 10 15 12,Source,Name,L,Type,Mechanism,Effect));@pemit %#=u(separator);@dolist/inline sortkey(#lambda/get(%#/\%0`TIMESTAMP),lattr(%#/D`COMBAT`Q`*))={@pemit %#=align(17 18 1 10 15 12,u(getmoniker,last(%i0,`)),get(%#/%i0),switch(get(%#/%i0`LEVEL),>9,S,get(%#/%i0`LEVEL)),default(%!/TYPE`[get(%#/%i0`TYPE)],<unknown>),default(%!/MECHANISM`[get(%#/%i0`MECHANISM)],<unknown>)%b\([if(match(1 2 6,get(%#/%i0`MECHANISM)),Mel,Rng)]\),iter(get(%#/%i0`EFFECTS),default(%!/EFFECT`%i0,<unknown>)))};@pemit %#=u(footer)

@@ HEALTH CODE
&INC`COMBAT`HEALTh`MAIN [u(cobj,age)]=@attach %!/INC`CHECKPC=u(strfirstof,%0,%#),1;@check nattr(%q<t1>/D`COMBAT`**)=@attach %!/INC`MSG=ERROR: %q<t1name> is not readied for battle.;@pemit %#=u(header,%q<t1name> - Health);@select/inline strmatch(%q<t1>,%#)=1,{@attach %!/INC`COMBAT`STATS`DISPLAY};@pemit %#=u(subheader,Effects);@pemit %#=align(1. 36 1. 37 1.,ansi(u(color,%#,BORDER),|),center(ansi(g,Attack Effects),36)[u(trimlines,%R[u(FUN`LIST_STATUS,%q<t1>,ATTACK)])],ansi(u(color,%#,BORDER),|),center(ansi(g,Defense Effects),37)[u(trimlines,%R[u(FUN`LIST_STATUS,%q<t1>,DEFENSE)])],ansi(u(color,%#,BORDER),|));@pemit %#=u(footer)

&FUN`LIST_STATUS [u(Cobj,age)]=iter(sortkey(#lambda/get(%!/STATUS`\[before(\%0,$)\]),u(filter,DISPLAY,get(%0/D`COMBAT`ACTIVE`STATUS`%1),%b,%b,%0,%1),i),\([get(%0/D`COMBAT`STATUS`%i0`%1_TURNS)]\)%B[ansi(hw,\[[ucstr(get(%0/D`COMBAT`STATUS`%i0))]\])] - [u(%!/STATUS`[before(%i0,$)]`DESCRIPTION,%0,%i0)][if(strlen(u(setr,intensity,u(STATUS`[before(%i0,$)]`CURE`INTENSITY,%0,%i0))),%b\(%q<intensity>\))],%b,%r)

&FIL`DISPLAY [u(cobj,age)]=t(match(get(%!/STATUS`[before(%0,$)]`TAGS),DISPLAY))

@@ @pemit %#=ACTIVE BOOSTS: [itemize(iter(get(%#/D`COMBAT`ACTIVE_BOOSTS),default(%!/BOOST`[u(setr,id,before(%i0,~))],<unset>)%b\([add(u(getstat,%#,D`COMBAT`ACTIVE_BOOSTS`ATTACK,%q<id>),0)]/[add(u(getstat,%#,D`COMBAT`ACTIVE_BOOSTS`DEFENSE,%q<id>),0)]\),%b,|),|,and,\,)];@pemit %#=ACTIVE EFFECTS: [itemize(iter(get(%#/D`COMBAT`ACTIVE_EFFECTS),default(%!/EFFECT`[u(setr,id,before(%i0,~))],<unset>)%b\([add(u(getstat,%#,D`COMBAT`ACTIVE_EFFECTS`ATTACK,%q<id>),0)]/[add(u(getstat,%#,D`COMBAT`ACTIVE_EFFECTS`DEFENSE,%q<id>),0)]\),%b,|),|,and,\,)];@pemit %#=u(footer)



@@ +bbpost 6/CSYS: Character Editor=The commands [ansi(h,+select\, +view\, +create\, +delete\, +add\, +remove\, +set\, +mode)] are the core of the Combat System editor. It works on the following principle:%R%RWhen you [ansi(h,+select)] something, this becomes your focus point, or +mode. Selecting a PLAYER with [ansi(h,+select player=<playername>)] will initialize them for the combat system, create a DEFAULT PILOT if they don't have one already, and put you in Player/Pilot Mode. (If they already HAVE a pilot, you will then need to [ansi(h,+select pilot=<pilot name or id>)] to target that.)%R%RWhile in Player/Pilot mode, the [ansi(h,+create)] command can be used to [ansi(h,+create pilot=<new pilot name>)] or [ansi(h,+create mecha=<new mecha name>)], which will shift your focus.%R%RShifting to MECHA MODE allows for [ansi(h,+create attack=<attack name>)].%R%RSimilarly, in each mode the functions of the +add, +remove, and +set commands change. For PILOT and MECHA mode, +set will let you target things like name, agi, mel, and similar properties. For example, [ansi(h,+set agi=60)]. Changes are saved immediately, but will only be reflected on players using it when they +reset.%R%RIn PLAYER or MECHA mode, the +add and +remove commands can be used to add/remove ABILITIES or BOOSTS. In ATTACK mode, it can only be used for Effects. The full list of available traits is on the csys design document, I'm not gonna list it here. Example: [ansi(h,+add abil=Attacker)]%R%RA more comprehensive guide will be written in the future, but I expect this to be intuitive enough for you guys to experiment.%R%R[ansi(hr,FOR NOW)] I have created a character called [ansi(h,MP-Holder)]. While I haven't quite worked out all the commands for handling MP Mecha and Generic Pilots, please feel free to create various pilot and mech builds on this guy. When we're ready I can mass-assign whatever's on him as generic/mp stuff for everyone to test.

@@ +bbpost 6/CSYS: Combat Commands=[ansi(h,+reset)] to get ready for combat! This will clear EVERYTHING right now. Sorry, switching pilots and mechas mid-flight isn't currently supported, although it won't be hard to add that in either. I mean you can, but you're starting the fight fresh. Not fair.%R%R[ansi(h,+boost <name>)] to activate a boost. They're listed in +stats.%R%R[ansi(h,+free <name>=<level> <type> <mechanism>)] to set a Free attack. /rem and /clear haven't been implemented yet, but entering the same name will overwrite the old entry. Free attacks are bound to your mecha and switch accordingly.%R%R[ansi(h,+attack <player>=<attack name>)] - Attack someone. You can (untested) use [ansi(h,+attack <player1>\,<player2>,\,<player3>\,...=<attack name>)] for multi-targeting. In theory.%R%R[ansi(h,+defend <attacker>=<response>)]. Where response is AVOID, BLOCK, STEADY, VENT, ALLOW, or SURRENDER.%R%RKNOWN ISSUES:%RA: There's currently no health display anywhere. Or active buffs/debuffs.%RB: Or an incoming attack display.%RC: Boss modes haven't been implemented yet.
@@ +bbpost 6/CSYS: Approval Commands=[ansi(hc,Player Commands)]%R[ansi(h,+submit <thing>)] to submit a designed Mecha or Pilot for approval. Once submitted they cannot be modified except by admin.%R%R[ansi(hc,Admin Commands)]%R[ansi(h,+set approved=<0 or 1>)] - This is to be used when you've used the character editor and selected the relevant mecha/pilot. Setting it to 0 clears the pending review and returns it to unapproved. Setting to 1 marks it approved so players can use it.%R[ansi(h,+key/add Csys=<player>)] - adds a player to the Csys Tester list. (see below.) Use +key/rem csys=<name> to revoke tester abilities.%R%RTesters can use unapproved mechs/pilots and can toggle on/off debug displays.%R%R[ansi(hc,Tester Commands)]%R[ansi(h,+matrix)] - This command toggles on/off the debug display. Only usable by admin and Csys Testers.
